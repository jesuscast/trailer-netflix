(function(){function r(c,f){return new Promise(function(d,b){function h(b){"https://assets.nflxext.com"==b.origin&&b.source==a.contentWindow&&"ready"==b.data&&(window.clearTimeout(l),window.removeEventListener("message",h),window.addEventListener("message",m),d(a))}var a=document.createElement("iframe");a.setAttribute("src",c);a.setAttribute("style","display:none");a.height=1;a.width=1;var l=window.setTimeout(function(){window.removeEventListener("message",h);document.body.removeChild(a);b(Error("timeout waiting for iframe to load"))},
f);window.addEventListener("message",h);document.body.appendChild(a)})}function n(l,g){return f.then(function(f){return new Promise(function(b,h){var a={cmd:l,msgId:++c,arguments:g};d.push({msgId:a.msgId,handler:function(a){a=a.data;a.success?b(a.result):h(Error("crypto-iframe error: "+a.result))}});f.contentWindow.postMessage(a,"https://assets.nflxext.com")})})}function m(c){for(var f,l=d.length;l--&&d[l].msgId!==c.data.msgId;);(f=0>l)||(f=c.data,f=!("https://assets.nflxext.com"===c.origin&&f&&f.hasOwnProperty("success")&&
f.hasOwnProperty("result")&&f.hasOwnProperty("msgId")));f||(f=d[l].handler,d.splice(l,1),f(c))}var l=navigator.userAgent.match(/Chrome\/([0-9]*)/);if(l&&37<=parseInt(l[1])){var c=0,d=[],f=(new Promise(function(c){function f(){document.removeEventListener("DOMContentLoaded",f);c()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):c()})).then(function(){return r("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",2E3)}).catch(function(){return r("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",
8E3)}),g={subtle:{}};window.crypto.getRandomValues&&(g.getRandomValues=function(c){return window.crypto.getRandomValues(c)});"encrypt decrypt sign verify digest generateKey deriveKey deriveBits importKey exportKey wrapKey unwrapKey".split(" ").map(function(c){g.subtle[c]=function(){return n(c,Array.prototype.slice.call(arguments))}});window.nfCrypto=g}})();
(function(r,n){var m;function l(a,b){if(!b||"utf-8"===b)return d(a);throw Error("unsupported encoding");}function c(a,b){if(!b||"utf-8"===b)return f(a);throw Error("unsupported encoding");}function d(a){for(var b=0,c,f=a.length,h="";b<f;){c=a[b++];if(c&128)if(192===(c&224))c=((c&31)<<6)+(a[b++]&63);else if(224===(c&240))c=((c&15)<<12)+((a[b++]&63)<<6)+(a[b++]&63);else throw Error("unsupported character");h+=String.fromCharCode(c)}return h}function f(a){var b=a.length,c;c=0;var f,h=0,l;for(f=b;f--;)l=
a.charCodeAt(f),128>l?c++:c=2048>l?c+2:c+3;c=new Uint8Array(c);for(f=0;f<b;f++)l=a.charCodeAt(f),128>l?c[h++]=l:(2048>l?c[h++]=192|l>>>6:(c[h++]=224|l>>>12,c[h++]=128|l>>>6&63),c[h++]=128|l&63);return c}function g(a,b){if(a===b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0}function t(a){if(!(a&&a.constructor==Uint8Array||Array.isArray(a)))throw new TypeError("Cannot compute the hash code of "+a);for(var b=1,c=0;c<a.length;++c){var f=a[c];
if("number"!==typeof f)throw new TypeError("Cannot compute the hash code over non-numeric elements: "+f);b=31*b+f&4294967295}return b}function k(a,b){if(a===b)return!0;if(!a||!b)return!1;b instanceof Array||(b=[b]);for(var c=0;c<b.length;++c){for(var f=b[c],h=!1,l=0;l<a.length;++l){var d=a[l];if(f.equals&&"function"===typeof f.equals&&f.equals(d)||f==d){h=!0;break}}if(!h)return!1}return!0}function u(a,b){return k(a,b)&&(a.length==b.length||k(b,a))}function b(a,b,c){var f;c&&(f=c);if("object"!==typeof a||
"function"!==typeof a.result||"function"!==typeof a.error)throw new TypeError("callback must be an object with function properties 'result' and 'error'.");try{var h=b.call(f,a);h!==n&&a.result(h)}catch(l){try{a.error(l)}catch(d){}}}function h(a,c,f){if("object"!==typeof a||"function"!==typeof a.timeout)throw new TypeError("callback must be an object with function properties 'result', 'timeout', and 'error'.");b(a,c,f)}function a(a,b,c){1E5>a&&(a=1E5+a);Object.defineProperties(this,{internalCode:{value:a,
writable:!1,configurable:!1},responseCode:{value:b,writable:!1,configurable:!1},message:{value:c,writable:!1,configurable:!1}})}function w(a){switch(a){case za.PSK:case za.MGK:return!0;default:return!1}}function y(a){switch(a){case za.PSK:case za.MGK:case za.X509:case za.RSA:case za.NPTICKET:case za.ECC:return!0;default:return!1}}function q(a){return a.toJSON()}function p(b,c){Kc?c.result(Kc):Promise.resolve().then(function(){return wa.getKeyByName(b)}).catch(function(){return wa.generateKey({name:b},
!1,["wrapKey","unwrapKey"])}).then(function(a){Kc=a;c.result(Kc)}).catch(function(b){c.error(new C(a.INTERNAL_EXCEPTION,"Unable to get system key"))})}function x(a,b){var c=b.masterToken,f=b.userIdToken,h=b.serviceTokens;return{NccpMethod:a.nccpMethod,UserId:a.userId,UT:f&&f.serialNumber,MT:c&&c.serialNumber+":"+c.sequenceNumber,STCount:h&&h.length}}function A(a){return a.uniqueKey()}function F(c,f,h,d){function g(a,c,f){var h=[];(function ec(){a.read(-1,c,{result:function(a){b(f,function(){if(a)h.push(a),
ec();else switch(h.length){case 0:return new Uint8Array(0);case 1:return h[0];default:var b,c,f,l=h.length,d=0;for(c=b=0;c<l;c++)b+=h[c].length;b=new Uint8Array(b);for(c=0;c<l;c++)f=h[c],b.set(f,d),d+=f.length;return b}})},timeout:function(){f.timeout()},error:function(a){f.error(a)}})})()}function k(){d.getStoreState({result:function(a){if(a)for(var b=q.slice(),c=0;c<b.length;c++)b[c]({storeState:a})},timeout:function(){c.error("Timeout getting store state",""+e)},error:function(a){c.error("Error getting store state",
""+a)}})}var q=[];this.addEventHandler=function(a,b){switch(a){case "shouldpersist":q.push(b)}};this.send=function(q,p){var n=q.timeout,r=new qe(c,h,q,d.getKeyRequestData()),t=q.httpLocation,m=q.serviceTokens;c.trace("Sending MSL request",{NccpMethod:q.nccpMethod});f.request(h,r,new yd(t),n,{result:function(f){b(p,function(){var h=f&&f.getMessageHeader(),d=h&&h.serviceTokens||[];c.trace("Received MSL response",{NccpMethod:q.nccpMethod},d.map(A).join("\n"));if(!f)throw new C(a.INTERNAL_EXCEPTION,"Null response stream");
q.allowTokenRefresh&&k();if(h=f.getErrorHeader())p.error(h);else{var r={};d.forEach(function(a){r[a.name]=a});m&&m.forEach(function(a){r[a.name]||d.push(a)});d=d.filter(function(a){return hf[a.name]&&!a.isDeleted()});g(f,n,{result:function(a){b(p,function(){return{body:l(a),serviceTokens:d}})},timeout:function(){p.timeout()},error:function(a){p.error(a)}})}})},timeout:function(){p.timeout()},error:function(a){p.error(a)}})};this.hasUserIdToken=function(a){return!!d.getUserIdToken(a)};this.removeUserIdToken=
function(a){if(a=d.getUserIdToken(a))d.removeUserIdToken(a),k()};this.isErrorReauth=function(a){return a&&a.errorCode==v.USERDATA_REAUTH};this.isErrorHeader=function(a){return a instanceof Mc};this.getErrorCode=function(a){return a&&a.errorCode};this.getStateForMdx=function(a){var b=d.getMasterToken();a=d.getUserIdToken(a);var c=d.getCryptoContext(b);return{masterToken:b,userIdToken:a,cryptoContext:c}};this.buildPlayDataRequest=function(a,b){var l=new re;f.request(h,new qe(c,h,a),l,a.timeout,{result:function(){b.result(l.getRequest())},
error:function(){b.result(l.getRequest())},timeout:function(){b.timeout()}})}}function D(b,c,f,h,l,d){function g(c){var f;return Promise.resolve().then(function(){f=b.authenticationKeyNames[c];if(!f)throw new C(a.KEY_IMPORT_ERROR,"Invalid config keyName "+c);return wa.getKeyByName(f)}).then(function(b){return new Promise(function(c,h){xc(b,{result:c,error:function(){h(new C(a.KEY_IMPORT_ERROR,"Unable to create "+f+" CipherKey"))}})})}).catch(function(b){throw new C(a.KEY_IMPORT_ERROR,"Unable to import "+
f,b);})}return Promise.resolve().then(function(){if(!wa.getKeyByName)throw new C(a.INTERNAL_EXCEPTION,"No WebCrypto cryptokeys");return Promise.all([g("e"),g("h"),g("w")])}).then(function(a){var g={};g[c]=new f(b.esn,a[0],a[1],a[2]);a=new h(b.esn);var k=new zg,k=[new l(k)],q=new d(c);return{entityAuthFactories:g,entityAuthData:a,keyExchangeFactories:k,keyRequestData:q}})}function B(b,c,f){function h(){return Promise.resolve().then(function(){return wa.generateKey(c,!1,["wrapKey","unwrapKey"])}).then(function(a){return l(a.publicKey,
a.privateKey)})}function l(b,c){return Promise.all([new Promise(function(c,f){yc(b,{result:c,error:function(b){f(new C(a.INTERNAL_EXCEPTION,"Unable to create keyx public key",b))}})}),new Promise(function(b,f){Nc(c,{result:b,error:function(b){f(new C(a.INTERNAL_EXCEPTION,"Unable to create keyx private key",b))}})})]).then(function(a){a=new zd("rsaKeypairId",f,a[0],a[1]);d&&(a.storeData={keyxPublicKey:b,keyxPrivateKey:c});return a})}var d=!b.systemKeyWrapFormat;return Promise.resolve().then(function(){var a=
b.storeState,c=a&&a.keyxPublicKey,a=a&&a.keyxPrivateKey;return d&&c&&a?l(c,a):h()}).then(function(a){var c={};c[za.NONE]=new Ag;var f=new Ad(b.esn),l=[new jf];return{entityAuthFactories:c,entityAuthData:f,keyExchangeFactories:l,keyRequestData:a,createKeyRequestData:d?h:n}})}var H=r.nfCrypto||r.msCrypto||r.webkitCrypto||r.crypto,E=H&&(H.webkitSubtle||H.subtle),J=r.nfCryptokeys||r.msCryptokeys||r.webkitCryptokeys||r.cryptokeys;(function(a){var b=function(){function a(c,f){c instanceof b?(this.abv=c.abv,
this.position=c.position):(this.abv=c,this.position=f||0)}a.prototype={readByte:function(){return this.abv[this.position++]},writeByte:function(a){this.abv[this.position++]=a},peekByte:function(a){return this.abv[a]},copyBytes:function(a,b,c){var f=new Uint8Array(this.abv.buffer,this.position,c);a=new Uint8Array(a.buffer,b,c);f.set(a);this.position+=c},seek:function(a){this.position=a},skip:function(a){this.position+=a},getPosition:function(){return this.position},setPosition:function(a){this.position=
a},getRemaining:function(){return this.abv.length-this.position},getLength:function(){return this.abv.length},isEndOfStream:function(){return this.position>=this.abv.length},show:function(){var a;return a="AbvStream: pos "+(this.getPosition().toString()+" of "+this.getLength().toString())}};return a}(),c={};(function(){function a(b,c){c.writeByte(b.tagClass<<6|b.constructed<<5|b.tag);var f=b.payloadLen;if(128>f)c.writeByte(f);else{for(var h=f,l=0;h;)++l,h>>=8;c.writeByte(128|l);for(h=0;h<l;++h)c.writeByte(f>>
8*(l-h-1)&255)}if(b.child)for(b.tag==u.BIT_STRING&&c.writeByte(0),f=b._child;f;){if(!a(f,c))return!1;f=f.next}else switch(b.tag){case u.INTEGER:b.backingStore[b.dataIdx]>>7&&c.writeByte(0);c.copyBytes(b.backingStore,b.dataIdx,b.dataLen);break;case u.BIT_STRING:c.writeByte(0);c.copyBytes(b.backingStore,b.dataIdx,b.dataLen);break;case u.OCTET_STRING:c.copyBytes(b.backingStore,b.dataIdx,b.dataLen);break;case u.OBJECT_IDENTIFIER:c.copyBytes(b.backingStore,b.dataIdx,b.dataLen)}return!0}function f(a){var b=
a.readByte(),c=b&127;if(c==b)return c;if(3<c||0===c)return-1;for(var h=b=0;h<c;++h)b=b<<8|a.readByte();return b}function h(a,c,l){var d=a.backingStore,g=new b(d,c);c+=l;l=a;var k,q,p;if(8<y++)return n;for(;g.getPosition()<c;){g.getPosition();p=g.readByte();if(31==(p&31)){for(q=0;p&128;)q<<=8,q|=p&127;p=q}k=p;q=k&31;if(0>q||30<q)return n;p=f(g);if(0>p||p>g.getRemaining())return n;l.constructed=k&32;l.tagClass=(k&192)>>6;l.tag=q;l.dataLen=p;l.dataIdx=g.getPosition();q=g;var r=k;k=p;if(r&32)q=!0;else if(r<
u.BIT_STRING||r>u.OCTET_STRING)q=!1;else{var t=new b(q);r==u.BIT_STRING&&t.skip(1);t.readByte()>>6&1?q=!1:(r=f(t),q=t.getPosition()-q.getPosition()+r==k)}q&&(q=g.getPosition(),k=p,l.tag==u.BIT_STRING&&(l.dataIdx++,l.dataLen--,q++,k--),l.child=new Ga(d,l),h(l.child,q,k));l.tag==u.INTEGER&&(q=g.getPosition(),0==g.peekByte(q)&&g.peekByte(q+1)>>7&&(l.dataIdx++,l.dataLen--));g.skip(p);g.getPosition()<c&&(l.next=new Ga(d,l.parent),l=l.next)}y--;return a}function l(a,b,c){if(9!=c)return!1;for(c=0;9>c;++c)if(a[b++]!=
Ua[c])return!1;return!0}function d(a){if(!(a&&a.child&&a.child.next&&a.child.child&&a.child.next.child))return!1;var b=a.child.child;return l(b.backingStore,b.dataIdx,b.dataLen)&&2==a.nChildren&&2==a.child.nChildren&&2==a.child.next.child.nChildren?!0:!1}function g(a){if(!(a&&a.child&&a.child.next&&a.child.next.child&&a.child.next.next&&a.child.next.next.child))return!1;var b=a.child.next.child;return l(b.backingStore,b.dataIdx,b.dataLen)&&3==a.nChildren&&2==a.child.next.nChildren&&9==a.child.next.next.child.nChildren?
!0:!1}function k(a){var b=w.createSequenceNode(),c=new x(b);c.addChild(w.createSequenceNode());c.addChild(w.createOidNode(Ua));c.addSibling(w.createNullNode());c.addToParent(b,w.createBitStringNode(null));c.addChild(w.createSequenceNode());c.addChild(w.createIntegerNode(a.n));c.addSibling(w.createIntegerNode(a.e));return b}function q(a){a=a.child.next.child.child;var b=a.data;a=a.next;return new A(b,a.data,null,null)}function p(a){var b=w.createSequenceNode(),c=new x(b);c.addChild(w.createIntegerNode(new Uint8Array([0])));
c.addSibling(w.createSequenceNode());c.addChild(w.createOidNode(Ua));c.addSibling(w.createNullNode());c.addToParent(b,w.createOctetStringNode(null));c.addChild(w.createSequenceNode());c.addChild(w.createIntegerNode(new Uint8Array([0])));c.addSibling(w.createIntegerNode(a.n));c.addSibling(w.createIntegerNode(a.e));c.addSibling(w.createIntegerNode(a.d));c.addSibling(w.createIntegerNode(a.p));c.addSibling(w.createIntegerNode(a.q));c.addSibling(w.createIntegerNode(a.dp));c.addSibling(w.createIntegerNode(a.dq));
c.addSibling(w.createIntegerNode(a.qi));return b}function r(a){var b=[];a=a.child.next.next.child.child.next;for(var c=0;8>c;c++)b.push(a.data),a=a.next;return new v(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7])}function t(a,b,c,f){if(!(a instanceof A||a instanceof v))return n;if(c)for(var h=0;h<c.length;++h)if(-1==Bd.indexOf(c[h]))return n;b={kty:"RSA",alg:b,key_ops:c||[],ext:f==n?!1:f,n:G(a.n,!0),e:G(a.e,!0)};a instanceof v&&(b.d=G(a.d,!0),b.p=G(a.p,!0),b.q=G(a.q,!0),b.dp=G(a.dp,!0),b.dq=G(a.dq,!0),
b.qi=G(a.qi,!0));return b}function m(a){if(!a.kty||"RSA"!=a.kty||!a.n||!a.e)return n;var b="RSA1_5 RSA-OAEP RSA-OAEP-256 RSA-OAEP-384 RSA-OAEP-512 RS256 RS384 RS512".split(" ");if(a.alg&&-1==b.indexOf(a.alg))return n;b=[];a.use?"enc"==a.use?b=["encrypt","decrypt","wrap","unwrap"]:"sig"==a.use&&(b=["sign","verify"]):b=a.key_ops;var c=a.ext,f=L(a.n,!0),h=L(a.e,!0);if(a.d){var l=L(a.d,!0),d=L(a.p,!0),g=L(a.q,!0),k=L(a.dp,!0),q=L(a.dq,!0),p=L(a.qi,!0);return new v(f,h,l,d,g,k,q,p,a.alg,b,c)}return new A(f,
h,c,b)}function ua(a,b,c,f){this.der=a;this.type=b;this.keyOps=c;this.extractable=f}var u={BER:0,BOOLEAN:1,INTEGER:2,BIT_STRING:3,OCTET_STRING:4,NULL:5,OBJECT_IDENTIFIER:6,OBJECT_DESCRIPTOR:7,INSTANCE_OF_EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED_PPV:11,UTF8_STRING:12,RELATIVE_OID:13,SEQUENCE:16,SET:17,NUMERIC_STRING:18,PRINTABLE_STRING:19,TELETEX_STRING:20,T61_STRING:20,VIDEOTEX_STRING:21,IA5_STRING:22,UTC_TIME:23,GENERALIZED_TIME:24,GRAPHIC_STRING:25,VISIBLE_STRING:26,ISO64_STRING:26,GENERAL_STRING:27,
UNIVERSAL_STRING:28,CHARACTER_STRING:29,BMP_STRING:30},Ga=function(a,b,c,f,h,l){this._data=a;this._parent=b||n;this._constructed=c||!1;this._tagClass=0;this._tag=f||0;this._dataIdx=h||0;this._dataLen=l||0};Ga.prototype={_child:n,_next:n,get data(){return new Uint8Array(this._data.buffer.slice(this._dataIdx,this._dataIdx+this._dataLen))},get backingStore(){return this._data},get constructed(){return this._constructed},set constructed(a){this._constructed=0!=a?!0:!1},get tagClass(){return this._tagClass},
set tagClass(a){this._tagClass=a},get tag(){return this._tag},set tag(a){this._tag=a},get dataIdx(){return this._dataIdx},set dataIdx(a){this._dataIdx=a},get dataLen(){return this._dataLen},set dataLen(a){this._dataLen=a},get child(){return this._child},set child(a){this._child=a;this._child.parent=this},get next(){return this._next},set next(a){this._next=a},get parent(){return this._parent},set parent(a){this._parent=a},get payloadLen(){var a=0;if(this._child){for(var b=this._child;b;)a+=b.length,
b=b.next;this._tag==u.BIT_STRING&&a++}else switch(this._tag){case u.INTEGER:a=this._dataLen;this._data[this._dataIdx]>>7&&a++;break;case u.BIT_STRING:a=this._dataLen+1;break;case u.OCTET_STRING:a=this._dataLen;break;case u.NULL:a=0;break;case u.OBJECT_IDENTIFIER:l(this._data,this._dataIdx,this._dataLen)&&(a=9)}return a},get length(){var a=this.payloadLen,b;if(127<a)for(b=a;b;)b>>=8,++a;return a+2},get der(){var c=this.length;if(!c)return n;var c=new Uint8Array(c),f=new b(c);return a(this,f)?c:n},
get nChildren(){for(var a=0,b=this._child;b;)a++,b=b.next;return a}};var w={createSequenceNode:function(){return new Ga(null,null,!0,u.SEQUENCE,null,null)},createOidNode:function(a){return new Ga(a,null,!1,u.OBJECT_IDENTIFIER,0,a?a.length:0)},createNullNode:function(){return new Ga(null,null,!1,u.NULL,null,null)},createBitStringNode:function(a){return new Ga(a,null,!1,u.BIT_STRING,0,a?a.length:0)},createIntegerNode:function(a){return new Ga(a,null,!1,u.INTEGER,0,a?a.length:0)},createOctetStringNode:function(a){return new Ga(a,
null,!1,u.OCTET_STRING,0,a?a.length:0)}},x=function(a){this._currentNode=this._rootNode=a};x.prototype={addChild:function(a){this.addTo(this._currentNode,a)},addSibling:function(a){this.addTo(this._currentNode.parent,a)},addTo:function(a,b){this._currentNode=b;this._currentNode.parent=a;if(a.child){for(var c=a.child;c.next;)c=c.next;c.next=b}else a.child=b},addToParent:function(a,b){this.findNode(a)&&this.addTo(a,b)},findNode:function(a){for(var b=this._currentNode;b;){if(a==b)return!0;b=b.parent}return!1}};
var y=0,Ua=new Uint8Array([42,134,72,134,247,13,1,1,1]),A=function(a,b,c,f){this.n=a;this.e=b;this.ext=c;this.keyOps=f},v=function(a,b,c,f,h,l,d,g,k,q,p){this.n=a;this.e=b;this.d=c;this.p=f;this.q=h;this.dp=l;this.dq=d;this.qi=g;this.alg=k;this.keyOps=q;this.ext=p},Bd="sign verify encrypt decrypt wrapKey unwrapKey deriveKey deriveBits".split(" ");ua.prototype.getDer=function(){return this.der};ua.prototype.getType=function(){return this.type};ua.prototype.getKeyOps=function(){return this.keyOps};
ua.prototype.getExtractable=function(){return this.extractable};c.parse=function(a){y=0;return h(new Ga(a),0,a.length)};c.show=function(a,b){};c.isRsaSpki=d;c.isRsaPkcs8=g;c.NodeFactory=w;c.Builder=x;c.tagVal=u;c.RsaPublicKey=A;c.RsaPrivateKey=v;c.buildRsaSpki=k;c.parseRsaSpki=function(a){a=c.parse(a);return d?q(a):n};c.buildRsaPkcs8=p;c.parseRsaPkcs8=function(a){a=c.parse(a);return g(a)?r(a):n};c.buildRsaJwk=t;c.parseRsaJwk=m;c.RsaDer=ua;c.rsaDerToJwk=function(a,b,f,h){a=c.parse(a);if(!a)return n;
if(d(a))a=q(a);else if(g(a))a=r(a);else return n;return t(a,b,f,h)};c.jwkToRsaDer=function(a){a=m(a);if(!a)return n;var b,c;if(a instanceof A)b="spki",c=k(a).der;else if(a instanceof v)b="pkcs8",c=p(a).der;else return n;return new ua(c,b,a.keyOps,a.ext)};c.webCryptoAlgorithmToJwkAlg=function(a){return"RSAES-PKCS1-v1_5"==a.name?"RSA1_5":"RSASSA-PKCS1-v1_5"==a.name?"SHA-256"==a.hash.name?"RS256":"SHA-384"==a.hash.name?"RS384":"SHA-512"==a.hash.name?"RS512":n:n};c.webCryptoUsageToJwkKeyOps=function(a){return a.map(function(a){return"wrapKey"==
a?"wrap":"unwrapKey"==a?"unwrap":a})}})();a.ASN1=c})(this);var G,L;(function(){for(var a={},b={},c={"=":0,".":0},f={"=":0,".":0},h=/\s+/g,l=/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/_-]*[=]{0,2}$/,d=64;d--;)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]]=262144*d,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]]=4096*d,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]]=64*d,f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]]=
d;for(d=64;d--&&"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]!="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[d];)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[d]]=262144*d,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[d]]=4096*d,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[d]]=64*d,f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[d]]=d;G=function(a,b){for(var c="",
f=0,h=a.length,l=h-2,d,g=b?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=b?"":"=";f<l;)d=65536*a[f++]+256*a[f++]+a[f++],c+=g[d>>>18]+g[d>>>12&63]+g[d>>>6&63]+g[d&63];f==l?(d=65536*a[f++]+256*a[f++],c+=g[d>>>18]+g[d>>>12&63]+g[d>>>6&63]+k):f==h-1&&(d=65536*a[f++],c+=g[d>>>18]+g[d>>>12&63]+k+k);return c};L=function(d,g){d=d.replace(h,"");if(g){var k=d.length%4;if(k)for(var k=4-k,q=0;q<k;++q)d+="="}k=d.length;if(0!=
k%4||!l.test(d))throw Error("bad base64: "+d);for(var p=k/4*3-("="==d[k-1]?1:0)-("="==d[k-2]?1:0),n=new Uint8Array(p),r=0,t=0;r<k;)q=a[d[r++]]+b[d[r++]]+c[d[r++]]+f[d[r++]],n[t++]=q>>>16,t<p&&(n[t++]=q>>>8&255,t<p&&(n[t++]=q&255));return n}})();var N={};(function(){function a(c){if(!(this instanceof a))return new a(c);for(var f=0,h=l.length;f<h;f++)this[l[f]]="";this.bufferCheckPosition=N.MAX_BUFFER_LENGTH;this.q=this.c=this.p="";this.opt=c||{};this.closed=this.closedRoot=this.sawRoot=!1;this.tag=
this.error=null;this.state=g.BEGIN;this.stack=new d;this.index=this.position=this.column=0;this.line=1;this.slashed=!1;this.unicodeI=0;this.unicodeS=null;b(this,"onready")}function b(a,c,f){if(a[c])a[c](f)}function c(a,f){var g=a.opt,h=a.textNode;g.trim&&(h=h.trim());g.normalize&&(h=h.replace(/\s+/g," "));a.textNode=h;a.textNode&&b(a,f?f:"onvalue",a.textNode);a.textNode=""}function f(a,g){c(a);g+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c;g=Error(g);a.error=g;b(a,"onerror",g);return a}
function h(d){d.state!==g.VALUE&&f(d,"Unexpected end");c(d);d.c="";d.closed=!0;b(d,"onend");a.call(d,d.opt);return d}var d=Array;N.parser=function(b){return new a(b)};N.CParser=a;N.MAX_BUFFER_LENGTH=65536;N.DEBUG=!1;N.INFO=!1;N.EVENTS="value string key openobject closeobject openarray closearray error end ready".split(" ");var l=["textNode","numberNode"];N.EVENTS.filter(function(a){return"error"!==a&&"end"!==a});var g=0;N.STATE={BEGIN:g++,VALUE:g++,OPEN_OBJECT:g++,CLOSE_OBJECT:g++,OPEN_ARRAY:g++,
CLOSE_ARRAY:g++,TEXT_ESCAPE:g++,STRING:g++,BACKSLASH:g++,END:g++,OPEN_KEY:g++,CLOSE_KEY:g++,TRUE:g++,TRUE2:g++,TRUE3:g++,FALSE:g++,FALSE2:g++,FALSE3:g++,FALSE4:g++,NULL:g++,NULL2:g++,NULL3:g++,NUMBER_DECIMAL_POINT:g++,NUMBER_DIGIT:g++};for(var k in N.STATE)N.STATE[N.STATE[k]]=k;g=N.STATE;Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__});var q=/[\\"\n]/g;a.prototype={end:function(){h(this)},write:function(a){if(this.error)throw this.error;if(this.closed)return f(this,"Cannot write after close. Assign an onready handler.");
if(null===a)return h(this);for(var d=a[0],k=this.p;d;){k=d;this.c=d=a.charAt(this.index++);k!==d?this.p=k:k=this.p;if(!d)break;this.position++;"\n"===d?(this.line++,this.column=0):this.column++;switch(this.state){case g.BEGIN:"{"===d?this.state=g.OPEN_OBJECT:"["===d?this.state=g.OPEN_ARRAY:"\r"!==d&&"\n"!==d&&" "!==d&&"\t"!==d&&f(this,"Non-whitespace before {[.");continue;case g.OPEN_KEY:case g.OPEN_OBJECT:if("\r"===d||"\n"===d||" "===d||"\t"===d)continue;if(this.state===g.OPEN_KEY)this.stack.push(g.CLOSE_KEY);
else if("}"===d){b(this,"onopenobject");b(this,"oncloseobject");this.state=this.stack.pop()||g.VALUE;continue}else this.stack.push(g.CLOSE_OBJECT);'"'===d?this.state=g.STRING:f(this,'Malformed object key should start with "');continue;case g.CLOSE_KEY:case g.CLOSE_OBJECT:if("\r"===d||"\n"===d||" "===d||"\t"===d)continue;":"===d?(this.state===g.CLOSE_OBJECT?(this.stack.push(g.CLOSE_OBJECT),c(this,"onopenobject")):c(this,"onkey"),this.state=g.VALUE):"}"===d?(c(this),b(this,"oncloseobject",void 0),this.state=
this.stack.pop()||g.VALUE):","===d?(this.state===g.CLOSE_OBJECT&&this.stack.push(g.CLOSE_OBJECT),c(this),this.state=g.OPEN_KEY):f(this,"Bad object");continue;case g.OPEN_ARRAY:case g.VALUE:if("\r"===d||"\n"===d||" "===d||"\t"===d)continue;if(this.state===g.OPEN_ARRAY)if(b(this,"onopenarray"),this.state=g.VALUE,"]"===d){b(this,"onclosearray");this.state=this.stack.pop()||g.VALUE;continue}else this.stack.push(g.CLOSE_ARRAY);'"'===d?this.state=g.STRING:"{"===d?this.state=g.OPEN_OBJECT:"["===d?this.state=
g.OPEN_ARRAY:"t"===d?this.state=g.TRUE:"f"===d?this.state=g.FALSE:"n"===d?this.state=g.NULL:"-"===d?this.numberNode+=d:"0"===d?(this.numberNode+=d,this.state=g.NUMBER_DIGIT):-1!=="123456789".indexOf(d)?(this.numberNode+=d,this.state=g.NUMBER_DIGIT):f(this,"Bad value");continue;case g.CLOSE_ARRAY:if(","===d)this.stack.push(g.CLOSE_ARRAY),c(this,"onvalue"),this.state=g.VALUE;else if("]"===d)c(this),b(this,"onclosearray",void 0),this.state=this.stack.pop()||g.VALUE;else if("\r"===d||"\n"===d||" "===
d||"\t"===d)continue;else f(this,"Bad array");continue;case g.STRING:var k=this.index-1,p=this.slashed,n=this.unicodeI;a:for(;;){if(N.DEBUG)for(;0<n;)if(this.unicodeS+=d,d=a.charAt(this.index++),4===n?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),n=0,k=this.index-1):n++,!d)break a;if('"'===d&&!p){this.state=this.stack.pop()||g.VALUE;(this.textNode+=a.substring(k,this.index-1))||b(this,"onvalue","");break}if("\\"===d&&!p&&(p=!0,this.textNode+=a.substring(k,this.index-1),d=a.charAt(this.index++),
!d))break;if(p)if(p=!1,"n"===d?this.textNode+="\n":"r"===d?this.textNode+="\r":"t"===d?this.textNode+="\t":"f"===d?this.textNode+="\f":"b"===d?this.textNode+="\b":"u"===d?(n=1,this.unicodeS=""):this.textNode+=d,d=a.charAt(this.index++),k=this.index-1,d)continue;else break;q.lastIndex=this.index;var r=q.exec(a);if(null===r){this.index=a.length+1;this.textNode+=a.substring(k,this.index-1);break}this.index=r.index+1;d=a.charAt(r.index);if(!d){this.textNode+=a.substring(k,this.index-1);break}}this.slashed=
p;this.unicodeI=n;continue;case g.TRUE:if(""===d)continue;"r"===d?this.state=g.TRUE2:f(this,"Invalid true started with t"+d);continue;case g.TRUE2:if(""===d)continue;"u"===d?this.state=g.TRUE3:f(this,"Invalid true started with tr"+d);continue;case g.TRUE3:if(""===d)continue;"e"===d?(b(this,"onvalue",!0),this.state=this.stack.pop()||g.VALUE):f(this,"Invalid true started with tru"+d);continue;case g.FALSE:if(""===d)continue;"a"===d?this.state=g.FALSE2:f(this,"Invalid false started with f"+d);continue;
case g.FALSE2:if(""===d)continue;"l"===d?this.state=g.FALSE3:f(this,"Invalid false started with fa"+d);continue;case g.FALSE3:if(""===d)continue;"s"===d?this.state=g.FALSE4:f(this,"Invalid false started with fal"+d);continue;case g.FALSE4:if(""===d)continue;"e"===d?(b(this,"onvalue",!1),this.state=this.stack.pop()||g.VALUE):f(this,"Invalid false started with fals"+d);continue;case g.NULL:if(""===d)continue;"u"===d?this.state=g.NULL2:f(this,"Invalid null started with n"+d);continue;case g.NULL2:if(""===
d)continue;"l"===d?this.state=g.NULL3:f(this,"Invalid null started with nu"+d);continue;case g.NULL3:if(""===d)continue;"l"===d?(b(this,"onvalue",null),this.state=this.stack.pop()||g.VALUE):f(this,"Invalid null started with nul"+d);continue;case g.NUMBER_DECIMAL_POINT:"."===d?(this.numberNode+=d,this.state=g.NUMBER_DIGIT):f(this,"Leading zero not followed by .");continue;case g.NUMBER_DIGIT:-1!=="0123456789".indexOf(d)?this.numberNode+=d:"."===d?(-1!==this.numberNode.indexOf(".")&&f(this,"Invalid number has two dots"),
this.numberNode+=d):"e"===d||"E"===d?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||f(this,"Invalid number has two exponential"),this.numberNode+=d):"+"===d||"-"===d?("e"!==k&&"E"!==k&&f(this,"Invalid symbol in number"),this.numberNode+=d):(this.numberNode&&b(this,"onvalue",parseFloat(this.numberNode)),this.numberNode="",this.index--,this.state=this.stack.pop()||g.VALUE);continue;default:f(this,"Unknown state: "+this.state)}}if(this.position>=this.bufferCheckPosition){a=Math.max(N.MAX_BUFFER_LENGTH,
10);k=d=0;for(p=l.length;k<p;k++){n=this[l[k]].length;if(n>a)switch(l[k]){case "text":break;default:f(this,"Max buffer length exceeded: "+l[k])}d=Math.max(d,n)}this.bufferCheckPosition=N.MAX_BUFFER_LENGTH-d+this.position}return this},resume:function(){this.error=null;return this},close:function(){return this.write(null)}}})();var T,ba;(function(){function a(b,c){c||(c=b.length);return b.reduce(function(a,b,d){return d<c?a+String.fromCharCode(b):a},"")}for(var b={},c=0;256>c;++c){var d=a([c]);b[d]=
c}for(var f=Object.keys(b).length,g=[],c=0;256>c;++c)g[c]=[c];T=function(c){function d(a,b){for(;0<b;){if(n>=p.length)return!1;if(b>r){var c=a,c=c>>>b-r;p[n]|=c&255;b-=r;r=8;++n}else b<=r&&(c=a,c<<=r-b,c&=255,c>>>=8-r,p[n]|=c&255,r-=b,b=0,0==r&&(r=8,++n))}return!0}var g={},h;for(h in b)g[h]=b[h];for(var l=f,k=[],q=8,p=new Uint8Array(c.length),n=0,r=8,t=0;t<c.length;++t){var m=c[t];k.push(m);h=a(k);var u=g[h];if(!u){k=a(k,k.length-1);if(!d(g[k],q))return null;0!=l>>q&&++q;g[h]=l++;k=[m]}}return 0<
k.length&&(h=a(k),u=g[h],!d(u,q))?null:p.subarray(0,8>r?n+1:n)};ba=function(a){for(var b=g.slice(),c=0,d=0,f=8,h=new Uint8Array(Math.ceil(1.5*a.length)),l=0,k=0,q=[];c<a.length&&!(8*(a.length-c)-d<f);){for(var p=k=0;p<f;){var n=Math.min(f-p,8-d),r=a[c],r=r<<d,r=r&255,r=r>>>8-n,p=p+n,d=d+n;8==d&&(d=0,++c);k|=(r&255)<<f-p}p=b[k];0==q.length?++f:(p?q.push(p[0]):q.push(q[0]),b[b.length]=q,q=[],b.length==1<<f&&++f,p||(p=b[k]));k=l+p.length;k>=h.length&&(n=new Uint8Array(Math.ceil(1.5*k)),n.set(h),h=n);
h.set(p,l);l=k;q=q.concat(p)}return h.subarray(0,l)}})();var Q,V,la,Qa,sa,oa,Aa,da,v;(function(){Q="utf-8";V=9007199254740992;var a=la={GZIP:"GZIP",LZW:"LZW"};Object.freeze(la);Qa=function(b){for(var c=[a.GZIP,a.LZW],d=0;d<c.length&&0<b.length;++d)for(var f=c[d],g=0;g<b.length;++g)if(b[g]==f)return f;return null};var b=sa={AES_CBC_PKCS5Padding:"AES/CBC/PKCS5Padding",AESWrap:"AESWrap",RSA_ECB_PKCS1Padding:"RSA/ECB/PKCS1Padding"};Object.freeze(sa);oa=function(a){return b.AES_CBC_PKCS5Padding==a?b.AES_CBC_PKCS5Padding:
b.RSA_ECB_PKCS1Padding==a?b.RSA_ECB_PKCS1Padding:b[a]};var c=Aa={HmacSHA256:"HmacSHA256",SHA256withRSA:"SHA256withRSA"};Object.freeze(Aa);da=function(a){return c[a]};v={FAIL:1,TRANSIENT_FAILURE:2,ENTITY_REAUTH:3,USER_REAUTH:4,KEYX_REQUIRED:5,ENTITYDATA_REAUTH:6,USERDATA_REAUTH:7,EXPIRED:8,REPLAYED:9,SSOTOKEN_REJECTED:10};Object.freeze(v)})();var K={isObjectLiteral:function(a){return null!==a&&"object"===typeof a&&a.constructor===Object},extendDeep:function(){var a=arguments[0],b=1,c=arguments.length,
d=!1,f,g,h,l;"boolean"===typeof a&&(d=a,a=arguments[1],b=2);for(;b<c;b++)if(null!=(f=arguments[b]))for(g in f)d&&g in a||(l=f[g],a!==l&&l!==n&&(h=a[g],a[g]=null!==h&&null!==l&&"object"===typeof h&&"object"===typeof l?K.extendDeep(d,{},h,l):l));return a}};(function(){function a(b,c){return function(){var a=b.base,d;b.base=c;d=b.apply(this,arguments);b.base=a;return d}}function b(c,d,f){var g,h,k,q;f=f||l;q=!!f.extendAll;for(g in d)h=d.__lookupGetter__(g),k=d.__lookupSetter__(g),h||k?(h&&c.__defineGetter__(g,
h),k&&c.__defineSetter__(g,k)):(h=d[g],k=c[g],"function"===typeof h&&"function"===typeof k&&h!==k?(h.base!==Function.prototype.base&&(h=a(h,k)),h.base=k):(q||f[g])&&K.isObjectLiteral(h)&&K.isObjectLiteral(k)&&(h=K.extendDeep({},k,h)),c[g]=h)}function c(){var a=Array.prototype.slice,b=a.call(arguments,1);return this.extend({init:function Lc(){var c=a.call(arguments,0);Lc.base.apply(this,b.concat(c))}})}function d(a,c){var f=new this(h);b(f,a,c);return g(f)}function f(a,c){b(this.prototype,a,c);return this}
function g(a){var b=function(){var a=this.init;a&&arguments[0]!==h&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=b;b.extend=d;b.bind=c;b.mixin=f;return b}var h={},l={actions:!0};Function.prototype.base=function(){};K.Class={create:g,mixin:b,extend:function(a,b){var c=g();c.prototype=new a;return c.extend(b)}};K.mixin=function(){K.log&&K.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();(function(){function a(b,
c){return function(){var a=b.base,d;b.base=c;d=b.apply(this,arguments);b.base=a;return d}}function b(c,d,f){var g,h,q,p;f=f||l;p=!!f.extendAll;for(g in d)h=d.__lookupGetter__(g),q=d.__lookupSetter__(g),h||q?(h&&c.__defineGetter__(g,h),q&&c.__defineSetter__(g,q)):(h=d[g],q=c[g],"function"===typeof h&&"function"===typeof q&&h!==q?(h.base!==k&&(h=a(h,q)),h.base=q):(p||f[g])&&K.isObjectLiteral(h)&&K.isObjectLiteral(q)&&(h=K.extendDeep({},q,h)),c[g]=h)}function c(){var a=Array.prototype.slice,b=a.call(arguments,
1);return this.extend({init:function ec(){var c=a.call(arguments,0);ec.base.apply(this,b.concat(c))}})}function d(a,c){var f=new this(h);b(f,a,c);return g(f)}function f(a,c){b(this.prototype,a,c);return this}function g(a){var b=function(){var a=this.init;a&&arguments[0]!==h&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=b;b.extend=d;b.bind=c;b.mixin=f;return b}var h={},l={actions:!0},k=function(){};Function.prototype.base=k;K.Class={create:g,mixin:b,extend:function(a,b){var c=
g();c.prototype=new a;return c.extend(b)}};K.mixin=function(){K.log&&K.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();var Y;(function(){function a(b){return b==V?1:b+1}function b(c){if(0===Object.keys(c._waiters).length)return 0;for(var d=a(c._nextWaiter);!c._waiters[d];)d=a(d);return d}Y=K.Class.create({init:function(){Object.defineProperties(this,{_queue:{value:[],writable:!1,enumerable:!1,configurable:!1},_waiters:{value:{},
writable:!1,enumerable:!1,configurable:!1},_nextWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1},_lastWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waiters[a]){var c=this._waiters[a];delete this._waiters[a];a==this._nextWaiter&&(this._nextWaiter=b(this));c.call(this,n)}},cancelAll:function(){for(;0!==this._nextWaiter;)this.cancel(this._nextWaiter)},poll:function(c,d){var f=this,g=a(this._lastWaiter);this._lastWaiter=g;h(d,function(){if(0<this._queue.length){var a=
this._queue.shift();setTimeout(function(){d.result(a)},0)}else{var h;-1!=c&&(h=setTimeout(function(){delete f._waiters[g];g==f._nextWaiter&&(f._nextWaiter=b(f));d.timeout()},c));this._waiters[g]=function(a){clearTimeout(h);setTimeout(function(){d.result(a)},0)};this._nextWaiter||(this._nextWaiter=g)}},f);return g},add:function(a){if(this._nextWaiter){var c=this._waiters[this._nextWaiter];delete this._waiters[this._nextWaiter];this._nextWaiter=b(this);c.call(this,a)}else this._queue.push(a)}})})();
var db;(function(){var a=0-V;db=K.Class.create({nextBoolean:function(){var a=new Uint8Array(1);H.getRandomValues(a);return a[0]&1?!0:!1},nextInt:function(a){if(null!==a&&a!==n){if("number"!==typeof a)throw new TypeError("n must be of type number");if(1>a)throw new RangeError("n must be greater than zero");--a;var b=new Uint8Array(4);H.getRandomValues(b);return Math.floor(((b[3]&127)<<24|b[2]<<16|b[1]<<8|b[0])/2147483648*(a-0+1)+0)}a=new Uint8Array(4);H.getRandomValues(a);b=(a[3]&127)<<24|a[2]<<16|
a[1]<<8|a[0];return a[3]&128?-b:b},nextLong:function(){for(var b=a;b==a;){b=new Uint8Array(7);H.getRandomValues(b);var c=16777216*((b[6]&31)<<24|b[5]<<16|b[4]<<8|b[3])+(b[2]<<16|b[1]<<8|b[0]),b=b[6]&128?-c-1:c}return b},nextBytes:function(a){H.getRandomValues(a)}})})();var Ma;(function(){function a(b){return b==V?1:b+1}function b(c){if(0===Object.keys(c._waitingReaders).length)return 0;for(var d=a(c._nextReader);!c._waitingReaders[d];)d=a(d);return d}function c(b){if(0===Object.keys(b._waitingWriters).length)return 0;
for(var d=a(b._nextWriter);!b._waitingWriters[d];)d=a(d);return d}Ma=K.Class.create({init:function(){Object.defineProperties(this,{_readers:{value:{},writable:!1,enumerable:!1,configurable:!1},_waitingReaders:{value:{},writable:!1,enumerable:!1,configurable:!1},_writer:{value:null,writable:!0,enumerable:!1,configurable:!1},_waitingWriters:{value:{},writable:!1,enumerable:!1,configurable:!1},_nextReader:{value:0,writable:!0,enumerable:!1,configurable:!1},_nextWriter:{value:0,writable:!0,enumerable:!1,
configurable:!1},_lastNumber:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waitingReaders[a]){var d=this._waitingReaders[a];delete this._waitingReaders[a];a==this._nextReader&&(this._nextReader=b(this));d.call(this,!0)}this._waitingWriters[a]&&(d=this._waitingWriters[a],delete this._waitingWriters[a],a==this._nextWriter&&(this._nextWriter=c(this)),d.call(this,!0))},cancelAll:function(){for(;0!==this._nextWriter;)this.cancel(this._nextWriter);for(;0!==this._nextReader;)this.cancel(this._nextReader)},
readLock:function(c,d){var f=this,g=a(this._lastNumber);this._lastNumber=g;h(d,function(){if(!this._writer&&0===Object.keys(this._waitingWriters).length)return this._readers[g]=!0,g;var a;-1!=c&&(a=setTimeout(function(){delete f._waitingReaders[g];g==f._nextReader&&(f._nextReader=b(f));d.timeout()},c));this._waitingReaders[g]=function(b){clearTimeout(a);b?setTimeout(function(){d.result(n)},0):(f._readers[g]=!0,setTimeout(function(){d.result(g)},0))};this._nextReader||(this._nextReader=g)},f);return g},
writeLock:function(b,d){var f=this,g=a(this._lastNumber);this._lastNumber=g;h(d,function(){if(0===Object.keys(this._readers).length&&0===Object.keys(this._waitingReaders).length&&!this._writer)return this._writer=g;var a;-1!=b&&(a=setTimeout(function(){delete f._waitingWriters[g];g==f._nextWriter&&(f._nextWriter=c(f));d.timeout()},b));this._waitingWriters[g]=function(b){clearTimeout(a);b?setTimeout(function(){d.result(n)},0):(f._writer=g,setTimeout(function(){d.result(g)},0))};this._nextWriter||(this._nextWriter=
g)},f);return g},unlock:function(b){if(b==this._writer)this._writer=null;else{if(!this._readers[b])throw new P("There is no reader or writer with ticket number "+b+".");delete this._readers[b]}if(this._nextWriter)0<Object.keys(this._readers).length||(b=this._waitingWriters[this._nextWriter],delete this._waitingWriters[this._nextWriter],this._nextWriter=c(this),b.call(this,!1));else{for(var d=this._nextReader;0<Object.keys(this._waitingReaders).length;d=a(d))this._waitingReaders[d]&&(b=this._waitingReaders[d],
delete this._waitingReaders[d],b.call(this,!1));this._nextReader=0}}})})();K.Class.mixin(a,{JSON_PARSE_ERROR:new a(0,v.FAIL,"Error parsing JSON."),JSON_ENCODE_ERROR:new a(1,v.FAIL,"Error encoding JSON."),ENVELOPE_HASH_MISMATCH:new a(2,v.FAIL,"Computed hash does not match envelope hash."),INVALID_PUBLIC_KEY:new a(3,v.FAIL,"Invalid public key provided."),INVALID_PRIVATE_KEY:new a(4,v.FAIL,"Invalid private key provided."),PLAINTEXT_ILLEGAL_BLOCK_SIZE:new a(5,v.FAIL,"Plaintext is not a multiple of the block size."),
PLAINTEXT_BAD_PADDING:new a(6,v.FAIL,"Plaintext contains incorrect padding."),CIPHERTEXT_ILLEGAL_BLOCK_SIZE:new a(7,v.FAIL,"Ciphertext is not a multiple of the block size."),CIPHERTEXT_BAD_PADDING:new a(8,v.FAIL,"Ciphertext contains incorrect padding."),ENCRYPT_NOT_SUPPORTED:new a(9,v.FAIL,"Encryption not supported."),DECRYPT_NOT_SUPPORTED:new a(10,v.FAIL,"Decryption not supported."),ENVELOPE_KEY_ID_MISMATCH:new a(11,v.FAIL,"Encryption envelope key ID does not match crypto context key ID."),CIPHERTEXT_ENVELOPE_PARSE_ERROR:new a(12,
v.FAIL,"Error parsing ciphertext envelope."),CIPHERTEXT_ENVELOPE_ENCODE_ERROR:new a(13,v.FAIL,"Error encoding ciphertext envelope."),SIGN_NOT_SUPPORTED:new a(14,v.FAIL,"Sign not supported."),VERIFY_NOT_SUPPORTED:new a(15,v.FAIL,"Verify not suppoprted."),SIGNATURE_ERROR:new a(16,v.FAIL,"Signature not initialized or unable to process data/signature."),HMAC_ERROR:new a(17,v.FAIL,"Error computing HMAC."),ENCRYPT_ERROR:new a(18,v.FAIL,"Error encrypting plaintext."),DECRYPT_ERROR:new a(19,v.FAIL,"Error decrypting ciphertext."),
INSUFFICIENT_CIPHERTEXT:new a(20,v.FAIL,"Insufficient ciphertext for decryption."),SESSION_KEY_CREATION_FAILURE:new a(21,v.FAIL,"Error when creating session keys."),ASN1_PARSE_ERROR:new a(22,v.FAIL,"Error parsing ASN.1."),ASN1_ENCODE_ERROR:new a(23,v.FAIL,"Error encoding ASN.1."),INVALID_SYMMETRIC_KEY:new a(24,v.FAIL,"Invalid symmetric key provided."),INVALID_ENCRYPTION_KEY:new a(25,v.FAIL,"Invalid encryption key."),INVALID_HMAC_KEY:new a(26,v.FAIL,"Invalid HMAC key."),WRAP_NOT_SUPPORTED:new a(27,
v.FAIL,"Wrap not supported."),UNWRAP_NOT_SUPPORTED:new a(28,v.FAIL,"Unwrap not supported."),UNIDENTIFIED_JWK_TYPE:new a(29,v.FAIL,"Unidentified JSON web key type."),UNIDENTIFIED_JWK_USAGE:new a(30,v.FAIL,"Unidentified JSON web key usage."),UNIDENTIFIED_JWK_ALGORITHM:new a(31,v.FAIL,"Unidentified JSON web key algorithm."),WRAP_ERROR:new a(32,v.FAIL,"Error wrapping plaintext."),UNWRAP_ERROR:new a(33,v.FAIL,"Error unwrapping ciphertext."),INVALID_JWK:new a(34,v.FAIL,"Invalid JSON web key."),INVALID_JWK_KEYDATA:new a(35,
v.FAIL,"Invalid JSON web key keydata."),UNSUPPORTED_JWK_ALGORITHM:new a(36,v.FAIL,"Unsupported JSON web key algorithm."),WRAP_KEY_CREATION_FAILURE:new a(37,v.FAIL,"Error when creating wrapping key."),INVALID_WRAP_CIPHERTEXT:new a(38,v.FAIL,"Invalid wrap ciphertext."),UNSUPPORTED_JWE_ALGORITHM:new a(39,v.FAIL,"Unsupported JSON web encryption algorithm."),JWE_ENCODE_ERROR:new a(40,v.FAIL,"Error encoding JSON web encryption header."),JWE_PARSE_ERROR:new a(41,v.FAIL,"Error parsing JSON web encryption header."),
INVALID_ALGORITHM_PARAMS:new a(42,v.FAIL,"Invalid algorithm parameters."),JWE_ALGORITHM_MISMATCH:new a(43,v.FAIL,"JSON web encryption header algorithms mismatch."),KEY_IMPORT_ERROR:new a(44,v.FAIL,"Error importing key."),KEY_EXPORT_ERROR:new a(45,v.FAIL,"Error exporting key."),DIGEST_ERROR:new a(46,v.FAIL,"Error in digest."),UNSUPPORTED_KEY:new a(47,v.FAIL,"Unsupported key type or algorithm."),UNSUPPORTED_JWE_SERIALIZATION:new a(48,v.FAIL,"Unsupported JSON web encryption serialization."),XML_PARSE_ERROR:new a(49,
v.FAIL,"Error parsing XML."),XML_ENCODE_ERROR:new a(50,v.FAIL,"Error encoding XML."),INVALID_WRAPPING_KEY:new a(51,v.FAIL,"Invalid wrapping key."),UNIDENTIFIED_CIPHERTEXT_ENVELOPE:new a(52,v.FAIL,"Unidentified ciphertext envelope version."),UNIDENTIFIED_SIGNATURE_ENVELOPE:new a(53,v.FAIL,"Unidentified signature envelope version."),UNSUPPORTED_CIPHERTEXT_ENVELOPE:new a(54,v.FAIL,"Unsupported ciphertext envelope version."),UNSUPPORTED_SIGNATURE_ENVELOPE:new a(55,v.FAIL,"Unsupported signature envelope version."),
UNIDENTIFIED_CIPHERSPEC:new a(56,v.FAIL,"Unidentified cipher specification."),UNIDENTIFIED_ALGORITHM:new a(57,v.FAIL,"Unidentified algorithm."),SIGNATURE_ENVELOPE_PARSE_ERROR:new a(58,v.FAIL,"Error parsing signature envelope."),SIGNATURE_ENVELOPE_ENCODE_ERROR:new a(59,v.FAIL,"Error encoding signature envelope."),INVALID_SIGNATURE:new a(60,v.FAIL,"Invalid signature."),WRAPKEY_FINGERPRINT_NOTSUPPORTED:new a(61,v.FAIL,"Wrap key fingerprint not supported"),UNIDENTIFIED_JWK_KEYOP:new a(62,v.FAIL,"Unidentified JSON web key key operation."),
MASTERTOKEN_UNTRUSTED:new a(1E3,v.ENTITY_REAUTH,"Master token is not trusted."),MASTERTOKEN_KEY_CREATION_ERROR:new a(1001,v.ENTITY_REAUTH,"Unable to construct symmetric keys from master token."),MASTERTOKEN_EXPIRES_BEFORE_RENEWAL:new a(1002,v.ENTITY_REAUTH,"Master token expiration timestamp is before the renewal window opens."),MASTERTOKEN_SESSIONDATA_MISSING:new a(1003,v.ENTITY_REAUTH,"No master token session data found."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(1004,v.ENTITY_REAUTH,"Master token sequence number is out of range."),
MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(1005,v.ENTITY_REAUTH,"Master token serial number is out of range."),MASTERTOKEN_TOKENDATA_INVALID:new a(1006,v.ENTITY_REAUTH,"Invalid master token data."),MASTERTOKEN_SIGNATURE_INVALID:new a(1007,v.ENTITY_REAUTH,"Invalid master token signature."),MASTERTOKEN_SESSIONDATA_INVALID:new a(1008,v.ENTITY_REAUTH,"Invalid master token session data."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_SYNC:new a(1009,v.ENTITY_REAUTH,"Master token sequence number does not have the expected value."),
MASTERTOKEN_TOKENDATA_MISSING:new a(1010,v.ENTITY_REAUTH,"No master token data found."),MASTERTOKEN_TOKENDATA_PARSE_ERROR:new a(1011,v.ENTITY_REAUTH,"Error parsing master token data."),MASTERTOKEN_SESSIONDATA_PARSE_ERROR:new a(1012,v.ENTITY_REAUTH,"Error parsing master token session data."),MASTERTOKEN_IDENTITY_REVOKED:new a(1013,v.ENTITY_REAUTH,"Master token entity identity is revoked."),MASTERTOKEN_REJECTED_BY_APP:new a(1014,v.ENTITY_REAUTH,"Master token is rejected by the application."),USERIDTOKEN_MASTERTOKEN_MISMATCH:new a(2E3,
v.USER_REAUTH,"User ID token master token serial number does not match master token serial number."),USERIDTOKEN_NOT_DECRYPTED:new a(2001,v.USER_REAUTH,"User ID token is not decrypted or verified."),USERIDTOKEN_MASTERTOKEN_NULL:new a(2002,v.USER_REAUTH,"User ID token requires a master token."),USERIDTOKEN_EXPIRES_BEFORE_RENEWAL:new a(2003,v.USER_REAUTH,"User ID token expiration timestamp is before the renewal window opens."),USERIDTOKEN_USERDATA_MISSING:new a(2004,v.USER_REAUTH,"No user ID token user data found."),
USERIDTOKEN_MASTERTOKEN_NOT_FOUND:new a(2005,v.USER_REAUTH,"User ID token is bound to an unknown master token."),USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2006,v.USER_REAUTH,"User ID token master token serial number is out of range."),USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2007,v.USER_REAUTH,"User ID token serial number is out of range."),USERIDTOKEN_TOKENDATA_INVALID:new a(2008,v.USER_REAUTH,"Invalid user ID token data."),USERIDTOKEN_SIGNATURE_INVALID:new a(2009,v.USER_REAUTH,
"Invalid user ID token signature."),USERIDTOKEN_USERDATA_INVALID:new a(2010,v.USER_REAUTH,"Invalid user ID token user data."),USERIDTOKEN_IDENTITY_INVALID:new a(2011,v.USER_REAUTH,"Invalid user ID token user identity."),RESERVED_2012:new a(2012,v.USER_REAUTH,"The entity is not associated with the user."),USERIDTOKEN_IDENTITY_NOT_FOUND:new a(2013,v.USER_REAUTH,"The user identity was not found."),USERIDTOKEN_PASSWORD_VERSION_CHANGED:new a(2014,v.USER_REAUTH,"The user identity must be reauthenticated because the password version changed."),
USERIDTOKEN_USERAUTH_DATA_MISMATCH:new a(2015,v.USER_REAUTH,"The user ID token and user authentication data user identities do not match."),USERIDTOKEN_TOKENDATA_MISSING:new a(2016,v.USER_REAUTH,"No user ID token data found."),USERIDTOKEN_TOKENDATA_PARSE_ERROR:new a(2017,v.USER_REAUTH,"Error parsing user ID token data."),USERIDTOKEN_USERDATA_PARSE_ERROR:new a(2018,v.USER_REAUTH,"Error parsing user ID token user data."),USERIDTOKEN_REVOKED:new a(2019,v.USER_REAUTH,"User ID token is revoked."),USERIDTOKEN_REJECTED_BY_APP:new a(2020,
v.USER_REAUTH,"User ID token is rejected by the application."),SERVICETOKEN_MASTERTOKEN_MISMATCH:new a(3E3,v.FAIL,"Service token master token serial number does not match master token serial number."),SERVICETOKEN_USERIDTOKEN_MISMATCH:new a(3001,v.FAIL,"Service token user ID token serial number does not match user ID token serial number."),SERVICETOKEN_SERVICEDATA_INVALID:new a(3002,v.FAIL,"Service token data invalid."),SERVICETOKEN_MASTERTOKEN_NOT_FOUND:new a(3003,v.FAIL,"Service token is bound to an unknown master token."),
SERVICETOKEN_USERIDTOKEN_NOT_FOUND:new a(3004,v.FAIL,"Service token is bound to an unknown user ID token."),SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3005,v.FAIL,"Service token master token serial number is out of range."),SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3006,v.FAIL,"Service token user ID token serial number is out of range."),SERVICETOKEN_TOKENDATA_INVALID:new a(3007,v.FAIL,"Invalid service token data."),SERVICETOKEN_SIGNATURE_INVALID:new a(3008,v.FAIL,"Invalid service token signature."),
SERVICETOKEN_TOKENDATA_MISSING:new a(3009,v.FAIL,"No service token data found."),UNIDENTIFIED_ENTITYAUTH_SCHEME:new a(4E3,v.FAIL,"Unable to identify entity authentication scheme."),ENTITYAUTH_FACTORY_NOT_FOUND:new a(4001,v.FAIL,"No factory registered for entity authentication scheme."),X509CERT_PARSE_ERROR:new a(4002,v.ENTITYDATA_REAUTH,"Error parsing X.509 certificate data."),X509CERT_ENCODE_ERROR:new a(4003,v.ENTITYDATA_REAUTH,"Error encoding X.509 certificate data."),X509CERT_VERIFICATION_FAILED:new a(4004,
v.ENTITYDATA_REAUTH,"X.509 certificate verification failed."),ENTITY_NOT_FOUND:new a(4005,v.FAIL,"Entity not recognized."),INCORRECT_ENTITYAUTH_DATA:new a(4006,v.FAIL,"Entity used incorrect entity authentication data type."),RSA_PUBLICKEY_NOT_FOUND:new a(4007,v.ENTITYDATA_REAUTH,"RSA public key not found."),NPTICKET_GRACE_PERIOD_EXCEEDED:new a(4008,v.ENTITYDATA_REAUTH,"Fake NP-Tickets cannot be used after the grace period when the Playstation Network is up."),NPTICKET_SERVICE_ID_MISSING:new a(4009,
v.ENTITYDATA_REAUTH,"NP-Ticket service ID is missing."),NPTICKET_SERVICE_ID_DISALLOWED:new a(4010,v.ENTITYDATA_REAUTH,"NP-Ticket service ID is not allowed."),NPTICKET_NOT_YET_VALID:new a(4011,v.ENTITYDATA_REAUTH,"NP-Ticket issuance date is in the future."),NPTICKET_EXPIRED:new a(4012,v.ENTITYDATA_REAUTH,"NP-Ticket has expired."),NPTICKET_PRIVATE_KEY_NOT_FOUND:new a(4013,v.ENTITYDATA_REAUTH,"No private key found for NP-Ticket GUID."),NPTICKET_COOKIE_VERIFICATION_FAILED:new a(4014,v.ENTITYDATA_REAUTH,
"NP-Ticket cookie signature verification failed."),NPTICKET_INCORRECT_COOKIE_VERSION:new a(4015,v.ENTITYDATA_REAUTH,"Incorrect NP-Ticket cookie version."),NPTICKET_BROKEN:new a(4016,v.ENTITYDATA_REAUTH,"NP-Ticket broken."),NPTICKET_VERIFICATION_FAILED:new a(4017,v.ENTITYDATA_REAUTH,"NP-Ticket signature verification failed."),NPTICKET_ERROR:new a(4018,v.ENTITYDATA_REAUTH,"Unknown NP-Ticket TCM error."),NPTICKET_CIPHER_INFO_NOT_FOUND:new a(4019,v.ENTITYDATA_REAUTH,"No cipher information found for NP-Ticket."),
NPTICKET_INVALID_CIPHER_INFO:new a(4020,v.ENTITYDATA_REAUTH,"Cipher information for NP-Ticket is invalid."),NPTICKET_UNSUPPORTED_VERSION:new a(4021,v.ENTITYDATA_REAUTH,"Unsupported NP-Ticket version."),NPTICKET_INCORRECT_KEY_LENGTH:new a(4022,v.ENTITYDATA_REAUTH,"Incorrect NP-Ticket public key length."),UNSUPPORTED_ENTITYAUTH_DATA:new a(4023,v.FAIL,"Unsupported entity authentication data."),CRYPTEX_RSA_KEY_SET_NOT_FOUND:new a(4024,v.FAIL,"Cryptex RSA key set not found."),ENTITY_REVOKED:new a(4025,
v.FAIL,"Entity is revoked."),ENTITY_REJECTED_BY_APP:new a(4026,v.ENTITYDATA_REAUTH,"Entity is rejected by the application."),FORCE_LOGIN:new a(5E3,v.USERDATA_REAUTH,"User must login again."),NETFLIXID_COOKIES_EXPIRED:new a(5001,v.USERDATA_REAUTH,"Netflix ID cookie identity has expired."),NETFLIXID_COOKIES_BLANK:new a(5002,v.USERDATA_REAUTH,"Netflix ID or Secure Netflix ID cookie is blank."),UNIDENTIFIED_USERAUTH_SCHEME:new a(5003,v.FAIL,"Unable to identify user authentication scheme."),USERAUTH_FACTORY_NOT_FOUND:new a(5004,
v.FAIL,"No factory registered for user authentication scheme."),EMAILPASSWORD_BLANK:new a(5005,v.USERDATA_REAUTH,"Email or password is blank."),AUTHMGR_COMMS_FAILURE:new a(5006,v.TRANSIENT_FAILURE,"Error communicating with authentication manager."),EMAILPASSWORD_INCORRECT:new a(5007,v.USERDATA_REAUTH,"Email or password is incorrect."),UNSUPPORTED_USERAUTH_DATA:new a(5008,v.FAIL,"Unsupported user authentication data."),SSOTOKEN_BLANK:new a(5009,v.SSOTOKEN_REJECTED,"SSO token is blank."),SSOTOKEN_NOT_ASSOCIATED:new a(5010,
v.USERDATA_REAUTH,"SSO token is not associated with a Netflix user."),USERAUTH_USERIDTOKEN_INVALID:new a(5011,v.USERDATA_REAUTH,"User authentication data user ID token is invalid."),PROFILEID_BLANK:new a(5012,v.USERDATA_REAUTH,"Profile ID is blank."),UNIDENTIFIED_USERAUTH_MECHANISM:new a(5013,v.FAIL,"Unable to identify user authentication mechanism."),UNSUPPORTED_USERAUTH_MECHANISM:new a(5014,v.FAIL,"Unsupported user authentication mechanism."),SSOTOKEN_INVALID:new a(5015,v.SSOTOKEN_REJECTED,"SSO token invalid."),
USERAUTH_MASTERTOKEN_MISSING:new a(5016,v.USERDATA_REAUTH,"User authentication required master token is missing."),ACCTMGR_COMMS_FAILURE:new a(5017,v.TRANSIENT_FAILURE,"Error communicating with the account manager."),SSO_ASSOCIATION_FAILURE:new a(5018,v.TRANSIENT_FAILURE,"SSO user association failed."),SSO_DISASSOCIATION_FAILURE:new a(5019,v.TRANSIENT_FAILURE,"SSO user disassociation failed."),MDX_USERAUTH_VERIFICATION_FAILED:new a(5020,v.USERDATA_REAUTH,"MDX user authentication data verification failed."),
USERAUTH_USERIDTOKEN_NOT_DECRYPTED:new a(5021,v.USERDATA_REAUTH,"User authentication data user ID token is not decrypted or verified."),MDX_USERAUTH_ACTION_INVALID:new a(5022,v.USERDATA_REAUTH,"MDX user authentication data action is invalid."),CTICKET_DECRYPT_ERROR:new a(5023,v.USERDATA_REAUTH,"CTicket decryption failed."),USERAUTH_MASTERTOKEN_INVALID:new a(5024,v.USERDATA_REAUTH,"User authentication data master token is invalid."),USERAUTH_MASTERTOKEN_NOT_DECRYPTED:new a(5025,v.USERDATA_REAUTH,"User authentication data master token is not decrypted or verified."),
CTICKET_CRYPTOCONTEXT_ERROR:new a(5026,v.USERDATA_REAUTH,"Error creating CTicket crypto context."),MDX_PIN_BLANK:new a(5027,v.USERDATA_REAUTH,"MDX controller or target PIN is blank."),MDX_PIN_MISMATCH:new a(5028,v.USERDATA_REAUTH,"MDX controller and target PIN mismatch."),MDX_USER_UNKNOWN:new a(5029,v.USERDATA_REAUTH,"MDX controller user ID token or CTicket is not decrypted or verified."),USERAUTH_USERIDTOKEN_MISSING:new a(5030,v.USERDATA_REAUTH,"User authentication required user ID token is missing."),
MDX_CONTROLLERDATA_INVALID:new a(5031,v.USERDATA_REAUTH,"MDX controller authentication data is invalid."),USERAUTH_ENTITY_MISMATCH:new a(5032,v.USERDATA_REAUTH,"User authentication data does not match entity identity."),USERAUTH_INCORRECT_DATA:new a(5033,v.FAIL,"Entity used incorrect key request data type"),SSO_ASSOCIATION_WITH_NONMEMBER:new a(5034,v.USERDATA_REAUTH,"SSO user association failed because the customer is not a member."),SSO_ASSOCIATION_WITH_FORMERMEMBER:new a(5035,v.USERDATA_REAUTH,
"SSO user association failed because the customer is a former member."),SSO_ASSOCIATION_CONFLICT:new a(5036,v.USERDATA_REAUTH,"SSO user association failed because the token identifies a different member."),USER_REJECTED_BY_APP:new a(5037,v.USERDATA_REAUTH,"User is rejected by the application."),PROFILE_SWITCH_DISALLOWED:new a(5038,v.TRANSIENT_FAILURE,"Unable to switch user profile."),MEMBERSHIPCLIENT_COMMS_FAILURE:new a(5039,v.TRANSIENT_FAILURE,"Error communicating with the membership manager."),
USERIDTOKEN_IDENTITY_NOT_ASSOCIATED_WITH_ENTITY:new a(5040,v.USER_REAUTH,"The entity is not associated with the user."),UNSUPPORTED_COMPRESSION:new a(6E3,v.FAIL,"Unsupported compression algorithm."),COMPRESSION_ERROR:new a(6001,v.FAIL,"Error compressing data."),UNCOMPRESSION_ERROR:new a(6002,v.FAIL,"Error uncompressing data."),MESSAGE_ENTITY_NOT_FOUND:new a(6003,v.FAIL,"Message header entity authentication data or master token not found."),PAYLOAD_MESSAGE_ID_MISMATCH:new a(6004,v.FAIL,"Payload chunk message ID does not match header message ID ."),
PAYLOAD_SEQUENCE_NUMBER_MISMATCH:new a(6005,v.FAIL,"Payload chunk sequence number does not match expected sequence number."),PAYLOAD_VERIFICATION_FAILED:new a(6006,v.FAIL,"Payload chunk payload signature verification failed."),MESSAGE_DATA_MISSING:new a(6007,v.FAIL,"No message data found."),MESSAGE_FORMAT_ERROR:new a(6008,v.FAIL,"Malformed message data."),MESSAGE_VERIFICATION_FAILED:new a(6009,v.FAIL,"Message header/error data signature verification failed."),HEADER_DATA_MISSING:new a(6010,v.FAIL,
"No header data found."),PAYLOAD_DATA_MISSING:new a(6011,v.FAIL,"No payload data found in non-EOM payload chunk."),PAYLOAD_DATA_CORRUPT:new a(6012,v.FAIL,"Corrupt payload data found in non-EOM payload chunk."),UNIDENTIFIED_COMPRESSION:new a(6013,v.FAIL,"Unidentified compression algorithm."),MESSAGE_EXPIRED:new a(6014,v.EXPIRED,"Message expired and not renewable. Rejected."),MESSAGE_ID_OUT_OF_RANGE:new a(6015,v.FAIL,"Message ID is out of range."),INTERNAL_CODE_NEGATIVE:new a(6016,v.FAIL,"Error header internal code is negative."),
UNEXPECTED_RESPONSE_MESSAGE_ID:new a(6017,v.FAIL,"Unexpected response message ID. Possible replay."),RESPONSE_REQUIRES_ENCRYPTION:new a(6018,v.KEYX_REQUIRED,"Message response requires encryption."),PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(6019,v.FAIL,"Payload chunk sequence number is out of range."),PAYLOAD_MESSAGE_ID_OUT_OF_RANGE:new a(6020,v.FAIL,"Payload chunk message ID is out of range."),MESSAGE_REPLAYED:new a(6021,v.REPLAYED,"Non-replayable message replayed."),INCOMPLETE_NONREPLAYABLE_MESSAGE:new a(6022,
v.FAIL,"Non-replayable message sent non-renewable or without key request data or without a master token."),HEADER_SIGNATURE_INVALID:new a(6023,v.FAIL,"Invalid Header signature."),HEADER_DATA_INVALID:new a(6024,v.FAIL,"Invalid header data."),PAYLOAD_INVALID:new a(6025,v.FAIL,"Invalid payload."),PAYLOAD_SIGNATURE_INVALID:new a(6026,v.FAIL,"Invalid payload signature."),RESPONSE_REQUIRES_MASTERTOKEN:new a(6027,v.KEYX_REQUIRED,"Message response requires a master token."),RESPONSE_REQUIRES_USERIDTOKEN:new a(6028,
v.USER_REAUTH,"Message response requires a user ID token."),REQUEST_REQUIRES_USERAUTHDATA:new a(6029,v.FAIL,"User-associated message requires user authentication data."),UNEXPECTED_MESSAGE_SENDER:new a(6030,v.FAIL,"Message sender is equal to the local entity or not the master token entity."),NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN:new a(6031,v.FAIL,"Non-replayable message requires a master token."),NONREPLAYABLE_ID_OUT_OF_RANGE:new a(6032,v.FAIL,"Non-replayable message non-replayable ID is out of range."),
MESSAGE_SERVICETOKEN_MISMATCH:new a(6033,v.FAIL,"Service token master token or user ID token serial number does not match the message token serial numbers."),MESSAGE_PEER_SERVICETOKEN_MISMATCH:new a(6034,v.FAIL,"Peer service token master token or user ID token serial number does not match the message peer token serial numbers."),RESPONSE_REQUIRES_INTEGRITY_PROTECTION:new a(6035,v.KEYX_REQUIRED,"Message response requires integrity protection."),HANDSHAKE_DATA_MISSING:new a(6036,v.FAIL,"Handshake message is not renewable or does not contain key request data."),
MESSAGE_RECIPIENT_MISMATCH:new a(6037,v.FAIL,"Message recipient does not match local identity."),UNIDENTIFIED_KEYX_SCHEME:new a(7E3,v.FAIL,"Unable to identify key exchange scheme."),KEYX_FACTORY_NOT_FOUND:new a(7001,v.FAIL,"No factory registered for key exchange scheme."),KEYX_REQUEST_NOT_FOUND:new a(7002,v.FAIL,"No key request found matching header key response data."),UNIDENTIFIED_KEYX_KEY_ID:new a(7003,v.FAIL,"Unable to identify key exchange key ID."),UNSUPPORTED_KEYX_KEY_ID:new a(7004,v.FAIL,
"Unsupported key exchange key ID."),UNIDENTIFIED_KEYX_MECHANISM:new a(7005,v.FAIL,"Unable to identify key exchange mechanism."),UNSUPPORTED_KEYX_MECHANISM:new a(7006,v.FAIL,"Unsupported key exchange mechanism."),KEYX_RESPONSE_REQUEST_MISMATCH:new a(7007,v.FAIL,"Key exchange response does not match request."),KEYX_PRIVATE_KEY_MISSING:new a(7008,v.FAIL,"Key exchange private key missing."),UNKNOWN_KEYX_PARAMETERS_ID:new a(7009,v.FAIL,"Key exchange parameters ID unknown or invalid."),KEYX_MASTER_TOKEN_MISSING:new a(7010,
v.FAIL,"Master token required for key exchange is missing."),KEYX_INVALID_PUBLIC_KEY:new a(7011,v.FAIL,"Key exchange public key is invalid."),KEYX_PUBLIC_KEY_MISSING:new a(7012,v.FAIL,"Key exchange public key missing."),KEYX_WRAPPING_KEY_MISSING:new a(7013,v.FAIL,"Key exchange wrapping key missing."),KEYX_WRAPPING_KEY_ID_MISSING:new a(7014,v.FAIL,"Key exchange wrapping key ID missing."),KEYX_INVALID_WRAPPING_KEY:new a(7015,v.FAIL,"Key exchange wrapping key is invalid."),KEYX_INCORRECT_DATA:new a(7016,
v.FAIL,"Entity used incorrect wrapping key data type"),CRYPTEX_ENCRYPTION_ERROR:new a(8E3,v.FAIL,"Error encrypting data with cryptex."),CRYPTEX_DECRYPTION_ERROR:new a(8001,v.FAIL,"Error decrypting data with cryptex."),CRYPTEX_MAC_ERROR:new a(8002,v.FAIL,"Error computing MAC with cryptex."),CRYPTEX_VERIFY_ERROR:new a(8003,v.FAIL,"Error verifying MAC with cryptex."),CRYPTEX_CONTEXT_CREATION_FAILURE:new a(8004,v.FAIL,"Error creating cryptex cipher or MAC context."),DATAMODEL_DEVICE_ACCESS_ERROR:new a(8005,
v.TRANSIENT_FAILURE,"Error accessing data model device."),DATAMODEL_DEVICETYPE_NOT_FOUND:new a(8006,v.FAIL,"Data model device type not found."),CRYPTEX_KEYSET_UNSUPPORTED:new a(8007,v.FAIL,"Cryptex key set not supported."),CRYPTEX_PRIVILEGE_EXCEPTION:new a(8008,v.FAIL,"Insufficient privileges for cryptex operation."),CRYPTEX_WRAP_ERROR:new a(8009,v.FAIL,"Error wrapping data with cryptex."),CRYPTEX_UNWRAP_ERROR:new a(8010,v.FAIL,"Error unwrapping data with cryptex."),CRYPTEX_COMMS_FAILURE:new a(8011,
v.TRANSIENT_FAILURE,"Error comunicating with cryptex."),CRYPTEX_SIGN_ERROR:new a(8012,v.FAIL,"Error computing signature with cryptex."),INTERNAL_EXCEPTION:new a(9E3,v.TRANSIENT_FAILURE,"Internal exception."),MSL_COMMS_FAILURE:new a(9001,v.FAIL,"Error communicating with MSL entity."),NONE:new a(9999,v.FAIL,"Special unit test error.")});Object.freeze(a);var C;(function(){C=K.Class.create(Error());C.mixin({init:function(a,b,c){function d(){return g?g:this.cause&&this.cause instanceof C?this.cause.messageId:
n}Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var f=a.message;b&&(f+=" ["+b+"]");var g,h=this.stack;Object.defineProperties(this,{message:{value:f,writable:!1,configurable:!0},error:{value:a,writable:!1,configurable:!0},cause:{value:c,writable:!1,configurable:!0},name:{value:"MslException",writable:!1,configurable:!0},masterToken:{value:null,writable:!0,configurable:!1},entityAuthenticationData:{value:null,writable:!0,configurable:!1},userIdToken:{value:null,writable:!0,
configurable:!1},userAuthenticationData:{value:null,writable:!0,configurable:!1},messageId:{get:d,set:function(a){if(0>a||a>V)throw new RangeError("Message ID "+a+" is outside the valid range.");d()||(g=a)},configurable:!0},stack:{get:function(){var a=this.toString();h&&(a+="\n"+h);c&&c.stack&&(a+="\nCaused by "+c.stack);return a},configurable:!0}})},setEntity:function(a){!a||this.masterToken||this.entityAuthenticationData||(a instanceof Cb?this.masterToken=a:a instanceof Qc&&(this.entityAuthenticationData=
a));return this},setUser:function(a){!a||this.userIdToken||this.userAuthenticationData||(a instanceof zc?this.userIdToken=a:a instanceof Rc&&(this.userAuthenticationData=a));return this},setMessageId:function(a){this.messageId=a;return this},toString:function(){return this.name+": "+this.message}})})();var I=C.extend({init:function tg(a,b,c){tg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslCryptoException",writable:!1,configurable:!0}})}}),R=C.extend({init:function ug(a,b,c){ug.base.call(this,
a,b,c);Object.defineProperties(this,{name:{value:"MslEncodingException",writable:!1,configurable:!0}})}}),Fb=C.extend({init:function td(a,b,c){td.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslEntityAuthException",writable:!1,configurable:!0}})}}),Ha;(function(){Ha=K.Class.create(Error());Ha.mixin({init:function(a,b,c){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var d=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},
cause:{value:b,writable:!1,configurable:!1},requestCause:{value:c,writable:!1,configurable:!1},name:{value:"MslErrorResponseException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();d&&(a+="\n"+d);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+this.message}})})();var Ia;(function(){Ia=K.Class.create(Error());Ia.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);
var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslIoException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+this.message}})})();var P;(function(){P=K.Class.create(Error());P.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,
this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInternalException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+this.message}})})();var Ja;(function(){Ja=K.Class.create(Error());Ja.mixin({init:function(a,b){Error.captureStackTrace&&
Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInterruptedException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+this.message}})})();var pa=C.extend({init:function vg(a,b,c){vg.base.call(this,
a,b,c);Object.defineProperties(this,{name:{value:"MslKeyExchangeException",writable:!1,configurable:!0}})}}),Xb=C.extend({init:function wg(a,b){wg.base.call(this,a);Object.defineProperties(this,{masterToken:{value:b,writable:!1,configurable:!1},name:{value:"MslMasterTokenException",writable:!1,configurable:!0}})}}),ia=C.extend({init:function xg(a,b,c){xg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslMessageException",writable:!1,configurable:!0}})}}),xa=C.extend({init:function yg(a,
b,c){yg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslUserAuthException",writable:!1,configurable:!0}})}}),wa,ya,Ea;(function(){function a(b){return"undefined"===typeof b?!1:b}function b(a){return a&&a.length?(ya===h.V2014_02&&(a=a.map(function(a){return"wrap"==a?"wrapKey":"unwrap"==a?"unwrapKey":a})),a):ya===h.V2014_02?"encrypt decrypt sign verify deriveKey wrapKey unwrapKey".split(" "):"encrypt decrypt sign verify deriveKey wrap unwrap".split(" ")}function c(a,b,d,g,h){return Promise.resolve().then(function(){return E.importKey(a,
b,d,g,h)}).catch(function(c){if("spki"!==a&&"pkcs8"!==a)throw c;c=ASN1.webCryptoAlgorithmToJwkAlg(d);var l=ASN1.webCryptoUsageToJwkKeyOps(h);c=ASN1.rsaDerToJwk(b,c,l,g);if(!c)throw Error("Could not make valid JWK from DER input");c=JSON.stringify(c);return E.importKey("jwk",f(c),d,g,h)})}function g(a,b){return Promise.resolve().then(function(){return E.exportKey(a,b)}).catch(function(c){if("spki"!==a&&"pkcs8"!==a)throw c;return E.exportKey("jwk",b).then(function(a){a=JSON.parse(d(new Uint8Array(a)));
a=ASN1.jwkToRsaDer(a);if(!a)throw Error("Could not make valid DER from JWK input");return a.getDer().buffer})})}var h=Ea={LEGACY:1,V2014_01:2,V2014_02:3,LATEST:3};Object.freeze(Ea);ya=h.LATEST;wa={encrypt:function(a,b,c){switch(ya){case h.LEGACY:return new Promise(function(d,f){var g=E.encrypt(a,b,c);g.oncomplete=function(a){d(a.target.result)};g.onerror=function(a){f(a)}});case h.V2014_01:case h.V2014_02:return E.encrypt(a,b,c).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},decrypt:function(a,b,c){switch(ya){case h.LEGACY:return new Promise(function(d,f){var g=E.decrypt(a,b,c);g.oncomplete=function(a){d(a.target.result)};g.onerror=function(a){f(a)}});case h.V2014_01:case h.V2014_02:return E.decrypt(a,b,c).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},sign:function(a,b,c){switch(ya){case h.LEGACY:return new Promise(function(d,f){var g=E.sign(a,b,c);g.oncomplete=function(a){d(a.target.result)};
g.onerror=function(a){f(a)}});case h.V2014_01:case h.V2014_02:return E.sign(a,b,c).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},verify:function(a,b,c,d){switch(ya){case h.LEGACY:return new Promise(function(f,g){var h=E.verify(a,b,c,d);h.oncomplete=function(a){f(a.target.result)};h.onerror=function(a){g(a)}});case h.V2014_01:case h.V2014_02:return E.verify(a,b,c,d);default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},digest:function(a,b){switch(ya){case h.LEGACY:return new Promise(function(c,d){var f=E.digest(a,b);f.oncomplete=function(a){c(a.target.result)};f.onerror=function(a){d(a)}});case h.V2014_01:case h.V2014_02:return E.digest(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},generateKey:function(c,d,f){var g=a(d),l=b(f);switch(ya){case h.LEGACY:return new Promise(function(a,b){var d=E.generateKey(c,
g,l);d.oncomplete=function(b){a(b.target.result)};d.onerror=function(a){b(a)}});case h.V2014_01:case h.V2014_02:return E.generateKey(c,g,l);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},deriveKey:function(c,d,f,g,l){var k=a(g),q=b(l);switch(ya){case h.LEGACY:return new Promise(function(a,b){var g=E.deriveKey(c,d,f,k,q);g.oncomplete=function(b){a(b.target.result)};g.onerror=function(a){b(a)}});case h.V2014_01:case h.V2014_02:return E.deriveKey(c,d,f,k,q);default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},importKey:function(d,f,g,l,k){var q=a(l),p=b(k);switch(ya){case h.LEGACY:return new Promise(function(a,b){var c=E.importKey(d,f,g,q,p);c.oncomplete=function(b){a(b.target.result)};c.onerror=function(a){b(a)}});case h.V2014_01:case h.V2014_02:return c(d,f,g,q,p);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},exportKey:function(a,b){switch(ya){case h.LEGACY:return new Promise(function(c,d){var f=E.exportKey(a,b);f.oncomplete=function(a){c(a.target.result)};
f.onerror=function(a){d(a)}});case h.V2014_01:case h.V2014_02:return g(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},wrapKey:function(a,b,c,d){switch(ya){case h.LEGACY:return new Promise(function(a,f){var g=E.wrapKey(b,c,d);g.oncomplete=function(b){a(b.target.result)};g.onerror=function(a){f(a)}});case h.V2014_01:case h.V2014_02:return E.wrapKey(a,b,c,d).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},unwrapKey:function(c,d,f,g,l,k,q){switch(ya){case h.LEGACY:return new Promise(function(a,b){var c=E.unwrapKey(d,l,f);c.oncomplete=function(b){a(b.target.result)};c.onerror=function(a){b(a)}});case h.V2014_01:case h.V2014_02:return E.unwrapKey(c,d,f,g,l,a(k),b(q));default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}}};J&&J.getKeyByName&&(wa.getKeyByName=function(a){switch(ya){case h.LEGACY:return new Promise(function(b,c){var d=J.getKeyByName(a);
d.oncomplete=function(a){b(a.target.result)};d.onerror=function(a){c(a)}});case h.V2014_01:case h.V2014_02:return J.getKeyByName(a);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}})})();var Mb={name:"AES-KW"},Yb={name:"AES-CBC"},rb={name:"HMAC",hash:{name:"SHA-256"}},Z={name:"RSA-OAEP",hash:{name:"SHA-1"}},Ka={name:"RSAES-PKCS1-v1_5"},bb={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},cb=["encrypt","decrypt"],gb=["wrap","unwrap"],X=["sign","verify"],sb,xc,kb;(function(){sb=
K.Class.create({init:function(c,d,f){function g(a){b(d,function(){var b=a?G(a):n;Object.defineProperties(h,{rawKey:{value:c,writable:!1,configurable:!1},keyData:{value:a,writable:!1,configurable:!1},keyDataB64:{value:b,writable:!1,configurable:!1}});return this},h)}var h=this;b(d,function(){if(!c||"object"!=typeof c)throw new I(a.INVALID_SYMMETRIC_KEY);!f&&c.extractable?wa.exportKey("raw",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new I(a.KEY_EXPORT_ERROR,"raw"))}):g(f)},h)},size:function(){return this.keyData.length},
toByteArray:function(){return this.keyData},toBase64:function(){return this.keyDataB64}});xc=function(a,b){new sb(a,b)};kb=function(c,d,f,g){b(g,function(){try{c="string"==typeof c?L(c):c}catch(b){throw new I(a.INVALID_SYMMETRIC_KEY,"keydata "+c,b);}wa.importKey("raw",c,d,!0,f).then(function(a){new sb(a,g,c)},function(b){g.error(new I(a.INVALID_SYMMETRIC_KEY))})})}})();var Td,yc,pc;(function(){Td=K.Class.create({init:function(c,d,f){function g(a){b(d,function(){Object.defineProperties(h,{rawKey:{value:c,
writable:!1,configurable:!1},encoded:{value:a,writable:!1,configurable:!1}});return this},h)}var h=this;b(d,function(){if(!c||"object"!=typeof c||"public"!=c.type)throw new TypeError("Only original public crypto keys are supported.");!f&&c.extractable?wa.exportKey("spki",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new I(a.KEY_EXPORT_ERROR,"spki"))}):g(f)})},getEncoded:function(){return this.encoded}});yc=function(a,b){new Td(a,b)};pc=function(c,d,f,g){b(g,function(){try{c="string"==
typeof c?L(c):c}catch(b){throw new I(a.INVALID_PUBLIC_KEY,"spki "+c,b);}wa.importKey("spki",c,d,!0,f).then(function(a){new Td(a,g,c)},function(b){g.error(new I(a.INVALID_PUBLIC_KEY))})})}})();var se,Nc;(function(){se=K.Class.create({init:function(c,d,f){function g(a){b(d,function(){Object.defineProperties(h,{rawKey:{value:c,writable:!1,configurable:!1},encoded:{value:a,writable:!1,configurable:!1}});return this},h)}var h=this;b(d,function(){if(!c||"object"!=typeof c||"private"!=c.type)throw new TypeError("Only original private crypto keys are supported.");
!f&&c.extractable?wa.exportKey("pkcs8",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new I(a.KEY_EXPORT_ERROR,"pkcs8"))}):g(f)})},getEncoded:function(){return this.encoded}});Nc=function(a,b){new se(a,b)}})();var lb,te,Fa,Ud;(function(){var c=Ud={V1:1,V2:2};lb=K.Class.create({init:function(a,d,f,g){b(g,function(){var b=c.V1,g=a,h=null,l;for(l in sa)if(sa[l]==a){b=c.V2;g=null;h=a;break}Object.defineProperties(this,{version:{value:b,writable:!1,enumerable:!1,configurable:!1},keyId:{value:g,
writable:!1,configurable:!1},cipherSpec:{value:h,writable:!1,configurable:!1},iv:{value:d,writable:!1,configurable:!1},ciphertext:{value:f,writable:!1,configurable:!1}});return this},this)},toJSON:function(){var a={};switch(this.version){case c.V1:a.keyid=this.keyId;this.iv&&(a.iv=G(this.iv));a.ciphertext=G(this.ciphertext);a.sha256="AA==";break;case c.V2:a.version=this.version;a.cipherspec=this.cipherSpec;this.iv&&(a.iv=G(this.iv));a.ciphertext=G(this.ciphertext);break;default:throw new P("Ciphertext envelope version "+
this.version+" encoding unsupported.");}return a}});te=function(a,b,c,d){new lb(a,b,c,d)};Fa=function(d,f,g){b(g,function(){var b=d.keyid,h=d.cipherspec,l=d.iv,k=d.ciphertext,q=d.sha256;if(!f)if((f=d.version)&&"number"===typeof f&&f===f){var p=!1,n;for(n in c)if(c[n]==f){p=!0;break}if(!p)throw new I(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(d));}else f=c.V1;switch(f){case c.V1:if("string"!==typeof b||l&&"string"!==typeof l||"string"!==typeof k||"string"!==typeof q)throw new R(a.JSON_PARSE_ERROR,
"ciphertext envelope "+JSON.stringify(d));break;case c.V2:n=d.version;if(n!=c.V2)throw new I(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(d));if("string"!==typeof h||l&&"string"!==typeof l||"string"!==typeof k)throw new R(a.JSON_PARSE_ERROR,"ciphertext envelope "+JSON.stringify(d));h=oa(h);if(!h)throw new I(a.UNIDENTIFIED_CIPHERSPEC,"ciphertext envelope "+JSON.stringify(d));b=h;break;default:throw new I(a.UNSUPPORTED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(d));
}try{l&&(l=L(l)),k=L(k)}catch(r){throw new I(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,"encryption envelope "+JSON.stringify(d),r);}new lb(b,l,k,g)})}})();var tb,Vd,mb,Wd;(function(){var d=Wd={V1:1,V2:2};tb=K.Class.create({init:function(a,b,f){var g;switch(a){case d.V1:g=f;break;case d.V2:g={};g.version=a;g.algorithm=b;g.signature=G(f);g=c(JSON.stringify(g),Q);break;default:throw new P("Signature envelope version "+a+" encoding unsupported.");}Object.defineProperties(this,{version:{value:a,writable:!1,enumerable:!1,
configurable:!1},algorithm:{value:b,writable:!1,configurable:!1},signature:{value:f,writable:!1,configurable:!1},bytes:{value:g,writable:!1,configurable:!1}})}});Vd=function(){var a,c,f,g;2==arguments.length?(a=d.V1,c=arguments[0],f=null,g=arguments[1]):3==arguments.length&&(a=d.V2,f=arguments[0],c=arguments[1],g=arguments[2]);b(g,function(){return new tb(a,f,c)})};mb=function(c,f,g){b(g,function(){if(f)switch(f){case d.V1:return new tb(d.V1,null,c);case d.V2:try{var b=l(c,Q),g=JSON.parse(b),h=parseInt(g.version),
k=g.algorithm,q=g.signature;if(!h||"number"!==typeof h||h!=h||"string"!==typeof k||"string"!==typeof q)throw new R(a.JSON_PARSE_ERROR,"signature envelope "+G(c));if(d.V2!=h)throw new I(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+G(c));var p=da(k);if(!p)throw new I(a.UNIDENTIFIED_ALGORITHM,"signature envelope "+G(c));var n=L(q);if(!n)throw new I(a.INVALID_SIGNATURE,"signature envelope "+Base64Util.encode(c));return new tb(d.V2,p,n)}catch(r){if(r instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,
"signature envelope "+G(c),r);throw r;}default:throw new I(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+G(c));}try{b=l(c,Q),g=JSON.parse(b)}catch(t){g=null}if(g&&g.version){if(b=g.version,"number"!==typeof b||b!==b)b=d.V1}else b=d.V1;switch(b){case d.V1:return new tb(b,null,c);case d.V2:p=g.algorithm;q=g.signature;if("string"!==typeof p||"string"!==typeof q)return new tb(d.V1,null,c);p=da(p);if(!p)return new tb(d.V1,null,c);try{n=L(q)}catch(m){return new tb(d.V1,null,c)}return new tb(b,
p,n);default:throw new I(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+c);}})}})();var id=K.Class.create({encrypt:function(a,b){},decrypt:function(a,b){},wrap:function(a,b){},unwrap:function(a,b,c,d){},sign:function(a,b){},verify:function(a,b,c){}}),qc,fc;(function(){var c=fc={RSA_OAEP:Z.name,A128KW:Mb.name};m="A128GCM";qc=K.Class.create({init:function(a,b,d,f,g){switch(b){case c.RSA_OAEP:g=g&&(g.rawKey||g);f=f&&(f.rawKey||f);break;case c.A128KW:g=f=f&&(f.rawKey||f);break;default:throw new P("Unsupported algorithm: "+
b);}Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_algo:{value:b,writable:!1,enumerable:!1,configurable:!1},_enc:{value:d,writable:!1,enumerable:!1,configurable:!1},_wrapKey:{value:g,writable:!1,enumerable:!1,configurable:!1},_unwrapKey:{value:f,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new I(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new I(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,d){b(d,function(){wa.wrapKey("jwe+jwk",
c.rawKey,this._wrapKey,this._wrapKey.algorithm).then(function(a){d.result(a)},function(b){d.error(new I(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function h(c){b(g,function(){switch(c.type){case "secret":xc(c,g);break;case "public":yc(c,g);break;case "private":Nc(c,g);break;default:throw new I(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){wa.unwrapKey("jwe+jwk",c,this._unwrapKey,this._unwrapKey.algorithm,d,!1,f).then(function(a){h(a)},function(){g.error(new I(a.UNWRAP_ERROR))})},this)},
sign:function(b,c){c.error(new I(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,d){d.error(new I(a.VERIFY_NOT_SUPPORTED))}})})();var Sc=id.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},wrap:function(a,b){b.result(a)},unwrap:function(a,b,c,d){d.result(a)},sign:function(a,b){b.result(new Uint8Array(0))},verify:function(a,b,c){c.result(!0)}}),Tc,Va;(function(){var d=Va={ENCRYPT_DECRYPT_OAEP:1,ENCRYPT_DECRYPT_PKCS1:2,WRAP_UNWRAP_OAEP:3,WRAP_UNWRAP_PKCS1:4,SIGN_VERIFY:5};Tc=
id.extend({init:function vd(a,b,c,f,g){vd.base.call(this);c&&(c=c.rawKey);f&&(f=f.rawKey);Object.defineProperties(this,{id:{value:b,writable:!1,enumerable:!1,configurable:!1},privateKey:{value:c,writable:!1,enumerable:!1,configurable:!1},publicKey:{value:f,writable:!1,enumerable:!1,configurable:!1},transform:{value:g==d.ENCRYPT_DECRYPT_PKCS1?Ka:g==d.ENCRYPT_DECRYPT_OAEP?Z:"nullOp",writable:!1,enumerable:!1,configurable:!1},wrapTransform:{value:g==d.WRAP_UNWRAP_PKCS1?Ka:g==d.WRAP_UNWRAP_OAEP?Z:"nullOp",
writable:!1,enumerable:!1,configurable:!1},algo:{value:g==d.SIGN_VERIFY?bb:"nullOp",writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(d,f){var g=this;b(f,function(){if("nullOp"==this.transform)return d;if(!this.publicKey)throw new I(a.ENCRYPT_NOT_SUPPORTED,"no public key");if(0==d.length)return d;wa.encrypt(g.transform,g.publicKey,d).then(function(b){te(g.id,null,b,{result:function(b){try{var d=JSON.stringify(b);f.result(c(d,Q))}catch(g){f.error(new I(a.ENCRYPT_ERROR,null,g))}},error:function(b){b instanceof
C||(b=new I(a.ENCRYPT_ERROR,null,b));f.error(b)}})},function(b){f.error(new I(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,d){var f=this;b(d,function(){if("nullOp"==this.transform)return c;if(!this.privateKey)throw new I(a.DECRYPT_NOT_SUPPORTED,"no private key");if(0==c.length)return c;var b;try{var g=l(c,Q);b=JSON.parse(g)}catch(h){if(h instanceof SyntaxError)throw new I(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,h);throw new I(a.DECRYPT_ERROR,null,h);}Fa(b,Ud.V1,{result:function(b){try{if(b.keyId!=
f.id)throw new I(a.ENVELOPE_KEY_ID_MISMATCH);var c=d.result;wa.decrypt(f.transform,f.privateKey,b.ciphertext).then(c,function(b){d.error(new I(a.DECRYPT_ERROR))})}catch(g){g instanceof C?d.error(g):d.error(new I(a.DECRYPT_ERROR,null,g))}},error:function(b){b instanceof R&&(b=new I(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof C||(b=new I(a.DECRYPT_ERROR,null,b));d.error(b)}})},this)},wrap:function(c,d){b(d,function(){if("nullOp"==this.wrapTransform||!this.publicKey)throw new I(a.WRAP_NOT_SUPPORTED,
"no public key");var b=d.result;wa.wrapKey("jwk",c.rawKey,this.publicKey,this.wrapTransform).then(b,function(b){d.error(new I(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function h(c){b(g,function(){switch(c.type){case "secret":xc(c,g);break;case "public":yc(c,g);break;case "private":Nc(c,g);break;default:throw new I(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){if("nullOp"==this.wrapTransform||!this.privateKey)throw new I(a.UNWRAP_NOT_SUPPORTED,"no private key");wa.unwrapKey("jwk",
c,this.privateKey,{name:this.privateKey.algorithm.name,hash:{name:"SHA-1"}},d,!1,f).then(h,function(b){g.error(new I(a.UNWRAP_ERROR))})},this)},sign:function(c,d){b(d,function(){if("nullOp"==this.algo)return new Uint8Array(0);if(!this.privateKey)throw new I(a.SIGN_NOT_SUPPORTED,"no private key");wa.sign(this.algo,this.privateKey,c).then(function(a){Vd(a,{result:function(a){d.result(a.bytes)},error:d.error})},function(b){d.error(new I(a.SIGNATURE_ERROR))})},this)},verify:function(c,d,f){var g=this;
b(f,function(){if("nullOp"==this.algo)return!0;if(!this.publicKey)throw new I(a.VERIFY_NOT_SUPPORTED,"no public key");mb(d,Wd.V1,{result:function(d){b(f,function(){var b=f.result;wa.verify(this.algo,this.publicKey,d.signature,c).then(b,function(b){f.error(new I(a.SIGNATURE_ERROR))})},g)},error:f.error})},this)}})})();var Nb;(function(){Nb=id.extend({init:function ud(a,b,c,d,f){ud.base.call(this);c=c&&c.rawKey;d=d&&d.rawKey;f=f&&f.rawKey;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,
configurable:!1},id:{value:b,writable:!1,enumerable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,enumerable:!1,configurable:!1},hmacKey:{value:d,writable:!1,enumerable:!1,configurable:!1},wrapKey:{value:f,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(d,f){var g=this;b(f,function(){if(!this.encryptionKey)throw new I(a.ENCRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==d.length)return d;var b=new Uint8Array(16);this.ctx.getRandom().nextBytes(b);wa.encrypt({name:Yb.name,
iv:b},g.encryptionKey,d).then(function(d){d=new Uint8Array(d);te(g.id,b,d,{result:function(b){try{var d=JSON.stringify(b);f.result(c(d,Q))}catch(g){f.error(new I(a.ENCRYPT_ERROR,null,g))}},error:function(b){b instanceof C||(b=new I(a.ENCRYPT_ERROR,null,b));f.error(b)}})},function(b){f.error(new I(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,d){var f=this;b(d,function(){if(!this.encryptionKey)throw new I(a.DECRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==c.length)return c;var b;try{var g=
l(c,Q);b=JSON.parse(g)}catch(h){if(h instanceof SyntaxError)throw new I(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,h);throw new I(a.DECRYPT_ERROR,null,h);}Fa(b,Ud.V1,{result:function(b){try{if(b.keyId!=f.id)throw new I(a.ENVELOPE_KEY_ID_MISMATCH);wa.decrypt({name:Yb.name,iv:b.iv},f.encryptionKey,b.ciphertext).then(function(a){a=new Uint8Array(a);d.result(a)},function(){d.error(new I(a.DECRYPT_ERROR))})}catch(c){c instanceof C?d.error(c):d.error(new I(a.DECRYPT_ERROR,null,c))}},error:function(b){b instanceof
R&&(b=new I(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof C||(b=new I(a.DECRYPT_ERROR,null,b));d.error(b)}})},this)},wrap:function(c,d){b(d,function(){if(!this.wrapKey)throw new I(a.WRAP_NOT_SUPPORTED,"no wrap/unwrap key");wa.wrapKey("raw",c.rawKey,this.wrapKey,this.wrapKey.algorithm).then(function(a){d.result(a)},function(b){d.error(new I(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function h(c){b(g,function(){switch(c.type){case "secret":xc(c,g);break;case "public":yc(c,g);break;
case "private":Nc(c,g);break;default:throw new I(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){if(!this.wrapKey)throw new I(a.UNWRAP_NOT_SUPPORTED,"no wrap/unwrap key");wa.unwrapKey("raw",c,this.wrapKey,this.wrapKey.algorithm,d,!1,f).then(function(a){h(a)},function(b){g.error(new I(a.UNWRAP_ERROR))})},this)},sign:function(c,d){var f=this;b(d,function(){if(!this.hmacKey)throw new I(a.SIGN_NOT_SUPPORTED,"no HMAC key.");wa.sign(rb,this.hmacKey,c).then(function(a){b(d,function(){var b=new Uint8Array(a);
Vd(b,{result:function(a){d.result(a.bytes)},error:d.error})},f)},function(){d.error(new I(a.HMAC_ERROR))})},this)},verify:function(c,d,f){var g=this;b(f,function(){if(!this.hmacKey)throw new I(a.VERIFY_NOT_SUPPORTED,"no HMAC key.");mb(d,Wd.V1,{result:function(d){b(f,function(){wa.verify(rb,this.hmacKey,d.signature,c).then(function(a){f.result(a)},function(b){f.error(new I(a.HMAC_ERROR))})},g)},error:f.error})},this)}})})();var nb=Nb.extend({init:function ud(b,c,d,f,g){if(d||f||g)ud.base.call(this,
b,d+"_"+c.sequenceNumber,f,g,null);else{if(!c.isDecrypted())throw new Xb(a.MASTERTOKEN_UNTRUSTED,c);ud.base.call(this,b,c.identity+"_"+c.sequenceNumber,c.encryptionKey,c.hmacKey,null)}}}),ue=id.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},wrap:function(a,b){b.error(new P("Wrap is unsupported by the MSL token crypto context."))},unwrap:function(a,b,c,d){d.error(new P("Unwrap is unsupported by the MSL token crypto context."))},sign:function(a,b){b.result(new Uint8Array(0))},
verify:function(a,b,c){c.result(!1)}}),za={PSK:"PSK",MGK:"MGK",X509:"X509",RSA:"RSA",NPTICKET:"NPTICKET",ECC:"ECC",NONE:"NONE"};Object.freeze(za);var Qc,Xd;(function(){Qc=K.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},getIdentity:function(){},getAuthData:function(){},equals:function(a){return this===a?!0:a instanceof Qc?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;a.authdata=this.getAuthData();return a}});
Xd=function(b,c){var d=c.scheme,f=c.authdata;if(!d||!f)throw new R(a.JSON_PARSE_ERROR,"entityauthdata "+JSON.stringify(c));if(!za[d])throw new Fb(a.UNIDENTIFIED_ENTITYAUTH_SCHEME,d);var g=b.getEntityAuthenticationFactory(d);if(!g)throw new Fb(a.ENTITYAUTH_FACTORY_NOT_FOUND,d);return g.createData(b,f)}})();var Cd=K.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b){},getCryptoContext:function(a,b){}}),Zb,ve;(function(){Zb=
Qc.extend({init:function vd(a){vd.base.call(this,za.MGK);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function wd(a){return this===a?!0:a instanceof Zb?wd.base.call(this,this,a)&&this.identity==a.identity:!1}});ve=function(b){var c=b.identity;if(!c)throw new R(a.JSON_PARSE_ERROR,"mgk authdata"+JSON.stringify(b));return new Zb(c)}})();var Cg=Cd.extend({init:function vd(a){vd.base.call(this,
za.MGK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return ve(b)},getCryptoContext:function(b,c){if(!(c instanceof Zb))throw new P("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw(new Fb(a.ENTITY_NOT_FOUND,"mgk "+c.identity)).setEntity(c);return new Sc}}),$b,lf;(function(){$b=Qc.extend({init:function wd(a){wd.base.call(this,za.PSK);Object.defineProperties(this,{identity:{value:a,
writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function Lc(a){return this===a?!0:a instanceof $b?Lc.base.call(this,this,a)&&this.identity==a.identity:!1}});lf=function(b){var c=b.identity;if(!c)throw new R(a.JSON_PARSE_ERROR,"psk authdata"+JSON.stringify(b));return new $b(c)}})();var we;we=Cd.extend({init:function wd(a){wd.base.call(this,za.PSK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,
enumerable:!1,configurable:!1}})},createData:function(a,b){return lf(b)},getCryptoContext:function(b,c){if(!(c instanceof $b))throw new P("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.getIdentity()!=this.localIdentity)throw(new Fb(a.ENTITY_NOT_FOUND,"psk "+c.identity)).setEntity(c);return new Sc}});var Yd,mf;(function(){Yd=Qc.extend({init:function Lc(a,b){Lc.base.call(this,za.RSA);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1},publicKeyId:{value:b,
writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;a.pubkeyid=this.publicKeyId;return a},equals:function ec(a){return this===a?!0:a instanceof Yd?ec.base.call(this,this,a)&&this.identity==a.identity&&this.publicKeyId==a.publicKeyId:!1}});mf=function(b){var c=b.identity,d=b.pubkeyid;if(!c||"string"!==typeof c||!d||"string"!==typeof d)throw new R(a.JSON_PARSE_ERROR,"RSA authdata"+JSON.stringify(b));return new Yd(c,d)}})();
var Dg=Cd.extend({init:function Lc(a){Lc.base.call(this,za.RSA);Object.defineProperties(this,{store:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return mf(b)},getCryptoContext:function(b,c){if(!(c instanceof Yd))throw new P("Incorrect authentication data type "+c+".");var d=c.identity,f=c.publicKeyId,g=this.store.getPublicKey(f);if(!g)throw(new Fb(a.RSA_PUBLICKEY_NOT_FOUND,f)).setEntity(c);return new Tc(b,d,null,g,Va.SIGN_VERIFY)}}),Ad,nf;(function(){Ad=Qc.extend({init:function ec(a){ec.base.call(this,
za.NONE);Object.defineProperties(this,{identity:{value:a,writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function xd(a){return this===a?!0:a instanceof Ad?xd.base.call(this,this,a)&&this.identity==a.identity:!1}});nf=function(b){var c=b.identity;if(!c)throw new R(a.JSON_PARSE_ERROR,"Unauthenticated authdata"+JSON.stringify(b));return new Ad(c)}})();var Ag=Cd.extend({init:function ec(){ec.base.call(this,za.NONE)},
createData:function(a,b){return nf(b)},getCryptoContext:function(a,b){if(!(b instanceof Ad))throw new P("Incorrect authentication data type "+JSON.stringify(b)+".");return new Sc}}),Eg=K.Class.create({init:function(){Object.defineProperties(this,{rsaKeys:{value:{},writable:!1,enumerable:!1,configurable:!1}})},addPublicKey:function(a,b){if(!(b instanceof Td))throw new P("Incorrect key data type "+b+".");this.rsaKeys[a]=b},getIdentities:function(){return Object.keys(this.rsaKeys)},removePublicKey:function(a){delete this.rsaKeys[a]},
getPublicKey:function(a){return this.rsaKeys[a]}}),xe=K.Class.create({abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){}}),Zd=K.Class.create({abort:function(){},close:function(a,b){},write:function(a,b,c,d,f){},flush:function(a,b){}}),Fg=K.Class.create({init:function(a){Object.defineProperties(this,{_data:{value:a,writable:!1,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_currentPosition:{value:0,
writable:!0,enumerable:!1,configurable:!1},_mark:{value:-1,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){},close:function(){this._close=!0},mark:function(){this._mark=this._currentPosition},reset:function(){if(-1==this._mark)throw new Ia("Stream has not been marked.");this._currentPosition=this._mark},markSupported:function(){return!0},read:function(a,b,c){h(c,function(){if(this._closed)throw new Ia("Stream is already closed.");if(this._currentPosition==this._data.length)return null;
-1==a&&(a=this._data.length-this._currentPosition);var b=this._data.subarray(this._currentPosition,this._currentPosition+a);this._currentPosition+=b.length;return b},this)}}),of=K.Class.create({init:function(){var a={_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_result:{value:new Uint8Array(0),writable:!0,enuemrable:!1,configurable:!1},_buffered:{value:[],writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},abort:function(){},close:function(a,b){this._closed=
!0;b.result(!0)},write:function(a,b,c,d,f){h(f,function(){if(this._closed)throw new Ia("Stream is already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");var d=a.subarray(b,c);this._buffered.push(d);return d.length},this)},flush:function(a,b){for(;0<this._buffered.length;){var c=this._buffered.shift();if(this._result){var d=
new Uint8Array(this._result.length+c.length);d.set(this._result);d.set(c,this._result.length);this._result=d}else this._result=new Uint8Array(c)}b.result(!0)},size:function(){this.flush(1,{result:function(){}});return this._result.length},toByteArray:function(){this.flush(1,{result:function(){}});return this._result}}),yd,Gg=K.Class.create({getResponse:function(a,b,c){}});(function(){var a=Zd.extend({init:function(a,b){var c={_httpLocation:{value:a,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:b,
writable:!0,enumerable:!1,configurable:!1},_buffer:{value:new of,writable:!1,enumerable:!1,configurable:!1},_response:{value:n,writable:!0,enumerable:!1,configurable:!1},_abortToken:{value:n,writable:!0,enumerable:!1,configurable:!1},_responseQueue:{value:new Y,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(a){this._timeout=a},getResponse:function(a,b){var c=this;this._responseQueue.poll(a,{result:function(a){h(b,function(){a&&this._responseQueue.add(a);
return a},c)},timeout:function(){h(b,function(){this._response={isTimeout:!0};this._responseQueue.add(this._response);this.abort();b.timeout()},c)},error:function(a){h(b,function(){this._response={isError:!0};this._responseQueue.add(this._response);throw a;},c)}})},abort:function(){this._abortToken&&this._abortToken.abort()},close:function(a,b){var c=this;h(b,function(){if(this._response)return!0;var a=this._buffer.toByteArray();0<a.length&&(this._abortToken=this._httpLocation.getResponse({body:a},
this._timeout,{result:function(a){c._response={response:a};c._responseQueue.add(c._response)},timeout:function(){c._response={isTimeout:!0};c._responseQueue.add(c._response)},error:function(a){c._response={isError:!0,error:a};c._responseQueue.add(c._response)}}));return!0},this)},write:function(a,b,c,d,f){h(f,function(){if(this._response)throw new Ia("HttpOutputStream already closed.");this._buffer.write(a,b,c,d,f)},this)},flush:function(a,b){h(b,function(){if(this._response)return!0;this._buffer.flush(a,
b)},this)}}),b=xe.extend({init:function(a){Object.defineProperties(this,{_out:{value:a,writable:!1,enumerable:!1,configurable:!1},_buffer:{value:n,writable:!0,enumerable:!1,configurable:!1},_exception:{value:n,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_json:{value:n,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){this._out.abort()},close:function(){this._buffer&&
this._buffer.close()},mark:function(){this._buffer||this._buffer.mark()},reset:function(){this._buffer&&this._buffer.reset()},markSupported:function(){if(this._buffer)return this._buffer.markSupported()},read:function(a,b,c){function d(l){h(c,function(){if(!l)return new Uint8Array(0);this._out.getResponse(b,{result:function(d){h(c,function(){var h;if(d.isTimeout)this._timedout=!0,c.timeout();else{if(d.isError)throw this._exception=d.error||new Ia("Unknown HTTP exception."),this._exception;if(!d.response)throw this._exception=
new Ia("Missing HTTP response."),this._exception;d.response.json!==n&&(this._json=d.response.json,this.getJSON=function(){return g._json});h=d.response.content||f("string"===typeof d.response.body?d.response.body:JSON.stringify(this._json));this._buffer=new Fg(h);this._buffer.read(a,b,c)}},g)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},g)}var g=this;h(c,function(){if(this._exception)throw this._exception;if(this._timedout)c.timeout();else{if(this._aborted)return new Uint8Array(0);
this._buffer?this._buffer.read(a,b,c):this._out.close(b,{result:function(a){d(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}},g)}});yd=K.Class.create({init:function(a,b){Object.defineProperties(this,{_httpLocation:{value:a,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:b,writable:!0,enumerable:!1,configurable:!1}})},setTimeout:function(a){this._timeout=a},openConnection:function(){var c=new a(this._httpLocation,this._timeout);return{input:new b(c),output:c}}})})();
var re;(function(){var a=Zd.extend({init:function(){var a={_buffer:{value:new Uint8Array,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setTimeout:function(){},getResponse:function(a,b){b.result({success:!1,content:null,errorHttpCode:n,errorSubCode:n})},abort:function(){},close:function(a,b){b.result(!0)},write:function(a,b,c,d,f){try{if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");
var g=a.subarray(b,c),h=new Uint8Array(this._buffer.length+g.length);h.set(this._buffer);h.set(g,this._buffer.length);this._buffer=h;f.result(g.length)}catch(l){f.error(l)}},flush:function(a,b){b.result(!0)},request:function(){return this._buffer}}),b=xe.extend({init:function(){},abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){c.result(new Uint8Array(16))}});re=K.Class.create({init:function(){var c={output:{value:new a,writable:!1,
enumerable:!1,configurable:!1},input:{value:new b,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(){},openConnection:function(){return{input:this.input,output:this.output}},getRequest:function(){return d(this.output.request())}})})();var pf=function(a,b,c){function d(a){a=new Hg(l(a,"utf-8"));var b=[],c;for(c=a.nextValue();c!==n;)b.push(c),c=a.nextValue();return b}(function(a,b,d){a.read(-1,b,{result:function(a){a&&a.length?d(null,a):d(null,null)},
timeout:function(){c.timeout()},error:function(a){d(a,null)}})})(a,b,function(b,f){b?c.error(b):f?a.getJSON!==n&&"function"===typeof a.getJSON?c.result(a.getJSON()):c.result(d(f)):c.result(null)})},Ob={SYMMETRIC_WRAPPED:"SYMMETRIC_WRAPPED",ASYMMETRIC_WRAPPED:"ASYMMETRIC_WRAPPED",DIFFIE_HELLMAN:"DIFFIE_HELLMAN",JWE_LADDER:"JWE_LADDER",JWK_LADDER:"JWK_LADDER",AUTHENTICATED_DH:"AUTHENTICATED_DH"};Object.freeze(Ob);var Dd,qf;(function(){Dd=K.Class.create({init:function(a){Object.defineProperties(this,
{keyExchangeScheme:{value:a,writable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===a?!0:a instanceof Dd?this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.keyExchangeScheme}});qf=function(c,d,f){b(f,function(){var b=d.scheme,g=d.keydata;if(!b||!g||"object"!==typeof g)throw new R(a.JSON_PARSE_ERROR,"keyrequestdata "+JSON.stringify(d));if(!Ob[b])throw new pa(a.UNIDENTIFIED_KEYX_SCHEME,
b);var h=c.getKeyExchangeFactory(b);if(!h)throw new pa(a.KEYX_FACTORY_NOT_FOUND,b);h.createRequestData(c,g,f)})}})();var Ed,ye;(function(){Ed=K.Class.create({init:function(a,b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},keyExchangeScheme:{value:b,wrtiable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.mastertoken=this.masterToken;a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===
a?!0:a instanceof Ed?this.masterToken.equals(a.masterToken)&&this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.masterToken.uniqueKey()+":"+this.keyExchangeScheme}});ye=function(c,d,f){b(f,function(){var g=d.mastertoken,h=d.scheme,l=d.keydata;if(!h||!g||"object"!==typeof g||!l||"object"!==typeof l)throw new R(a.JSON_PARSE_ERROR,"keyresponsedata "+JSON.stringify(d));if(!Ob[h])throw new pa(a.UNIDENTIFIED_KEYX_SCHEME,h);Uc(c,g,{result:function(d){b(f,function(){var b=c.getKeyExchangeFactory(h);
if(!b)throw new pa(a.KEYX_FACTORY_NOT_FOUND,h);return b.createResponseData(c,d,l)})},error:function(a){f.error(a)}})})}})();var Pb;(function(){var c=K.Class.create({init:function(a,b){Object.defineProperties(this,{keyResponseData:{value:a,writable:!1,configurable:!1},cryptoContext:{value:b,writable:!1,configurable:!1}})}});Pb=K.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createRequestData:function(a,b,c){},createResponseData:function(a,
b,c){},generateResponse:function(a,b,c,d){},getCryptoContext:function(a,b,c,d,f){},generateSessionKeys:function(c,d){b(d,function(){var b=new Uint8Array(16),f=new Uint8Array(32);c.getRandom().nextBytes(b);c.getRandom().nextBytes(f);kb(b,Yb,cb,{result:function(b){kb(f,rb,X,{result:function(a){d.result({encryptionKey:b,hmacKey:a})},error:function(b){d.error(new I(a.SESSION_KEY_CREATION_FAILURE,null,b))}})},error:function(b){d.error(new I(a.SESSION_KEY_CREATION_FAILURE,null,b))}})})},importSessionKeys:function(a,
b,c){kb(a,Yb,cb,{result:function(a){kb(b,rb,X,{result:function(b){c.result({encryptionKey:a,hmacKey:b})},error:function(a){c.error(a)}})},error:function(a){c.error(a)}})}});Pb.KeyExchangeData=c})();var rf,ze,sf;(function(){function c(f,g,h,l,k){b(k,function(){switch(g){case d.PSK:var c=new $b(l),q=f.getEntityAuthenticationFactory(za.PSK);if(!q)throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);c=q.getCryptoContext(f,c);return new qc(f,fc.A128KW,m,n);case d.MGK:c=new Zb(l);q=f.getEntityAuthenticationFactory(za.MGK);
if(!q)throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);c=q.getCryptoContext(f,c);return new qc(f,fc.A128KW,m,n);case d.WRAP:c=f.getMslCryptoContext();c.unwrap(h,Mb,gb,{result:function(a){b(k,function(){return new qc(f,fc.A128KW,m,a)})},error:k.error});break;default:throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);}})}var d={PSK:"PSK",MGK:"MGK",WRAP:"WRAP"},f=ze=Dd.extend({init:function Ga(a,b){Ga.base.call(this,Ob.JWE_LADDER);switch(a){case d.WRAP:if(!b)throw new P("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");
break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=G(this.wrapdata));return a},equals:function Ta(a){return a===this?!0:a instanceof ze?Ta.base.call(this,a)&&this.mechanism==a.mechanism&&g(this.wrapdata,a.wrapdata):!1},uniqueKey:function Pc(){var a=Pc.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+t(this.wrapdata));
return a}}),h=sf=Ed.extend({init:function qb(a,b,c,d,f){qb.base.call(this,a,Ob.JWE_LADDER);Object.defineProperties(this,{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:d,writable:!1,configurable:!1},hmacKey:{value:f,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.wrapkey=G(this.wrapKey);a.wrapdata=G(this.wrapdata);a.encryptionkey=G(this.encryptionKey);a.hmackey=G(this.hmacKey);return a},equals:function Ua(a){return this===
a?!0:a instanceof sf?Ua.base.call(this,a)&&g(this.wrapKey,a.wrapKey)&&g(this.wrapdata,a.wrapdata)&&g(this.encryptionKey,a.encryptionKey)&&g(this.hmacKey,a.hmacKey):!1},uniqueKey:function Bb(){return Bb.base.call(this)+":"+t(this.wrapKey)+":"+t(this.wrapdata)+":"+t(this.encryptionKey)+":"+t(this.hmacKey)}});rf=Pb.extend({init:function gd(a){gd.base.call(this,Ob.JWE_LADDER);Object.defineProperties(this,{repository:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createRequestData:function(c,g,
h){b(h,function(){var b=g.mechanism,c=g.wrapdata;if(!b||b==d.WRAP&&(!c||"string"!==typeof c))throw new R(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(g));if(!d[b])throw new pa(a.UNIDENTIFIED_KEYX_MECHANISM,b);var h;switch(b){case d.WRAP:try{h=L(c)}catch(l){throw new pa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+g.toString());}if(null==h||0==h.length)throw new pa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+g.toString());break;default:h=null}return new f(b,h)})},createResponseData:function(b,c,d){b=d.wrapkey;
var f=d.wrapdata,g=d.encryptionkey,l=d.hmackey;if(!(b&&"string"===typeof b&&f&&"string"===typeof f&&g&&"string"===typeof g&&l)||"string"!==typeof l)throw new R(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(d));var k,q,p,n;try{k=L(b),q=L(f)}catch(r){throw new I(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(d),r);}try{p=L(g)}catch(t){throw new I(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),t);}try{n=L(l)}catch(m){throw new I(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(d),m);}return new h(c,
k,q,p,n)},generateResponse:function(d,g,l,k){function q(a,c,f){t.generateSessionKeys(d,{result:function(d){b(k,function(){p(a,c,f,d.encryptionKey,d.hmacKey)},t)},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;})}})}function p(a,f,h,l,q){b(k,function(){c(d,g.mechanism,g.wrapdata,a,{result:function(a){a.wrap(f,{result:function(a){n(f,h,l,q,a)},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;})}})},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);
throw a;})}})},t)}function n(a,c,f,g,h){b(k,function(){var l=new qc(d,fc.A128KW,m,a);l.wrap(f,{result:function(a){l.wrap(g,{result:function(b){r(c,h,f,a,g,b)},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;})}})},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;})}})},t)}function r(a,c,f,g,q,p){b(k,function(){var n=d.getTokenFactory();u?n.renewMasterToken(d,u,f,q,{result:function(f){b(k,function(){var b=new nb(d,f),l=new h(f,c,a,g,p);return new Pb.KeyExchangeData(l,
b,k)},t)},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;})}}):n.createMasterToken(d,l,f,q,{result:function(f){b(k,function(){var b=new nb(d,f),l=new h(f,c,a,g,p);return new Pb.KeyExchangeData(l,b,k)},t)},error:k.error})},t)}var t=this,u;b(k,function(){if(!(g instanceof f))throw new P("Key request data "+JSON.stringify(g)+" was not created by this factory.");var c=l;if(l instanceof Cb){if(!l.isVerified())throw new Xb(a.MASTERTOKEN_UNTRUSTED,l);u=l;c=l.identity}var h=new Uint8Array(16);
d.getRandom().nextBytes(h);kb(h,Mb,gb,{result:function(a){b(k,function(){d.getMslCryptoContext().wrap(a,{result:function(b){q(c,a,b)},error:function(a){b(k,function(){a instanceof C&&a.setEntity(u);throw a;},t)}})},t)},error:function(c){b(k,function(){throw(new I(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(u);},t)}})},t)},getCryptoContext:function(c,g,l,k,q){function p(a,d,f,g,h){b(q,function(){var l=new qc(c,fc.A128KW,m,h);l.unwrap(d.encryptionKey,Yb,cb,{result:function(h){l.unwrap(d.hmacKey,
rb,X,{result:function(a){b(q,function(){this.repository.addCryptoContext(d.wrapdata,l);this.repository.removeCryptoContext(f);return new nb(c,d.masterToken,g,h,a)},r)},error:function(c){b(q,function(){c instanceof C&&c.setEntity(a);throw c;})}})},error:function(c){b(q,function(){c instanceof C&&c.setEntity(a);throw c;})}})},r)}var r=this;b(q,function(){if(!(g instanceof f))throw new P("Key request data "+JSON.stringify(g)+" was not created by this factory.");if(!(l instanceof h))throw new P("Key response data "+
JSON.stringify(l)+" was not created by this factory.");var k=g.mechanism,t=g.wrapdata;c.getEntityAuthenticationData(null,{result:function(f){b(q,function(){var g=f.getIdentity(),h;switch(k){case d.PSK:h=new $b(g);var r=c.getEntityAuthenticationFactory(za.PSK);if(!r)throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(f);h=r.getCryptoContext(c,h);h=new qc(c,fc.A128KW,m,n);break;case d.MGK:h=new Zb(g);r=c.getEntityAuthenticationFactory(za.MGK);if(!r)throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(f);
h=r.getCryptoContext(c,h);h=new qc(c,fc.A128KW,m,h.wrapKey);break;case d.WRAP:h=this.repository.getCryptoContext(t);if(!h)throw(new pa(a.KEYX_WRAPPING_KEY_MISSING,G(t))).setEntity(f);break;default:throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(f);}h.unwrap(l.wrapKey,Mb,gb,{result:function(a){p(f,l,t,g,a)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(f);throw a;})}})},r)},error:q.error})},r)}})})();var Be,ub,ta;(function(){function c(f,g,h,k,q){b(q,function(){switch(g){case d.PSK:var c=
new $b(k),p=f.getEntityAuthenticationFactory(za.PSK);if(!p)throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);c=p.getCryptoContext(f,c);return new l(n);case d.MGK:c=new Zb(k);p=f.getEntityAuthenticationFactory(za.MGK);if(!p)throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);c=p.getCryptoContext(f,c);return new l(n);case d.WRAP:c=f.getMslCryptoContext();c.unwrap(h,Mb,gb,{result:function(a){b(q,function(){return new l(a)})},error:q.error});break;default:throw new pa(a.UNSUPPORTED_KEYX_MECHANISM,g);}})}var d={PSK:"PSK",
MGK:"MGK",WRAP:"WRAP"},f=ub=Dd.extend({init:function Ta(a,b){Ta.base.call(this,Ob.JWK_LADDER);switch(a){case d.WRAP:if(!b)throw new P("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=G(this.wrapdata));return a},equals:function Pc(a){return a===
this?!0:a instanceof ub?Pc.base.call(this,a)&&this.mechanism==a.mechanism&&g(this.wrapdata,a.wrapdata):!1},uniqueKey:function qb(){var a=qb.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+t(this.wrapdata));return a}}),h=ta=Ed.extend({init:function Ua(a,b,c,d,f){Ua.base.call(this,a,Ob.JWK_LADDER);Object.defineProperties(this,{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:d,writable:!1,configurable:!1},hmacKey:{value:f,writable:!1,
configurable:!1}})},getKeydata:function(){var a={};a.wrapkey=G(this.wrapKey);a.wrapdata=G(this.wrapdata);a.encryptionkey=G(this.encryptionKey);a.hmackey=G(this.hmacKey);return a},equals:function Bb(a){return this===a?!0:a instanceof ta?Bb.base.call(this,a)&&g(this.wrapKey,a.wrapKey)&&g(this.wrapdata,a.wrapdata)&&g(this.encryptionKey,a.encryptionKey)&&g(this.hmacKey,a.hmacKey):!1},uniqueKey:function gd(){return gd.base.call(this)+":"+t(this.wrapKey)+":"+t(this.wrapdata)+":"+t(this.encryptionKey)+":"+
t(this.hmacKey)}}),l=id.extend({init:function(a){a&&a.rawKey&&(a=a.rawKey);Object.defineProperties(this,{_wrapKey:{value:a,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new I(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new I(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,d){b(d,function(){wa.wrapKey("jwk",c.rawKey,this._wrapKey,Mb).then(function(a){d.result(a)},function(b){d.error(new I(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function h(c){b(g,function(){switch(c.type){case "secret":xc(c,
g);break;case "public":yc(c,g);break;case "private":Nc(c,g);break;default:throw new I(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){wa.unwrapKey("jwk",c,this._wrapKey,Mb,d,!1,f).then(function(a){h(a)},function(b){g.error(new I(a.UNWRAP_ERROR))})},this)},sign:function(b,c){c.error(new I(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,d){d.error(new I(a.VERIFY_NOT_SUPPORTED))}});Be=Pb.extend({init:function Bd(a){Bd.base.call(this,Ob.JWK_LADDER);Object.defineProperties(this,{repository:{value:a,
writable:!1,enumerable:!1,configurable:!1}})},createRequestData:function(c,g,h){b(h,function(){var b=g.mechanism,c=g.wrapdata;if(!b||b==d.WRAP&&(!c||"string"!==typeof c))throw new R(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(g));if(!d[b])throw new pa(a.UNIDENTIFIED_KEYX_MECHANISM,b);var h;switch(b){case d.WRAP:try{h=L(c)}catch(l){throw new pa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+g.toString());}if(null==h||0==h.length)throw new pa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+g.toString());break;default:h=
null}return new f(b,h)})},createResponseData:function(b,c,d){b=d.wrapkey;var f=d.wrapdata,g=d.encryptionkey,l=d.hmackey;if(!(b&&"string"===typeof b&&f&&"string"===typeof f&&g&&"string"===typeof g&&l)||"string"!==typeof l)throw new R(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(d));var k,q,p,n;try{k=L(b),q=L(f)}catch(r){throw new I(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(d),r);}try{p=L(g)}catch(t){throw new I(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),t);}try{n=L(l)}catch(m){throw new I(a.INVALID_HMAC_KEY,
"keydata "+JSON.stringify(d),m);}return new h(c,k,q,p,n)},generateResponse:function(d,g,k,q){function p(a,c,f){m.generateSessionKeys(d,{result:function(d){b(q,function(){n(a,c,f,d.encryptionKey,d.hmacKey)},m)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;})}})}function n(a,f,h,l,k){b(q,function(){c(d,g.mechanism,g.wrapdata,a,{result:function(a){a.wrap(f,{result:function(a){r(f,h,l,k,a)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;})}})},error:function(a){b(q,
function(){a instanceof C&&a.setEntity(u);throw a;})}})},m)}function r(a,c,d,f,g){b(q,function(){var h=new l(a);h.wrap(d,{result:function(a){h.wrap(f,{result:function(b){t(c,g,d,a,f,b)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;})}})},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;})}})},m)}function t(a,c,f,g,l,p){b(q,function(){var n=d.getTokenFactory();u?n.renewMasterToken(d,u,f,l,{result:function(f){b(q,function(){var b=new nb(d,f),l=new h(f,
c,a,g,p);return new Pb.KeyExchangeData(l,b,q)},m)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;})}}):n.createMasterToken(d,k,f,l,{result:function(f){b(q,function(){var b=new nb(d,f),l=new h(f,c,a,g,p);return new Pb.KeyExchangeData(l,b,q)},m)},error:q.error})},m)}var m=this,u;b(q,function(){if(!(g instanceof f))throw new P("Key request data "+JSON.stringify(g)+" was not created by this factory.");var c=k;if(k instanceof Cb){if(!k.isVerified())throw new Xb(a.MASTERTOKEN_UNTRUSTED,
k);u=k;c=k.identity}var h=new Uint8Array(16);d.getRandom().nextBytes(h);kb(h,Mb,gb,{result:function(a){b(q,function(){d.getMslCryptoContext().wrap(a,{result:function(b){p(c,a,b)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(u);throw a;},m)}})},m)},error:function(c){b(q,function(){throw(new I(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(u);},m)}})},m)},getCryptoContext:function(c,g,k,q,p){function n(a,d,f,g,h){b(p,function(){var k=new l(h);k.unwrap(d.encryptionKey,Yb,cb,{result:function(h){k.unwrap(d.hmacKey,
rb,X,{result:function(a){b(p,function(){this.repository.addCryptoContext(d.wrapdata,k);this.repository.removeCryptoContext(f);return new nb(c,d.masterToken,g,h,a)},r)},error:function(c){b(p,function(){c instanceof C&&c.setEntity(a);throw c;})}})},error:function(c){b(p,function(){c instanceof C&&c.setEntity(a);throw c;})}})},r)}var r=this;b(p,function(){if(!(g instanceof f))throw new P("Key request data "+JSON.stringify(g)+" was not created by this factory.");if(!(k instanceof h))throw new P("Key response data "+
JSON.stringify(k)+" was not created by this factory.");var q=g.mechanism,t=g.wrapdata;c.getEntityAuthenticationData(null,{result:function(f){b(p,function(){var g=f.getIdentity(),h;switch(q){case d.PSK:h=new $b(g);var r=c.getEntityAuthenticationFactory(za.PSK);if(!r)throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,q)).setEntity(f);h=r.getCryptoContext(c,h);h=new l(h.wrapKey);break;case d.MGK:h=new Zb(g);r=c.getEntityAuthenticationFactory(za.MGK);if(!r)throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,q)).setEntity(f);
h=r.getCryptoContext(c,h);h=new l(h.wrapKey);break;case d.WRAP:h=this.repository.getCryptoContext(t);if(!h)throw(new pa(a.KEYX_WRAPPING_KEY_MISSING,G(t))).setEntity(f);break;default:throw(new pa(a.UNSUPPORTED_KEYX_MECHANISM,q)).setEntity(f);}h.unwrap(k.wrapKey,Mb,gb,{result:function(a){n(f,k,t,g,a)},error:function(a){b(p,function(){a instanceof C&&a.setEntity(f);throw a;})}})},r)},error:p.error})},r)}})})();var ha=K.Class.create({addCryptoContext:function(a,b){},getCryptoContext:function(a){},removeCryptoContext:function(a){}}),
jf,Fd,zd,ae;(function(){function c(b,f,g,h,l){switch(g){case d.JWE_RSA:case d.JWEJS_RSA:return new qc(b,fc.RSA_OAEP,m,h,l);case d.JWK_RSA:return new Tc(b,f,h,l,Va.WRAP_UNWRAP_OAEP);case d.JWK_RSAES:return new Tc(b,f,h,l,Va.WRAP_UNWRAP_PKCS1);default:throw new I(a.UNSUPPORTED_KEYX_MECHANISM,g);}}var d=Fd={RSA:"RSA",ECC:"ECC",JWE_RSA:"JWE_RSA",JWEJS_RSA:"JWEJS_RSA",JWK_RSA:"JWK_RSA",JWK_RSAES:"JWK_RSAES"},f=zd=Dd.extend({init:function Ta(a,b,c,d){Ta.base.call(this,Ob.ASYMMETRIC_WRAPPED);Object.defineProperties(this,
{keyPairId:{value:a,writable:!1,configurable:!1},mechanism:{value:b,writable:!1,configurable:!1},publicKey:{value:c,writable:!1,configurable:!1},privateKey:{value:d,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.mechanism=this.mechanism;a.publickey=G(this.publicKey.getEncoded());return a},equals:function Pc(a){if(a===this)return!0;if(!(a instanceof zd))return!1;var b=this.privateKey===a.privateKey||this.privateKey&&a.privateKey&&g(this.privateKey.getEncoded(),
a.privateKey.getEncoded());return Pc.base.call(this,a)&&this.keyPairId==a.keyPairId&&this.mechanism==a.mechanism&&g(this.publicKey.getEncoded(),a.publicKey.getEncoded())&&b},uniqueKey:function qb(){var a=this.publicKey.getEncoded(),b=this.privateKey&&this.privateKey.getEncoded(),a=qb.base.call(this)+":"+this.keyPairId+":"+this.mechanism+":"+t(a);b&&(a+=":"+t(b));return a}}),h=function(c,g){b(g,function(){var b=c.keypairid,h=c.mechanism,l=c.publickey;if(!b||"string"!==typeof b||!h||!l||"string"!==
typeof l)throw new R(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(c));if(!d[h])throw new pa(a.UNIDENTIFIED_KEYX_MECHANISM,h);try{var k=L(l);switch(h){case d.JWE_RSA:case d.JWEJS_RSA:case d.JWK_RSA:pc(k,Z,gb,{result:function(a){g.result(new f(b,h,a,null))},error:function(a){g.error(a)}});break;case d.JWK_RSAES:pc(k,Ka,gb,{result:function(a){g.result(new f(b,h,a,null))},error:function(a){g.error(a)}});break;default:throw new I(a.UNSUPPORTED_KEYX_MECHANISM,h);}}catch(q){if(!(q instanceof C))throw new I(a.INVALID_PUBLIC_KEY,
"keydata "+JSON.stringify(c),q);throw q;}})},l=ae=Ed.extend({init:function Ua(a,b,c,d){Ua.base.call(this,a,Ob.ASYMMETRIC_WRAPPED);Object.defineProperties(this,{keyPairId:{value:b,writable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,configurable:!1},hmacKey:{value:d,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.encryptionkey=G(this.encryptionKey);a.hmackey=G(this.hmacKey);return a},equals:function Bb(a){return this===a?!0:a instanceof ae?Bb.base.call(this,
a)&&this.keyPairId==a.keyPairId&&g(this.encryptionKey,a.encryptionKey)&&g(this.hmacKey,a.hmacKey):!1},uniqueKey:function gd(){return gd.base.call(this)+":"+this.keyPairId+":"+t(this.encryptionKey)+":"+t(this.hmacKey)}});jf=Pb.extend({init:function Bd(){Bd.base.call(this,Ob.ASYMMETRIC_WRAPPED)},createRequestData:function(a,b,c){h(b,c)},createResponseData:function(b,c,d){b=d.keypairid;var f=d.encryptionkey,g=d.hmackey;if(!b||"string"!==typeof b||!f||"string"!==typeof f||!g||"string"!==typeof g)throw new R(a.JSON_PARSE_ERROR,
"keydata "+JSON.stringify(d));var h;try{h=L(f)}catch(k){throw new I(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),k);}var q;try{q=L(g)}catch(p){throw new I(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(d),p);}return new l(c,b,h,q)},generateResponse:function(a,d,g,h){function k(f,l){b(h,function(){var k=c(a,d.keyPairId,d.mechanism,null,d.publicKey);k.wrap(f,{result:function(a){b(h,function(){k.wrap(l,{result:function(b){q(f,a,l,b)},error:function(a){b(h,function(){a instanceof C&&g instanceof
Cb&&a.setEntity(g);throw a;},p)}})},p)},error:function(a){b(h,function(){a instanceof C&&g instanceof Cb&&a.setEntity(g);throw a;},p)}})},p)}function q(c,f,k,r){b(h,function(){var q=a.getTokenFactory();g instanceof Cb?q.renewMasterToken(a,g,c,k,{result:function(c){b(h,function(){var b=new nb(a,c),g=new l(c,d.keyPairId,f,r);return new Pb.KeyExchangeData(g,b,h)},p)},error:function(a){b(h,function(){a instanceof C&&a.setEntity(g);throw a;},p)}}):q.createMasterToken(a,g,c,k,{result:function(c){b(h,function(){var b=
new nb(a,c),g=new l(c,d.keyPairId,f,r);return new Pb.KeyExchangeData(g,b,h)},p)},error:h.error})},p)}var p=this;b(h,function(){if(!(d instanceof f))throw new P("Key request data "+JSON.stringify(d)+" was not created by this factory.");this.generateSessionKeys(a,{result:function(a){k(a.encryptionKey,a.hmacKey)},error:function(a){b(h,function(){a instanceof C&&g instanceof Cb&&a.setEntity(g);throw a;},p)}})},p)},getCryptoContext:function(d,g,h,k,q){var p=this;b(q,function(){if(!(g instanceof f))throw new P("Key request data "+
JSON.stringify(g)+" was not created by this factory.");if(!(h instanceof l))throw new P("Key response data "+JSON.stringify(h)+" was not created by this factory.");var r=g.keyPairId,n=h.keyPairId;if(r!=n)throw(new pa(a.KEYX_RESPONSE_REQUEST_MISMATCH,"request "+r+"; response "+n)).setEntity(k);n=g.privateKey;if(!n)throw(new pa(a.KEYX_PRIVATE_KEY_MISSING,"request Asymmetric private key")).setEntity(k);var t=c(d,r,g.mechanism,n,null);t.unwrap(h.encryptionKey,Yb,cb,{result:function(a){t.unwrap(h.hmacKey,
rb,X,{result:function(c){d.getEntityAuthenticationData(null,{result:function(f){b(q,function(){var b=f.getIdentity();return new nb(d,h.masterToken,b,a,c)},p)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(k);throw a;},p)}})},error:function(a){b(q,function(){a instanceof C&&a.setEntity(k);throw a;},p)}})},error:function(a){b(q,function(){a instanceof C&&a.setEntity(k);throw a;},p)}})},p)}})})();var Hg=K.Class.create({init:function(a){var b=N.parser(),c=[],d=[],f,g,h,l=0,k=!1;b.onerror=
function(a){k||(k=!0,b.end())};b.onopenobject=function(a){if(f)f[h]={},d.push(f),f=f[h];else if(g){var b={};d.push(g);g.push(b);f=b;g=n}else f={};h=a};b.oncloseobject=function(){var a=d.pop();a?"object"===typeof a?f=a:(f=n,g=a):(c.push(f),l=b.index,f=n)};b.onopenarray=function(){if(f)f[h]=[],d.push(f),g=f[h],f=n;else if(g){var a=[];d.push(g);g.push(a);g=a}else g=[]};b.onclosearray=function(){var a=d.pop();a?"object"===typeof a?(f=a,g=n):g=a:(c.push(g),l=b.index,g=n)};b.onkey=function(a){h=a};b.onvalue=
function(a){f?f[h]=a:g?g.push(a):(c.push(a),l=b.index)};b.write(a).close();Object.defineProperties(this,{_values:{value:c,writable:!1,enumerable:!1,configurable:!1},_lastIndex:{value:l,writable:!0,enumerable:!1,configurable:!1}})},more:function(){return 0<this._values.length},nextValue:function(){return 0==this._values.length?n:this._values.shift()},lastIndex:function(){return this._lastIndex}}),be,Ce,uf,De,vf,ce;(function(){var c=Ce="entityauthdata",d=uf="mastertoken",f=De="headerdata",g=vf="errordata",
h=ce="signature";be=function(l,k,q,p){b(p,function(){var b=k[c],r=k[d],t=k[h];if(b&&"object"!==typeof b||r&&"object"!==typeof r||"string"!==typeof t)throw new R(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));var m;try{m=L(t)}catch(u){throw new ia(a.HEADER_SIGNATURE_INVALID,"header/errormsg "+JSON.stringify(k),u);}var w=null;b&&(w=Xd(l,b));var x=k[f];if(x!=n&&null!=x){if("string"!==typeof x)throw new R(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));r?Uc(l,r,{result:function(a){Ee(l,
x,w,a,m,q,p)},error:function(a){p.error(a)}}):Ee(l,x,w,null,m,q,p)}else if(b=k[g],b!=n&&null!=b){if("string"!==typeof b)throw new R(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));wf(l,b,w,m,p)}else throw new R(a.JSON_PARSE_ERROR,JSON.stringify(k));})}})();var Mc,xf,wf;(function(){function d(a,b){this.errordata=a;this.signature=b}Mc=K.Class.create({init:function(d,f,g,h,l,k,q,p,r,n){var t=this;b(n,function(){0>k&&(k=-1);if(0>h||h>V)throw new P("Message ID "+h+" is out of range.");if(!f)throw new ia(a.MESSAGE_ENTITY_NOT_FOUND);
if(r)return Object.defineProperties(this,{entityAuthenticationData:{value:f,writable:!1,configurable:!1},recipient:{value:g,writable:!1,configurable:!1},messageId:{value:h,writable:!1,configurable:!1},errorCode:{value:l,writable:!1,configurable:!1},internalCode:{value:k,writable:!1,configurable:!1},errorMessage:{value:q,writable:!1,configurable:!1},userMessage:{value:p,writable:!1,configurable:!1},errordata:{value:r.errordata,writable:!1,enumerable:!1,configurable:!1},signature:{value:r.signature,
writable:!1,enumerable:!1,configurable:!1}}),this;var m={};g&&(m.recipient=g);m.messageid=h;m.errorcode=l;0<k&&(m.internalcode=k);q&&(m.errormsg=q);p&&(m.usermsg=p);var u;try{u=d.getEntityAuthenticationFactory(f.scheme).getCryptoContext(d,f)}catch(w){throw w instanceof C&&(w.setEntity(f),w.setMessageId(h)),w;}m=c(JSON.stringify(m),Q);u.encrypt(m,{result:function(a){b(n,function(){u.sign(a,{result:function(c){b(n,function(){Object.defineProperties(this,{entityAuthenticationData:{value:f,writable:!1,
configurable:!1},recipient:{value:g,writable:!1,configurable:!1},messageId:{value:h,writable:!1,configurable:!1},errorCode:{value:l,writable:!1,configurable:!1},internalCode:{value:k,writable:!1,configurable:!1},errorMessage:{value:q,writable:!1,configurable:!1},userMessage:{value:p,writable:!1,configurable:!1},errordata:{value:a,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},t)},error:function(a){b(n,function(){a instanceof
C&&(a.setEntity(f),a.setMessageId(h));throw a;},t)}})},t)},error:function(a){b(n,function(){a instanceof C&&(a.setEntity(f),a.setMessageId(h));throw a;},t)}})},t)},toJSON:function(){var a={};a[Ce]=this.entityAuthenticationData;a[vf]=G(this.errordata);a[ce]=G(this.signature);return a}});xf=function(a,b,c,d,f,g,h,l,k){new Mc(a,b,c,d,f,g,h,l,null,k)};wf=function(c,f,g,h,k){b(k,function(){if(!g)throw new ia(a.MESSAGE_ENTITY_NOT_FOUND);var q;try{var p=g.scheme,r=c.getEntityAuthenticationFactory(p);if(!r)throw new Fb(a.ENTITYAUTH_FACTORY_NOT_FOUND,
p);q=r.getCryptoContext(c,g)}catch(t){throw t instanceof C&&t.setEntity(g),t;}try{f=L(f)}catch(m){throw(new ia(a.HEADER_DATA_INVALID,f,m)).setEntity(g);}if(!f||0==f.length)throw(new ia(a.HEADER_DATA_MISSING,f)).setEntity(g);q.verify(f,h,{result:function(p){b(k,function(){if(!p)throw(new I(a.MESSAGE_VERIFICATION_FAILED)).setEntity(g);q.decrypt(f,{result:function(q){b(k,function(){var b=l(q,Q),p;try{p=JSON.parse(b)}catch(r){if(r instanceof SyntaxError)throw(new R(a.JSON_PARSE_ERROR,"errordata "+b,r)).setEntity(g);
throw r;}var t=p.recipient!==n?p.recipient:null,m=parseInt(p.messageid),u=parseInt(p.errorcode),w=parseInt(p.internalcode),x=p.errormsg,y=p.usermsg;if(t&&"string"!==typeof t||!m||m!=m||!u||u!=u||p.internalcode&&w!=w||x&&"string"!==typeof x||y&&"string"!==typeof y)throw(new R(a.JSON_PARSE_ERROR,"errordata "+b)).setEntity(g);if(0>m||m>V)throw(new ia(a.MESSAGE_ID_OUT_OF_RANGE,"errordata "+b)).setEntity(g);p=!1;for(var A in v)if(v[A]==u){p=!0;break}p||(u=v.FAIL);if(w){if(0>w)throw(new ia(a.INTERNAL_CODE_NEGATIVE,
"errordata "+b)).setEntity(g).setMessageId(m);}else w=-1;b=new d(f,h);new Mc(c,g,t,m,u,w,x,y,b,k)})},error:function(a){b(k,function(){a instanceof C&&a.setEntity(g);throw a;})}})})},error:function(a){b(k,function(){a instanceof C&&a.setEntity(g);throw a;})}})})}})();var yf=K.Class.create({getUserMessage:function(a,b){}}),Gd,zf,Fe;(function(){Fe=function(a,b){if(!a||!b)return null;var c=a.compressionAlgorithms.filter(function(a){for(var c=0;c<b.compressionAlgorithms.length;++c)if(a==b.compressionAlgorithms[c])return!0;
return!1}),d=a.languages.filter(function(a){for(var c=0;c<b.languages.length;++c)if(a==b.languages[c])return!0;return!1});return new Gd(c,d)};Gd=K.Class.create({init:function(a,b){a||(a=[]);b||(b=[]);a.sort();Object.defineProperties(this,{compressionAlgorithms:{value:a,writable:!1,enumerable:!0,configurable:!1},languages:{value:b,writable:!1,enumerable:!0,configurable:!1}})},toJSON:function(){var a={};a.compressionalgos=this.compressionAlgorithms;a.languages=this.languages;return a},equals:function(a){return this===
a?!0:a instanceof Gd?u(this.compressionAlgorithms,a.compressionAlgorithms)&&u(this.languages,a.languages):!1},uniqueKey:function(){return this.compressionAlgorithms.join(":")+"|"+this.languages.join(":")}});zf=function(b){var c=b.compressionalgos,d=b.languages;if(c&&!(c instanceof Array)||d&&!(d instanceof Array))throw new R(a.JSON_PARSE_ERROR,"capabilities "+JSON.stringify(b));b=[];for(var f=0;c&&f<c.length;++f){var g=c[f];la[g]&&b.push(g)}return new Gd(b,d)}})();var Hd,Af,Ee,Bf,Cf;(function(){function d(a,
b,c,f,g){this.customer=a;this.sender=b;this.messageCryptoContext=c;this.headerdata=f;this.signature=g}function f(a,b,c,d,g,h,l,k,q,p,r,n,t,m,u,w,x,y,A,v){return{cryptoContext:{value:b,writable:!1,configurable:!1},customer:{value:c,writable:!1,configurable:!1},entityAuthenticationData:{value:d,writable:!1,configurable:!1},masterToken:{value:g,writable:!1,configurable:!1},sender:{value:h,writable:!1,configurable:!1},messageId:{value:l,writable:!1,configurable:!1},nonReplayableId:{value:w,writable:!1,
configurable:!1},keyRequestData:{value:k,writable:!1,configurable:!1},keyResponseData:{value:q,writable:!1,configurable:!1},userAuthenticationData:{value:p,writable:!1,configurable:!1},userIdToken:{value:r,writable:!1,configurable:!1},serviceTokens:{value:n,writable:!1,configurable:!1},peerMasterToken:{value:t,writable:!1,configurable:!1},peerUserIdToken:{value:m,writable:!1,configurable:!1},peerServiceTokens:{value:u,writable:!1,configurable:!1},messageCapabilities:{value:y,writable:!1,configurable:!1},
renewable:{value:x,writable:!1,enumerable:!1,configurable:!1},headerdata:{value:A,writable:!1,enumerable:!1,configurable:!1},signature:{value:v,writable:!1,enumerable:!1,configurable:!1}}}function g(b,c,d){if(d){if(c=b.getMslStore().getCryptoContext(d))return c;if(!d.isVerified()||!d.isDecrypted())throw new Xb(a.MASTERTOKEN_UNTRUSTED,d);return new nb(b,d)}d=c.scheme;var f=b.getEntityAuthenticationFactory(d);if(!f)throw new Fb(a.ENTITYAUTH_FACTORY_NOT_FOUND,d);return f.getCryptoContext(b,c)}function h(c,
d,f,g,k){b(k,function(){d.verify(f,g,{result:function(c){b(k,function(){if(!c)throw new I(a.MESSAGE_VERIFICATION_FAILED);d.decrypt(f,{result:function(a){b(k,function(){return l(a,Q)})},error:function(a){k.error(a)}})})},error:function(a){k.error(a)}})})}function k(a,c,d){b(d,function(){if(c)ye(a,c,d);else return null})}function q(a,c,d,f){b(f,function(){if(c)jd(a,c,d,f);else return null})}function p(a,c,d,f){b(f,function(){if(d)Ge(a,c,d,f);else return null})}function r(c,d,f,g,h,l,k){function q(d,
k,r){if(k>=d.length){var n=[],t;for(t in p)n.push(p[t]);r.result(n)}else{n=d[k];if("object"!==typeof n)throw new R(a.JSON_PARSE_ERROR,"headerdata "+l);de(c,n,f,g,h,{result:function(a){b(r,function(){p[a.uniqueKey()]=a;q(d,k+1,r)})},error:function(a){r.error(a)}})}}var p={};b(k,function(){if(d){if(!(d instanceof Array))throw new R(a.JSON_PARSE_ERROR,"headerdata "+l);q(d,0,k)}else return[]})}function t(c,d,f,g,h,l){function k(c,d,f){b(f,function(){var b=d.peermastertoken;if(b&&"object"!==typeof b)throw new R(a.JSON_PARSE_ERROR,
"headerdata "+h);if(!b)return null;Uc(c,b,f)})}function q(c,d,f,g){b(g,function(){var b=d.peeruseridtoken;if(b&&"object"!==typeof b)throw new R(a.JSON_PARSE_ERROR,"headerdata "+h);if(!b)return null;jd(c,b,f,g)})}b(l,function(){if(!c.isPeerToPeer())return{peerMasterToken:null,peerUserIdToken:null,peerServiceTokens:[]};k(c,d,{result:function(a){b(l,function(){var k=f?f.masterToken:a;q(c,d,k,{result:function(f){b(l,function(){r(c,d.peerservicetokens,k,f,g,h,{result:function(c){b(l,function(){return{peerMasterToken:a,
peerUserIdToken:f,peerServiceTokens:c}})},error:function(a){b(l,function(){a instanceof C&&(a.setEntity(k),a.setUser(f));throw a;})}})})},error:function(a){b(l,function(){a instanceof C&&a.setEntity(k);throw a;})}})})},error:l.error})})}function m(c,d,f,g){function h(a,d){b(g,function(){if(d>=a.length)return l;qf(c,a[d],{result:function(c){b(g,function(){l.push(c);h(a,d+1)})},error:function(a){g.error(a)}})})}var l=[];b(g,function(){var b=d.keyrequestdata;if(!b)return l;if(!(b instanceof Array))throw new R(a.JSON_PARSE_ERROR,
"headerdata "+f);h(b,0)})}var u=Bf=K.Class.create({init:function(a,b,c,d,f,g,h,l,k){Object.defineProperties(this,{messageId:{value:a,writable:!1,configurable:!1},nonReplayableId:{value:b,writable:!1,configurable:!1},renewable:{value:c,writable:!1,configurable:!1},capabilities:{value:d,writable:!1,configurable:!1},keyRequestData:{value:f,writable:!1,configurable:!1},keyResponseData:{value:g,writable:!1,configurable:!1},userAuthData:{value:h,writable:!1,configurable:!1},userIdToken:{value:l,writable:!1,
configurable:!1},serviceTokens:{value:k,writable:!1,configurable:!1}})}}),x=Cf=K.Class.create({init:function(a,b,c){Object.defineProperties(this,{peerMasterToken:{value:a,writable:!1,configurable:!1},peerUserIdToken:{value:b,writable:!1,configurable:!1},peerServiceTokens:{value:c,writable:!1,configurable:!1}})}});Hd=K.Class.create({init:function(a,d,h,l,k,q,p){function r(t){b(p,function(){d=h?null:d;var r=l.nonReplayableId,m=l.renewable,u=l.capabilities,w=l.messageId,x=l.keyRequestData?l.keyRequestData:
[],y=l.keyResponseData,A=l.userAuthData,v=l.userIdToken,Ga=l.serviceTokens?l.serviceTokens:[],ua,Ua,$a;a.isPeerToPeer()?(ua=k.peerMasterToken,Ua=k.peerUserIdToken,$a=k.peerServiceTokens?k.peerServiceTokens:[]):(Ua=ua=null,$a=[]);if(0>w||w>V)throw new P("Message ID "+w+" is out of range.");if(!d&&!h)throw new P("Message entity authentication data or master token must be provided.");var Ta,qb;y?a.isPeerToPeer()?(Ta=h,qb=y.masterToken):(Ta=y.masterToken,qb=ua):(Ta=h,qb=ua);if(v&&(!Ta||!v.isBoundTo(Ta)))throw new P("User ID token must be bound to a master token.");
if(Ua&&(!qb||!Ua.isBoundTo(qb)))throw new P("Peer user ID token must be bound to a peer master token.");Ga.forEach(function(a){if(a.isMasterTokenBound()&&(!Ta||!a.isBoundTo(Ta)))throw new P("Master token bound service tokens must be bound to the provided master token.");if(a.isUserIdTokenBound()&&(!v||!a.isBoundTo(v)))throw new P("User ID token bound service tokens must be bound to the provided user ID token.");},this);$a.forEach(function(a){if(a.isMasterTokenBound()&&(!qb||!a.isBoundTo(qb)))throw new P("Master token bound peer service tokens must be bound to the provided peer master token.");
if(a.isUserIdTokenBound()&&(!Ua||!a.isBoundTo(Ua)))throw new P("User ID token bound peer service tokens must be bound to the provided peer user ID token.");},this);if(q){var F=q.customer,D=q.messageCryptoContext,B=f(a,D,F,d,h,t,w,x,y,A,v,Ga,ua,Ua,$a,r,m,u,q.headerdata,q.signature);Object.defineProperties(this,B);return this}var F=v?v.customer:null,B={};t&&(B.sender=t);B.messageid=w;"number"===typeof r&&(B.nonreplayableid=r);B.renewable=m;u&&(B.capabilities=u);0<x.length&&(B.keyrequestdata=x);y&&(B.keyresponsedata=
y);A&&(B.userauthdata=A);v&&(B.useridtoken=v);0<Ga.length&&(B.servicetokens=Ga);ua&&(B.peermastertoken=ua);Ua&&(B.peeruseridtoken=Ua);0<$a.length&&(B.peerservicetokens=$a);var D;try{D=g(a,d,h)}catch(Bb){throw Bb instanceof C&&(Bb.setEntity(h),Bb.setEntity(d),Bb.setUser(v),Bb.setUser(A),Bb.setMessageId(w)),Bb;}B=c(JSON.stringify(B),Q);D.encrypt(B,{result:function(c){b(p,function(){D.sign(c,{result:function(g){b(p,function(){var b=f(a,D,F,d,h,t,w,x,y,A,v,Ga,ua,Ua,$a,r,m,u,c,g);Object.defineProperties(this,
b);return this},n)},error:function(a){b(p,function(){a instanceof C&&(a.setEntity(h),a.setEntity(d),a.setUser(v),a.setUser(A),a.setMessageId(w));throw a;},n)}})},n)},error:function(a){b(p,function(){a instanceof C&&(a.setEntity(h),a.setEntity(d),a.setUser(v),a.setUser(A),a.setMessageId(w));throw a;},n)}})},n)}var n=this;b(p,function(){q?r(q.sender):h?a.getEntityAuthenticationData(null,{result:function(a){a=a.getIdentity();r(a)},error:p.error}):r(null)},n)},isEncrypting:function(){return this.masterToken||
w(this.entityAuthenticationData.scheme)},isRenewable:function(){return this.renewable},toJSON:function(){var a={};this.masterToken?a[uf]=this.masterToken:a[Ce]=this.entityAuthenticationData;a[De]=G(this.headerdata);a[ce]=G(this.signature);return a}});Af=function(a,b,c,d,f,g){new Hd(a,b,c,d,f,null,g)};Ee=function(c,f,l,w,y,A,v){b(v,function(){l=w?null:l;if(!l&&!w)throw new ia(a.MESSAGE_ENTITY_NOT_FOUND);var B=f;try{f=L(B)}catch(F){throw new ia(a.HEADER_DATA_INVALID,B,F);}if(!f||0==f.length)throw new ia(a.HEADER_DATA_MISSING,
B);var oc;try{oc=g(c,l,w)}catch(D){throw D instanceof C&&(D.setEntity(w),D.setEntity(l)),D;}h(c,oc,f,y,{result:function(g){b(v,function(){var h;try{h=JSON.parse(g)}catch(ua){if(ua instanceof SyntaxError)throw(new R(a.JSON_PARSE_ERROR,"headerdata "+g,ua)).setEntity(w).setEntity(l);throw ua;}var B=parseInt(h.messageid);if(!B||B!=B)throw(new R(a.JSON_PARSE_ERROR,"headerdata "+g)).setEntity(w).setEntity(l);if(0>B||B>V)throw(new ia(a.MESSAGE_ID_OUT_OF_RANGE,"headerdata "+g)).setEntity(w).setEntity(l);
var D=w?h.sender:null;if(w&&(!D||"string"!==typeof D))throw(new R(a.JSON_PARSE_ERROR,"headerdata "+g)).setEntity(w).setEntity(l).setMessageId(B);var F=h.keyresponsedata;if(F&&"object"!==typeof F)throw(new R(a.JSON_PARSE_ERROR,"headerdata "+g)).setEntity(w).setEntity(l).setMessageId(B);var wc=v;v={result:function(a){wc.result(a)},error:function(a){a instanceof C&&(a.setEntity(w),a.setEntity(l),a.setMessageId(B));wc.error(a)}};k(c,F,{result:function(k){b(v,function(){var ua=!c.isPeerToPeer()&&k?k.masterToken:
w,$a=h.useridtoken;if($a&&"object"!==typeof $a)throw new R(a.JSON_PARSE_ERROR,"headerdata "+g);q(c,$a,ua,{result:function(q){b(v,function(){var Ga=h.userauthdata;if(Ga&&"object"!==typeof Ga)throw new R(a.JSON_PARSE_ERROR,"headerdata "+g);p(c,ua,Ga,{result:function(p){b(v,function(){var Ga;if(p){var $a=p.scheme,Ta=c.getUserAuthenticationFactory($a);if(!Ta)throw(new xa(a.USERAUTH_FACTORY_NOT_FOUND,$a)).setUser(q).setUser(p);$a=w?w.identity:l.getIdentity();Ga=Ta.authenticate(c,$a,p,q)}else Ga=q?q.customer:
null;r(c,h.servicetokens,ua,q,A,g,{result:function(r){b(v,function(){var ua=h.nonreplayableid!==n?parseInt(h.nonreplayableid):null,$a=h.renewable;if(ua!=ua||"boolean"!==typeof $a)throw new R(a.JSON_PARSE_ERROR,"headerdata "+g);if(0>ua||ua>V)throw new ia(a.NONREPLAYABLE_ID_OUT_OF_RANGE,"headerdata "+g);var Ta=null,F=h.capabilities;if(F){if("object"!==typeof F)throw new R(a.JSON_PARSE_ERROR,"headerdata "+g);Ta=zf(F)}m(c,h,g,{result:function(a){t(c,h,k,A,g,{result:function(g){b(v,function(){var b=g.peerMasterToken,
h=g.peerUserIdToken,n=g.peerServiceTokens,t=new u(B,ua,$a,Ta,a,k,p,q,r),b=new x(b,h,n),h=new d(Ga,D,oc,f,y);new Hd(c,l,w,t,b,h,v)})},error:v.error})},error:function(a){b(v,function(){a instanceof C&&(a.setUser(q),a.setUser(p));throw a;})}})})},error:function(a){b(v,function(){a instanceof C&&(a.setEntity(ua),a.setUser(q),a.setUser(p));throw a;})}})})},error:v.error})})},error:v.error})})},error:v.error})})},error:v.error})})}})();var Ie,Ff,Je;(function(){function d(a,b){this.payload=a;this.signature=
b}Ie=K.Class.create({init:function(a,d,f,g,h,l,k,q){var p=this;b(q,function(){if(0>a||a>V)throw new P("Sequence number "+a+" is outside the valid range.");if(0>d||d>V)throw new P("Message ID "+d+" is outside the valid range.");if(k)return Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},messageId:{value:d,writable:!1,configurable:!1},compressionAlgo:{value:g,writable:!1,configurable:!1},data:{value:h,writable:!1,configurable:!1},endofmsg:{value:f,writable:!1,enumerable:!1,
configurable:!1},payload:{value:k.payload,writable:!1,enumerable:!1,configurable:!1},signature:{value:k.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var r;g?(r=Ac(g,h),r||(g=null,r=h)):(g=null,r=h);var n={};n.sequencenumber=a;n.messageid=d;f&&(n.endofmsg=f);g&&(n.compressionalgo=g);n.data=G(r);r=c(JSON.stringify(n),Q);l.encrypt(r,{result:function(c){b(q,function(){l.sign(c,{result:function(l){b(q,function(){Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},
messageId:{value:d,writable:!1,configurable:!1},compressionAlgo:{value:g,writable:!1,configurable:!1},data:{value:h,writable:!1,configurable:!1},endofmsg:{value:f,writable:!1,enumerable:!1,configurable:!1},payload:{value:c,writable:!1,enumerable:!1,configurable:!1},signature:{value:l,writable:!1,enumerable:!1,configurable:!1}});return this},p)},error:function(a){q.error(a)}})},p)},error:function(a){q.error(a)}})},p)},isEndOfMessage:function(){return this.endofmsg},toJSON:function(){var a={};a.payload=
G(this.payload);a.signature=G(this.signature);return a}});Ff=function(a,b,c,d,f,g,h){new Ie(a,b,c,d,f,g,null,h)};Je=function(c,f,g){b(g,function(){var h=c.payload,k=c.signature;if(!h||"string"!==typeof h||"string"!==typeof k)throw new R(a.JSON_PARSE_ERROR,"payload chunk "+JSON.stringify(c));var q,p;try{q=L(h)}catch(r){throw new ia(a.PAYLOAD_INVALID,"payload chunk "+JSON.stringify(c),r);}try{p=L(k)}catch(n){throw new ia(a.PAYLOAD_SIGNATURE_INVALID,"payload chunk "+JSON.stringify(c),n);}f.verify(q,
p,{result:function(c){b(g,function(){if(!c)throw new I(a.PAYLOAD_VERIFICATION_FAILED);f.decrypt(q,{result:function(c){b(g,function(){var b=l(c,Q),h;try{h=JSON.parse(b)}catch(k){if(k instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,"payload chunk payload "+b,k);throw k;}var r=parseInt(h.sequencenumber),n=parseInt(h.messageid),t=h.endofmsg,m=h.compressionalgo;h=h.data;if(!r||r!=r||!n||n!=n||t&&"boolean"!==typeof t||m&&"string"!==typeof m||"string"!==typeof h)throw new R(a.JSON_PARSE_ERROR,"payload chunk payload "+
b);if(0>r||r>V)throw new C(a.PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE,"payload chunk payload "+b);if(0>n||n>V)throw new C(a.PAYLOAD_MESSAGE_ID_OUT_OF_RANGE,"payload chunk payload "+b);t||(t=!1);if(m&&!la[m])throw new ia(a.UNIDENTIFIED_COMPRESSION,m);var u;try{u=L(h)}catch(w){throw new ia(a.PAYLOAD_DATA_CORRUPT,h,w);}if(u&&0!=u.length)b=m?Vc(m,u):u;else{if(0<h.length)throw new ia(a.PAYLOAD_DATA_CORRUPT,h);if(t)b=new Uint8Array(0);else throw new ia(a.PAYLOAD_DATA_MISSING,h);}u=new d(q,p);new Ie(r,n,t,m,
b,f,u,g)})},error:function(a){g.error(a)}})})},error:function(a){g.error(a)}})})}})();var Id,Wc,Xc,gc,Gf,fe;(function(){function c(d,f,g,h,l){function k(){b(l,function(){p>=f.length&&(p=0,++q);if(q>=r.length){if(n)throw n;throw new pa(a.KEYX_FACTORY_NOT_FOUND,JSON.stringify(f));}var c=r[q],g=f[p];c.scheme!=g.keyExchangeScheme?(++p,k()):c.generateResponse(d,g,t,{result:function(a){l.result(a)},error:function(a){b(l,function(){if(!(a instanceof C))throw a;n=a;++p;k()})}})})}var q=0,p=0,r=d.getKeyExchangeFactories(),
n,t=g?g:h;k()}function d(a,f,g,h,l){b(l,function(){var d=f.keyRequestData;if(f.isRenewable()&&0<d.length)h?h.isRenewable()||h.isExpired()?c(a,d,h,null,l):a.getTokenFactory().isNewestMasterToken(a,h,{result:function(f){b(l,function(){if(f)return null;c(a,d,h,null,l)})},error:l.error}):c(a,d,null,g.getIdentity(),l);else return null})}function f(c,d,g,h){b(h,function(){var b=d.userIdToken,f=d.userAuthenticationData,l=d.messageId;if(b&&b.isVerified()){if(b.isRenewable()&&d.isRenewable()||b.isExpired()||
!b.isBoundTo(g)){f=c.getTokenFactory();f.renewUserIdToken(c,b,g,h);return}}else if(d.isRenewable()&&g&&f){b=d.customer;if(!b){var b=f.scheme,k=c.getUserAuthenticationFactory(b);if(!k)throw(new xa(a.USERAUTH_FACTORY_NOT_FOUND,b)).setEntity(g).setUser(f).setMessageId(l);b=k.authenticate(c,g.identity,f,null)}f=c.getTokenFactory();f.createUserIdToken(c,b,g,h);return}return b})}var g=new Uint8Array(0),h=Wc=function(a){if(0>a||a>V)throw new P("Message ID "+a+" is outside the valid range.");return a==V?
0:a+1};Xc=function(a){if(0>a||a>V)throw new P("Message ID "+a+" is outside the valid range.");return 0==a?V:a-1};gc=function(a,c,d,f,g){b(g,function(){if(f==n||null==f){var h=a.getRandom();do f=h.nextLong();while(0>f||f>V)}else if(0>f||f>V)throw new P("Message ID "+f+" is outside the valid range.");a.getEntityAuthenticationData(null,{result:function(h){b(g,function(){var b=a.getMessageCapabilities();return new Id(a,f,b,h,c,d,null,null,null,null,null)})},error:function(a){g.error(a)}})})};Gf=function(a,
c,g){b(g,function(){function l(a){b(g,function(){a instanceof C&&(a.setEntity(k),a.setEntity(q),a.setUser(p),a.setUser(r),a.setMessageId(n));throw a;})}var k=c.masterToken,q=c.entityAuthenticationData,p=c.userIdToken,r=c.userAuthenticationData,n=c.messageId,t=h(n);d(a,c,q,k,{result:function(d){b(g,function(){var h=d?d.keyResponseData.masterToken:h=k;a.getEntityAuthenticationData(null,{result:function(q){b(g,function(){f(a,c,h,{result:function(f){b(g,function(){p=f;var b=Fe(c.messageCapabilities,a.getMessageCapabilities()),
g=c.keyResponseData,h=c.serviceTokens;return a.isPeerToPeer()?new Id(a,t,b,q,g?g.masterToken:c.peerMasterToken,c.peerUserIdToken,c.peerServiceTokens,k,p,h,d):new Id(a,t,b,q,g?g.masterToken:k,p,h,null,null,null,d)})},error:l})})},error:l})})},error:l})})};fe=function(a,c,d,f,g){b(g,function(){a.getEntityAuthenticationData(null,{result:function(l){b(g,function(){var b;if(c!=n&&null!=c)b=h(c);else{var k=a.getRandom();do b=k.nextInt();while(0>b||b>V)}xf(a,l,b,d.responseCode,d.internalCode,d.message,f,
g)})},error:function(a){g.error(a)}})})};Id=K.Class.create({init:function(a,b,c,d,f,g,h,l,k,q,p){if(!a.isPeerToPeer()&&(l||k))throw new P("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");var r;r=p&&!a.isPeerToPeer()?p.keyResponseData.masterToken:f;var n={};a.getMslStore().getServiceTokens(r,g).forEach(function(a){n[a.name]=a},this);h&&h.forEach(function(a){n[a.name]=a},this);var t,m,u={};a.isPeerToPeer()&&(t=l,m=k,h=p?p.keyResponseData.masterToken:l,a.getMslStore().getServiceTokens(h,
k).forEach(function(a){u[a.name]=a},this),q&&q.forEach(function(a){u[a.name]=a},this));Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:d,writable:!1,enumerable:!1,configurable:!1},_masterToken:{value:f,writable:!0,enumerable:!1,configurable:!1},_messageId:{value:b,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:c,writable:!1,enumerable:!1,configurable:!1},_keyExchangeData:{value:p,writable:!1,enumerable:!1,configurable:!1},
_nonReplayable:{value:!1,writable:!0,enumerable:!1,configurable:!1},_renewable:{value:!1,writable:!0,enumerable:!1,configurable:!1},_keyRequestData:{value:{},writable:!1,enumerable:!1,configurable:!1},_userAuthData:{value:null,writable:!0,enumerable:!1,configurable:!1},_userIdToken:{value:g,writable:!0,enumerable:!1,configurable:!1},_serviceTokens:{value:n,writable:!1,enumerable:!1,configurable:!1},_peerMasterToken:{value:t,writable:!0,enumerable:!1,configurable:!1},_peerUserIdToken:{value:m,writable:!0,
enumerable:!1,configurable:!1},_peerServiceTokens:{value:u,writable:!1,enumerable:!1,configurable:!1}})},getMessageId:function(){return this._messageId},getMasterToken:function(){return this._masterToken},getUserIdToken:function(){return this._userIdToken},getKeyExchangeData:function(){return this._keyExchangeData},willEncryptHeader:function(){return this._masterToken||w(this._entityAuthData.scheme)},willEncryptPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||
w(this._entityAuthData.scheme)},willIntegrityProtectHeader:function(){return this._masterToken||y(this._entityAuthData.scheme)},willIntegrityProtectPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||y(this._entityAuthData.scheme)},getHeader:function(c){b(c,function(){var b=this._keyExchangeData?this._keyExchangeData.keyResponseData:null,d=[],f;for(f in this._serviceTokens)d.push(this._serviceTokens[f]);var g=[],h;for(h in this._keyRequestData)g.push(this._keyRequestData[h]);
if(this._nonReplayable){if(!this._masterToken)throw new ia(a.NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN);h=this._ctx.getMslStore().getNonReplayableId(this._masterToken)}else h=null;b=new Bf(this._messageId,h,this._renewable,this._capabilities,g,b,this._userAuthData,this._userIdToken,d);d=[];for(f in this._peerServiceTokens)d.push(this._peerServiceTokens[f]);f=new Cf(this._peerMasterToken,this._peerUserIdToken,d);Af(this._ctx,this._entityAuthData,this._masterToken,b,f,c)},this)},isNonReplayable:function(){return this._nonReplayable},
setNonReplayable:function(a){this._nonReplayable=a;return this},isRenewable:function(){return this._renewable},setRenewable:function(a){this._renewable=a;return this},setAuthTokens:function(a,b){if(b&&!b.isBoundTo(a))throw new P("User ID token must be bound to master token.");if(this._keyExchangeData&&!this._ctx.isPeerToPeer())throw new P("Attempt to set message builder master token when key exchange data exists as a trusted network server.");var c;try{c=this._ctx.getMslStore().getServiceTokens(a,
b)}catch(d){if(d instanceof C)throw new P("Invalid master token and user ID token combination despite checking above.",d);throw d;}var f=[],g;for(g in this._serviceTokens)f.push(this._serviceTokens[g]);f.forEach(function(c){(c.isUserIdTokenBound()&&!c.isBoundTo(b)||c.isMasterTokenBound()&&!c.isBoundTo(a))&&delete this._serviceTokens[c.name]},this);c.forEach(function(a){this._serviceTokens[a.name]=a},this);this._masterToken=a;this._userIdToken=b},setUserAuthenticationData:function(a){this._userAuthData=
a;return this},setCustomer:function(a,c){var d=this;b(c,function(){if(!this._ctx.isPeerToPeer()&&null!=this._userIdToken||this._ctx.isPeerToPeer()&&null!=this._peerUserIdToken)throw new P("User ID token or peer user ID token already exists for the remote user.");var f;f=this._keyExchangeData?this._keyExchangeData.keyResponseData.masterToken:this._ctx.isPeerToPeer()?this._peerMasterToken:this._masterToken;if(!f)throw new P("User ID token or peer user ID token cannot be created because no corresponding master token exists.");
this._ctx.getTokenFactory().createUserIdToken(this._ctx,a,f,{result:function(a){b(c,function(){this._ctx.isPeerToPeer()?this._peerUserIdToken=a:(this._userIdToken=a,this._userAuthData=null);return!0},d)},error:function(a){c.error(a)}})},d)},addKeyRequestData:function(a){this._keyRequestData[a.uniqueKey()]=a;return this},removeKeyRequestData:function(a){delete this._keyRequestData[a.uniqueKey()];return this},addServiceToken:function(b){var c;c=this._keyExchangeData&&!this._ctx.isPeerToPeer()?this._keyExchangeData.keyResponseData.masterToken:
this._masterToken;if(b.isMasterTokenBound()&&!b.isBoundTo(c))throw(new ia(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; mt "+JSON.stringify(c))).setEntity(c);if(b.isUserIdTokenBound()&&!b.isBoundTo(this._userIdToken))throw(new ia(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._userIdToken))).setEntity(c).setUser(this._userIdToken);this._serviceTokens[b.name]=b;return this},addServiceTokenIfAbsent:function(a){this._serviceTokens[a.name]||this.addServiceToken(a);
return this},excludeServiceToken:function(a){delete this._serviceTokens[a];return this},deleteServiceToken:function(a,c){var d=this;b(c,function(){var f=this._serviceTokens[a];if(!f)return this;var h=f.isMasterTokenBound()?this._masterToken:null,f=f.isUserIdTokenBound()?this._userIdToken:null;hc(this._ctx,a,g,h,f,!1,null,new Sc,{result:function(a){b(c,function(){return this.addServiceToken(a)},d)},error:function(a){a instanceof C&&(a=new P("Failed to create and add empty service token to message.",
a));c.error(a)}})},d)},getServiceTokens:function(){var a=[],b;for(b in this._serviceTokens)a.push(this._serviceTokens[b]);return a},getPeerMasterToken:function(){return this._peerMasterToken},getPeerUserIdToken:function(){return this._peerUserIdToken},setPeerAuthTokens:function(b,c){if(!this._ctx.isPeerToPeer())throw new P("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");if(c&&!b)throw new P("Peer master token cannot be null when setting peer user ID token.");if(c&&
!c.isBoundTo(b))throw(new ia(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit "+c+"; mt "+b)).setEntity(b).setUser(c);var d;try{d=this._ctx.getMslStore().getServiceTokens(b,c)}catch(f){if(f instanceof C)throw new P("Invalid peer master token and user ID token combination despite proper check.",f);throw f;}Object.keys(this._peerServiceTokens).forEach(function(a){var d=this._peerServiceTokens[a];d.isUserIdTokenBound()&&!d.isBoundTo(c)?delete this._peerServiceTokens[a]:d.isMasterTokenBound()&&!d.isBoundTo(b)&&
delete this._peerServiceTokens[a]},this);d.forEach(function(a){var b=a.name;this._peerServiceTokens[b]||(this._peerServiceTokens[b]=a)},this);this._peerUserIdToken=c;this._peerMasterToken=b;return this},addPeerServiceToken:function(b){if(!this._ctx.isPeerToPeer())throw new P("Cannot set peer service tokens when not in peer-to-peer mode.");if(b.isMasterTokenBound()&&!b.isBoundTo(this._peerMasterToken))throw(new ia(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; mt "+JSON.stringify(this._peerMasterToken))).setEntity(this._peerMasterToken);
if(b.isUserIdTokenBound()&&!b.isBoundTo(this._peerUserIdToken))throw(new ia(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._peerUserIdToken))).setEntity(this._peerMasterToken).setUser(this._peerUserIdToken);this._peerServiceTokens[b.name]=b;return this},addPeerServiceTokenIfAbsent:function(a){this._peerServiceTokens[a.name]||this.addPeerServiceToken(a);return this},excludePeerServiceToken:function(a){delete this._peerServiceTokens[a];return this},deletePeerServiceToken:function(a,
c){var d=this;b(c,function(){var f=this._peerServiceTokens[a];if(!f)return this;var h=f.isMasterTokenBound()?this._peerMasterToken:null,f=f.isUserIdTokenBound()?this._peerUserIdToken:null;hc(this._ctx,a,g,h,f,!1,null,new Sc,{result:function(a){b(c,function(){return this.addPeerServiceToken(a)},d)},error:function(a){a instanceof C&&(a=new P("Failed to create and add empty peer service token to message.",a));c.error(a)}})},d)},getPeerServiceTokens:function(){var a=[],b;for(b in this._peerServiceTokens)a.push(this._peerServiceTokens[b]);
return a}})})();var Hf;(function(){function a(b,c){return c[b]?c[b]:c[""]}function c(a){var b=a.builder.getKeyExchangeData();return b&&!a.ctx.isPeerToPeer()?b.keyResponseData.masterToken:a.builder.getMasterToken()}Hf=K.Class.create({init:function(a,b,c){a={ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},cryptoContexts:{value:b.getCryptoContexts(),writable:!1,enumerable:!1,configurable:!1},builder:{value:c,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},isPrimaryMasterTokenAvailable:function(){return c(this)?
!0:!1},isPrimaryUserIdTokenAvailable:function(){return this.builder.getUserIdToken()?!0:!1},isPeerMasterTokenAvailable:function(){return this.builder.getPeerMasterToken()?!0:!1},isPeerUserIdTokenAvailable:function(){return this.builder.getPeerUserIdToken()?!0:!1},getPrimaryServiceTokens:function(){return this.builder.getServiceTokens()},getPeerServiceTokens:function(){return this.builder.getPeerServiceTokens()},addPrimaryServiceToken:function(a){try{return this.builder.addServiceToken(a),!0}catch(b){if(b instanceof
ia)return!1;throw b;}},addPeerServiceToken:function(a){try{return this.builder.addPeerServiceToken(a),!0}catch(b){if(b instanceof ia)return!1;throw b;}},addUnboundPrimaryServiceToken:function(c,d,f,g,h){var l=this;b(h,function(){var k=a(c,this.cryptoContexts);if(!k)return!1;hc(this.ctx,c,d,null,null,f,g,k,{result:function(a){b(h,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite being unbound.",b);
throw b;}return!0},l)},error:function(a){h.error(a)}})},l)},addUnboundPeerServiceToken:function(c,d,f,g,h){var l=this;b(h,function(){var k=a(c,this.cryptoContexts);if(!k)return!1;hc(this.ctx,c,d,null,null,f,g,k,{result:function(a){b(h,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite being unbound.",b);throw b;}return!0},l)},error:function(a){h.error(a)}})},l)},addMasterBoundPrimaryServiceToken:function(d,
f,g,h,l){var k=this;b(l,function(){var q=c(this);if(!q)return!1;var p=a(d,this.cryptoContexts);if(!p)return!1;hc(this.ctx,d,f,q,null,g,h,p,{result:function(a){b(l,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},k)},error:function(a){l.error(a)}})},k)},addMasterBoundPeerServiceToken:function(c,d,f,g,h){var l=this;b(h,function(){var k=this.builder.getPeerMasterToken();
if(!k)return!1;var q=a(c,this.cryptoContexts);if(!q)return!1;hc(this.ctx,c,d,k,null,f,g,q,{result:function(a){b(h,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},l)},error:function(a){h.error(a)}})},l)},addUserBoundPrimaryServiceToken:function(d,f,g,h,l){var k=this;b(l,function(){var q=c(this);if(!q)return!1;var p=this.builder.getUserIdToken();
if(!p)return!1;var r=a(d,this.cryptoContexts);if(!r)return!1;hc(this.ctx,d,f,q,p,g,h,r,{result:function(a){b(l,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},k)},error:function(a){l.error(a)}})},k)},addUserBoundPeerServiceToken:function(c,d,f,g,h){var l=this;b(h,function(){var k=this.builder.getPeerMasterToken();if(!k)return!1;
var q=this.builder.getPeerUserIdToken();if(!q)return!1;var p=a(c,this.cryptoContexts);if(!p)return!1;hc(this.ctx,c,d,k,q,f,g,p,{result:function(a){b(h,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof ia)throw new P("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},l)},error:function(a){h.error(a)}})},l)},excludePrimaryServiceToken:function(a){for(var b=this.builder.getServiceTokens(),c=
0;c<b.length;++c)if(b[c].name==a)return this.builder.excludeServiceToken(a),!0;return!1},excludePeerServiceToken:function(a){for(var b=this.builder.getPeerServiceTokens(),c=0;c<b.length;++c)if(b[c].name==a)return this.builder.excludePeerServiceToken(a),!0;return!1},deletePrimaryServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getServiceTokens(),d=0;d<b.length;++d)if(b[d].name==a){this.builder.deleteServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},
this)},deletePeerServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getPeerServiceTokens(),d=0;d<b.length;++d)if(b[d].name==a){this.builder.deletePeerServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},this)}})})();var Ke,Le;(function(){function c(d,f,g,h){b(h,function(){function c(){b(h,function(){if(n>=g.length){if(r)throw r;throw new pa(a.KEYX_RESPONSE_REQUEST_MISMATCH,JSON.stringify(g));}var f=g[n];q!=f.keyExchangeScheme?(++n,c()):p.getCryptoContext(d,
f,k,l,{result:h.result,error:function(a){b(h,function(){if(!(a instanceof C))throw a;r=a;++n;c()})}})})}var l=f.masterToken,k=f.keyResponseData;if(!k)return null;var q=k.keyExchangeScheme,p=d.getKeyExchangeFactory(q);if(!p)throw new pa(a.KEYX_FACTORY_NOT_FOUND,q);var r,n=0;c()})}Ke=xe.extend({init:function(b,d,f,g,l,k,q){var p=this;h(q,function(){function h(){p._ready=!0;p._readyQueue.add(!0)}function q(a,b){try{var c=b.masterToken;a.getTokenFactory().isMasterTokenRevoked(a,c,{result:function(d){d?
(p._errored=(new Xb(d,c)).setUser(b.userIdToken).setUser(b.userAuthenticationData).setMessageId(b.messageId),h()):r(a,b)},error:function(a){a instanceof C&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));p._errored=a;h()}})}catch(d){d instanceof C&&(d.setEntity(b.masterToken),d.setUser(b.userIdToken),d.setUser(b.userAuthenticationData),d.setMessageId(b.messageId)),p._errored=d,h()}}function r(a,b){try{var c=b.masterToken,d=b.userIdToken;
d?a.getTokenFactory().isUserIdTokenRevoked(a,c,d,{result:function(f){f?(p._errored=(new MslUserIdTokenException(f,d)).setEntity(c).setUser(d).setMessageId(b.messageId),h()):t(a,b)},error:function(a){a instanceof C&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));p._errored=a;h()}}):t(a,b)}catch(f){f instanceof C&&(f.setEntity(b.masterToken),f.setUser(b.userIdToken),f.setUser(b.userAuthenticationData),f.setMessageId(b.messageId)),
p._errored=f,h()}}function t(b,c){try{var d=c.masterToken;d.isExpired()?c.isRenewable()&&0!=c.keyRequestData.length?b.getTokenFactory().isMasterTokenRenewable(b,d,{result:function(a){a?(p._errored=(new ia(a,"Master token is expired and not renewable.")).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),h()):m(b,c)},error:function(a){a instanceof C&&(a.setEntity(c.masterToken),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));
p._errored=a;h()}}):(p._errored=(new ia(a.MESSAGE_EXPIRED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),h()):m(b,c)}catch(f){f instanceof C&&(f.setEntity(c.masterToken),f.setUser(c.userIdToken),f.setUser(c.userAuthenticationData),f.setMessageId(c.messageId)),p._errored=f,h()}}function m(b,c){try{var d=c.masterToken,f=c.nonReplayableId;"number"===typeof f?d?b.getTokenFactory().acceptNonReplayableId(b,d,f,{result:function(b){b||(p._errored=
(new ia(a.MESSAGE_REPLAYED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId));h()},error:function(a){a instanceof C&&(a.setEntity(d),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));p._errored=a;h()}}):(p._errored=(new ia(a.INCOMPLETE_NONREPLAYABLE_MESSAGE,JSON.stringify(c))).setEntity(c.entityAuthenticationData).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),
h()):h()}catch(g){g instanceof C&&(g.setEntity(c.masterToken),g.setEntity(c.entityAuthenticationData),g.setUser(c.userIdToken),g.setUser(c.userAuthenticationData),g.setMessageId(c.messageId)),p._errored=g,h()}}var u={_source:{value:d,writable:!1,enumerable:!1,configurable:!1},_parser:{value:n,writable:!0,enumerable:!1,configurable:!1},_charset:{value:f,writable:!1,enumerable:!1,configurable:!1},_remainingData:{value:"",writable:!0,enumerable:!1,configurable:!1},_timeout:{value:k,writable:!1,enumerable:!1,
configurable:!1},_header:{value:n,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:n,writable:!0,enumerable:!1,configurable:!1},_keyxCryptoContext:{value:n,writable:!0,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enuemrable:!1,configurable:!1},_eom:{value:!1,writable:!0,enumerable:!1,configurable:!1},_closeSource:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!0,enumerable:!1,configurable:!1},_payloadIndex:{value:-1,
writable:!0,enumerable:!1,configurable:!1},_payloadOffset:{value:0,writable:!0,enuemrable:!1,configurable:!1},_markOffset:{value:0,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:null,writable:!0,enumerable:!1,configurable:!1},_readException:{value:null,writable:!0,enumerable:!1,configurable:!1},_ready:{value:!1,writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Y,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},
_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,u);pf(p._source,k,{result:function(d){p._json=d;p._jsonIndex=0;null===p._json?(p._errored=new R(a.MESSAGE_DATA_MISSING),h()):be(b,p._json[p._jsonIndex++],l,{result:function(a){p._header=a;if(p._header instanceof Mc)p._keyxCryptoContext=null,p._cryptoContext=null,h();else{var d=p._header;c(b,d,g,{result:function(a){try{p._keyxCryptoContext=a;b.isPeerToPeer()||
!p._keyxCryptoContext?p._cryptoContext=d.cryptoContext:p._cryptoContext=p._keyxCryptoContext;try{var c=d.masterToken;c&&(b.isPeerToPeer()||c.isVerified())?q(b,d):m(b,d)}catch(f){f instanceof C&&(f.setEntity(d.masterToken),f.setUser(d.userIdToken),f.setUser(d.userAuthenticationData),f.setMessageId(d.messageId)),p._errored=f,h()}}catch(g){g instanceof C&&(g.setEntity(d.masterToken),g.setEntity(d.entityAuthenticationData),g.setUser(d.userIdToken),g.setUser(d.userAuthenticationData),g.setMessageId(d.messageId)),
p._errored=g,h()}},error:function(a){a instanceof C&&(a.setEntity(d.masterToken),a.setEntity(d.entityAuthenticationData),a.setUser(d.userIdToken),a.setUser(d.userAuthenticationData),a.setMessageId(d.messageId));p._errored=a;h()}})}},error:function(a){p._errored=a;h()}})},timeout:function(){p._timedout=!0;h()},error:function(a){p._errored=a;h()}});return this},p)},nextData:function(b,c){var d=this;h(c,function(){function b(a){h(a,function(){var c;if(this._jsonIndex<this._json.length)return c=this._json[this._jsonIndex++];
pf(this._source,this._timeout,{result:function(c){c&&c.length&&0<c.length?(c.forEach(function(a){this._json.push(a)}),b(a)):(this._eom=!0,a.result(null))},timeout:function(){a.timeout()},error:function(b){a.error(b)}})},d)}var f=this.getMessageHeader();if(!f)throw new P("Read attempted with error message.");if(-1!=this._payloadIndex&&this._payloadIndex<this._payloads.length)return this._payloads[this._payloadIndex++];if(this._eom)return null;b({result:function(b){h(c,function(){if(!b)return null;
if("object"!==typeof b)throw new R(a.MESSAGE_FORMAT_ERROR);Je(b,this._cryptoContext,{result:function(b){h(c,function(){var c=f.masterToken,d=f.entityAuthenticationData,g=f.userIdToken,h=f.getUserAuthenticationData;if(b.messageId!=f.messageId)throw(new ia(a.PAYLOAD_MESSAGE_ID_MISMATCH,"payload mid "+b.messageId+" header mid "+f.messageId)).setEntity(c).setEntity(d).setUser(g).setUser(h);if(b.sequenceNumber!=this._payloadSequenceNumber)throw(new ia(a.PAYLOAD_SEQUENCE_NUMBER_MISMATCH,"payload seqno "+
b.sequenceNumber+" expected seqno "+this._payloadSequenceNumber)).setEntity(c).setEntity(d).setUser(g).setUser(h);++this._payloadSequenceNumber;b.isEndOfMessage()&&(this._eom=!0);c=b.data;this._payloads.push(c);this._payloadIndex=-1;return c},d)},error:function(b){b instanceof SyntaxError&&(b=new R(a.JSON_PARSE_ERROR,"payloadchunk",b));c.error(b)}})},d)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},d)},isReady:function(a,b){function c(){h(b,function(){if(this._aborted)return!1;
if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;return!0}},d)}var d=this;h(b,function(){this._ready?c():this._readyQueue.poll(a,{result:function(a){h(b,function(){if(a===n)return!1;c()},d)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},d)},getMessageHeader:function(){return this._header instanceof Hd?this._header:null},getErrorHeader:function(){return this._header instanceof Mc?this._header:null},getIdentity:function(){var a=this.getMessageHeader();if(a){var b=
a.masterToken;return b?b.identity:a.entityAuthenticationData.getIdentity()}return this.getErrorHeader().entityAuthenticationData.getIdentity()},getCustomer:function(){var a=this.getMessageHeader();return a?a.customer:null},getPayloadCryptoContext:function(){return this._cryptoContext},getKeyExchangeCryptoContext:function(){return this._keyxCryptoContext},closeSource:function(a){this._closeSource=a},abort:function(){this._aborted=!0;this._source.abort();this._readyQueue.cancelAll()},close:function(){this._closeSource&&
this._source.close()},mark:function(){if(this._currentPayload){for(;0<this._payloads.length&&this._payloads[0]!==this._currentPayload;)this._payloads.shift();this._payloadIndex=0;this._currentPayload=this._payloads[this._payloadIndex++];this._markOffset=this._payloadOffset}else this._payloadIndex=-1,this._payloads=[]},markSupported:function(){return!0},read:function(a,b,c){function d(){h(c,function(){function d(c){h(c,function(){if(l&&q>=l.length)return l.subarray(0,q);var g=-1;if(this._currentPayload){var p=
this._currentPayload.length-this._payloadOffset;if(!l){var r=p;if(-1!=this._payloadIndex)for(var n=this._payloadIndex;n<this._payloads.length;++n)r+=this._payloads[n].length;0<r&&(l=new Uint8Array(r))}p=Math.min(p,l?l.length-q:0);0<p&&(g=this._currentPayload.subarray(this._payloadOffset,this._payloadOffset+p),l.set(g,k),g=p,k+=p,this._payloadOffset+=p)}-1!=g?(q+=g,d(c)):this.nextData(b,{result:function(b){h(c,function(){if(this._aborted)return l?l.subarray(0,q):new Uint8Array(0);this._currentPayload=
b;this._payloadOffset=0;if(this._currentPayload)d(c);else return 0==q&&0!=a?null:l?l.subarray(0,q):new Uint8Array(0)},f)},timeout:function(){c.timeout(l?l.subarray(0,q):new Uint8Array(0))},error:function(a){h(c,function(){a instanceof C&&(a=new Ia("Error reading the payload chunk.",a));if(0<q)return f._readException=a,l.subarray(0,q);throw a;},f)}})},f)}if(this._aborted)return new Uint8Array(0);if(this._timedout)c.timeout(new Uint8Array(0));else{if(this._errored)throw this._errored;if(null!=this._readException){var g=
this._readException;this._readException=null;throw g;}var l=-1!=a?new Uint8Array(a):n,k=0,q=0;d(c)}},f)}var f=this;h(c,function(){if(-1>a)throw new RangeError("read requested with illegal length "+a);this._ready?d():this._readyQueue.poll(b,{result:function(a){a===n?c.result(!1):d()},timeout:function(){c.timeout(new Uint8Array(0))},error:function(a){c.error(a)}})},f)},reset:function(){this._payloadIndex=0;0<this._payloads.length?(this._currentPayload=this._payloads[this._payloadIndex++],this._payloadOffset=
this._markOffset):this._currentPayload=null}});Le=function(a,b,c,d,f,g,h){new Ke(a,b,c,d,f,g,h)}})();var If,Jd;(function(){If=Zd.extend({init:function(a,b,d,f,g,l,k){var q=this;h(k,function(){function h(){q._ready=!0;q._readyQueue.add(!0)}var k=Fe(a.getMessageCapabilities(),f.messageCapabilities),p=null;k&&(p=Qa(k.compressionAlgorithms));k={_destination:{value:b,writable:!1,enumerable:!1,configurable:!1},_charset:{value:d,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:k,writable:!1,
enumerable:!1,configurable:!1},_header:{value:f,writable:!1,enumerable:!1,configurable:!1},_compressionAlgo:{value:p,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:g,writable:!1,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:[],writable:!0,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!1,enumerable:!1,configurable:!1},_ready:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Y,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,k);var r=c(JSON.stringify(f),d);b.write(r,0,r.length,l,{result:function(a){try{q._aborted?h():a<r.length?(q._timedout=!0,h()):b.flush(l,{result:function(a){q._aborted||(q._timedout=
!a);h()},timeout:function(){q._timedout=!0;h()},error:function(a){q._errored=a;h()}})}catch(c){q._errored=c,h()}},timeout:function(){q._timedout=!0;h()},error:function(a){q._errored=a;h()}});return this},q)},setCompressionAlgorithm:function(a,b,c){function d(){f.flush(b,{result:function(b){h(c,function(){if(!b)throw new Ia("flush() aborted");this._compressionAlgo=a;return!0},f)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}var f=this;h(c,function(){if(!this.getMessageHeader())throw new P("Cannot write payload data for an error message.");
if(this._compressionAlgo==a)return!0;if(a){if(!this._capabilities)return!1;for(var b=this._capabilities.compressionAlgorithms,c=0;c<b.length;++c)if(b[c]==a){d();return}return!1}d()},f)},getMessageHeader:function(){return this._header instanceof Hd?this._header:null},getErrorMessage:function(){return this._header instanceof Mc?this._header:null},getPayloads:function(){return this._payloads},abort:function(){this._aborted=!0;this._destination.abort();this._readyQueue.cancelAll()},close:function(a,b){var c=
this;h(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(this._closed)return!0;this._closed=!0;this.flush(a,{result:function(a){h(b,function(){a&&(this._currentPayload=null);return a},c)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})}},c)},flush:function(a,b){function d(){h(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(!this._currentPayload||!this._closed&&
0==this._currentPayload.length)return!0;var d=this.getMessageHeader();if(!d)return!0;var g=0;this._currentPayload&&this._currentPayload.forEach(function(a){g+=a.length});for(var l=new Uint8Array(g),k=0,q=0;this._currentPayload&&q<this._currentPayload.length;++q){var p=this._currentPayload[q];l.set(p,k);k+=p.length}Ff(this._payloadSequenceNumber,d.messageId,this._closed,this._compressionAlgo,l,this._cryptoContext,{result:function(d){h(b,function(){this._payloads.push(d);var g=c(JSON.stringify(d),this._charset);
this._destination.write(g,0,g.length,a,{result:function(c){h(b,function(){if(this._aborted)return!1;c<d.length?b.timeout():this._destination.flush(a,{result:function(a){h(b,function(){if(this._aborted)return!1;if(a)return++this._payloadSequenceNumber,this._currentPayload=this._closed?null:[],!0;b.timeout()},f)},timeout:function(){b.timeout()},error:function(a){a instanceof C&&(a=new Ia("Error encoding payload chunk [sequence number "+f._payloadSequenceNumber+"].",a));b.error(a)}})},f)},timeout:function(a){b.timeout()},
error:function(a){a instanceof C&&(a=new Ia("Error encoding payload chunk [sequence number "+f._payloadSequenceNumber+"].",a));b.error(a)}})},f)},error:function(a){a instanceof C&&(a=new Ia("Error encoding payload chunk [sequence number "+f._payloadSequenceNumber+"].",a));b.error(a)}})}},f)}var f=this;h(b,function(){this._ready?d():this._readyQueue.poll(a,{result:function(a){a===n?b.result(!1):d()},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},f)},write:function(a,b,c,d,f){h(f,
function(){if(this._aborted)return!1;if(this._timedout)f.timeout();else{if(this._errored)throw this._errored;if(this._closed)throw new Ia("Message output stream already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");if(!this.getMessageHeader())throw new P("Cannot write payload data for an error message.");var d=a.subarray(b,
b+c);this._currentPayload.push(d);return d.length}},this)}});Jd=function(a,b,c,d,f,g,h){new If(a,b,c,d,f,g,h)}})();var Kd=K.Class.create({sentHeader:function(a){},receivedHeader:function(a){}});Object.freeze({USERDATA_REAUTH:v.USERDATA_REAUTH,SSOTOKEN_REJECTED:v.SSOTOKEN_REJECTED});var Me=K.Class.create({getCryptoContexts:function(){},getRecipient:function(){},isEncrypted:function(){},isIntegrityProtected:function(){},isNonReplayable:function(){},isRequestingTokens:function(){},getUserId:function(){},
getUserAuthData:function(a,b,c,d){},getCustomer:function(){},getKeyRequestData:function(a){},updateServiceTokens:function(a,b,c){},write:function(a,b,c){},getDebugContext:function(){}});K.Class.create({getInputStream:function(a){},getOutputStream:function(a){}});var Jf;(function(){function c(a){return function(){a.abort()}}function d(a,b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},ticket:{value:b,writable:!1,configurable:!1}})}function f(a,b){Object.defineProperties(this,
{builder:{value:a,writable:!1,configurable:!1},msgCtx:{value:b,writable:!1,configurable:!1}})}function g(a,b,c){Object.defineProperties(this,{requestHeader:{value:a,writable:!1,configurable:!1},payloads:{value:b,writable:!1,configurable:!1},handshake:{value:c,writable:!1,configurable:!1}})}function l(a,b){Object.defineProperties(this,{requestHeader:{value:b.requestHeader,writable:!1,configurable:!1},payloads:{value:b.payloads,writable:!1,configurable:!1},handshake:{value:b.handshake,writable:!1,configurable:!1},
response:{value:a,writable:!1,configurable:!1}})}function k(a){for(;a;){if(a instanceof Ja)return!0;a=a instanceof C?a.cause:n}return!1}function q(a,b,c,d,f,g,l,k,p){fe(b,d,f,g,{result:function(d){c&&c.sentHeader(d);Jd(b,l,Q,d,null,null,k,{result:function(b){a.setAbort(function(){b.abort()});b.close(k,{result:function(a){h(p,function(){if(!a)throw new Ja("sendError aborted.");return a})},timeout:function(){p.timeout()},error:function(a){p.error(a)}})},timeout:function(){},error:function(a){p.error(a)}})},
error:function(a){p.error(a)}})}var p=Zd.extend({close:function(a,b){b.result(!0)},write:function(a,c,d,f,g){b(g,function(){return Math.min(a.length-c,d)})},flush:function(a,b){b.result(!0)}}),r=yf.extend({getUserMessage:function(a,b){return null}}),t=Me.extend({init:function(a){Object.defineProperties(this,{_appCtx:{value:a,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContexts:function(){return this._appCtx.getCryptoContexts()},isEncrypted:function(){return this._appCtx.isEncrypted()},
isIntegrityProtected:function(){return this._appCtx.isIntegrityProtected()},isNonReplayable:function(){return this._appCtx.isNonReplayable()},isRequestingTokens:function(){return this._appCtx.isRequestingTokens()},getUserId:function(){return this._appCtx.getUserId()},getUserAuthData:function(a,b,c,d){this._appCtx.getUserAuthData(a,b,c,d)},getCustomer:function(){return this._appCtx.getCustomer()},getKeyRequestData:function(a){this._appCtx.getKeyRequestData(a)},updateServiceTokens:function(a,b,c){this._appCtx.updateServiceTokens(a,
b,c)},write:function(a,b,c){this._appCtx.write(a,b,c)},getDebugContext:function(){return this._appCtx.getDebugContext()}}),m=t.extend({init:function kf(a,b){kf.base.call(this,b);Object.defineProperties(this,{_payloads:{value:a,writable:!1,enumerable:!1,configurable:!1}})},write:function(a,b,c){function d(g,l){if(g==f._payloads.length)c.result(!0);else{var k=f._payloads[g];a.setCompressionAlgorithm(k.compressionAlgo,b,{result:function(q){a.write(k.data,0,k.data.length,b,{result:function(q){h(c,function(){k.isEndOfMessage()?
d(g+1,l):a.flush(b,{result:function(a){c.result(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},f)},timeout:function(a){c.timeout(a)},error:function(a){c.error(a)}})},timeout:function(){},error:function(a){c.error(a)}})}}var f=this;d(0)}}),u=t.extend({init:function oc(a){oc.base.call(this,a)},isEncrypted:function(){return!1},isNonReplayable:function(){return!1},write:function(a,b,c){c.result(!0)}}),w={},x,y,A,B,F=K.Class.create({init:function(a){a||(a=new r);Object.defineProperties(this,
{_filterFactory:{value:null,writable:!0,enumerable:!1,configurable:!1},_renewingContexts:{value:[],writable:!1,enumerable:!1,configurable:!1},_masterTokenLocks:{value:{},writable:!1,enumerable:!1,configurable:!1},_messageRegistry:{value:a,writable:!1,enumerable:!1,configurable:!1}})},setFilterFactory:function(a){this._filterFactory=a},getNewestMasterToken:function(a,b,c,f){var g=this;h(f,function(){var l=b.getMslStore(),k=l.getMasterToken();if(!k)return null;var q=k.uniqueKey(),p=this._masterTokenLocks[q];
p||(p=new Ma,this._masterTokenLocks[q]=p);var r=p.readLock(c,{result:function(r){h(f,function(){if(r===n)throw new Ja("getNewestMasterToken aborted.");var t=l.getMasterToken();if(k.equals(t))return new d(k,r);p.unlock(r);p.writeLock(c,{result:function(d){h(f,function(){if(d===n)throw new Ja("getNewestMasterToken aborted.");delete this._masterTokenLocks[q];p.unlock(d);return this.getNewestMasterToken(a,b,c,f)},g)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},g)},timeout:function(){f.timeout()},
error:function(a){f.error(a)}});a.setAbort(function(){r&&(p.cancel(r),r=n)})},g)},deleteMasterToken:function(a,b){if(b){var c=this;setTimeout(function(){var d=b.uniqueKey(),f=c._masterTokenLocks[d];f||(f=new Ma,c._masterTokenLocks[d]=f);f.writeLock(-1,{result:function(g){a.getMslStore().removeCryptoContext(b);delete c._masterTokenLocks[d];f.unlock(g)},timeout:function(){throw new P("Unexpected timeout received.");},error:function(a){throw a;}})},0)}},releaseMasterToken:function(a){if(a&&a.masterToken){var b=
a.masterToken.uniqueKey(),b=this._masterTokenLocks[b];if(!b)throw new P("Master token read/write lock does not exist when it should.");b.unlock(a.ticket)}},updateOutgoingCryptoContexts:function(a,b,c){var d=a.getMslStore();!a.isPeerToPeer()&&c&&(d.setCryptoContext(c.keyResponseData.masterToken,c.cryptoContext),this.deleteMasterToken(a,b.masterToken))},updateIncomingCryptoContexts:function(a,b,c){var d=c.getMessageHeader();if(d){var f=a.getMslStore();if(d=d.keyResponseData)f.setCryptoContext(d.masterToken,
c.getKeyExchangeCryptoContext()),this.deleteMasterToken(a,b.masterToken)}},storeServiceTokens:function(a,b,c,d){a=a.getMslStore();for(var f=[],g=0;g<d.length;++g){var h=d[g];if(!h.isBoundTo(b)||!b.isVerified()){var l=h.data;l&&0==l.length?a.removeServiceTokens(h.name,h.isMasterTokenBound()?b:null,h.isUserIdTokenBound()?c:null):f.push(h)}}0<f.length&&a.addServiceTokens(f)},buildRequest:function(a,c,d,f,g){var h=this;this.getNewestMasterToken(a,c,f,{result:function(a){b(g,function(){var f=a&&a.masterToken,
l;if(f){l=d.getUserId();var k=c.getMslStore();l=(l=l?k.getUserIdToken(l):null)&&l.isBoundTo(f)?l:null}else l=null;gc(c,f,l,null,{result:function(c){b(g,function(){c.setNonReplayable(d.isNonReplayable());return{builder:c,tokenTicket:a}})},error:function(c){b(g,function(){this.releaseMasterToken(a);c instanceof C&&(c=new P("User ID token not bound to master token despite internal check.",c));throw c;},h)}})},h)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},buildResponse:function(a,
b,c,d,f,g){var l=this;Gf(b,d,{result:function(k){h(g,function(){k.setNonReplayable(c.isNonReplayable());if(!b.isPeerToPeer()&&!d.keyResponseData)return{builder:k,tokenTicket:null};this.getNewestMasterToken(a,b,f,{result:function(a){h(g,function(){var d=a&&a.masterToken,f;if(d){f=c.getUserId();var g=b.getMslStore();f=(f=f?g.getUserIdToken(f):null)&&f.isBoundTo(d)?f:null}else f=null;k.setAuthTokens(d,f);return{builder:k,tokenTicket:a}},l)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},
l)},error:function(a){g.error(a)}})},buildErrorResponse:function(a,b,c,d,g,l,k){function q(a,d){h(k,function(){var l=Wc(g.messageId),q=new m(d,c);gc(b,null,null,l,{result:function(c){h(k,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(a.peerMasterToken,a.peerUserIdToken);c.setNonReplayable(q.isNonReplayable());return{errorResult:new f(c,q),tokenTicket:null}},r)},error:function(a){k.error(a)}})},r)}function p(d,q){r.getNewestMasterToken(a,b,l,{result:function(a){h(k,function(){var l=a&&a.masterToken,
p=Wc(g.messageId),n=new m(q,c);gc(b,l,null,p,{result:function(c){h(k,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(d.peerMasterToken,d.peerUserIdToken);c.setNonReplayable(n.isNonReplayable());return{errorResult:new f(c,n),tokenTicket:a}},r)},error:function(a){k.error(a)}})},r)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}var r=this;h(k,function(){var n=d.requestHeader,t=d.payloads,u=g.errorCode;switch(u){case v.ENTITYDATA_REAUTH:case v.ENTITY_REAUTH:b.getEntityAuthenticationData(u,
{result:function(a){h(k,function(){if(!a)return null;q(n,t)},r)},error:function(a){k.error(a)}});break;case v.USERDATA_REAUTH:case v.SSOTOKEN_REJECTED:c.getUserAuthData(u,!1,!0,{result:function(a){h(k,function(){if(!a)return null;p(n,t)},r)},error:function(a){k.error(a)}});break;case v.USER_REAUTH:p(n,t);break;case v.KEYX_REQUIRED:var u=Wc(g.messageId),w=new m(t,c);gc(b,null,null,u,{result:function(a){h(k,function(){b.isPeerToPeer()&&a.setPeerAuthTokens(n.peerMasterToken,n.peerUserIdToken);a.setRenewable(!0);
a.setNonReplayable(w.isNonReplayable());return{errorResult:new f(a,w),tokenTicket:null}},r)},error:function(a){k.error(a)}});break;case v.EXPIRED:this.getNewestMasterToken(a,b,l,{result:function(a){h(k,function(){var d=a&&a.masterToken,l=n.userIdToken,q=Wc(g.messageId),p=new m(t,c);gc(b,d,l,q,{result:function(c){h(k,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(n.peerMasterToken,n.peerUserIdToken);n.masterToken.equals(d)&&c.setRenewable(!0);c.setNonReplayable(p.isNonReplayable());return{errorResult:new f(c,
p),tokenTicket:a}},r)},error:function(a){k.error(a)}},r)},r)},timeout:function(){k.timeout()},error:function(a){k.error(a)}});break;case v.REPLAYED:this.getNewestMasterToken(a,b,l,{result:function(a){h(k,function(){var d=a&&a.masterToken,l=n.userIdToken,q=Wc(g.messageId),p=new m(t,c);gc(b,d,l,q,{result:function(c){h(k,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(n.peerMasterToken,n.peerUserIdToken);n.masterToken.equals(d)?(c.setRenewable(!0),c.setNonReplayable(!1)):c.setNonReplayable(p.isNonReplayable());
return{errorResult:new f(c,p),tokenTicket:a}},r)},error:function(a){k.error(a)}})},r)},timeout:function(){k.timeout()},error:function(a){k.error(a)}});break;default:return null}},r)},cleanupContext:function(a,b,c){switch(c.errorCode){case v.ENTITY_REAUTH:this.deleteMasterToken(a,b.masterToken);break;case v.USER_REAUTH:c=b.userIdToken,b.masterToken&&c&&a.getMslStore().removeUserIdToken(c)}},send:function(a,b,c,d,f,l,k){function q(a,d,g){h(k,function(){var l=f.getPeerUserIdToken();!b.isPeerToPeer()&&
!d||b.isPeerToPeer()&&!l?(l=c.getCustomer())?f.setCustomer(l,{result:function(b){h(k,function(){d=f.getUserIdToken();r(a,d,g)},u)},error:function(a){k.error(a)}}):r(a,d,g):r(a,d,g)},u)}function r(a,b,d){h(k,function(){var g=!d&&(!c.isEncrypted()||f.willEncryptPayloads())&&(!c.isIntegrityProtected()||f.willIntegrityProtectPayloads())&&(!c.isNonReplayable()||f.isNonReplayable()&&a);g||f.setNonReplayable(!1);var l=[];f.isRenewable()&&(!a||a.isRenewable()||c.isNonReplayable())?c.getKeyRequestData({result:function(c){h(k,
function(){for(var d=0;d<c.length;++d){var h=c[d];l.push(h);f.addKeyRequestData(h)}n(a,b,g,l)},u)},error:function(a){k.error(a)}}):n(a,b,g,l)},u)}function n(g,q,p,r){h(k,function(){var r=new Hf(b,c,f);c.updateServiceTokens(r,!p,{result:function(r){f.getHeader({result:function(r){h(k,function(){var h=c.getDebugContext();h&&h.sentHeader(r);h=f.getKeyExchangeData();this.updateOutgoingCryptoContexts(b,r,h);this.storeServiceTokens(b,g,q,r.serviceTokens);h=!b.isPeerToPeer()&&h?h.cryptoContext:r.cryptoContext;
if(a.isAborted())throw new Ja("send aborted.");var n=null!=this._filterFactory?this._filterFactory.getOutputStream(d):d;Jd(b,n,Q,r,h,l,{result:function(b){a.setAbort(function(){b.abort()});t(b,r,p)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},u)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},error:function(a){k.error(a)}})},u)}function t(d,f,g){if(g)c.write(d,l,{result:function(b){h(k,function(){if(a.isAborted())throw new Ja("MessageOutputStream write aborted.");
m(d,f,g)},u)},timeout:function(){k.timeout()},error:function(a){k.error(a)}});else{var q=new p,r=new Sc;Jd(b,q,Q,f,r,l,{result:function(b){c.write(b,l,{result:function(c){h(k,function(){if(a.isAborted())throw new Ja("MessageOutputStream proxy write aborted.");b.close(l,{result:function(a){h(k,function(){if(!a)throw new Ja("MessageOutputStream proxy close aborted.");var c=b.getPayloads();m(d,f,g,c)},u)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},u)},timeout:function(){k.timeout()},
error:function(a){k.error(a)}})},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}}function m(a,b,c,d){a.close(l,{result:function(f){h(k,function(){if(!f)throw new Ja("MessageOutputStream close aborted.");d||(d=a.getPayloads());return new g(b,d,!c)},u)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}var u=this;h(k,function(){var a=f.getMasterToken(),b=f.getUserIdToken(),d=!1;if(c.getUserId()){var g=!b;c.getUserAuthData(null,f.isRenewable(),g,{result:function(c){h(k,
function(){c&&(f.willEncryptHeader()&&f.willIntegrityProtectHeader()?f.setUserAuthenticationData(c):d=!0);q(a,b,d)},u)},error:function(a){k.error(a)}})}else q(a,b,d)},u)},receive:function(b,c,d,f,g,l,k){var q=this;h(k,function(){if(b.isAborted())throw new Ja("receive aborted.");var p=[];g&&(p=g.keyRequestData.filter(function(){return!0}));var r=d.getCryptoContexts(),n=this._filterFactory?this._filterFactory.getInputStream(f):f;Le(c,n,Q,p,r,l,{result:function(f){b.setAbort(function(){f.abort()});f.isReady(l,
{result:function(b){h(k,function(){if(!b)throw new Ja("MessageInputStream aborted.");var l=f.getMessageHeader(),p=f.getErrorHeader(),r=d.getDebugContext();r&&r.receivedHeader(l?l:p);if(g&&(r=p?p.errorCode:null,l||r!=v.FAIL&&r!=v.TRANSIENT_FAILURE&&r!=v.ENTITY_REAUTH&&r!=v.ENTITYDATA_REAUTH)){var r=l?l.messageId:p.messageId,n=Wc(g.messageId);if(r!=n)throw new ia(a.UNEXPECTED_RESPONSE_MESSAGE_ID,"expected "+n+"; received "+r);}c.getEntityAuthenticationData(null,{result:function(b){h(k,function(){var h=
b.getIdentity(),k;if(l){k=l.entityAuthenticationData;var q=l.masterToken;k=q?l.sender:k.getIdentity();if(q&&q.isDecrypted()&&q.identity!=k||h==k)throw new ia(a.UNEXPECTED_MESSAGE_SENDER,k);g&&this.updateIncomingCryptoContexts(c,g,f);h=l.keyResponseData;c.isPeerToPeer()?(h=h?h.masterToken:l.peerMasterToken,q=l.peerUserIdToken,k=l.peerServiceTokens):(h=h?h.masterToken:l.masterToken,q=l.userIdToken,k=l.serviceTokens);var r=d.getUserId();r&&q&&!q.isVerified()&&c.getMslStore().addUserIdToken(r,q);this.storeServiceTokens(c,
h,q,k)}else if(k=p.entityAuthenticationData.getIdentity(),h==k)throw new ia(a.UNEXPECTED_MESSAGE_SENDER,k);return f},q)},error:k.error})},q)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},q)},sendReceive:function(a,b,c,d,f,g,k,q,p){function r(t,m){h(p,function(){g.setRenewable(m);this.send(a,b,c,f,g,k,{result:function(f){h(p,function(){var g=f.requestHeader.keyRequestData;q||f.handshake||!g.isEmpty()?this.receive(a,
b,c,d,f.requestHeader,k,{result:function(a){h(p,function(){m&&this.releaseRenewalLock(b,t,a);return new l(a,f)},n)},timeout:function(){h(p,function(){m&&this.releaseRenewalLock(b,t,null);p.timeout()},n)},error:function(a){h(p,function(){m&&this.releaseRenewalLock(b,t,null);throw a;},n)}}):h(p,function(){m&&this.releaseRenewalLock(b,t,null);return new l(null,f)},n)},n)},timeout:function(){h(p,function(){m&&this.releaseRenewalLock(b,t,null);p.timeout()},n)},error:function(a){h(p,function(){m&&this.releaseRenewalLock(b,
t,null);throw a;},n)}})},n)}var n=this;h(p,function(){var d=new Y;this.acquireRenewalLock(a,b,c,d,g,k,{result:function(a){r(d,a)},timeout:function(){p.timeout()},error:function(a){a instanceof Ja?p.result(null):p.error(a)}})},n)},acquireRenewalLock:function(a,b,c,d,f,g,k){function l(r,t,m){h(k,function(){if(a.isAborted())throw new Ja("acquireRenewalLock aborted.");for(var u=null,x=0;x<this._renewingContexts.length;++x){var y=this._renewingContexts[x];if(y.ctx===b){u=y.queue;break}}if(!u)return this._renewingContexts.push({ctx:b,
queue:d}),!0;var v=u.poll(g,{result:function(a){h(k,function(){if(a===n)throw new Ja("acquireRenewalLock aborted.");u.add(a);if(a===w||a.isExpired())l(a,t,m);else{if(m&&!t||t&&!t.isBoundTo(a)){var d=b.getMslStore().getUserIdToken(m);t=d&&d.isBoundTo(a)?d:null}f.setAuthTokens(a,t);f.isRenewable()&&a.equals(r)?l(a,t,m):c.isRequestingTokens()&&!t?l(a,t,m):q(a,t)}},p)},timeout:function(){},error:function(a){}});a.setAbort(function(){v&&(u.cancel(v),v=n)})},p)}function q(f,g){h(k,function(){if(a.isAborted())throw new Ja("acquireRenewalLock aborted.");
if(!f||f.isRenewable()||!g&&c.getUserId()||g&&g.isRenewable()){for(var h=null,k=0;k<this._renewingContexts.length;++k){var l=this._renewingContexts[k];if(l.ctx===b){h=l.queue;break}}if(!h)return this._renewingContexts.push({ctx:b,queue:d}),!0}return!1},p)}var p=this;h(k,function(){var a=f.getMasterToken(),b=f.getUserIdToken(),d=c.getUserId();c.isEncrypted()&&!f.willEncryptPayloads()||c.isIntegrityProtected()&&!f.willIntegrityProtectPayloads()||f.isRenewable()||!a&&c.isNonReplayable()||a&&a.isExpired()||
!(b||!d||f.willEncryptHeader()&&f.willIntegrityProtectHeader())||c.isRequestingTokens()&&(!a||d&&!b)?l(a,b,d):q(a,b)},p)},releaseRenewalLock:function(a,b,c){for(var d,f,g=0;g<this._renewingContexts.length;++g){var h=this._renewingContexts[g];if(h.ctx===a){d=g;f=h.queue;break}}if(f!==b)throw new P("Attempt to release renewal lock that is not owned by this queue.");c?(c=c.messageHeader)?(f=c.keyResponseData)?b.add(f.masterToken):(a=a.isPeerToPeer()?c.peerMasterToken:c.masterToken)?b.add(a):b.add(w):
b.add(w):b.add(w);this._renewingContexts.splice(d,1)}});Jf=K.Class.create({init:function(){var a={_impl:{value:new F,writable:!1,enumerable:!1,configurable:!1},_shutdown:{value:!1,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setFilterFactory:function(a){this._impl.setFilterFactory(a)},shutdown:function(){this._shutdown=!0},receive:function(a,b,d,f,g,h){if(this._shutdown)throw new C("MslControl is shutdown.");var k=new x(this._impl,a,b,d,f,g);setTimeout(function(){k.call(h)},
0);return c(k)},respond:function(a,b,d,f,g,h,k){if(this._shutdown)throw new C("MslControl is shutdown.");var l=new y(this._impl,a,b,d,f,g,h);setTimeout(function(){l.call(k)},0);return c(l)},error:function(a,b,d,f,g,h,k){if(this._shutdown)throw new C("MslControl is shutdown.");var l=new A(this._impl,a,b,d,f,g,h);setTimeout(function(){l.call(k)},0);return c(l)},request:function(a,b){if(this._shutdown)throw new C("MslControl is shutdown.");var d,f,g,h,k;if(5==arguments.length){if(d=arguments[2],g=f=
null,h=arguments[3],k=arguments[4],a.isPeerToPeer()){k.error(new P("This method cannot be used in peer-to-peer mode."));return}}else if(6==arguments.length&&(d=null,f=arguments[2],g=arguments[3],h=arguments[4],k=arguments[5],!a.isPeerToPeer())){k.error(new P("This method cannot be used in trusted network mode."));return}var l=new B(this._impl,a,b,d,f,g,null,0,h);setTimeout(function(){l.call(k)},0);return c(l)}});x=K.Class.create({init:function(a,b,c,d,f,g){Object.defineProperties(this,{_ctrl:{value:a,
writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:d,writable:!1,enumerable:!1,configurable:!1},_output:{value:f,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:g,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:n,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},
abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},call:function(b){function c(f){h(b,function(){var c=f.messageHeader;if(!c)return f;this.setAbort(function(){f.abort()});f.mark(Number.MAX_VALUE);f.read(1,g._timeout,{result:function(a){h(b,function(){if(a&&0==a.length)return null;if(a)return f.reset(),f;d(f)},g)},timeout:function(){b.timeout()},error:function(d){h(b,function(){if(k(d))return null;var f=c?c.messageId:null,l,p;d instanceof
Ia?(l=a.MSL_COMMS_FAILURE,p=d):(l=a.INTERNAL_EXCEPTION,p=new P("Error peeking into the message payloads."));q(this,this._ctx,this._msgCtx.getDebugContext(),f,l,null,this._output,this._timeout,{result:function(a){b.error(p)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return null;throw new Ha("Error peeking into the message payloads.",a,d);},g)}})},g)}})},g)}function d(c){h(b,function(){c.close();this._ctrl.buildResponse(this,this._ctx,this._msgCtx,c.messageHeader,this._timeout,
{result:function(a){h(b,function(){var d=a.builder,g=a.tokenTicket,h=c.messageHeader,k=new u(this._msgCtx);if(!this._ctx.isPeerToPeer()||h.isEncrypting()||h.keyResponseData)f(h,d,k,g);else{var l=new B(this._ctrl,this._ctx,k,null,this._input,this._output,a,1,this._timeout);this.setAbort(function(){l.abort()});l.call(b)}},g)},timeout:function(){b.timeout()},error:function(d){h(b,function(){if(k(d))return null;var f,l,p,r;d instanceof C?(f=d.messageId,l=d.error,p=c.messageHeader.messageCapabilities,
p=this._ctrl.messageRegistry.getUserMessage(l,p?p.languages:null),r=d):(f=requestHeader?requestHeader.messageId:null,l=a.INTERNAL_EXCEPTION,p=null,r=new P("Error creating an automatic handshake response.",d));q(this,this._ctx,this._msgCtx.getDebugContext(),f,l,p,this._output,this._timeout,{result:function(a){b.error(r)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return null;throw new Ha("Error creating an automatic handshake response.",a,d);},g)}})},g)}})},g)}function f(c,
d,l,p){h(b,function(){d.setRenewable(!1);this._ctrl.send(this._ctx,l,this._output,d,this._timeout,{result:function(a){h(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(p);return null},g)},timeout:function(){h(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(p);b.timeout()},g)},error:function(d){h(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(p);if(k(d))return null;var f,l,r,n;d instanceof C?(f=d.messageId,l=d.error,r=c?c.messageCapabilities:
null,r=this._ctrl.messageRegistry.getUserMessage(l,r?r.languages:null),n=d):d instanceof Ia?(f=c?c.messageId:null,l=a.MSL_COMMS_FAILURE,r=null,n=d):(f=c?c.messageId:null,l=a.INTERNAL_EXCEPTION,r=null,n=new P("Error sending an automatic handshake response.",d));q(this,this._ctx,this._msgCtx.getDebugContext(),f,l,r,this._output,this._timeout,{result:function(a){b.error(n)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return null;throw new Ha("Error sending an automatic handshake response.",
a,d);},g)}})},g)}})},g)}var g=this;h(b,function(){this._ctrl.receive(this,this._ctx,this._msgCtx,this._input,null,this._timeout,{result:function(a){c(a)},timeout:function(){b.timeout()},error:function(c){h(b,function(){if(k(c))return null;var d,f,l,p;c instanceof C?(d=c.messageId,f=c.error,l=this._ctrl.messageRegistry.getUserMessage(f,null),p=c):(d=null,f=a.INTERNAL_EXCEPTION,l=null,p=new P("Error receiving the message header.",c));q(this,this._ctx,this._msgCtx.getDebugContext(),d,f,l,this._output,
this._timeout,{result:function(a){b.error(p)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return null;throw new Ha("Error receiving the message header.",a,c);},g)}})},g)}})},g)}});y=K.Class.create({init:function(a,b,c,d,f,g,h){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:d,writable:!1,enumerable:!1,
configurable:!1},_output:{value:f,writable:!1,enumerable:!1,configurable:!1},_request:{value:g,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:h,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:n,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},trustedNetworkExecute:function(b,
c,d){var f=this;h(d,function(){if(12<c+1)return!1;var g;if(g=this._msgCtx.isIntegrityProtected()&&!b.willIntegrityProtectHeader()?a.RESPONSE_REQUIRES_INTEGRITY_PROTECTION:this._msgCtx.isEncrypted()&&!b.willEncryptPayloads()?a.RESPONSE_REQUIRES_ENCRYPTION:null){var l=Xc(b.getMessageId());q(this,this._ctx,this._msgCtx.getDebugContext(),l,g,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){h(d,function(){if(k(a))return!1;throw new Ha("Response requires encryption or integrity protection but cannot be protected: "+
g,a,null);},f)}})}else!this._msgCtx.getCustomer()||b.getMasterToken()||b.getKeyExchangeData()?(b.setRenewable(!1),this._ctrl.send(this._ctx,this._msgCtx,this._output,b,this._timeout,{result:function(a){d.result(!0)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})):(l=Xc(b.getMessageId()),q(this,this._ctx,this._msgCtx.getDebugContext(),l,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){h(d,
function(){if(k(a))return!1;throw new Ha("Response wishes to attach a user ID token but there is no master token.",a,null);},f)}}))},f)},peerToPeerExecute:function(b,c,d,f){function g(a){h(f,function(){var c=a.response;c.close();c=c.getErrorHeader();this._ctrl.cleanupContext(this._ctx,a.requestHeader,c);this._ctrl.buildErrorResponse(this,this._ctx,b,a,c,{result:function(a){h(f,function(){if(!a)return!1;var b=a.errorResult,c=a.tokenTicket;this.peerToPeerExecute(b.msgCtx,b.builder,d,{result:function(a){h(f,
function(){this._ctrl.releaseMasterToken(c);return a},l)},timeout:function(){h(f,function(){this._ctrl.releaseMasterToken(c);f.timeout()},l)},error:function(a){h(f,function(){this._ctrl.releaseMasterToken(c);throw a;},l)}})},l)}})},l)}var l=this;h(f,function(){if(12<d+2)return!1;if(null!=b.getCustomer()&&null==c.getPeerMasterToken()&&null==c.getKeyExchangeData()){var p=Xc(c.getMessageId());q(this,this._ctx,b.getDebugContext(),p,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){f.result(!1)},
timeout:function(){f.timeout()},error:function(a){h(f,function(){if(k(a))return!1;throw new Ha("Response wishes to attach a user ID token but there is no master token.",a,null);},l)}})}else this._ctrl.sendReceive(this._ctx,b,this._input,this._output,c,this._timeout,!1,{result:function(a){h(f,function(){function c(){p.read(32768,l._timeout,{result:function(a){h(f,function(){a?c():k()},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function k(){h(f,function(){var c=new m(a.payloads,
b);this._ctrl.buildResponse(this,this._ctx,c,q,this._timeout,{result:function(a){h(f,function(){var b=a.tokenTicket;this.peerToPeerExecute(c,a.builder,d,{result:function(a){h(f,function(){this._ctrl.releaseMasterToken(b);return a},l)},timeout:function(){h(f,function(){this._ctrl.releaseMasterToken(b);f.timeout()},l)},error:function(a){h(f,function(){this._ctrl.releaseMasterToken(b);throw a;},l)}})},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},l)}var p=a.response;d+=2;if(!p)return!0;
var q=p.getMessageHeader();if(q){var r=a.payloads,r=0<r.length&&0<r[0].data.length;if(a.handshake&&r)c();else return!0}else g(a)},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},l)},call:function(b){var c=this;this._ctrl.buildResponse(this,this._ctx,this._msgCtx,this._request,this._timeout,{result:function(d){h(b,function(){var f=d.builder,g=d.tokenTicket;this._ctx.isPeerToPeer()?this.peerToPeerExecute(this._msgCtx,f,3,{result:function(a){h(b,function(){this._ctx.isPeerToPeer()&&
this.releaseMasterToken(g);return a},c)},timeout:function(){h(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(g);b.timeout()},c)},error:function(d){h(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(g);if(k(d))return!1;var l=Xc(f.getMessageId()),p,r,n;d instanceof C?(p=d.error,r=this._request.messageCapabilities,r=this._ctrl.messageRegistry.getUserMessage(p,r?r.languages:null),n=d):d instanceof Ia?(p=a.MSL_COMMS_FAILURE,r=null,n=d):(p=a.INTERNAL_EXCEPTION,r=null,n=new P("Error sending the response.",
d));q(this,this._ctx,this._msgCtx.getDebugContext(),l,p,r,this._output,this._timeout,{result:function(a){b.error(n)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return!1;throw new Ha("Error sending the response.",a,null);},c)}})},c)}}):this.trustedNetworkExecute(f,3,{result:function(a){h(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(g);return a},c)},timeout:function(){h(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(g);b.timeout()},c)},
error:function(d){h(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(g);if(k(d))return!1;var l=Xc(f.getMessageId()),p,r,n;d instanceof C?(p=d.error,r=this._request.messageCapabilities,r=this._ctrl.messageRegistry.getUserMessage(p,r?r.languages:null),n=d):d instanceof Ia?(p=a.MSL_COMMS_FAILURE,r=null,n=d):(p=a.INTERNAL_EXCEPTION,r=null,n=new P("Error sending the response.",d));q(this,this._ctx,this._msgCtx.getDebugContext(),l,p,r,this._output,this._timeout,{result:function(a){b.error(n)},
timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return!1;throw new Ha("Error sending the response.",a,null);},c)}})},c)}})},c)},timeout:function(){b.timeout()},error:function(d){h(b,function(){if(k(d))return!1;var f,g,l,p;d instanceof C?(f=d.messageId,g=d.error,l=this._request.messageCapabilities,l=this._ctrl.messageRegistry.getUserMessage(g,l?l.languages:null),p=d):(f=null,g=a.INTERNAL_EXCEPTION,l=null,p=new P("Error building the response.",d));q(this,this._ctx,this._msgCtx.getDebugContext(),
f,g,l,this._output,this._timeout,{result:function(a){b.error(p)},timeout:function(){b.timeout()},error:function(a){h(b,function(){if(k(a))return null;throw new Ha("Error building the response.",a,d);},c)}})},c)}})}});A=K.Class.create({init:function(a,b,c,d,f,g,h){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_appError:{value:d,writable:!1,enumerable:!1,
configurable:!1},_output:{value:output,writable:!1,enumerable:!1,configurable:!1},_request:{value:g,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:h,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:n,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},call:function(b){var c=
this;h(b,function(){var d;if(this._appError==ENTITY_REJECTED)d=this._request.masterToken?a.MASTERTOKEN_REJECTED_BY_APP:a.ENTITY_REJECTED_BY_APP;else if(this._appError==USER_REJECTED)d=this._request.userIdToken?a.USERIDTOKEN_REJECTED_BY_APP:a.USER_REJECTED_BY_APP;else throw new P("Unhandled application error "+this._appError+".");var f=this._request.messageCapabilities,f=this._ctrl.messageRegistry.getUserMessage(d,f?f.languages:null);q(this,this._ctx,this._msgCtx.getDebugContext(),this._request.messageId,
d,f,this._output,this._timeout,{result:function(a){b.result(a)},timeout:b.timeout,error:function(a){h(b,function(){if(k(a))return!1;if(a instanceof C)throw a;throw new P("Error building the error response.",a);},c)}})},c)}});var D={result:function(){},timeout:function(){},error:function(){}};B=K.Class.create({init:function(a,b,c,d,f,g,h,l,k){var p;h?(p=h.builder,h=h.tokenTicket):h=p=null;Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,
enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_remoteEntity:{value:d,writable:!1,enumerable:!1,configurable:!1},_input:{value:f,writable:!0,enumerable:!1,configurable:!1},_output:{value:g,writable:!0,enumerable:!1,configurable:!1},_openedStreams:{value:!1,writable:!0,enumerable:!1,configurable:!1},_builder:{value:p,writable:!0,enumerable:!1,configurable:!1},_tokenTicket:{value:h,writable:!0,enumerable:!1,configurable:!1},_timeout:{value:k,writable:!1,enumerable:!1,
configurable:!1},_msgCount:{value:l,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:n,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},execute:function(a,b,c,d,f){function g(b){function l(a){h(f,function(){var c=b.response;return a?a:c},k)}h(f,function(){var g=b.response;
g.close();var p=g.getErrorHeader();this._ctrl.cleanupContext(this._ctx,b.requestHeader,p);this._ctrl.buildErrorResponse(this,this._ctx,a,b,p,c,{result:function(a){h(f,function(){if(!a)return g;var b=a.errorResult,p=a.tokenTicket,q=b.builder,b=b.msgCtx;if(this._ctx.isPeerToPeer())this.execute(b,q,this._timeout,d,{result:function(a){h(f,function(){this._ctrl.releaseMasterToken(p);l(a)},k)},timeout:function(){h(f,function(){this._ctrl.releaseMasterToken(p);f.timeout()},k)},error:function(a){h(f,function(){this._ctrl.releaseMasterToken(p);
f.error(a)},k)}});else{this._openedStreams&&(this._input.close(),this._output.close(c,D));var r=new B(this._ctrl,this._ctx,b,this._remoteEntity,null,null,{builder:q,tokenTicket:p},d,this._timeout);this.setAbort(function(){r.abort()});r.call({result:function(a){l(a)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},k)}function l(b){h(f,function(){function g(){p.read(32768,k._timeout,{result:function(a){a?g():l()},
timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function l(){h(f,function(){var g=new m(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,q,c,{result:function(a){h(f,function(){var b=a.tokenTicket;this.execute(g,a.builder,this._timeout,d,{result:function(a){h(f,function(){this._ctrl.releaseMasterToken(b);return a},k)},timeout:function(){h(f,function(){this._ctrl.releaseMasterToken(b);f.timeout()},k)},error:function(a){h(f,function(){this._ctrl.releaseMasterToken(b);throw a;},
k)}})},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},k)}var p=b.response,q=p.getMessageHeader(),r=b.payloads,r=0<r.length&&0<r[0].data.length;if(!this._ctx.isPeerToPeer()){if(!b.handshake||!r)return p;this._openedStreams&&(this._input.close(),this._output.close(c,D));var n=new m(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,q,c,{result:function(a){h(f,function(){var b=new B(this._ctrl,this._ctx,n,this._remoteEntity,null,null,a,d,this._timeout);this.setAbort(function(){b.abort()});
b.call(f)},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}else if(b.handshake&&r)g();else if(0<q.keyRequestData.length){var t=new u(a);this._ctrl.buildResponse(this,this._ctx,t,q,c,{result:function(a){h(f,function(){var b=a.builder,c=a.tokenTicket;p.mark();p.read(1,this._timeout,{result:function(a){h(f,function(){function g(){p.read(32768,k._timeout,{result:function(a){a?g():l()},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function l(){k.execute(t,b,k._timeout,
d,{result:function(a){h(f,function(){this._ctrl.releaseMasterToken(c);return a},k)},timeout:function(){h(f,function(){this._ctrl.releaseMasterToken(c);f.timeout()},k)},error:function(a){h(f,function(){this._ctrl.releaseMasterToken(c);throw a;},k)}})}if(a)if(p.reset(),12>=d+1)b.setRenewable(!1),this._ctrl.send(this,this._ctx,t,this._output,b,this._timeout,{result:function(a){h(f,function(){this.releaseMasterToken(c);return p},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}});else return this.releaseMasterToken(c),
p;else g()},k)},timeout:function(){h(f,function(){this.releaseMasterToken(c);f.timeout()},k)},error:function(a){h(f,function(){this.releaseMasterToken(c);throw a;},k)}})},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}},k)}var k=this;h(f,function(){if(12<d+2)return null;this._ctrl.sendReceive(this,this._ctx,a,this._input,this._output,b,c,!0,{result:function(a){h(f,function(){if(!a)return null;var b=a.response;d+=2;b.getMessageHeader()?l(a):g(a)},k)},timeout:function(){f.timeout()},
error:function(a){f.error(a)}})},k)},call:function(a){function b(d,f,g){h(a,function(){this.execute(this._msgCtx,d,g,this._msgCount,{result:function(b){h(a,function(){this._ctrl.releaseMasterToken(f);this._openedStreams&&this._output.close(g,D);b&&b.closeSource(this._openedStreams);return b},c)},timeout:function(){h(a,function(){this._ctrl.releaseMasterToken(f);this._openedStreams&&(this._output.close(g,D),this._input.close());a.timeout()},c)},error:function(b){h(a,function(){this._ctrl.releaseMasterToken(f);
this._openedStreams&&(this._output.close(g,D),this._input.close());if(k(b))return null;throw b;},c)}})},c)}var c=this;h(a,function(){var d=this._timeout;if(!this._input||!this._output)try{this._remoteEntity.setTimeout(this._timeout);var f=Date.now(),g=this._remoteEntity.openConnection();this._output=g.output;this._input=g.input;-1!=d&&(d=this._timeout-(Date.now()-f));this._openedStreams=!0}catch(l){this._builder&&this._ctrl.releaseMasterToken(this._tokenTicket);this._output&&this._output.close(this._timeout,
D);this._input&&this._input.close();if(k(l))return null;throw l;}this._builder?b(this._builder,this._tokenTicket,d):this._ctrl.buildRequest(this,this._ctx,this._msgCtx,this._timeout,{result:function(f){h(a,function(){b(f.builder,f.tokenTicket,d)},c)},timeout:function(){h(a,function(){this._openedStreams&&(this._output.close(this._timeout,D),this._input.close());a.timeout()},c)},error:function(b){h(a,function(){this._openedStreams&&(this._output.close(this._timeout,D),this._input.close());if(k(b))return null;
throw b;},c)}})},c)}})})();var ge,Kf;(function(){ge=K.Class.create({init:function(a){Object.defineProperties(this,{id:{value:a,writable:!1,configurable:!1}})},toJSON:function(){var a={};a.id=this.id;return a},equals:function(a){return this===a?!0:a instanceof ge?this.id==a.id:!1},uniqueKey:function(){return this.id}});Kf=function(b){var c=b.id;if(!c)throw new R(a.JSON_PARSE_ERROR,JSON.stringify(b));return new ge(c)}})();K.Class.create({isNewestMasterToken:function(a,b,c){},isMasterTokenRevoked:function(a,
b){},acceptNonReplayableId:function(a,b,c,d){},createMasterToken:function(a,b,c,d,f){},isMasterTokenRenewable:function(a,b,c){},renewMasterToken:function(a,b,c,d,f){},isUserIdTokenRevoked:function(a,b,c,d){},createUserIdToken:function(a,b,c,d){},renewUserIdToken:function(a,b,c,d){}});var Cb,Uc;(function(){function d(a,b,c,f){this.sessiondata=a;this.tokendata=b;this.signature=c;this.verified=f}Cb=K.Class.create({init:function(a,d,f,g,h,l,k,p,q,r,n){var t=this;b(n,function(){if(f.getTime()<d.getTime())throw new P("Cannot construct a master token that expires before its renewal window opens.");
if(0>g||g>V)throw new P("Sequence number "+g+" is outside the valid range.");if(0>h||h>V)throw new P("Serial number "+h+" is outside the valid range.");var m=Math.floor(d.getTime()/1E3),u=Math.floor(f.getTime()/1E3),w;if(r)w=r.sessiondata;else{var x={};l&&(x.issuerdata=l);x.identity=k;x.encryptionkey=G(p.toByteArray());x.hmackey=G(q.toByteArray());w=c(JSON.stringify(x),Q)}if(r)return Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:m,
writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:u,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:g,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:l,writable:!1,configurable:!1},identity:{value:k,writable:!1,configurable:!1},encryptionKey:{value:p,writable:!1,configurable:!1},hmacKey:{value:q,writable:!1,configurable:!1},sessiondata:{value:w,writable:!1,enumerable:!1,configurable:!1},verified:{value:r.verified,
writable:!1,enumerable:!1,configurable:!1},tokendata:{value:r.tokendata,writable:!1,enumerable:!1,configurable:!1},signature:{value:r.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var y=a.getMslCryptoContext();y.encrypt(w,{result:function(d){b(n,function(){var f={};f.renewalwindow=m;f.expiration=u;f.sequencenumber=g;f.serialnumber=h;f.sessiondata=G(d);var r=c(JSON.stringify(f),Q);y.sign(r,{result:function(c){b(n,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,
configurable:!1},renewalWindowSeconds:{value:m,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:u,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:g,writable:!1,enumerable:!1,configurable:!1},serialNumber:{value:h,writable:!1,enumerable:!1,configurable:!1},issuerData:{value:l,writable:!1,configurable:!1},identity:{value:k,writable:!1,configurable:!1},encryptionKey:{value:p,writable:!1,configurable:!1},hmacKey:{value:q,writable:!1,configurable:!1},sessiondata:{value:w,
writable:!1,enumerable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:r,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},t)},error:function(a){n.error(a)}})},t)},error:function(a){n.error(a)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*this.expirationSeconds)},isDecrypted:function(){return this.sessiondata?
!0:!1},isVerified:function(){return this.verified},isRenewable:function(a){return this.isVerified()?this.renewalWindow.getTime()<=this.ctx.getTime():!0},isExpired:function(a){return this.isVerified()?this.expiration.getTime()<=this.ctx.getTime():!1},isNewerThan:function(a){if(this.sequenceNumber==a.sequenceNumber)return this.expiration>a.expiration;if(this.sequenceNumber>a.sequenceNumber){var b=this.sequenceNumber-V+127;return a.sequenceNumber>=b}b=a.sequenceNumber-V+127;return this.sequenceNumber<
b},toJSON:function(){var a={};a.tokendata=G(this.tokendata);a.signature=G(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Cb?this.serialNumber==a.serialNumber&&this.sequenceNumber==a.sequenceNumber&&this.expiration.getTime()==a.expiration.getTime():!1},uniqueKey:function(){return this.serialNumber+":"+this.sequenceNumber+this.expiration.getTime()}});Uc=function(c,f,g){b(g,function(){var h=c.getMslCryptoContext(),k=f.tokendata,p=f.signature;if("string"!==typeof k||"string"!==
typeof p)throw new R(a.JSON_PARSE_ERROR,"mastertoken "+JSON.stringify(f));var q,r;try{q=L(k)}catch(n){throw new C(a.MASTERTOKEN_TOKENDATA_INVALID,"mastertoken "+JSON.stringify(f),n);}if(!q||0==q.length)throw new R(a.MASTERTOKEN_TOKENDATA_MISSING,"mastertoken "+JSON.stringify(f));try{r=L(p)}catch(t){throw new C(a.MASTERTOKEN_SIGNATURE_INVALID,"mastertoken "+JSON.stringify(f),t);}h.verify(q,r,{result:function(f){b(g,function(){var k,p,n,t,m,u=l(q,Q);try{var w=JSON.parse(u);k=parseInt(w.renewalwindow);
p=parseInt(w.expiration);n=parseInt(w.sequencenumber);t=parseInt(w.serialnumber);m=w.sessiondata}catch(x){if(x instanceof SyntaxError)throw new R(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+u,x);throw x;}if(!k||k!=k||!p||p!=p||"number"!==typeof n||n!=n||"number"!==typeof t||t!=t||"string"!==typeof m)throw new R(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+u);if(p<k)throw new C(a.MASTERTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+u);if(0>n||n>V)throw new C(a.MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE,
"mastertokendata "+u);if(0>t||t>V)throw new C(a.MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"mastertokendata "+u);var y=new Date(1E3*k),v=new Date(1E3*p),A;try{A=L(m)}catch(B){throw new C(a.MASTERTOKEN_SESSIONDATA_INVALID,m,B);}if(!A||0==A.length)throw new C(a.MASTERTOKEN_SESSIONDATA_MISSING,m);f?h.decrypt(A,{result:function(h){b(g,function(){var k,p,m,u,w=l(h,Q);try{var x=JSON.parse(w);k=x.issuerdata;p=x.identity;m=x.encryptionkey;u=x.hmackey}catch(A){if(A instanceof SyntaxError)throw new R(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,
"sessiondata "+w,A);throw A;}if(k&&"object"!==typeof k||!p||"string"!==typeof m||"string"!==typeof u)throw new R(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,"sessiondata "+w);kb(m,Yb,cb,{result:function(l){kb(u,rb,X,{result:function(a){b(g,function(){var b=new d(h,q,r,f);new Cb(c,y,v,n,t,k,p,l,a,b,g)})},error:function(b){g.error(new I(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})},error:function(b){g.error(new I(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})})},error:function(a){g.error(a)}}):(k=new d(null,q,r,f),new Cb(c,
y,v,n,t,null,null,null,null,k,g))})},error:function(a){g.error(a)}})})}})();var zc,jd;(function(){function d(a,b,c){this.tokendata=a;this.signature=b;this.verified=c}zc=K.Class.create({init:function(a,d,f,g,h,l,k,p,q){var r=this;b(q,function(){if(f.getTime()<d.getTime())throw new P("Cannot construct a user ID token that expires before its renewal window opens.");if(!g)throw new P("Cannot construct a user ID token without a master token.");if(0>h||h>V)throw new P("Serial number "+h+" is outside the valid range.");
var n=Math.floor(d.getTime()/1E3),t=Math.floor(f.getTime()/1E3),m=g.serialNumber;if(p){var u=p.tokendata,w=p.signature,x=p.verified,m=g.serialNumber;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:n,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:t,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:m,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:l,
writable:!1,configurable:!1},customer:{value:k,writable:!1,configurable:!1},verified:{value:x,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:u,writable:!1,enumerable:!1,configurable:!1},signature:{value:w,writable:!1,enumerable:!1,configurable:!1}});return this}u={};l&&(u.issuerdata=l);u.identity=k;var u=c(JSON.stringify(u),Q),y=a.getMslCryptoContext();y.encrypt(u,{result:function(d){b(q,function(){var f={};f.renewalwindow=n;f.expiration=t;f.mtserialnumber=m;f.serialnumber=h;f.userdata=
G(d);var p=c(JSON.stringify(f),Q);y.sign(p,{result:function(c){b(q,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:n,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:t,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:g.serialNumber,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:l,writable:!1,configurable:!1},customer:{value:k,writable:!1,
configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:p,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},r)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(g);throw a;},r)}})},r)},error:function(a){b(q,function(){a instanceof C&&a.setEntity(g);throw a;},r)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*this.expirationSeconds)},
isVerified:function(){return this.verified},isDecrypted:function(){return this.customer?!0:!1},isRenewable:function(){return this.renewalWindow.getTime()<=this.ctx.getTime()},isExpired:function(){return this.expiration.getTime()<=this.ctx.getTime()},isBoundTo:function(a){return a&&a.serialNumber==this.mtSerialNumber},toJSON:function(){var a={};a.tokendata=G(this.tokendata);a.signature=G(this.signature);return a},equals:function(a){return this===a?!0:a instanceof zc?this.serialNumber==a.serialNumber&&
this.mtSerialNumber==a.mtSerialNumber:!1},uniqueKey:function(){return this.serialNumber+":"+this.mtSerialNumber}});jd=function(c,f,g,h){b(h,function(){var k=c.getMslCryptoContext(),p=f.tokendata,q=f.signature;if("string"!==typeof p||"string"!==typeof q)throw(new R(a.JSON_PARSE_ERROR,"useridtoken "+JSON.stringify(f))).setEntity(g);var r,n;try{r=L(p)}catch(t){throw(new C(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),t)).setEntity(g);}if(!r||0==r.length)throw(new R(a.USERIDTOKEN_TOKENDATA_MISSING,
"useridtoken "+JSON.stringify(f))).setEntity(g);try{n=L(q)}catch(m){throw(new C(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),m)).setEntity(g);}k.verify(r,n,{result:function(f){b(h,function(){var p,q,t,m,u,w=l(r,Q);try{var x=JSON.parse(w);p=parseInt(x.renewalwindow);q=parseInt(x.expiration);t=parseInt(x.mtserialnumber);m=parseInt(x.serialnumber);u=x.userdata}catch(y){if(y instanceof SyntaxError)throw(new R(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+w,y)).setEntity(g);
throw y;}if(!p||p!=p||!q||q!=q||"number"!==typeof t||t!=t||"number"!==typeof m||m!=m||"string"!==typeof u)throw(new R(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+w)).setEntity(g);if(q<p)throw(new C(a.USERIDTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+w)).setEntity(g);if(0>t||t>V)throw(new C(a.USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+w)).setEntity(g);if(0>m||m>V)throw(new C(a.USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+w)).setEntity(g);var v=new Date(1E3*
p),A=new Date(1E3*q);if(!g||t!=g.serialNumber)throw(new C(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+t+"; mt "+JSON.stringify(g))).setEntity(g);var B;try{B=L(u)}catch(D){throw(new C(a.USERIDTOKEN_USERDATA_INVALID,u,D)).setEntity(g);}if(!B||0==B.length)throw(new C(a.USERIDTOKEN_USERDATA_MISSING,u)).setEntity(g);f?k.decrypt(B,{result:function(k){b(h,function(){var b,p,q=l(k,Q);try{var t=JSON.parse(q);b=t.issuerdata;p=t.identity}catch(u){if(u instanceof SyntaxError)throw(new R(a.USERIDTOKEN_USERDATA_PARSE_ERROR,
"userdata "+q)).setEntity(g);throw u;}if(b&&"object"!==typeof b||"object"!==typeof p)throw(new R(a.USERIDTOKEN_USERDATA_PARSE_ERROR,"userdata "+q)).setEntity(g);var w;try{w=Kf(p)}catch(x){throw(new C(a.USERIDTOKEN_IDENTITY_INVALID,"userdata "+q,x)).setEntity(g);}p=new d(r,n,f);new zc(c,v,A,g,m,b,w,p,h)})},error:function(a){b(h,function(){a instanceof C&&a.setEntity(g);throw a;})}}):(p=new d(r,n,f),new zc(c,v,A,g,m,null,null,p,h))})},error:function(a){b(h,function(){a instanceof C&&a.setEntity(g);
throw a;})}})})}})();var Bc,hc,de;(function(){function d(b,c){var f=b.tokendata;if("string"!==typeof f)throw new R(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));var g;try{g=L(f)}catch(h){throw new C(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(b),h);}if(!g||0==g.length)throw new R(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(b));var k;try{k=JSON.parse(l(g,Q)).name}catch(p){if(p instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b),
p);throw p;}if(!k)throw new R(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));return c[k]?c[k]:c[""]}function f(a,b,c){this.tokendata=a;this.signature=b;this.verified=c}Bc=K.Class.create({init:function(a,d,f,g,h,l,k,p,q,r){var n=this;b(r,function(){if(g&&h&&!h.isBoundTo(g))throw new P("Cannot construct a service token bound to a master token and user ID token where the user ID token is not bound to the same master token.");var t=g?g.serialNumber:-1,m=h?h.serialNumber:-1;if(q)return x=q.tokendata,
Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:d,writable:!1,configurable:!1},mtSerialNumber:{value:t,writable:!1,configurable:!1},uitSerialNumber:{value:m,writable:!1,configurable:!1},data:{value:f,writable:!1,configurable:!1},encrypted:{value:l,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:k,writable:!1,configurable:!1},verified:{value:q.verified,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:x,writable:!1,enumerable:!1,
configurable:!1},signature:{value:q.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var u;k?(u=Ac(k,f),u.length<f.length||(k=null,u=f)):(k=null,u=f);var w={};w.name=d;-1!=t&&(w.mtserialnumber=t);-1!=m&&(w.uitserialnumber=m);w.encrypted=l;k&&(w.compressionalgo=k);if(l&&0<u.length)p.encrypt(u,{result:function(q){b(r,function(){w.servicedata=G(q);var u=c(JSON.stringify(w),Q);p.sign(u,{result:function(c){b(r,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},
name:{value:d,writable:!1,configurable:!1},mtSerialNumber:{value:t,writable:!1,configurable:!1},uitSerialNumber:{value:m,writable:!1,configurable:!1},data:{value:f,writable:!1,configurable:!1},encrypted:{value:l,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:k,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:u,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},
n)},error:function(a){b(r,function(){a instanceof C&&(a.setEntity(g),a.setUser(h));throw a;})}})},n)},error:function(a){b(r,function(){a instanceof C&&(a.setEntity(g),a.setUser(h));throw a;})}});else{w.servicedata=G(u);var x=c(JSON.stringify(w),Q);p.sign(x,{result:function(c){b(r,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:d,writable:!1,configurable:!1},mtSerialNumber:{value:t,writable:!1,configurable:!1},uitSerialNumber:{value:m,writable:!1,
configurable:!1},data:{value:f,writable:!1,configurable:!1},encrypted:{value:l,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:k,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:x,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},n)},error:function(a){b(r,function(){a instanceof C&&(a.setEntity(g),a.setUser(h));throw a;})}})}},this)},isEncrypted:function(){return this.encrypted},
isVerified:function(){return this.verified},isDecrypted:function(){return this.data?!0:!1},isDeleted:function(){return this.data&&0==this.data.length},isMasterTokenBound:function(){return-1!=this.mtSerialNumber},isBoundTo:function(a){return a?a instanceof Cb?a.serialNumber==this.mtSerialNumber:a instanceof zc?a.serialNumber==this.uitSerialNumber:!1:!1},isUserIdTokenBound:function(){return-1!=this.uitSerialNumber},isUnbound:function(){return-1==this.mtSerialNumber&&-1==this.uitSerialNumber},toJSON:function(){var a=
{};a.tokendata=G(this.tokendata);a.signature=G(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Bc?this.name==a.name&&this.mtSerialNumber==a.mtSerialNumber&&this.uitSerialNumber==a.uitSerialNumber:!1},uniqueKey:function(){return this.name+":"+this.mtSerialNumber+":"+this.uitSerialNumber}});hc=function(a,b,c,d,f,g,h,l,k){new Bc(a,b,c,d,f,g,h,l,null,k)};de=function(c,g,h,k,p,q){b(q,function(){!p||p instanceof id||(p=d(g,p));var r=g.tokendata,n=g.signature;if("string"!==typeof r||
"string"!==typeof n)throw(new R(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(g))).setEntity(h).setEntity(k);var t,m;try{t=L(r)}catch(u){throw(new C(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(g),u)).setEntity(h).setEntity(k);}if(!t||0==t.length)throw(new R(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(g))).setEntity(h).setEntity(k);try{m=L(n)}catch(w){throw(new C(a.SERVICETOKEN_SIGNATURE_INVALID,"servicetoken "+JSON.stringify(g),w)).setEntity(h).setEntity(k);
}var x,y,v,A,B,D,F=l(t,Q);try{var E=JSON.parse(F);x=E.name;y=E.mtserialnumber?parseInt(E.mtserialnumber):-1;v=E.uitserialnumber?parseInt(E.uitserialnumber):-1;A=E.encrypted;B=E.compressionalgo;D=E.servicedata}catch(G){if(G instanceof SyntaxError)throw(new R(a.JSON_PARSE_ERROR,"servicetokendata "+F,G)).setEntity(h).setEntity(k);throw G;}if(!x||"number"!==typeof y||y!=y||"number"!==typeof v||v!=v||"boolean"!==typeof A||B&&"string"!==typeof B||"string"!==typeof D)throw(new R(a.JSON_PARSE_ERROR,"servicetokendata "+
F)).setEntity(h).setEntity(k);if(E.mtserialnumber&&0>y||y>V)throw(new C(a.SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+F)).setEntity(h).setEntity(k);if(E.uitserialnumber&&0>v||v>V)throw(new C(a.SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+F)).setEntity(h).setEntity(k);if(-1!=y&&(!h||y!=h.serialNumber))throw(new C(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st mtserialnumber "+y+"; mt "+h)).setEntity(h).setEntity(k);if(-1!=v&&(!k||v!=k.serialNumber))throw(new C(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,
"st uitserialnumber "+v+"; uit "+k)).setEntity(h).setEntity(k);A=!0===A;var H;if(B){if(!la[B])throw new C(a.UNIDENTIFIED_COMPRESSION,B);H=B}else H=null;p?p.verify(t,m,{result:function(d){b(q,function(){if(d){var g;try{g=L(D)}catch(l){throw(new C(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+F,l)).setEntity(h).setEntity(k);}if(!g||0!=D.length&&0==g.length)throw(new C(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+F)).setEntity(h).setEntity(k);if(A&&0<g.length)p.decrypt(g,{result:function(a){b(q,
function(){var b=H?Vc(H,a):a,g=new f(t,m,d);new Bc(c,x,b,-1!=y?h:null,-1!=v?k:null,A,H,p,g,q)})},error:function(a){b(q,function(){a instanceof C&&(a.setEntity(h),a.setUser(k));throw a;})}});else{g=H?Vc(H,g):g;var r=new f(t,m,d);new Bc(c,x,g,-1!=y?h:null,-1!=v?k:null,A,H,p,r,q)}}else g=""==D?new Uint8Array(0):null,r=new f(t,m,d),new Bc(c,x,g,-1!=y?h:null,-1!=v?k:null,A,H,p,r,q)})},error:function(a){b(q,function(){a instanceof C&&(a.setEntity(h),a.setUser(k));throw a;})}}):(r=""==D?new Uint8Array(0):
null,n=new f(t,m,!1),new Bc(c,x,r,-1!=y?h:null,-1!=v?k:null,A,H,p,n,q))})}})();var Qb={EMAIL_PASSWORD:"EMAIL_PASSWORD",NETFLIXID:"NETFLIXID",SSO:"SSO",SWITCH_PROFILE:"SWITCH_PROFILE",MDX:"MDX"};Object.freeze(Qb);var Rc,Ge;(function(){Rc=K.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},getAuthData:function(){},equals:function(a){return this===a?!0:a instanceof Rc?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;
a.authdata=this.getAuthData();return a}});Ge=function(c,d,f,g){b(g,function(){var b=f.scheme,h=f.authdata;if(!b||!h)throw new R(a.JSON_PARSE_ERROR,"userauthdata "+JSON.stringify(f));if(!Qb[b])throw new xa(a.UNIDENTIFIED_USERAUTH_SCHEME,b);var k=c.getUserAuthenticationFactory(b);if(!k)throw new xa(a.USERAUTH_FACTORY_NOT_FOUND,b);k.createData(c,d,h,g)})}})();var Ne=K.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b,
c,d){},authenticate:function(a,b,c,d){}}),kd,Lf;(function(){kd=Rc.extend({init:function xd(a,b){xd.base.call(this,Qb.NETFLIXID);Object.defineProperties(this,{netflixId:{value:a,writable:!1,configurable:!1},secureNetflixId:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.netflixid=this.netflixId;this.secureNetflixId&&(a.securenetflixid=this.secureNetflixId);return a},equals:function wc(a){return this===a?!0:a instanceof kd?wc.base.call(this,a)&&this.netflixId==a.netflixId&&
this.secureNetflixId==a.secureNetflixId:!1}});Lf=function(b){var c=b.netflixid,d=b.securenetflixid;if(!c)throw new R(a.JSON_PARSE_ERROR,"NetflixId authdata "+JSON.stringify(b));return new kd(c,d)}})();var Jg=Ne.extend({init:function xd(){xd.base.call(this,Qb.NETFLIXID)},createData:function(a,c,d,f){b(f,function(){return Lf(d)})},authenticate:function(b,c,d,f){if(!(d instanceof kd))throw new P("Incorrect authentication data type "+d+".");b=d.secureNetflixId;if(!d.netflixId||!b)throw(new xa(a.NETFLIXID_COOKIES_BLANK)).setUser(d);
throw(new xa(a.UNSUPPORTED_USERAUTH_DATA,this.scheme)).setUser(d);}}),Yc,Mf;(function(){Yc=Rc.extend({init:function wc(a,b){wc.base.call(this,Qb.EMAIL_PASSWORD);Object.defineProperties(this,{email:{value:a,writable:!1,configurable:!1},password:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.email=this.email;a.password=this.password;return a},equals:function ua(a){return this===a?!0:a instanceof Yc?ua.base.call(this,this,a)&&this.email==a.email&&this.password==a.password:
!1}});Mf=function(b){var c=b.email,d=b.password;if(!c||!d)throw new R(a.JSON_PARSE_ERROR,"email/password authdata "+JSON.stringify(b));return new Yc(c,d)}})();var Kg=Ne.extend({init:function wc(){wc.base.call(this,Qb.EMAIL_PASSWORD)},createData:function(a,c,d,f){b(f,function(){return Mf(d)})},authenticate:function(b,c,d,f){if(!(d instanceof Yc))throw new P("Incorrect authentication data type "+d+".");b=d.password;if(!d.email||!b)throw(new xa(a.EMAILPASSWORD_BLANK)).setUser(d);throw(new xa(a.UNSUPPORTED_USERAUTH_DATA,
this.scheme)).setUser(d);}}),Cc,ld,he,Oe,Ld,Pe;(function(){function d(a,b){return"<"+a+">"+b+"</"+a+">"}function f(a){return a.replace(/[<>&"']/g,function(a){return n[a]})}function h(a){return encodeURIComponent(a).replace("%20","+").replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}var k=he={MSL:"MSL",NTBA:"NTBA",MSL_LEGACY:"MSL_LEGACY"},p=K.Class.create({getAction:function(){},getNonce:function(){},getPin:function(){},getSignature:function(){},getEncoding:function(){},equals:function(){}}),q=Oe=p.extend({init:function(d,
f,g,h,k,l,p){function q(h){b(p,function(){var b;try{var l={};l.useridtoken=d;l.action=f;l.nonce=g;l.pin=G(h);b=c(JSON.stringify(l),Q)}catch(q){throw new R(a.JSON_ENCODE_ERROR,"MSL-based MDX authdata",q);}k.sign(b,{result:function(a){r(b,a)},error:p.error})},n)}function r(a,c){b(p,function(){Object.defineProperties(this,{_userIdToken:{value:d,writable:!1,enumerable:!1,configurable:!1},_action:{value:f,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:g,writable:!1,enumerable:!1,configurable:!1},
_pin:{value:h,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:a,writable:!1,enumerable:!1,configurable:!1},_signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},n)}var n=this;b(p,function(){l?r(l.encoding,l.signature):k.encrypt(c(h,Q),{result:function(a){q(a)},error:p.error})},n)},getUserIdToken:function(){return this._userIdToken},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},
getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof q?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin&&this._userIdToken.equals(a._userIdToken):!1}});Oe.ACTION="userauth";var r=function(c,d,f,g,h){function k(g){b(h,function(){var k=l(f,Q),q,r,n,t;try{var m=JSON.parse(k);q=m.useridtoken;r=m.action;n=m.nonce;t=m.pin}catch(u){if(u instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+k,u);throw u;}if(!(q&&"object"===typeof q&&
r&&"string"===typeof r&&n&&"number"===typeof n&&t)||"string"!==typeof t)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+k);jd(c,q,d,{result:function(c){b(h,function(){if(!c.isDecrypted())throw new xa(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,"MDX authdata "+k);p(g,c,r,n,t)})},error:function(c){b(h,function(){if(c instanceof C)throw new xa(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+k,c);throw c;})}})})}function p(a,c,d,k,r){b(h,function(){var p=L(r);a.decrypt(p,{result:function(a){b(h,function(){var b=
l(a,Q);new q(c,d,k,b,null,{encoding:f,signature:g},h)})},error:h.error})})}b(h,function(){var l;try{var p=c.getMslStore().getCryptoContext(d);l=p?p:new nb(c,d)}catch(q){if(q instanceof Xb)throw new xa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+G(f));throw q;}l.verify(f,g,{result:function(c){b(h,function(){if(!c)throw new I(a.MDX_USERAUTH_VERIFICATION_FAILED,"MDX authdata "+G(f));k(l)})},error:h.error})})},n={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},t=Ld=p.extend({init:function(a,
b,g,h){var k=d("action",f(a)),l=d("nonce",b.toString());g=d("pin",g);k=d("registerdata",k+l+g);k=c(k,"utf-8");Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:b,writable:!1,enumerable:!1,configurable:!1},_pin:{value:null,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:k,writable:!1,enumerable:!1,configurable:!1},_signature:{value:h,writable:!1,enumerable:!1,configurable:!1}})},getAction:function(){return this._action},getNonce:function(){return this._nonce},
getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof t?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin:!1}});Ld.ACTION="regpairrequest";var m=Pe=p.extend({init:function(a,g,k,l,p,q){function r(k){b(q,function(){var b=G(k),p=d("action",f(a)),r=d("nonce",g.toString()),t=d("pin",b),p=d("registerdata",p+r+t),m=c(p,"utf-8"),b="action="+h(a)+"&nonce="+h(g.toString())+
"&pin="+h(b);l.sign(c(b,"utf-8"),{result:function(a){n(m,a)},error:q.error})},t)}function n(c,d){b(q,function(){Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:g,writable:!1,enumerable:!1,configurable:!1},_pin:{value:k,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:c,writable:!1,enumerable:!1,configurable:!1},_signature:{value:d,writable:!1,enumerable:!1,configurable:!1}});return this},t)}var t=this;b(q,function(){p?n(p.encoding,
p.signature):l.encrypt(c(k,"utf-8"),{result:function(a){r(a)},error:q.error})},t)},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof m?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin:!1}});Pe.ACTION=Ld.ACTION;var u=function(d,f,g,k,p){b(p,function(){var q=d.getMslStore().getCryptoContext(f),
r=q?q:new nb(d,f),q=l(g,"utf-8"),n=(new DOMParser).parseFromString(q,"application/xml"),q=n.getElementsByTagName("action"),t=n.getElementsByTagName("nonce"),n=n.getElementsByTagName("pin"),u=q&&1==q.length&&q[0].firstChild?q[0].firstChild.nodeValue:null,w=t&&1==t.length&&t[0].firstChild?parseInt(t[0].firstChild.nodeValue):null,x=n&&1==n.length&&n[0].firstChild?n[0].firstChild.nodeValue:null;if(!u||!w||!x)throw new R(a.XML_PARSE_ERROR,"MDX authdata "+G(g));q="action="+h(u)+"&nonce="+h(w.toString())+
"&pin="+h(x);r.verify(c(q,"utf-8"),k,{result:function(c){b(p,function(){if(!c)throw new I(a.MDX_USERAUTH_VERIFICATION_FAILED,"MDX authdata "+G(g));var d=L(x);r.decrypt(d,{result:function(a){b(p,function(){var b=l(a,"utf-8");new m(u,w,b,null,{encoding:g,signature:k},p)})},error:p.error})})},error:p.error})})};Cc=Rc.extend({init:function Bg(a,b,c,d,f,g){Bg.base.call(this,Qb.MDX);var h=null,l=null,p=null;if("string"===typeof c)a=k.MSL_LEGACY,p=c;else if(c instanceof Uint8Array)a=k.NTBA,l=c;else if(c instanceof
Cb)a=k.MSL,h=c;else throw new TypeError("Controller token "+c+" is not a master token, encrypted CTicket, or MSL token construct.");var r=c=null,n=null,t=null;if(g){var m=g.controllerAuthData;c=m.getAction();r=m.getPin();n=g.userIdToken;m instanceof q?t=m.getUserIdToken().customer:n&&(t=n.customer)}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},action:{value:c,writable:!1,configurable:!1},targetPin:{value:b,writable:!1,configurable:!1},controllerPin:{value:r,writable:!1,
configurable:!1},customer:{value:t,writable:!1,configurable:!1},_masterToken:{value:h,writable:!1,enumerable:!1,configurable:!1},_encryptedCTicket:{value:l,writable:!1,enumerable:!1,configurable:!1},_mslTokens:{value:p,writable:!1,enumerable:!1,configurable:!1},_controllerEncoding:{value:d,writable:!1,enumerable:!1,configurable:!1},_signature:{value:f,writable:!1,enumerable:!1,configurable:!1}})},getAuthData:function(){var a={};switch(this.mechanism){case k.MSL:var b=JSON.parse(JSON.stringify(this._masterToken));
a.mastertoken=b;break;case k.NTBA:b=l(this._encryptedCTicket,"utf-8");a.cticket=b;break;case k.MSL_LEGACY:a.cticket=this._mslTokens;break;default:throw new P("Unsupported MDX mechanism.");}a.pin=this.targetPin;a.mdxauthdata=G(this._controllerEncoding);a.signature=G(this._signature);return a},equals:function jb(a){return this===a?!0:a instanceof Cc?jb.base.call(this,a)&&(this._masterToken==a._masterToken||this._masterToken&&this._masterToken.equals(a._masterToken))&&(this._encryptedCTicket==a._encryptedCTicket||
this._encryptedCTicket&&g(this._encryptedCTicket,a._encryptedCTicket))&&this._mslTokens==a._mslTokens&&g(this._controllerEncoding,a._controllerEncoding)&&g(this._signature,a._signature):!1}});ld=function(c,d,f){function g(h,k,l,p){Uc(c,k,{result:function(g){b(f,function(){if(!g.isDecrypted())throw new xa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+d.toString());r(c,g,l,p,{result:function(a){b(f,function(){var b=a.getEncoding(),d=a.getSignature();return new Cc(c,h,g,b,d,{controllerAuthData:a,
userIdToken:null})})},error:f.error})})},error:function(c){b(f,function(){if(c instanceof C)throw new xa(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}function h(c,d,g,k){b(f,function(){throw new xa(a.UNSUPPORTED_USERAUTH_MECHANISM,"NtbaControllerData$parse");})}function k(g,h,p,q){function r(f,g){b(g,function(){var h;try{h=L(f)}catch(k){throw new xa(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),k);}if(!h||0==h.length)throw new xa(a.USERAUTH_MASTERTOKEN_MISSING,
"MDX authdata "+JSON.stringify(d));try{var p=JSON.parse(l(h,"utf-8"));Uc(c,p,{result:function(c){b(g,function(){if(!c.isDecrypted())throw new xa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+d.toString());return c})},error:function(c){b(g,function(){if(c instanceof C)throw new xa(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(q){if(q instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d),q);throw q;}})}function n(f,g,
h){b(h,function(){var k;try{k=L(f)}catch(p){throw new xa(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),p);}if(!k||0==k.length)throw new xa(a.USERAUTH_USERIDTOKEN_MISSING,"MDX authdata "+JSON.stringify(d));try{var q=JSON.parse(l(k,"utf-8"));jd(c,q,g,{result:function(c){b(h,function(){if(!c.isDecrypted())throw new xa(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,"MDX authdata "+JSON.stringify(d));return c})},error:function(c){b(h,function(){if(c instanceof C)throw new xa(a.USERAUTH_USERIDTOKEN_INVALID,
"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(r){if(r instanceof SyntaxError)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d),r);throw r;}})}b(f,function(){var k=h.split(",");if(3!=k.length||"1"!=k[0])throw new xa(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));r(k[1],{result:function(l){n(k[2],l,{result:function(k){u(c,l,p,q,{result:function(a){b(f,function(){return new Cc(c,g,h,p,q,{controllerAuthData:a,userIdToken:k})})},error:function(c){b(f,function(){if(c instanceof
Xb)throw new xa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+JSON.stringify(d),c);throw c;})}})},error:f.error})},error:f.error})})}b(f,function(){var b=d.pin,c=d.mdxauthdata,f=d.signature;if(!b||"string"!==typeof b||!c||"string"!==typeof c||!f||"string"!==typeof f)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));var l,p;try{l=L(c),p=L(f)}catch(q){throw new xa(a.MDX_CONTROLLERDATA_INVALID,"MDX authdata "+JSON.stringify(d),q);}if(d.mastertoken){c=d.mastertoken;if(!c||"object"!==
typeof c)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));g(b,c,l,p)}else if(d.cticket){c=d.cticket;if(!c||"string"!==typeof c)throw new R(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));-1==c.indexOf(",")?h(b,c,l,p):k(b,c,l,p)}else throw new xa(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));})}})();var Nf;(function(){var b=Oe.ACTION,c=Ld.ACTION,d=Pe.ACTION;Nf=Ne.extend({init:function Ta(){Ta.base.call(this,Qb.MDX)},createData:function(a,b,c,d){ld(a,c,
d)},authenticate:function(f,g,h,k){if(!(h instanceof Cc))throw new P("Incorrect authentication data type "+h.getClass().getName()+".");f=h.action;switch(h.mechanism){case he.MSL:if(b!=f)throw(new xa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(h);break;case he.NTBA:if(c!=f)throw(new xa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(h);break;case he.MSL_LEGACY:if(d!=f)throw(new xa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(h);}f=h.controllerPin;g=h.targetPin;if(!f||!g)throw(new xa(a.MDX_PIN_BLANK)).setUser(h);if(f!=
g)throw(new xa(a.MDX_PIN_MISMATCH)).setUser(h);f=h.customer;if(!f)throw(new xa(a.MDX_USER_UNKNOWN)).setUser(h);if(k&&(k=k.customer,!f.equals(k)))throw(new xa(a.USERIDTOKEN_USERAUTH_DATA_MISMATCH,"uad customer "+f+"; uit customer "+k)).setUser(h);return f}})})();Object.freeze({ENTITY_REAUTH:v.ENTITY_REAUTH,ENTITYDATA_REAUTH:v.ENTITYDATA_REAUTH});var Lg=K.Class.create({getTime:function(){},getRandom:function(){},isPeerToPeer:function(){},getMessageCapabilities:function(){},getEntityAuthenticationData:function(a,
b){},getMslCryptoContext:function(){},getEntityAuthenticationFactory:function(a){},getUserAuthenticationFactory:function(a){},getTokenFactory:function(){},getKeyExchangeFactory:function(a){},getKeyExchangeFactories:function(){},getMslStore:function(){}}),Rb=K.Class.create({setCryptoContext:function(a,b){},getMasterToken:function(){},getNonReplayableId:function(a){},getCryptoContext:function(a){},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){},
removeUserIdToken:function(a){},clearUserIdTokens:function(){},addServiceTokens:function(a){},getServiceTokens:function(a,b){},removeServiceTokens:function(a,b,c){},clearServiceTokens:function(){}}),Ac,Vc;(function(){var b=la;Ac=function(c,d){switch(c){case b.LZW:return T(d);case b.GZIP:return gzip$compress(d);default:throw new C(a.UNSUPPORTED_COMPRESSION,c);}};Vc=function(c,d,f){switch(c){case b.LZW:return ba(d);case b.GZIP:return gzip$uncompress(d);default:throw new C(a.UNSUPPORTED_COMPRESSION,
c.name());}}})();Rb.extend({setCryptoContext:function(a,b){},getMasterToken:function(){return null},getNonReplayableId:function(a){return 1},getCryptoContext:function(a){return null},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){return null},removeUserIdToken:function(a){},clearUserIdTokens:function(){},addServiceTokens:function(a){},getServiceTokens:function(b,c){if(c){if(!b)throw new C(a.USERIDTOKEN_MASTERTOKEN_NULL);
if(!c.isBoundTo(b))throw new C(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}return[]},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new C(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.masterTokenSerialNumber+"; mt "+c.serialNumber);},clearServiceTokens:function(){}});var Of;(function(){Of=Rb.extend({init:function ua(){ua.base.call(this);Object.defineProperties(this,{masterTokens:{value:{},writable:!1,enumerable:!1,
configurable:!1},cryptoContexts:{value:{},writable:!1,enumerable:!1,configurable:!1},userIdTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},nonReplayableIds:{value:{},writable:!1,enumerable:!1,configurable:!1},unboundServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},mtServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},uitServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1}})},setCryptoContext:function(a,b){if(b){var c=a.uniqueKey();this.masterTokens[c]=
a;this.cryptoContexts[c]=b}else this.removeCryptoContext(a)},getMasterToken:function(){var a=null,b;for(b in this.masterTokens){var c=this.masterTokens[b];if(!a||c.isNewerThan(a))a=c}return a},getNonReplayableId:function(a){a=a.serialNumber;var b;b=this.nonReplayableIds[a]!==n?this.nonReplayableIds[a]:0;if(0>b||b>V)throw new P("Non-replayable ID "+b+" is outside the valid range.");b=b==V?0:b+1;return this.nonReplayableIds[a]=b},getCryptoContext:function(a){return this.cryptoContexts[a.uniqueKey()]},
removeCryptoContext:function(a){var b=a.uniqueKey();if(this.masterTokens[b]){delete this.masterTokens[b];delete this.cryptoContexts[b];var b=a.serialNumber,c;for(c in this.masterTokens)if(this.masterTokens[c].serialNumber==b)return;delete this.nonReplayableIds[b];Object.keys(this.userIdTokens).forEach(function(b){b=this.userIdTokens[b];b.isBoundTo(a)&&this.removeUserIdToken(b)},this);try{this.removeServiceTokens(null,a,null)}catch(d){if(d instanceof C)throw new P("Unexpected exception while removing master token bound service tokens.",
d);throw d;}}},clearCryptoContexts:function(){[this.masterTokens,this.cryptoContexts,this.nonReplayableIds,this.userIdTokens,this.uitServiceTokens,this.mtServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)},addUserIdToken:function(b,c){var d=!1,f;for(f in this.masterTokens)if(c.isBoundTo(this.masterTokens[f])){d=!0;break}if(!d)throw new C(a.USERIDTOKEN_MASTERTOKEN_NOT_FOUND,"uit mtserialnumber "+c.mtSerialNumber);this.userIdTokens[b]=c},getUserIdToken:function(a){return this.userIdTokens[a]},
removeUserIdToken:function(a){var b=null,c;for(c in this.masterTokens){var d=this.masterTokens[c];if(a.isBoundTo(d)){b=d;break}}Object.keys(this.userIdTokens).forEach(function(c){if(this.userIdTokens[c].equals(a)){delete this.userIdTokens[c];try{this.removeServiceTokens(null,b,a)}catch(d){if(d instanceof C)throw new P("Unexpected exception while removing user ID token bound service tokens.",d);throw d;}}},this)},clearUserIdTokens:function(){for(var a in this.userIdTokens){var b=this.userIdTokens[a];
try{this.removeServiceTokens(null,null,b)}catch(c){if(c instanceof C)throw new P("Unexpected exception while removing user ID token bound service tokens.",c);throw c;}delete this.userIdTokens[a]}},addServiceTokens:function(b){b.forEach(function(b){if(b.isUnbound())this.unboundServiceTokens[b.uniqueKey()]=b;else{if(b.isMasterTokenBound()){var c=!1,d;for(d in this.masterTokens)if(b.isBoundTo(this.masterTokens[d])){c=!0;break}if(!c)throw new C(a.SERVICETOKEN_MASTERTOKEN_NOT_FOUND,"st mtserialnumber "+
b.mtSerialNumber);}if(b.isUserIdTokenBound()){var c=!1,f;for(f in this.userIdTokens)if(b.isBoundTo(this.userIdTokens[f])){c=!0;break}if(!c)throw new C(a.SERVICETOKEN_USERIDTOKEN_NOT_FOUND,"st uitserialnumber "+b.uitSerialNumber);}b.isMasterTokenBound()&&((f=this.mtServiceTokens[b.mtSerialNumber])||(f={}),f[b.uniqueKey()]=b,this.mtServiceTokens[b.mtSerialNumber]=f);b.isUserIdTokenBound()&&((f=this.uitServiceTokens[b.uitSerialNumber])||(f={}),f[b.uniqueKey()]=b,this.uitServiceTokens[b.uitSerialNumber]=
f)}},this)},getServiceTokens:function(b,c){if(c){if(!b)throw new C(a.USERIDTOKEN_MASTERTOKEN_NULL);if(!c.isBoundTo(b))throw new C(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}var d={},f;for(f in this.unboundServiceTokens){var g=this.unboundServiceTokens[f];d[g.uniqueKey()]=g}if(b&&(g=this.mtServiceTokens[b.serialNumber]))for(f in g){var h=g[f];h.isUserIdTokenBound()||(d[f]=h)}if(c&&(g=this.uitServiceTokens[c.serialNumber]))for(f in g)h=g[f],h.isBoundTo(b)&&
(d[f]=h);g=[];for(f in d)g.push(d[f]);return g},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new C(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.mtSerialNumber+"; mt "+c.serialNumber);if(b&&!c&&!d){Object.keys(this.unboundServiceTokens).forEach(function(a){this.unboundServiceTokens[a].name==b&&delete this.unboundServiceTokens[a]},this);for(var f in this.mtServiceTokens){var g=this.mtServiceTokens[f],h=Object.keys(g);h.forEach(function(a){g[a].name==b&&delete g[a]},
this);this.mtServiceTokens[f]=g}for(var k in this.uitServiceTokens)g=this.uitServiceTokens[k],f=Object.keys(g),f.forEach(function(a){g[a].name==b&&delete g[a]},this),this.uitServiceTokens[k]=g}if(c&&!d){if(g=this.mtServiceTokens[c.serialNumber])h=Object.keys(g),h.forEach(function(a){var c=g[a];b&&c.name!=b||delete g[a]},this),this.mtServiceTokens[c.serialNumber]=g;for(k in this.uitServiceTokens){var l=this.uitServiceTokens[k];f=Object.keys(l);f.forEach(function(a){var d=l[a];b&&d.name!=b||d.isBoundTo(c)&&
delete l[a]},this);this.uitServiceTokens[k]=l}}d&&(g=this.uitServiceTokens[d.serialNumber])&&(f=Object.keys(g),f.forEach(function(a){var d=g[a];b&&d.name!=b||c&&!d.isBoundTo(c)||delete g[a]},this),this.uitServiceTokens[d.serialNumber]=g)},clearServiceTokens:function(){[this.unboundServiceTokens,this.mtServiceTokens,this.uitServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)}})})();var zg=ha.extend({init:function ua(){ua.base.call(this);Object.defineProperties(this,{_contextMap:{value:{},
writable:!1,enumerable:!1,configurable:!1}})},addCryptoContext:function(a,b){if(b&&a&&a.length){var c=G(a);this._contextMap[c]=b}},getCryptoContext:function(a){return a&&a.length?(a=G(a),this._contextMap[a]||null):null},removeCryptoContext:function(a){a&&a.length&&(a=G(a),delete this._contextMap[a])}}),md=Cg.extend({init:function $a(a,b,c,d){$a.base.call(this,a);Object.defineProperties(this,{_kde:{value:b,writable:!1,enumerable:!1,configurable:!1},_kdh:{value:c,writable:!1,enumerable:!1,configurable:!1},
_kdw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof Zb))throw new P("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new Fb(a.ENTITY_NOT_FOUND,"mgk "+c.identity);return new Nb(b,this.localIdentity,this._kde,this._kdh,this._kdw)}}),Pf=we.extend({init:function Ga(a,b,c,d){Ga.base.call(this,a);Object.defineProperties(this,{_kpe:{value:b,writable:!1,enumerable:!1,configurable:!1},_kph:{value:c,
writable:!1,enumerable:!1,configurable:!1},_kpw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof $b))throw new P("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new Fb(a.ENTITY_NOT_FOUND,"psk "+c.identity);return new Nb(b,this.localIdentity,this._kpe,this._kph,this._kpw)}}),Qf=Of.extend({init:function Ta(a,b,c,d,f,g){Ta.base.call(this);this._log=a;this._esn=b;this._keyRequestData=c;this._createKeyRequestData=
d;this._systemKeyName=f;this._systemKeyWrapFormat=g},setCryptoContext:function Pc(a,b,c){var d=this;d._log.trace("Adding MasterToken",{SequenceNumber:a.sequenceNumber,SerialNumber:a.serialNumber,Expiration:a.expiration.getTime()});Pc.base.call(this,a,b);!c&&(a=d._createKeyRequestData)&&(d._log.trace("Generating new keyx request data"),a().then(function(a){d._keyRequestData=a},function(a){d._log.error("Unable to generate new keyx request data",""+a)}))},addUserIdToken:function qb(a,b){this._log.trace("Adding UserIdToken",
{UserId:a,SerialNumber:b.serialNumber,MTSerialNumber:b.mtSerialNumber,Expiration:b.expiration.getTime()});qb.base.call(this,a,b)},addServiceTokens:function Ua(a){Ua.base.call(this,a.filter(function(a){return!hf[a.name]}))},getKeyRequestData:function(){return this._keyRequestData},getStoreState:function(a){var c=this;b(a,function(){var d=c.getMasterToken();d?c.getKeysForStore(d,{result:function(f){b(a,function(){var a=c.userIdTokens,b=Object.keys(a).map(function(b){var f=a[b];return{userId:b,userIdTokenJSON:a[b].toJSON(),
serviceTokenJSONList:c.getServiceTokens(d,f).map(q)}});f.esn=c._esn;f.masterTokenJSON=d.toJSON();f.userList=b;var g=c._keyRequestData.storeData;g&&Object.keys(g).forEach(function(a){f[a]=g[a]});return f})},timeout:a.timeout,error:a.error}):a.result(null)})},getKeysForStore:function(c,d){var f=this;b(d,function(){var b=f.getCryptoContext(c),b={encryptionKey:b.encryptionKey,hmacKey:b.hmacKey};if(b.encryptionKey&&b.hmacKey)if(f._systemKeyWrapFormat)f.wrapKeysWithSystemKey(b,d);else return b;else throw new C(a.INTERNAL_EXCEPTION,
"Unable to get CryptoContext keys");})},wrapKeysWithSystemKey:function(c,d){var f=this;p(this._systemKeyName,{result:function(g){b(d,function(){var b=c.encryptionKey,h=c.hmacKey,k=b[Zc],l=h[Zc];if(k&&l)return{wrappedEncryptionKey:k,wrappedHmacKey:l};Promise.resolve().then(function(){return Promise.all([wa.wrapKey(f._systemKeyWrapFormat,b,g,g.algorithm),wa.wrapKey(f._systemKeyWrapFormat,h,g,g.algorithm)])}).then(function(a){k=G(a[0]);b[Zc]=k;l=G(a[1]);h[Zc]=l;d.result({wrappedEncryptionKey:k,wrappedHmacKey:l})}).catch(function(b){d.error(new C(a.INTERNAL_EXCEPTION,
"Error wrapping key with SYSTEM key",b))})})},timeout:d.timeout,error:d.error})},unwrapKeysWithSystemKey:function(c,d){var f=this;p(this._systemKeyName,{result:function(g){b(d,function(){var b=L(c.wrappedEncryptionKey),h=L(c.wrappedHmacKey);Promise.resolve().then(function(){return Promise.all([wa.unwrapKey(f._systemKeyWrapFormat,b,g,g.algorithm,Yb,!1,cb),wa.unwrapKey(f._systemKeyWrapFormat,h,g,g.algorithm,rb,!1,X)])}).then(function(a){var b=a[0];a=a[1];b[Zc]=c.wrappedEncryptionKey;a[Zc]=c.wrappedHmacKey;
d.result({encryptionKey:b,hmacKey:a})}).catch(function(b){d.error(new C(a.INTERNAL_EXCEPTION,"Error unwrapping with SYSTEM key",b))})})},timeout:d.timeout,error:d.error})},loadStoreState:function(a,b,c,d){function f(d){function g(){if(!p&&q&&r&&n){p=!0;var c=new nb(b,q,a.esn,{rawKey:r},{rawKey:n});k.setCryptoContext(q,c,!0);d.result(q)}}function h(a,b){l.error(a,b&&""+b);p||(p=!0,d.error())}var p,q,r,n;c.masterTokenJSON?(Uc(b,c.masterTokenJSON,{result:function(a){q=a;g()},timeout:function(){h("Timeout parsing MasterToken")},
error:function(a){h("Error parsing MasterToken",a)}}),k._systemKeyWrapFormat?k.unwrapKeysWithSystemKey(c,{result:function(a){r=a.encryptionKey;n=a.hmacKey;g()},timeout:function(){h("Timeout unwrapping keys")},error:function(a){h("Error unwrapping keys",a)}}):Promise.resolve().then(function(){return wa.encrypt({name:Yb.name,iv:new Uint8Array(16)},c.encryptionKey,new Uint8Array(1))}).then(function(a){r=c.encryptionKey}).catch(function(a){h("Error loading encryptionKey")}).then(function(){return wa.sign(rb,
c.hmacKey,new Uint8Array(1))}).then(function(a){n=c.hmacKey;g()}).catch(function(a){h("Error loading hmacKey")})):h("Persisted store is corrupt")}function g(a,d){var f;try{f=c.userList.slice()}catch(l){}f?function hd(){var c=f.shift();c?jd(b,c.userIdTokenJSON,a,{result:function(b){try{k.addUserIdToken(c.userId,b),h(a,b,c.serviceTokenJSONList,{result:hd,timeout:hd,error:hd})}catch(d){hd()}},timeout:hd,error:hd}):d.result()}():d.result()}function h(a,c,d,f){var g;try{g=d.slice()}catch(l){}if(g){var p=
k.getCryptoContext(a);(function Ae(){var d=g.shift();d?de(b,d,a,c,p,{result:function(a){k.addServiceTokens([a]);Ae()},timeout:function(){Ae()},error:function(){Ae()}}):f.result()})()}else f.result()}var k=this,l=k._log;c.esn!=k._esn?(l.error("ESN mismatch, starting fresh"),d.error()):f({result:function(a){g(a,d)},timeout:d.timeout,error:d.error})}}),hf={"streaming.servicetokens.movie":!0,"streaming.servicetokens.license":!0},Zc="$netflix$msl$wrapsys",Kc,Rf=Lg.extend({init:function(a,b,c,d,f,g){var h=
new Gd([la.LZW]),k=new Eg;k.addPublicKey(b,c);d[za.RSA]=new Dg(k);b={};b[Qb.EMAIL_PASSWORD]=new Kg;b[Qb.NETFLIXID]=new Jg;b[Qb.MDX]=new Nf;a={_mslCryptoContext:{value:new ue,writable:!0,enumerable:!1,configurable:!1},_capabilities:{value:h,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:f,writable:!0,enumerable:!1,configurable:!1},_entityAuthFactories:{value:d,writable:!1,enumerable:!1,configurable:!1},_userAuthFactories:{value:b,writable:!1,enumerable:!1,configurable:!1},_keyExchangeFactories:{value:g,
writable:!1,enumerable:!1,configurable:!1},_store:{value:a,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},getTime:function(){return Date.now()},getRandom:function(){return new db},isPeerToPeer:function(){return!1},getMessageCapabilities:function(){return this._capabilities},getEntityAuthenticationData:function(a,b){b.result(this._entityAuthData)},getMslCryptoContext:function(){return this._mslCryptoContext},getEntityAuthenticationFactory:function(a){return this._entityAuthFactories[a]},
getUserAuthenticationFactory:function(a){return this._userAuthFactories[a]},getTokenFactory:function(){return null},getKeyExchangeFactory:function(a){return this._keyExchangeFactories.filter(function(b){return b.scheme==a})[0]},getKeyExchangeFactories:function(){return this._keyExchangeFactories},getMslStore:function(){return this._store}}),qe=Me.extend({init:function(a,b,c,d){this._log=a;this._mslContext=b;this._mslRequest=c;this._keyRequestData=d},getCryptoContexts:function(){return{}},isEncrypted:function(){return!!this._mslRequest.encrypted},
isNonReplayable:function(){return!!this._mslRequest.nonReplayable},isRequestingTokens:function(){return!0},getUserId:function(){return this._mslRequest.userId||null},getUserAuthData:function(a,c,d,f){var g=this._mslRequest,h=this._mslContext;b(f,function(){if(a)return null;if(g.email)return new Yc(g.email,g.password);if(g.netflixId)return new kd(g.netflixId,g.secureNetflixId);if(g.mdxControllerToken){var b=(new Ld("regpairrequest",g.mdxNonce,g.mdxEncryptedPinB64,g.mdxSignature)).getEncoding();return new Cc(h,
g.mdxPin,g.mdxControllerToken,b,g.mdxSignature)}if(d&&g.getIdCookies){var c=g.getIdCookies(),b=c.netflixId,c=c.secureNetflixId;if(b)return new kd(b,c)}return null})},getCustomer:function(){return null},getKeyRequestData:function(a){a.result(this._mslRequest.allowTokenRefresh?[this._keyRequestData]:[])},updateServiceTokens:function(a,b,c){var d=this._log,f=(this._mslRequest.serviceTokens||[]).slice(),g=this._mslContext;b=g.getMslStore();var h=a.builder.getMasterToken(),k=this.getUserId(),l=b.getUserIdToken(k);
(function Oc(){var b=f.shift();if(b)try{b instanceof Bc?(a.addPrimaryServiceToken(b),Oc()):de(g,b,h,l,null,{result:function(b){try{a.addPrimaryServiceToken(b)}catch(c){d.warn("Exception adding service token",""+c)}Oc()},timeout:function(){d.warn("Timeout parsing service token");Oc()},error:function(a){d.warn("Error parsing service token",""+a);Oc()}})}catch(k){d.warn("Exception processing service token",""+k),Oc()}else c.result(!0)})()},write:function(a,b,d){var f=c(this._mslRequest.body);a.write(f,
0,f.length,b,{result:function(c){c!=f.length?d.error(new Ia("Not all data was written to output.")):a.flush(b,{result:function(){d.result(!0)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})},timeout:function(){d.timeout()},error:function(a){d.error(a)}})},getDebugContext:function(){this._dc||(this._dc=new Mg(this._log,this._mslRequest));return this._dc}}),Mg=Kd.extend({init:function(a,b){this._log=a;this._mslRequest=b},sentHeader:function(a){this._log.trace("Sent MSL header",x(this._mslRequest,
a),a.serviceTokens&&a.serviceTokens.map(A).join("\n"))},receivedHeader:function(a){var b=x(this._mslRequest,a),c=a.errorCode;c?this._log.warn("Received MSL error header",b,{errorCode:c,errorMessage:a.errorMessage,internalCode:a.internalCode}):this._log.trace("Received MSL header",b)}}),Sf={PSK:function(a){return D(a,za.PSK,Pf,$b,Be,ub)},MGK:function(a){return D(a,za.MGK,md,Zb,Be,ub)},MGK_WITH_FALLBACK:function(b){var c;switch(b.esnPrefix){case "GOOGEUR001":case "GOOGLEXX01":c="PSK";break;default:c=
"MGK"}var d=Sf[c];if(!d)throw new C(a.INTERNAL_EXCEPTION,"Invalid fallback authenticationType: "+c);return d(b)},MGK_JWE:function(a){return D(a,za.MGK,md,Zb,rf,ze)},JWK_RSA:function(a){return B(a,{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},Fd.JWK_RSA)},JWK_RSAES:function(a){return B(a,{name:"RSAES-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},Fd.JWK_RSAES)},JWEJS_RSA:function(a){return B(a,{name:"RSA-OAEP",modulusLength:2048,
publicExponent:new Uint8Array([1,0,1])},Fd.JWEJS_RSA)}};r.netflix=r.netflix||{};r.netflix.msl={createMslClient:function(b,c){var d=b.log,f,g,h,k=b.notifyMilestone||function(){};Promise.resolve().then(function(){if(!(E&&E.generateKey&&E.importKey&&E.unwrapKey))throw new C(a.INTERNAL_EXCEPTION,"No WebCrypto");ya=E.generateKey({name:"AES-CBC",length:128},!0,cb).then?Ea.V2014_02:Ea.LEGACY;k("mslisik");return wa.importKey("spki",b.serverIdentityKeyData,bb,!1,["verify"])}).then(function(b){return new Promise(function(c,
d){yc(b,{result:c,error:function(){d(new C(a.KEY_IMPORT_ERROR,"Unable to create server identity verification key"))}})})}).then(function(c){f=c;if(c=Sf[b.authenticationType])return k("mslcc"),c(b);throw new C(a.INTERNAL_EXCEPTION,"Invalid authenticationType: "+b.authenticationType);}).then(function(a){g=new Qf(d,b.esn,a.keyRequestData,a.createKeyRequestData,b.authenticationKeyNames.s,b.systemKeyWrapFormat);h=new Rf(g,b.serverIdentityId,f,a.entityAuthFactories,a.entityAuthData,a.keyExchangeFactories);
var c=b.storeState;if(c)return k("mslss"),d.info("Loading store state"),new Promise(function(a,d){g.loadStoreState(b,h,c,{result:a,timeout:a,error:a})});d.info("No store state, starting fresh")}).then(function(){var a=new Jf;k("msldone");c.result(new F(d,a,h,g))}).catch(function(a){c.error(a)})},IHttpLocation:Gg,MslIoException:Ia}})(window);
(function(){(function n(m,l,c){function d(g,k){if(!l[g]){if(!m[g]){var u="function"==typeof require?require:void 0;if(!k&&u)return u(g,!0);if(f)return f(g,!0);u=Error("Cannot find module '"+g+"'");throw u.code="MODULE_NOT_FOUND",u;}u=l[g]={Ta:{}};m[g][0].call(u.Ta,function(b){var c=m[g][1][b];return d(c?c:b)},u,u.Ta,n,m,l,c)}return l[g].Ta}for(var f="function"==typeof require?require:void 0,g=0;g<c.length;g++)d(c[g]);return d})({1:[function(n){(function(m,l){function c(a){a=w(a)?$c(a):a;return Xh.qg(a)}
function d(){return!0}function f(){}function g(){}function t(a){return null!==a&&a!==l}function k(a){return"object"==typeof a}function u(a){return a&&a.constructor==Na}function b(a,b,c){return"number"==typeof a&&!isNaN(a)&&isFinite(a)&&(b===l||a>=b)&&(c===l||a<=c)}function h(a,c,d){return b(a,c,d)&&0==a%1}function a(a){return a&&Ng.test(a)}function w(a){return"string"==typeof a}function y(a){return w(a)&&a}function q(a){return"function"==typeof a}function p(a,b){for(var c in a)a.hasOwnProperty(c)&&
b(c,a[c])}function x(a,b,c){if(b)if(c){var d=c.$g,f=c.prefix,g=c.Ye;p(b,function(b,c){if(!g||t(c))a[(f||"")+(d?b.toLowerCase():b)]=c})}else p(b,function(b,c){a[b]=c});return a}function A(a,b,c,d){if(a){var f=a[b];q(f)&&(c=f.apply(a,Og.call(arguments,3)))}}function F(a){var b={};p(a,function(a,c){b[a]=c});return b}function D(a){for(var b=0,c=arguments.length;b<c;){var d=arguments[b++];if(t(d))return d}}function B(a){for(var b,c=!0,d;c;)for(c=!1,b=a.length;--b;)d=a[b],d.startTime<a[b-1].startTime&&
(a[b]=a[b-1],a[b-1]=d,c=!0)}function H(a){for(var b={},c=a.length;c--;)b[a[c]]=!0;return b}function E(a){return sc(a,10)}function J(a,b){return Ya(a+Qe()*(b-a))}function G(a){if(a){var b=a.stack,c=a.number;a=""+a;b?(b=""+b,0!=b.indexOf(a)&&(b=a+"\n"+b)):b=a;c&&(b+="\nnumber:"+c);return b}}function L(a){return b(a)?a.toFixed(0):""}function N(a){return b(a)?(a/1E3).toFixed(0):""}function T(a){return b(a)?a.toFixed():""}function ba(a,b){try{var c=Gb.plugins,d=c.length,f;for(f=0;f<d;f++)if(b.test(c[f][a]))return c[f];
return!1}catch(g){}}function Q(){var a=ba("filename",/widevinecdm/i);if(a){try{var b=a.description.match(/version: ([0-9.]+)/);if(b&&b[1])return b[1]}catch(c){}return"true"}return"false"}function V(){try{var a=vb.defineProperty({},"videoCapabilities",{value:[{contentType:'video/mp4; codecs="avc1.640028"'}]});Gb.requestMediaKeySystemAccess("com.widevine.alpha",[a]).then(function(){Dc.cpth264wv=!0}).catch(function(){Dc.cpth264wv=!1})}catch(b){}}function la(a,b){if(a===b)return!0;if(!a||!b)return!1;
for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]))return!1;return!0}function Qa(a,b){if(a.length==b.length){for(var c=a.length;c--;)if(a[c]!=b[c])return!1;return!0}return!1}function sa(a){if(a){var b=a.length;if(b)return b=J(0,b-1),a[b]}}function oa(a,b){function c(){a.removeEventListener("loadedmetadata",c);b.apply(this,arguments)}a.addEventListener("loadedmetadata",c)}function Aa(){var a=eb.cookie.split("; "),b=a.length,c,d,f,g={};for(c=0;c<b;c++)if(d=Yh(a[c]))f=d.indexOf("="),
0<f&&(g[d.substr(0,f)]=d.substr(f+1));return g}function da(){var a,b;if(a=da.ln)return a;a=He.search.substr(1);b=a.indexOf("#");0<=b&&(a=a.substr(0,b));a=v(a);return da.ln=a}function v(a){for(var b=/[+]/g,c=(a||"").split("&"),d={},f,g=0;g<c.length;g++)a=Yh(c[g]),f=a.indexOf("="),0<=f?d[Zh(a.substr(0,f).replace(b,"%20")).toLowerCase()]=Zh(a.substr(f+1).replace(b,"%20")):d[a.toLowerCase()]=null;return d}function K(a){var b="";p(a,function(a,c){b&&(b+="&");b+=Md(a)+"="+Md(c)});return b}function Y(a,
b,c,d){var f=eb.createElement(a);b&&(f.style.cssText=b);c&&(f.innerHTML=c);d&&p(d,function(a,b){f.setAttribute(a,b)});return f}function db(a){var b="";p(a,function(a,c){b+=(b?";":"")+a+":"+c});return b}function Ma(a,b){var c=a[0];if(b<=c[0])return c.slice(1);for(var d=1,f;f=a[d++];){if(b<=f[0]){var d=(b-c[0])/(f[0]-c[0]),g=[];qa(c.length,f.length);for(var h=1;h<c.length;h++)g.push((c[h]||0)+d*((f[h]||0)-(c[h]||0)));return g}c=f}return c.slice(1)}function C(a){return Nj.call(a,function(a,b){return a-
b})}function I(a){for(var b=0,c=a.length;c--;)b+=a[c];return b}function R(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=l;for(;++c<d;)null!=(g=a[c])&&g>f&&(f=g)}else{for(;++c<d&&!(null!=(f=b.call(a,a[c],c))&&f<=f);)f=l;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&g>f&&(f=g)}return f}function Fb(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=l;for(;++c<d;)null!=(g=a[c])&&f>g&&(f=g)}else{for(;++c<d&&!(null!=(f=b.call(a,
a[c],c))&&f<=f);)f=l;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&f>g&&(f=g)}return f}function Ha(a){return q(a.then)?a:new Nd(function(b,c){a.oncomplete=function(){b(a.result)};a.onerror=function(){c(a.error)}})}function Ia(a,c){function d(a){0>f.indexOf(a)&&b(a)&&f.push(a)}a=a.slice();C(a);var f=[];if(!c||!c.length)return a;if(!a.length)return[];var g=c.length,h,k;try{for(;g--;){var l=""+c[g],p=E(l);switch(l[l.length-1]){case "-":for(h=a.length;h--;)if(k=a[h],k<p){d(k);break}break;case "+":for(h=0;h<
a.length;h++)if(k=a[h],k>p){d(k);break}break;default:0<=a.indexOf(p)&&d(p)}}}catch(q){}f.length||f.push(a[0]);C(f);return f}function P(a,b,c){var d;a/b>c?(d=Ya(b*c),a=b):(d=a,a=Ya(a/c));return{width:d,height:a}}function Ja(a,b){var c=a.length,d=(c-1)*b+1;if(1===d)return a[0];if(d==c)return a[c-1];c=ja(d);return a[c-1]+(d-c)*(a[c]-a[c-1])}function pa(a){try{return v(Pg(a)).bt}catch(b){}}function Xb(a,b){b=ad.isArray(b)?b:[b];for(var c=a.length,d=0;d<c;d++)for(var f=0;f<b.length;f++)if(a[d].type==b[f])return a[d];
throw new La("Box not found "+b);}function ia(a){return a.rb("trak/mdia/minf/stbl/stsd/enca|encv").children.filter(function(a){return"sinf"==a.type&&"cenc"==a.xg.schm.as})[0].rb("schi/tenc").Uj}function xa(a){function b(a,d){var f=c[a];c[a]=c[d];c[d]=f}var c=new Na(a);b(0,3);b(1,2);b(4,5);b(6,7);return c}function wa(){var a=new ArrayBuffer(4),b=new Na(a),a=new Uint32Array(a);b[0]=161;b[1]=178;b[2]=195;b[3]=212;return 3569595041==a[0]?"LE":2712847316==a[0]?"BE":"undefined"}function ya(a,b,c){return a>=
b?a<=c?a:c:b}function Ea(a){if(b(a))return(a/1E3).toFixed(3)}function Mb(a,b){var c=Og.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,b){return"undefined"!=typeof c[b]?c[b]:a})}function Yb(a){for(var b=a.length,c=new Uint16Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function rb(a){function b(){if(g)for(var a;a=d.pop();)a(h)}function c(a){g=!0;h=a;b()}var d=[],f,g,h;return function(g){d.push(g);f||(f=!0,a(c));b()}}function Z(a){return m.setTimeout(a,0)}function Ka(a,b){return m.setTimeout(a,
b)}function bb(a){m.clearTimeout(a)}function cb(a,b){return m.setInterval(a,b)}function gb(a){m.clearInterval(a)}function X(){var a=Re()-bd;if(a<Qg){var b=Qg+1,c=b-a;Z(function(){na.warn("Clock roll-back detected, adjusting time",{Delta:""+-c})});bd-=c;a=b}return Qg=a}function sb(){return ja(Re()/1E3)}function xc(){}function kb(a){function b(d){h=null;c(d||a)}function c(a){var d=X();if(g){var U=a-(d-f);0>=U?(a=g,g=null,f=d,a()):h=h||Ka(b.bind(this,a),U)}}var d=this,f=-a,g,h;this.zh=function(b){a=
b};this.lb=function(a){g=a;h=h||Z(b)};this.$r=function(a){d.Ec();Z(a)};this.Ec=function(){h&&bb(h)}}function Td(a){var b=0,c;this.get=function(){var d=X();if(!c||1E3<d-b)b=d,c=a();return c};this.clear=function(){c=l}}function yc(a){this.Ha={index:a.index,qa:a.qa,Tc:a.Tc,ma:a.ma,Uc:a.Uc,Ub:Yc.prototype.Ub};this.r=function(a){this.Oi=a};this.r.prototype=this}function pc(a){var b=a.length,c,d=1;if(b>d){c=se(a[d]);if(b==d+1)return c;for(var f={};d<b;)x(f,c),c=se(a[++d]);return f}}function se(a){return a&&
k(a)?a.Ga?a.Ga:q(a.Ee)?a.Ee():Oj.test(a.name)?{Exception:a.message||""+a,StackTrace:a.stack||"nostack"}:a:t(a)?{Details:""+a}:{}}function Nc(a,b,c){var d=a.fields||{},f=""+a.message;p(d,function(a,b){Pj.hasOwnProperty(a)||(f+=", "+a+": "+b)});f=f.replace(Qj," ");a=(a.time/1E3).toFixed(3)+"|"+(a.Ha&&a.Ha.index||0)+"|"+(Rj[a.level]||a.level)+"|"+a.category+"| "+f;d.Exception&&(a+="\r\n"+d.Exception);b&&d.StackTrace&&(a+="\r\n"+d.StackTrace);c&&d.Details&&(a+="\r\n"+d.Details);return a}function lb(){var a=
{},b="$es$"+Sj++;x(this,{addListener:function(c,d,f){var g="$netflix$player$order"+b+"$"+c;if(a){var h=a[c]?a[c].slice():[];f&&(d[g]=f);0>h.indexOf(d)&&(h.push(d),h.sort(function(a,b){return(a[g]||0)-(b[g]||0)}));a[c]=h}},removeListener:function(b,c){if(a&&a[b]){for(var d=a[b].slice(),f;0<=(f=d.indexOf(c));)d.splice(f,1);a[b]=d}},Nv:function(b){return a&&!!(a[b]||(a[b]=[])).length},B:function(b,c,d){if(a)for(var f=a[b]||(a[b]=[]),g=0;g<f.length;g++)if(d)(function(){var a=f[g];Z(function(){a(c)})})();
else f[g](c)},Ch:function(b,c){if(a){var d=a[b]||(a[b]=[]);c=c||{};for(var f=0;f<d.length&&!c.Ej;f++)d[f](c)}},Ec:function(){a=l}})}function te(){function a(f){var U=c.indexOf(f);0<=U?c.splice(U,1):f==d&&(d=l);Z(b)}function b(){for(var h=0,k,l;!d&&(k=f[h]);){if(0>=c.length||!k.Tj)f.splice(h,1),l=g++,k.Tj?d=l:c.push(l),k.Tn({c:!0,iw:l,hf:function(){a(l)}});h++}}var c=[],d,f=[],g=1;x(this,{rn:function(a,c){f.push({Tj:a,Tn:c});b()},hf:a})}function Fa(a,b){function c(a,b){return(a["$netflix$player$order"+
g]||0)-(b["$netflix$player$order"+g]||0)}var d=this,f=b?[b]:[],g="$op$"+Tj++;x(d,{value:a,addListener:function(a,b){f.indexOf(a);a["$netflix$player$order"+g]=b;f=f.slice();f.push(a);f.sort(c)},removeListener:function(a){f=f.slice();var b;0<=(b=f.indexOf(a))&&f.splice(b,1)},set:function(a,b){if(d.value!==a){var c={oldValue:d.value,newValue:a};b&&x(c,b);d.value=a;for(var U=f,g=U.length,h=0;h<g;h++)U[h](c)}}})}function Ud(){}function tb(a,b){var c;x(this,{jc:function(){c||(c=Ka(b,a))},wb:function(){c&&
(bb(c),c=l)}})}function Vd(a){var b,c="";for(b=8;b--;)c=(Uj[a&15]||"0")+c,a>>>=4;return c}function mb(a,b,c){this.errorCode=a||O.cc;b&&k(b)?(this.g=b.g,this.P=b.P,this.C=b.C,this.qe=b.Yo,this.Ic=b.Ic,this.sg=b.sg,this.Jc=b.Jc,this.td=b.td,this.Ca=b.Ca,this.We=b.method):(this.g=b,this.P=c);a=this.stack=[this.errorCode];this.g?a.push(this.g):this.P&&a.push(M.cc);this.P&&a.push(this.P);this.qd=Tf+a.join("-")}function Wd(a){return 1100<=a&&1199>=a}function id(a){return 1300<=a&&1399>=a}function qc(a){return 1900<=
a&&1999>=a}function fc(a,b){E(a);return 1<=a&&9>=a?b+a:b}function Sc(a){return fc(a,M.Ol)}function Tc(a){return fc(a,M.ll)}function Va(a){var b={};b.ErrorSubCode=a.g||M.cc;a.P&&(b.ErrorExternalCode=a.P);a.C&&(b.ErrorDetails=a.C);return b}function Nb(a){ai[a]=X()}function nb(a){if(w(a)&&Vj.test(a)){var b=a.split(".");if(4===b.length){for(var c=0;c<b.length;c++){var d=E(b[c]);if(0>d||!h(d,0,255)||1!==b[c].length&&0===b[c].indexOf("0"))return}return a}}}function ue(a){var b=0;if(nb(a)===a)return a=a.split("."),
b+=E(a[0])<<24,b+=E(a[1])<<16,b+=E(a[2])<<8,b+E(a[3])}function za(a){if(w(a)&&a.match(Wj)){var b=a.split(":");if(-1!==b[b.length-1].indexOf(".")){a=ue(b[b.length-1])>>>0;var c=[];c.push((a>>>16&65535).toString(16));c.push((a&65535).toString(16));b.pop();b.push(c[0]);b.push(c[1]);a=b.join(":")}a=a.split("::");if(!(2<a.length||1===a.length&&8!==b.length)){if(1<a.length)if(b=a[0].split(":"),a=a[1].split(":"),1===b.length&&""===b[0]&&(b=[]),1===a.length&&""===a[0]&&(a=[]),c=8-(b.length+a.length),1>c)b=
[];else{var d;for(d=0;d<c;d++)b.push("0");for(d=0;d<a.length;d++)b.push(a[d])}a=b.length;if(8===a){for(;a--;)if(c=sc(b[a],16),!h(c,0,65535))return;return b.join(":")}}}}function Qc(a,b,c){var d=nb(a),f=za(a),g=nb(b),h=za(b);if(!d&&!f||!g&&!h||d&&!g||f&&!h)return!1;if(a===d)return c=-1<<32-c,(ue(a)&c)!==(ue(b)&c)?!1:!0;if(a===f){a=a.split(":");b=b.split(":");for(d=ja(c/16);d--;)if(a[d]!==b[d])return!1;c%=16;if(0!==c)for(a=sc(a[d],16).toString(2),b=sc(b[d],16).toString(2),a="0000000000000000".substring(0,
16-a.length)+a,b="0000000000000000".substring(0,16-b.length)+b,d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}return!1}function Xd(a,b){var c;this.Bh=function(){c||(c=cb(b,a))};this.pd=function(){c&&(gb(c),c=l)}}function Cd(a,b,c,d,f){zd(a,function(a){a.c?Xj(a.object,b,c,d,function(a){a.c?f({c:!0,entries:a.entries}):f(a)}):f(a)})}function Zb(){function a(c){var g=d.Gg();if(f!=g){var U,l;g<n&&(l=k||q[ja(g*t)]||q[0]);if(l){for(;l&&l.endTime<g;)l=l.next;for(;l&&l.previous&&l.previous.endTime>=g;)l=l.previous}l&&
(l.startTime<=g&&g<=l.endTime?(U=l,b(l.endTime-g)):b(l.startTime-g));k=l;f=g;h!=U&&(h=U,!c&&d.ih&&d.ih())}}function b(a){p&&(bb(p),p=l);g&&0<a&&(p=Ka(c,a+Yj))}function c(){p=l;a()}var d=this,f,g,h,k,p,q,n,t;x(d,{Hk:function(b){var c=b&&b.length;k=h=f=l;q=b;n=c&&qa.apply(null,b.map(function(a){return a.endTime}));t=c&&c/n;a()},Gg:l,start:function(){g=!0;a()},stop:function(){g=!1;p&&(bb(p),p=l)},fp:function(){a(!0);return h},ih:l})}function ve(a,b,c,d,f){var g="";a.textNodes.forEach(function(a){var U=
g,h=a.style,k=bi(a.text);for(a=a.lineBreaks;a--;)k="<br />"+k;var p=h.characterStyle;a=d[p];var q;0<=p.indexOf("MONOSPACE")?(p=h.cellResolution,q=a&&p&&(40===p.x&&19===p.y?q=4/3/(40/19):52===p.x&&19===p.y&&(q=16/9/(52/19)),q)?a.width/a.fontSize/q:void 0,q=q||a.lineHeight):q=a.lineHeight;q=h.characterSize*b.height/(q||1);q=0<f?ja(q*f):Ya(q);q={"font-size":q+"px","line-height":"normal","font-weight":"normal"};h.characterItalic&&(q["font-style"]="italic");h.characterUnderline&&(q["text-decoration"]=
"underline");h.characterColor&&(q.color=h.characterColor);h.backgroundColor&&0!==h.backgroundOpacity&&(p=h.backgroundColor,a=h.backgroundOpacity,a=a!==l?a:1,p=p.substring(1),p=sc(p,16),q["background-color"]="rgba("+(p>>16&255)+","+(p>>8&255)+","+(p&255)+","+a+")");a=h.characterEdgeColor||"#000000";switch(h.characterEdgeAttributes){case Rg:q["text-shadow"]=a+" 0px 0px 13px";break;case ci:q["text-shadow"]="-1px 0px "+a+",0px 1px "+a+",1px 0px "+a+",0px -1px "+a;break;case Zj:q["text-shadow"]="-1px -1px white, 0px -1px white, -1px 0px white, 1px 1px black, 0px 1px black, 1px 0px black";
break;case ak:q["text-shadow"]="1px 1px white, 0px 1px white, 1px 0px white, -1px -1px black, 0px -1px black, -1px 0px black"}q=db(q);(a=c[h.characterStyle||"PROPORTIONAL_SANS_SERIF"])&&(q+=";"+a);h=h.characterOpacity;0<h&&1>h&&(k='<span style="opacity:'+h+'">'+k+"</span>");g=U+('<span style="'+q+'">'+k+"</span>")});return g}function Cg(a,b,c,d,f){var g="",h=f.width;f=f.height;for(var k=b.length;k--;){var l=b[k],q=a[k],q=q&&q.region,n="position:absolute;background:"+d+";width:"+Ya(l.width+2*c)+"px;height:"+
Ya(l.height+2*c)+"px;";p($b(q,l,h,f,c),function(a,b){n+=a+":"+b+";"});g+='<div style="'+n+'"></div>'}return g}function $b(a,b,c,d,f){var g={};"right"==a.horizontalAlignment?g.right=100*(c-b.left-b.width-f)/c+"%":g.left=100*(b.left-f)/c+"%";"bottom"==a.verticalAlignment?g.bottom=100*(d-b.top-b.height-f)/d+"%":g.top=100*(b.top-f)/d+"%";return g}function lf(a){function b(){var l=d.parentNode,p=l&&l.clientWidth,q=l&&l.clientHeight,n=l=0,ma={width:p,height:q},t,m;if(0<p&&0<q&&f){g&&(ma=P(p,q,g),l=Ya((p-
ma.width)/2),n=Ya((q-ma.height)/2));var u=f.blocks;t=u&&u.map(function(b){var c=ve(b,ma,a,h),d={display:"block","white-space":"nowrap"};switch(b.region.horizontalAlignment){case "left":d["text-align"]="left";break;case "right":d["text-align"]="right";break;default:d["text-align"]="center"}b=db(d)+";position:absolute";return Y("div",b,c,Sg)})}x(c,{left:l+"px",right:l+"px",top:n+"px",bottom:n+"px"});d.style.display="none";d.innerHTML="";if(t&&t.length){p=ma.width;l=ma.height;t.forEach(function(a){d.appendChild(a)});
var w=db(c);d.style.cssText=w+";visibility:hidden;z-index:-1";var y=[],v,A,Da;for(m=t.length;m--;)A=t[m],Da=u[m],v=we(A,Da,p,l),v.width>p&&(A.innerHTML=ve(Da,ma,a,h,p/v.width),v=we(A,Da,p,l)),y[m]=v;m=ma;k&&(m=Yd(ma,k,q,n));y=mf(y,m);if(n=u&&u[0]&&u[0].textNodes&&u[0].textNodes[0]&&u[0].textNodes[0].style)q=n.windowColor,n=n.windowOpacity,q&&0<n&&(m=Ya(l/50),q=Cg(u,y,m,q,ma),q=Y("div","position:absolute;left:0;top:0;right:0;bottom:0;opacity:"+n,q,Sg),d.insertBefore(q,d.firstChild));d.style.display=
"none";for(m=y.length;m--;)v=y[m],x(t[m].style,$b(u[m].region,v,p,l,0));d.style.cssText=w}}var c={position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"block"},d=Y("DIV",l,l,{"class":"player-timedtext"}),f,g,h=function(a){var b={};p(a,function(a,c){var d=Y("DIV","display:block;position:fixed;z-index:-1;visibility:hidden;font-size:1000px;"+c+";","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Sg);eb.body.appendChild(d);var f={fontSize:1E3,height:d.clientHeight,width:d.clientWidth/
52,lineHeight:d.clientHeight/1E3};eb.body.removeChild(d);b[a]=f});return b}(a),k;d.onselectstart=function(){return!1};x(this,{sj:function(){return d},qs:function(a){g=a},ts:function(a){f=a;b()},Or:b,Ah:function(a){k=a;b()}})}function we(a,b,c,d){var f=b.region,g=(f.marginTop||0)*d,h=(f.marginBottom||0)*d,k=(f.marginLeft||0)*c,l=(f.marginRight||0)*c;b=a.clientWidth||1;a=a.clientHeight||1;switch(f.verticalAlignment){case "top":d=g;break;case "center":d=(g+d-h-a)/2;break;default:d=d-h-a}switch(f.horizontalAlignment){case "left":c=
k;break;case "right":c=c-l-b;break;default:c=(k+c-l-b)/2}return{top:d,left:c,width:b,height:a}}function Yd(a,b,c,d){return{height:c-qa(d,b.bottom|0)-qa(d,b.top|0),width:a.width}}function mf(a,b){function c(a,b,f){if(a&&1<a.length){for(var g=[],U=[],h=0;h<a.length;h++)g[h]=0,U[h]=0;for(var k=!1,h=0;h<a.length;h++)for(var l=h+1;l<a.length;l++){var p,q=a[h],aa=a[l];if(0>q.width||0>aa.width||aa.left>q.left+q.width||aa.left+aa.width<q.left||aa.top>q.top+q.height?0:aa.top+aa.height>=q.top){p=qa(q.left,
aa.left);var n=qa(q.top,aa.top);p={width:qa(ea(q.left+q.width,aa.left+aa.width)-p,0),height:qa(ea(q.top+q.height,aa.top+aa.height)-n,0),x:p,y:n}}else p=void 0;if(p&&1<p.width&&1<p.height)if(n=p.width<=p.height,q=d(a[h]),aa=d(a[l]),n&&b||!n&&!b)p=qa(p.width/2,.25),q.x<=aa.x?(U[h]-=p,U[l]+=p):(U[l]-=p,U[h]+=p);else if(n&&!b||!n&&b)q=qa(p.height/2,.25),g[h]-=q,g[l]+=q}for(h=0;h<a.length;h++){if(-.25>U[h]&&0<=a[h].left+U[h]||.25<U[h]&&a[h].left+a[h].width+U[h]<=f.width)a[h].left+=U[h],k=!0;if(-.25>g[h]&&
0<=a[h].top+g[h]||.25<g[h]&&a[h].top+a[h].height+g[h]<=f.height)a[h].top+=g[h],k=!0}return k}}function d(a){return{x:a.left+a.width/2,y:a.top+a.height/2}}var f=a.map(function(a){return{top:a.top,left:a.left,width:a.width,height:a.height}});(function(a,b){a.forEach(function(a){0>a.left&&a.left+a.width<b.width?a.left+=ea(-a.left,b.width-(a.left+a.width)):a.left+a.width>b.width&&0<a.left&&(a.left-=ea(a.left+a.width-b.width,a.left));0>a.top&&a.top+a.height<b.height?a.top+=ea(-a.top,b.height-(a.top+a.height)):
a.top+a.height>b.height&&0<a.top&&(a.top-=ea(a.top+a.height-b.height,a.top))})})(f,b);for(var g=0;50>g&&c(f,!0,b);g++);for(g=0;50>g&&c(f,!1,b);g++);return f}function Dg(a){di.root.getDirectory("netflix.player.namedatapair",ei,function(b){a({c:!0,Co:b})},function(){a({g:M.cn})})}function Ad(a,b,c){function d(){c({g:M.Zm})}a.getFile(b,fi,function(a){a.file(function(b){var f=new gi;f.onloadend=function(){c({c:!0,text:f.result,vg:a})};f.onerror=d;f.readAsText(b)},d)},d)}function nf(a,b,c,d,f){function g(){f&&
f({g:M.bn})}function h(a){a.createWriter(function(b){try{b.onwriteend=function(){b.onwriteend=null;b.onerror=null;b.truncate(b.position);f&&f({c:!0,vg:a})},b.onerror=g,b.write(new bk([c]))}catch(d){g()}},g)}b.createWriter?h(b):a.getFile(b,d?ck:ei,h,g)}function Ag(a,b,c){function d(){c&&c({g:M.$m})}function f(a){a.remove(function(){c&&c(fa)},d)}b.remove?f(b):a.getFile(b,fi,f,d)}function Eg(a){var b={};a({c:!0,Gh:{load:function(a,c){b.hasOwnProperty(a)?c({c:!0,data:b[a],Td:a}):c({g:M.uc})},save:function(a,
c,d,f){d&&b.hasOwnProperty(a)?f({c:!1}):(b[a]=c,f&&f({c:!0,Td:a}))},remove:function(a,c){delete b[a];c&&c(fa)}}})}function xe(a){function b(){b=g;a({c:!0,Gh:{load:function(a,b){c(a,function(c){Ad(d,a,function(a){Z(c.hf);if(a.c){var d=a.text,f;try{d&&(f=ab.parse(d))}catch(g){b({g:M.dn});return}f?b({c:!0,data:f,Td:a.vg}):b({g:M.uc})}else b(a)})})},save:function(a,b,f,g){var U=a.name||a,h=ab.stringify(b);c(U,function(b){nf(d,a,h,f,function(a){Z(b.hf);a.c?g&&g({c:!0,Td:a.vg}):g&&g(a)})})},remove:function(a,
b){c(a.name||a,function(c){Ag(d,a,function(a){Z(c.hf);b&&b(a)})})}}})}function c(a,b){(f[a]||(f[a]=new te)).rn(!0,b)}var d,f={};Dg(function(c){c.c?(d=c.Co,b()):a(c)})}function Zd(a){function b(d,f){b=g;k&&k.wb();if(d){var h={g:d};f&&(h.C=f);a(h)}else a({c:!0,Gh:{load:function(a,b){c("get",!1,a,function(c){var d;try{var f=c.target.result;d=f?{c:!0,data:f.data,Td:a}:{g:M.uc}}catch(g){d={g:M.ui,C:G(g)}}b(d)},function(a){b({g:M.ui,C:a})},function(){b({g:M.vi})})},save:function(a,b,d,f){c(d?"add":"put",
!0,{name:a,data:b},function(){f&&f({c:!0,Td:a})},function(a){f&&f({g:M.gn,C:a})},function(){f&&f({g:M.yi})})},remove:function(a,b){c("delete",!0,a,function(){b&&b(fa)},function(a){b&&b({g:M.si,C:a})},function(){b&&b({g:M.Lf})})}}})}function c(a,b,f,g,U,k){function l(){q&&q.wb();p&&(p.onsuccess=null,p.onerror=null)}try{var p=h.transaction("namedatapairs",b?"readwrite":"readonly").objectStore("namedatapairs")[a](f);p.onsuccess=function(a){l();g(a)};p.onerror=function(){l();U(d(p))};var q=new tb(z.Nk,
function(){l();k()});q.jc()}catch(aa){l(),U(G(aa))}}function d(a){a=a&&a.error;return"onerror: "+(a&&(a.name||""+a))}var f=new na.r("Storage"),h;if(Tg){var k=new tb(z.Nk,function(){b(M.$h)});k.jc();Nb("idbo");var l=Tg.open("netflix.player",1);l?(l.onblocked=function(){b(M.rl)},l.onupgradeneeded=function(){Nb("idbun");h=l.result;h.createObjectStore("namedatapairs",{keyPath:"name"})},l.onsuccess=function(){Nb("idbs");h=l.result;b()},l.onerror=function(){Nb("idbe");var a=d(l);f.error("IndexedDB open error",
a);b(M.sl,a)}):b(M.Zh)}else Ug?b(M.ql,G(Ug)):b(M.Yh)}function Fg(a){function c(a,b){p(a,function(a,d){q(d)?b[a]=d.call(l,b[a]):k(d)&&(b[a]=b[a]||{},c(d,b[a]))})}function d(a,b){var c=Og.call(arguments,1);return function(b){t(b)&&(c[1]=b);return a.apply(l,c)}}function f(a){a=a.toLowerCase();Tb.hasOwnProperty(a)&&(ra[a]=Tb[a]);return a}function g(a,b,c){a=a.toLowerCase();if(ra.hasOwnProperty(a)){var d=ra[a];try{d=c?c(d):d}catch(f){d=l}if(d!==l)return d;na.error("Invalid configuration value. Name: "+
a)}return b}function n(a,b,c,d){return g(a,b,function(a){w(a)&&(a=E(a));if(h(a,c,d))return a})}function m(a,b,c,d){return g(a,b,function(a){w(a)&&(a=E(a));if(h(a,c||0,d))return a})}function u(a,c,d,f){return g(a,c,function(a){w(a)&&(a=cc(a));if(b(a,d,f))return a})}function v(a,b,c){return g(a,b,function(a){if(c?c.test(a):w(a))return a})}function S(a,b){return g(a,b,function(a){if("true"==a||!0===a)return!0;if("false"==a||!1===a)return!1})}function A(a,b,c,d){a=a.split("|");for(var f=a.length;f--;)if(a[f]=
E(a[f]),!h(a[f],b||0,c))return;if(d===l||a.length>=d)return a}function bc(a,b,c,d,f){return g(a,b,function(a){return A(a,c,d,f)})}function B(a,b,c,d,f,U){return g(a,b,function(a){a=a.split(";");for(var b=a.length;b--;)if(a[b]=A(a[b],c,d),a[b]===l||a[b].length!=f)return;if(U===l||a.length>=U)return a})}function ie(a,b){a=a.toLowerCase();if(ra.hasOwnProperty(a)){for(var c=ra[a],c=ad.isArray(c)?c:c.split("|"),d=c.length;d--;)if(w(c[d]))c[d]=ab.parse(Pg(c[d]));else return na.error("Invalid configuration value."),
b;return c}return b}function wb(a,b,c,d){return g(a,b,function(a){a=ad.isArray(a)?a:a.split("|");for(var b=a.length;b--;)if(c?!c.test(a[b]):!y(a[b]))return;if(d===l||a.length>=d)return a})}function Za(a,b,c){return g(a,b,function(a){var d={};x(d,b);if(w(a)){a=a.split(";");for(var f=a.length;f--;){var g=a[f],U=g.indexOf(":");if(0>=U)return;var h=g.substring(0,U);if(g=g.substring(U+1)){if(c&&!c.test(g))return;d[h]=g}else delete d[h]}}else x(d,a);return d})}function Se(a){var b=[];p(a,function(a,c){var d;
try{d=ab.stringify(c)}catch(f){d="cantparse"}b.push(a+"="+d)});return b.join("\n")}var Hb=/^[0-9-+]+$/,va=/^(2\.14)|(2\.15)|(2\.16)|(3\.0)$/,ga=/^[0-9]+[%]?$/,Da=/^[0-9]*$/,ra,Tb,Ca,hi=!0,ii=!1,Pa=!0,F=!1,ca=!0;(function(){function b(a){a.split(",").forEach(function(a){var b=a.indexOf("=");0<b&&(ra[a.substring(0,b).toLowerCase()]=a.substring(b+1))})}ra={};x(ra,ji);a&&a.length&&dk.call(a,function(a){w(a)?b(a):k(a)&&x(ra,a,{$g:!0})});Tb=x({},da(),{$g:!0});var c=Aa().cadmiumconfig;c&&(na.info("Config cookie loaded",
c),b(c));ek&&x(ra,Tb)})();Ca=/^test/i.test(v(f("environment")))||/^test|int$/i.test(v(f("env")));z={};var Fc={nv:function(a){return hi=S(f("enableDDPlus"),D(a,!0))},rv:function(a){return Pa=S(f("enableLSSDH"),D(a,!0))},pv:function(a){return ii=S(f("enableHEVC"),D(a,!1))},qv:function(a){return ca=S(f("enableImageSubs"),D(a,!0))},Vf:function(a){return wb("audioProfiles",D(a,ki)).filter(function(a){return"ddplus-5.1-dash"===a?fk&&hi:!0})},fv:function(a){return F=S("disableHD",D(a,!1))},Qh:function(a){a=
wb("videoProfiles",D(a,li)).filter(function(a){return"playready-h264mpl31-dash"===a?!F:"playready-h264mpl40-dash"===a?!F&&gk:/^hevc-/.test(a)?ii:!0});return mi(a)},ot:d(v,f("videoCodecs"),tg()),ad:function(a){return wb("timedTextProfiles",D(a,ni)).filter(function(a){return"dfxp-ls-sdh"===a?Pa:"nflx-cmisc"===a?ca:!0})},Oe:d(wb,f("keySystemIdList"),oi,l,1),Un:d(v,f("canHDCP"),hk||"constrict",/^(constrict|ifpresent|never)$/),dl:d(v,"widevineRASC","CAUSwwUKvQIIAxIQ5US6QAvBDzfTtjb4tU/7QxiH8c+TBSKOAjCCAQoCggEBAObzvlu2hZRsapAPx4Aa4GUZj4/GjxgXUtBH4THSkM40x63wQeyVxlEEo1D/T1FkVM/S+tiKbJiIGaT0Yb5LTAHcJEhODB40TXlwPfcxBjJLfOkF3jP6wIlqbb6OPVkDi6KMTZ3EYL6BEFGfD1ag/LDsPxG6EZIn3k4S3ODcej6YSzG4TnGD0szj5m6uj/2azPZsWAlSNBRUejmP6Tiota7g5u6AWZz0MsgCiEvnxRHmTRee+LO6U4dswzF3Odr2XBPD/hIAtp0RX8JlcGazBS0GABMMo2qNfCiSiGdyl2xZJq4fq99LoVfCLNChkn1N2NIYLrStQHa35pgObvhwi7ECAwEAAToQdGVzdC5uZXRmbGl4LmNvbRKAA4TTLzJbDZaKfozb9vDv5qpW5A/DNL9gbnJJi/AIZB3QOW2veGmKT3xaKNQ4NSvo/EyfVlhc4ujd4QPrFgYztGLNrxeyRF0J8XzGOPsvv9Mc9uLHKfiZQuy21KZYWF7HNedJ4qpAe6gqZ6uq7Se7f2JbelzENX8rsTpppKvkgPRIKLspFwv0EJQLPWD1zjew2PjoGEwJYlKbSbHVcUNygplaGmPkUCBThDh7p/5Lx5ff2d/oPpIlFvhqntmfOfumt4i+ZL3fFaObvkjpQFVAajqmfipY0KAtiUYYJAJSbm2DnrqP7+DmO9hmRMm9uJkXC2MxbmeNtJHAHdbgKsqjLHDiqwk1JplFMoC9KNMp2pUNdX9TkcrtJoEDqIn3zX9p+itdt3a9mVFc7/ZL4xpraYdQvOwP5LmXj9galK3s+eQJ7bkX6cCi+2X+iBmCMx4R0XJ3/1gxiM5LiStibCnfInub1nNgJDojxFA3jH/IuUcblEf/5Y0s1SzokBnR8V0KbA=="),
kw:function(){return-1},lq:d(n,f("logDisplayMaxEntryCount"),1E3,-1),oq:d(n,f("logToConsoleLevel"),-1),xe:function(){return Ca},Rr:d(S,"requireNetflixId",!1),Sr:d(S,"requireSecureNetflixId",!1),et:d(S,"upgradeNetflixId",!0),Pq:d(v,"netflixIdEsnPrefix"),Vo:d(S,"enforceSinglePlayback",!0),Wo:d(S,"enforceSingleSession",!1),bg:d(S,"closeOtherPlaybacks",!0),pa:d(S,f("useASE"),!1),Bn:d(m,"asyncLoadTimeout",15E3,1),qq:d(m,"mainThreadMonitorPollRate",0),Fe:d(v,"groupName",""),al:d(m,f("verbosePlaybackInfoDenominator"),
100),yn:d(S,f("allowPleaseCallMessage"),!1),Pr:d(S,"renderTimedText",!0),Uk:d(Za,"timedTextStyleDefaults",{}),Vk:d(Za,"timedTextStyleOverrides",{}),Ss:d(Za,"timedTextFontFamilyMapping",pi||{"default":"font-family:Arial,Helvetica;font-weight:bolder"}),Ts:d(m,f("timedTextTimeOverride"),0),Tk:d(m,"timedTextSimpleFallbackThreshold",ik),gg:d(v,f("customDfxpUrl")),Xn:d(wb,"cdnIdWhiteList",[]),Wn:d(wb,"cdnIdBlackList",[]),zg:d(v,f("forceAudioTrack")),Lq:d(S,"muteVolumeOnPlaybackClose",!0),ze:d(v,f("forceTimedTextTrack")),
Ks:d(m,"storageMinimumSize",0,0),Ok:d(v,"storageType","idb",/^(none|fs|idb)$/),Nk:d(m,"storageTimeout",8E3,1),jq:d(m,"lockExpiration",1E4),kq:d(m,"lockRefresh",3E3),Gq:d(m,"minBufferingTimeInMilliseconds",4E3),xr:d(m,"progressBackwardsGraceTimeMilliseconds",4E3),yr:d(m,"progressBackwardsMinPercent",10),Mn:d(v,f("bookmarkIgnoreBeginning"),"30000",ga),Nn:d(v,f("bookmarkIgnoreEnd"),"5%",ga),dg:d(v,"connectionStrategy","parallel",/^(parallel|single)$/),Ii:d(v,f("bandwidthMeterType"),"sliding_window",
/^(historical|sliding_window)$/),Yj:d(m,"maxParallelConnections",3),hr:d(v,"parallelDownloadManagerType","chunk",/^(subchunk|chunk)$/),tq:d(m,"maxChunksInProgressForSubchunking",3),Ms:d(m,"subchunkLength",Vg(2,17)),ir:d(u,"parallelSafeBufferThreshhold",40/240),pn:d(u,"abortDownloadBufferThreshhold",40/240),Fh:d(m,"slidingWindowWidthMilliseconds",3E4),mr:d(S,"pingOnConnectTimeout",!0),lr:d(m,"pingCDNTimeoutMilliseconds",8E3),Gd:d(m,"maxBufferSizeMilliseconds",232E3,1E4,145152E5),Hb:d(m,"maxBufferSizeBytes",
0),Ei:d(m,"backBufferSizeMilliseconds",1E4,0,145152E5),Kn:d(m,"backToFrontBufferRatioPercent",25,0,1E3),Uf:d(m,"audioChunkSizeMilliseconds",16E3),nt:d(m,"videoChunkSizeMilliseconds",4004),Io:d(S,"droppedFrameRateFilterEnabled",!1),Jo:d(m,"droppedFrameRateFilterMaxObservation",60,10,1E3),Lo:d(B,"droppedFrameRateFilterPolicy",[[4,15],[8,9],[12,2],[20,1]],l,l,2,0),Mo:d(S,"droppedFrameRateFilterWithoutRebufferEnabled",!1),ve:d(m,"droppedFrameRateFilterBasedOnPreviousSession"),ej:d(bc,"droppedFrameRateFilterBasedOnPreviousSessionPolicy"),
Ko:d(m,"droppedFrameRateFilterMinHeight",384),Po:d(m,"droppedFramesStorageSessionLimit",10),Oo:d(m,"droppedFramesStorageInterval",6E4),No:d(bc,"droppedFramesPercentilesList",[]),zo:d(m,f("defaultVolume"),100,0,100),Zi:d(S,"disableVideoRightClickMenu",!0),Va:d(m,"minDecoderBufferMilliseconds",1E3,0,145152E5),er:d(m,"optimalDecoderBufferMilliseconds",5E3,0,145152E5),vq:d(m,"maxDecoderBufferMilliseconds",7E3,0,145152E5),Vi:d(m,"decoderTimeoutMilliseconds",1E4,1),$i:d(S,"disgardMediaOnAppend",!1),An:d(S,
"appendMediaBeforeInit",!1),kr:d(m,"pauseTimeoutLimitMilliseconds",18E5),Mj:d(m,"inactivityMonitorInterval",3E4,0),qn:d(bc,"abrdelLogPointsSeconds",[15,30,60,120],0,l,4),Dp:d(v,f("heuristicsAlgorithm"),""),cp:d(B,f("fixedVideoBitrates"),[],l,l,2,0),Pj:d(wb,f("initialVideoBitrates"),["0+","400+","900+"],Hb,1),Pp:d(wb,f("initialVideoBitratesForCarreraFallback"),["0+","400+","900+"],Hb,1),Op:d(wb,f("initialAudioBitrates"),["0+","90+","150+"],Hb,1),Cn:d(m,"audioBandwidthDenominator",15,1),Lk:d(m,"simulationLimitMilliseconds",
12E5,1E4),Ep:d(m,"highStreamSimulationMilliseconds",12E4,1),rr:d(B,"prebufferBitrate",[[500,235],[1E3,560],[5E3,1050],[1E4,1050],[3E4,3E3]],l,l,2,1),Qk:d(B,"switchUpToBitrate",[[235,560],[375,750],[560,1050],[750,1400],[1050,1750],[1750,3E3],[2350,1E5]],l,l,2,1),lh:d(m,"prebufferMinAudioMilliseconds",6E3),mh:d(m,"prebufferMinVideoMilliseconds",6E3),sr:d(m,"prebufferMaxMilliseconds",3E4),Jr:d(m,"rebufferMaxMilliseconds",232E3),So:d(S,"enableTrickPlay",!1),fe:d(bc,"additionalDownloadSimulationParams",
[2E3,2E3,100],0,l,3),$s:d(m,"trickPlayHighResolutionBitrateThreshold",1E3),ct:d(m,"trickPlayHighResolutionThresholdMilliseconds",1E4),dt:d(u,"trickplayBufferFactor",.5),Zs:d(m,"trickPlayDownloadRetryCount",1),pk:d(bc,"prebufferSimulationParams",[2E3,2E3,60],0,l,3),Ji:d(B,"bufferingSimulationParams",[[6E4,1E3,1E3,100],[12E4,1E3,1E3,20],[18E4,0,0,0]],l,l,4,1),Xf:d(B,"bufferingSwitchUpSimulationParams",[[6E4,3E3,3E3,140],[12E4,3E3,3E3,60],[18E4,0,0,0]],l,l,4,1),bj:d(m,"doNotSwitchDownIfBufferIsAboveMilliseconds",
18E4),Ro:d(S,"enableHistorical",!0),Sg:d(m,"histAggregationTimeSpanInSeconds",300),Fp:d(m,"histCompareBitsIPv4",24),Gp:d(m,"histCompareBitsIPv6",32),Gj:d(v,"histFilterType","none",/^(none|timeofDay|dayOfWeekAndTimeOfDay)$/),Jj:d(m,"histSizeLimit",1E3),Ij:d(m,"histMinSampleSize",1),Hj:d(m,"histMaxSampleSize",1E3),Kj:d(m,"histTimeOfDayRangeInSeconds",3600),Vn:d(Za,"carreraParameters",{1750:7,1050:5,750:4.5,560:4.5,375:4.5}),Mi:d(n,"carreraMediaSecondsToDownload",8E3),Ki:d(n,"carreraChunksToAverage",
10),Mu:d(u,"carreraConfidenceThreshold",.7),Li:d(n,"carreraHistoricalPercentileToUse",50),Vg:d(v,"initialBitrateSelectionAlgorithm","default",/^(default|carrera)$/),On:{zq:d(m,"maxReservoirSizeMilliseconds",12E4),yq:d(m,"maxOutageProtectionMilliseconds",6E4),uq:d(m,"maxCushionSizeInBufferPercentage",90),Tr:d(m,"reservoirLookAheadChunks",60),Fs:d(m,"startupPhaseInChunks",30),Gs:d(S,"startupQualityOptimization",!0),Qo:d(S,"dynamicReservoir",!0),Yp:d(S,"isUsingStrictMaxChunkSize",!0),Ys:d(S,"transitFromInitialPhase",
!0),Hs:d(S,"startupSafeRateCalculationEnabled",!0),Is:d(S,"startupThresholdFunctionOfBufferEnabled",!0),Ds:d(S,"startupLookAheadCalculationEnabled",!1),Es:d(m,"startupLookAheadChunks",120),Up:d(S,"isReservoirManualSet",!1),sq:d(m,"manualReservoirMilliseconds",9E4),Qp:d(S,"isCushionManualSet",!1),rq:d(m,"manualCushionMilliseconds",126E3),Tp:d(S,"isLookingAhead",!1),Xp:d(S,"isUsingRateMap",!1)},eb:d(bc,"failedDownloadRetryWaits",[10,200,500,1E3,2E3,4E3,8E3,16E3]),wv:d(bc,"failedDownloadRetryWaitsASE",
[10,200,500,1E3,2E3,4E3]),ft:d(S,"useCDNExponentialBackoff",!0),Ck:d(m,"selectCdnDownloadRetryCountBeforeCdnSwitch",2),os:d(m,"selectCdnTimeoutMilliseconds",1E3),ms:d(m,"selectCdnSignificantLatency",300),mf:d(m,"selectCdnBandwidthThresholdKbps",2E3),Dk:d(v,"selectCdnType","bandwidth",/^(latency|bandwidth)$/),ie:d(m,"bandwidthTestBytesPerCdn",204800),kt:d(S,"useVariableConnectTimeout",!1),Hq:d(m,"minConnectTimeoutMilliseconds",4E3),Pb:d(m,"connectTimeoutMilliseconds",8E3,500),lo:d(m,"connectTimeoutBufferDiscount",
2),mo:d(m,"connectTimeoutoutUpperLimitMultiplier",1E4),Kd:d(m,"noProgressTimeoutMilliseconds",8E3,500),jt:d(S,"useOnLineApi",!1),Cp:d(m,"headerDownloadRetryCountBeforeCdnSwitch",1),Sk:d(m,"timedTextDownloadRetryCountBeforeCdnSwitch",1),Nj:d(m,"initialHeaderDownloadTimeout",2E3),Fj:d(m,"headerDownloadTimeout",3E3),ep:d(S,"forcePresentingStateToPlaying",!1),ls:d(m,"seekBackOnAudioTrackChangeMilliseconds",8E3),Pk:d(wb,f("supportedAudioTrackTypes"),[],l,1),Os:d(wb,f("supportedAudioBitrates"),[],Hb),Ps:d(wb,
f("supportedVideoBitrates"),[],Hb),Oj:d(m,"initialLogFlushTimeout",5E3),Wc:d(v,"playdataPersistKey",Ca?"unsentplaydatatest":"unsentplaydata"),nf:d(S,"sendPersistedPlaydata",!0),jh:d(m,"playdataPersistIntervalMilliseconds",4E3),pr:d(S,"playdataPrepareRequest",!1),Qg:d(m,"heartbeatCooldown",1E4,1E3),nq:d(wb,"logPerformanceTiming","navigationStart redirectStart fetchStart secureConnectionStart requestStart domLoading".split(" ")),Eq:d(S,"midplayEnabled",!0),$j:d(m,"midplayIntervalMilliseconds",3E5),
Fq:d(bc,"midplayKeyPoints",[15E3,3E4,6E4,12E4]),aj:d(m,f("dlprestartCount"),0),og:d(m,"downloadReportDenominator",0),Go:d(m,"downloadReportInterval",3E5),re:d(wb,"downloadReportTcpInfo",[]),hv:d(m,"downloadReportTraceInterval",1E3),Ln:d(Za,f("bookmarkByMovieId"),{}),Wb:d(S,f("limitedDurationLicense"),!1),Qe:d(m,f("licenseRenewalRequestDelay"),0),Vj:d(S,f("limitedDurationFlagOverride"),l),Sd:d(S,f("secureStopEnabled"),!1),Ak:d(S,f("secureStopFromPersistedKeySession"),!1),fs:d(m,"secureStopKeyMessageTimeoutMilliseconds",
2E3,1),es:d(m,"secureStopKeyAddedTimeoutMilliseconds",1E3,1),js:d(m,f("secureStopPersistedKeyMessageTimeoutMilliseconds"),2500,1),ks:d(m,f("secureStopPersistedKeySessionRetries"),17,1),hs:d(m,"secureStopPersistedKeyAddedTimeoutUnmatchedSession",1E3,1),cs:d(S,f("secureStopDisplayLogWindowOnError"),!1),ds:d(S,f("secureStopIgnoreVideoError"),!1),ht:d(S,f("useCdmId"),!1),Np:d(wb,"initSegmentBoxTypeList",["ftyp","moov"]),Ip:d(wb,"ignorePsshList",jk||[]),tt:d(S,"workaroundSaio",!0),ut:d(S,"workaroundTenc",
!0),el:d(S,f("workaroundAudioKeyFrame"),!1),Sn:d(S,f("callEndOfStream"),qi),io:d(S,f("clipLongVideo"),ri),ws:d(S,f("setVideoElementSize"),kk),eo:d(S,f("clearVideoSrc"),!0),Xi:d(m,f("delayPlayPause"),0),Jn:d(S,f("avoidSBRemove"),!1),ur:d(S,f("preferOldEme"),!0),Ar:d(S,f("promiseBasedEme"),!1),Yq:d(S,f("nudgeSourceBuffer"),!1),Bk:d(n,f("seekDelta"),1),tr:d(S,f("preciseSeeking"),!1),Wi:d(Za,f("delayErrorHandling")),Vs:d(S,"trackingLogEnabled",!0),Xs:d(v,"trackingLogUrl",Ca?"https://customerevents.test.netflix.com/track/debug":
"https://customerevents.netflix.com/track/debug",Ng),Ws:d(bc,"trackingLogStallKeyPoints",[1E4,3E4,6E4,12E4]),tg:d(v,"esnUrl"),kj:d(m,"esnUrlTimeout",6E3),gj:d(S,f("enableEmeVerboseLogging"),!1),Mq:d(v,"nccpAppId","",Da),Nq:d(v,"nccpSessionId","",Da),Zn:d(v,"cdnProxyUrl"),Ib:{Ev:d(S,"nccpForceRegister",!1),Dv:d(S,"nccpForceAuthenticationRenewal",!1),ye:d(v,f("nccpForceDebugLogLevel"),l,/^(ERROR|WARN|INFO|TRACE)$/),nh:d(v,"nccpProtocolVersion","3.1",va),Br:d(Za,"protocolVersionOverrides",{mdxregister:"2.16"},
va),xj:function(){return function(a){return this.Br()[a]||this.nh()}.bind(Fc.Ib)},hc:d(v,"nccpControllerUrl",Ca?"https://cbp.nccp.test.netflix.com/nccp/controller":"https://cbp.nccp.netflix.com/nccp/controller",Ng),Cr:d(v,"nccpProxyPath",""),zs:function(){return"2.0000.308.011"},Yk:d(v,"nccpUIVersion"),$n:function(){return"1"},sk:d(wb,"preferredLanguages",Ig,/^[a-zA-Z-]{2,5}$/,1),Vr:d(S,"nccpRetryOnNetworkFailures",!0),zn:d(S,"nccpAlwaysIncludeIdsInPlaydata",!0)},Wf:d(v,"authenticationType","JWK_RSA"),
Dn:d(Za,"authenticationKeyNames",x({e:"DKE",h:"DKH",w:"DKW",s:"DKS"},lk)),Qs:d(v,"systemKeyWrapFormat",mk),Jq:d(S,"mslDeleteStore",!1),Kq:d(S,"mslPersistStore",!0),Cy:d(bc,"streamingFailureRetryWaits",[4E3,8E3]),Pw:d(m,"minInitVideoBitrate",235),yw:d(m,"maxInitVideoBitrate",1050),Mw:d(m,"minAcceptableVideoBitrate",235),ov:d(S,"enableGoodQualityBuffering",!1),Sw:d(m,"minRequiredBuffer",3E4),Rw:d(m,"minPrebufSize",6E3),vw:d(m,"maxBufferingTime",2E3),Vv:d(ie,"initialBitrateSelectionCurve",null),Ky:d(m,
"throughputPercentForAudio",15),Hu:d(m,"bandwidthMargin",10),Iu:d(ie,"bandwidthMarginCurve",[{m:38,b:8E3},{m:50,b:6E4},{m:17,b:12E4},{m:0,b:24E4}]),Sv:d(m,"highWatermarkLevel",3E4),Ny:d(m,"toStableThreshold",3E4),Oy:d(m,"toUnstableThreshold",15E3),By:d(S,"skipBitrateInUpswitch",!0),Uy:d(m,"watermarkLevelForSkipStart",8E3),Qv:d(m,"highStreamRetentionWindow",9E4),Rv:d(m,"highStreamTransitionWindow",3E5),qw:d(m,"lowestBufForUpswitch",9E3),jw:d(m,"lockPeriodAfterDownswitch",15E3),pw:d(m,"lowWatermarkLevel",
15E3),Fw:d(m,"maxSimuLength",6E5),rw:d(m,"lowestWaterMarkLevel",6E3),Lw:d(u,"mediaRate",1.5),yv:d(u,"fastUpswitchFactor",3),zw:d(m,"maxMediaBufferAllowed",24E4),mw:d(m,"lowGradeModeEnterThreshold",12E4),nw:d(m,"lowGradeModeExitThreshold",9E4),xw:d(m,"maxDomainFailureWaitDuration",3E4),uw:d(m,"maxAttemptsOnFailure",18),uv:d(S,"exhaustAllLocationsForFailure",!0),Aw:d(m,"maxNetworkErrorsDuringBuffering",20),ww:d(m,"maxBufferingTimeAllowedWithNetworkError",6E4),xv:d(m,"fastDomainSelectionBwThreshold",
2E3),Ly:d(m,"throughputProbingEnterThreshold",4E4),My:d(m,"throughputProbingExitThreshold",34E3),hw:d(m,"locationProbingTimeout",1E4),Bv:d(m,"finalLocationSelectionBwThreshold",1E4),Iy:d(u,"throughputHighConfidenceLevel",.75),Jy:d(u,"throughputLowConfidenceLevel",.4),Bw:d(m,"maxPartialBuffersAtBufferingStart",2),Qw:d(m,"minPendingBufferLen",6E3),Cw:d(m,"maxPendingBufferLen",12E3),Gw:d(m,"maxStreamingSkew",4E3),Dw:d(m,"maxPendingBufferPercentage",10),Ew:d(m,"maxRequestsInBuffer",60),Pv:d(m,"headerRequestSize",
4096),Nw:d(m,"minBufferLenForHeaderDownloading",1E4),ey:d(m,"reserveForSkipbackBufferMs",1E4),Tx:d(S,"pipelineEnabled",!1),Qy:d(m,"updatePtsIntervalMs",1E3),Lu:d(m,"bufferLevelNotifyIntervalMs",2E3),$u:d(m,"defaultHeaderCacheSize",4),Zu:d(m,"defaultHeaderCacheDataCount",3),lv:d(S,"enableAbandonTesting",!1),xu:d(m,"abandonRequestFrequency",4),Dy:d(m,"streamingStatusIntervalMs",2E3),Ux:d(m,"prebufferTimeLimit",24E4),Ow:d(m,"minBufferLevelForTrackSwitch",2E3),Qx:d(m,"penaltyFactorForLongConnectTime",
2),lw:d(m,"longConnectTimeThreshold",200),zu:d(m,"additionalBufferingLongConnectTime",2E3),Au:d(m,"additionalBufferingPerFailure",8E3),Yw:d(m,"networkFailureResetWaitMs",2E3),Xw:d(m,"networkFailureAbandonMs",6E4),Hw:d(m,"maxThrottledNetworkFailures",3),Hy:d(m,"throttledNetworkFailureThresholdMs",200),mv:d(S,"enableAbortBlock",!1),ow:d(m,"lowThroughputThreshold",400),Uw:d(S,"mp4ParsingInNative",!0),Wx:d(S,"pruneRequestsFromNative",!0)},W=!0;Uf=function(a){a&&(ra=x({},a,{$g:!0}),c(Fc,z),na.trace("Config applied for",
Se(W?ra:a)),W=!1)};Uf(ra)}function of(a,b){return w(a)&&"%"==a[a.length-1]?Ya(cc(a)*b/100):a}function yd(){return 3<=E(z.Ib.nh)}function Gg(a,b,c,d){x(this,{ij:b,lc:a,bs:nk||"cadmium",jv:c,jj:d})}function re(){for(var a="",b=ja(bd/1E3),c=6;c--;)a="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[b%32]+a,b=ja(b/32);for(;30>a.length;)a+="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[J(0,31)];return a}function pf(){try{var a=z.xe?"NetflixIdTest":"NetflixId",b=Aa()[a],c=pa(b);return"dbl"==c||"dev"==c}catch(d){}}function Ob(a){cd.N({url:z.tg,
Pb:z.kj,Kd:z.kj,type:Wg,withCredentials:!0,Xb:function(a){a=ab.parse(a).data.esn;if(!si.test(a))throw new La("bad esn");var b=a.match(si)[2];if(!y(b))throw new La("bad deviceId");Vf=a;return b}},a)}function Dd(a){a=new Gc(ic(a));a.Z();return{aq:a.uk(),Uo:a.uk()}}function qf(a,b){var c=a.url.split("?"),d=c[0],f;f=a.offset;(f=f!==l?a.length!==l?f+"-"+(a.offset+a.length-1):f+"-":void 0)&&(b.Kb=f,d="/"==d[d.length-1]?d+"range/":d+"/range/",d+=f);f=a.zc?"random="+(1E17*Qe()).toFixed(0):"";d=c[1]?d+("?"+
c[1]+(f?"&"+f:"")):d+(f?"?"+f:"");!a.i||d&&0==d.toLowerCase().indexOf("https")||(c=z&&z.Zn)&&(d=c.replace("{URL}",d).replace("{EURL}",Md(d)));b.url=d}function Ed(){return!1!==Gb.onLine}function ye(a,b,c,d){var f=d.kh,g=d.headers;a.open(f?"POST":"GET",b,!c);switch(d.responseType){case jc:a.responseType="arraybuffer";break;case ti:A(a,"overrideMimeType",l,"text/xml")}f&&(b={"Content-Type":w(f)?"text/plain":"application/x-octet-stream"},g=g?x(b,g):b);g&&p(g,function(b,c){a.setRequestHeader(b,c)});d.withCredentials&&
(a.withCredentials=!0);a.msCaching!==l&&(a.msCaching="disabled");f?a.send(f):a.send()}function Pb(a,b){switch(b.type){case jc:return a.response||new ArrayBuffer(0);case ti:return a.responseXML;default:return a.responseText}}function rf(a){function b(a){b=g;f.onload=null;f.onabort=null;f.onerror=null;var c=f.status;!a&&200<=c&&299>=c?(h.content=Pb(f,h),h.c=!0):(h.g=a?M.Za:M.bd,h.Ca=h.P=c,h.c=!1)}var c=/^[a-z]*:\/\/.*/i,d=a.url,f=new ui,h={L:a,type:a.responseType};xc(w(d)&&!c.test(d));f.onload=function(){b()};
f.onerror=function(){b()};f.onabort=function(){b(!0)};ye(f,d,!0,a);return h}function ze(a){function b(c){a.fireEvent(ke,c)}return{N:function(c,d){c.Ha=a;var f=cd.N(c,d);a.fireEvent(Te,f);f.Ci(b);return f}}}function sf(a){return{N:function(b,c){b.Ha=a;var d;a.i.value&&z.mr&&(d={nr:new Be(a.ua),wq:z.Yj,jk:0,i:a.i.value});d=cd.N(b,c,d);a.fireEvent(Te,d);d.Ci(function(b){a.fireEvent(ke,b)});return d}}}function Be(a){function b(a,c,d){if(c.Qa[a.id])return{responseType:jc,url:c.Qa[a.id],Xb:Rf,offset:c.j.t[d?
d.index:0].offset,length:8,i:a,track:c.track,stream:c,Cb:d.type+"-"+d.index+"-ping",zc:!0}}this.ua=a;this.ping=function(a){function c(a){bb(k);d(a)}function d(b){(b=b&&b.c)&&a.Ns();!b&&a.nj()}var f=this.ua,g=a.stream,U=a.G,h;if(a.jk>a.wq)a.nj();else if(U&&!U.media){(g=b(a.i,g,U))&&(h=f.N(g,c));var k=Ka(function(){d();h&&h.abort()},z.lr)}}}function ub(a,b){for(var c=1;(b=arguments[c++])&&(a=a[b]););return a}function ta(a,b){var c;a?c=E(a[ob]):b!==l&&(c=b);return c}function ha(a,b){var c;a?c=a[ob]:
b!==l&&(c=b);return c}function jf(a){if(y(a)){var b=(new ok).parseFromString(a,"text/xml"),c=b.getElementsByTagName("parsererror");if(c&&c[0]){try{na.error("parser error details",{errornode:(new pk).serializeToString(c[0]),xmlData:a.slice(0,300),fileSize:a.length})}catch(d){}throw new La("xml parser error");}return b}throw new La("bad xml text");}function Fd(a){var b,c,d={};d[Wf]=a.localName;var f={};d[Ib]=f;var g=[];d[Xg]=g;var h=a.attributes;b=h.length;for(c=0;c<b;c++){var k=h[c];f[k.localName]=
k.value}a=a.childNodes;b=a.length;f={};for(c=0;c<b;c++)switch(h=a[c],h.nodeType){case qk:h=Fd(h);k=h[Wf];h[rk]=d;g.push(h);d[k]?f[k][xb]=h:d[k]=h;f[k]=h;break;case sk:case tk:h=h.text||h.nodeValue,g.push(h),d[ob]||(d[ob]=h)}return d}function zd(a,b){var c,d;try{c=jf(a)}catch(f){na.error("xml2xmlDoc exception",f)}Z(function(){if(c&&c.documentElement)try{d=Fd(c.nodeType==uk?c.documentElement:c)}catch(a){na.error("xmlDoc2js exception",a)}Z(function(){d?b({c:!0,object:d}):b({c:!1,g:M.ol})})})}function ae(a,
b,c,d){xc(k(a)&&!ad.isArray(a));d=d||"";var f="",g=a.hasOwnProperty(Ib)&&a[Ib];g&&p(g,function(a,b){f&&(f+=" ");f+=a+'="'+be(b)+'"'});c=(b?b+":":"")+c;var g=d+"<"+c+(f?" "+f:""),h=a.hasOwnProperty(ob)&&a[ob];if(h)return g+">"+be(h)+"</"+c+">";a=Hg(a,b,d+"  ");return g+(a?">\n"+a+"\n"+d+"</"+c+">":"/>")}function Hg(a,b,c){xc(k(a)&&!ad.isArray(a));c=c||"";var d="";p(a,function(a,f){if("$"!=a[0]){var g;g=f;g=ad.isArray(g)?g:[g];for(var h=0;h<g.length;h++)if(f=g[h],d&&(d+="\n"),k(f))d+=ae(f,b,a,c);else{var U=
(b?b+":":"")+a;d+=c+"<"+U+">"+be(f)+"</"+U+">"}}});return d}function be(a){return w(a)?bi(a):b(a)?""+a:""}function Ce(a,b,d,f){function h(a,b){t("netflixid",l,l,a,function(a){if(a.c){var c=ub(a.Yc,"netflixiddata","netflixidpair");a=ha(c.netflixid);var c=ha(c.securenetflixid),d=/^[^=]*=([^;]*)/;b({c:!0,ea:a.match(d)[1],Ya:c.match(d)[1],fh:a,rh:c})}else b(a)})}function k(a,b,c){t("mdxpair",{targetuuid:a.Fy,controllerrequest:{cticket:a.so,pairdata:{nonce:a.Qq,controlleruuid:a.Uu},pairdatahmac:a.Px}},
l,b,function(a){if(a.c){a=a.Ur.mdxpairgrant;var b=a.controllererror,d=a.targetsharedsecret,f=a.grantdata,g,h;f&&(h={nonce:ta(f.nonce),controlleruuid:ha(f.controlleruuid),controlleruserid:ha(f.controlleruserid),controllersharedsecret:ha(f.controllersharedsecret),targetuuid:ha(f.targetuuid),targetuserid:ha(f.targetuserid)},g=ha(a.grantdatahmac));d&&(h=h||{},h.targetsharedsecret=ha(d.sharedsecret));c({c:!0,Ru:b&&{Su:ta(b.controllererrorcode)},Lv:h,Mv:g})}else c(a)})}function m(c,d,g,h,k,l,p){function n(){var b=
0;Oa={softwareversion:a.zs,sdkversion:f.bs,certificationversion:a.$n,preferredlanguages:{appselectedlanguages:{language:a.sk.map(function(a){return{index:b++,bcp47:a}})}},clientservertimes:{servertime:u(),clienttime:k}};a.Yk&&(Oa.uiversion=a.Yk);t()}function t(){var a='<?xml version="1.0" encoding="utf-8"?>\n<nccp:request xmlns:nccp="http://www.netflix.com/eds/nccp/'+aa+'">\n'+ae(Oa,"nccp","header")+"\n"+ae(w,"nccp",d)+"\n</nccp:request>";p({c:!0,ck:{Jd:l,We:d,url:c+"/"+aa+"/"+d,body:a,timeout:1E3*
b.Ve,$k:l.S,pf:h&&h.mslServiceTokens,cy:!ga[d],ik:!!ga[d],hj:!0}})}g=g||{};var aa=a.xj(d),w,Oa;q(g)?g(l,function(a){a.c?(w=a.dy,n()):p(a)}):(w=g,n())}function n(c,f,h,k,p){function q(a){w.trace("Sending NCCP request",{Method:c});d.send(a,function(a){if(a.c){w.trace("Received NCCP response",{Method:c});var b=a.body;Db={mslServiceTokens:a.pf};t(b)}else u(a)})}function t(a){zd(a,function(a){var d;if(a.c&&"response"==(d=a.object)[Wf]){a=d;var f,h;try{var U=a.responseheader.clientservertimes;f=ta(U.clienttime);
h=ta(U.servertime)}catch(k){w.error("Exception while checking clienttime in NCCP response",k)}if(Oa==f||Oa+1==f){b.wh=h-sb();var p;w.trace("Processing NCCP response",{Method:c});try{var q=a.result,m=q.status,n=a.parameters;b.kf=ta(n.retrycontrol);b.Ve=ta(n.mintimeout);b.Zg=ta(n.loginterval);b.ah=ta(n.maxlogsize);b.Te=ha(n.loglevel);var t=ha(n.playbackparameters.sendheartbeats);b.vh=/^true$/i.test(t);b.zd=ta(n.playbackparameters.heartbeatinterval);(b.gh||g)();if("true"!=m.success[ob]){var aa=m.error||
{},S=ta(aa.code),x=ta(aa.reasoncode,0),y=ta(aa.actionid),v=ha(aa.description),nd=aa.usertext,Ca=nd?ha(nd.text):l,Sb=nd?ha(nd.bcp47):l;w.warn("NCCP responded with error",{Method:c,ActionId:y,Code:S,Description:v});var rc=M.cm;8==y&&(rc=M.ki);p={dk:aa,Ic:y,g:rc,P:S,td:S,sg:x,C:v,Yo:Ca,tv:Sb}}else p={c:!0,Ur:q,Yc:q[c],Ia:Db}}catch(A){w.error("Exception while processing NCCP response",A),p={g:M.Ef,C:G(A)}}u(p)}else{h=a.result.status;var Za,bc;"true"!=h.success[ob]&&(Za=h.error||{},bc=ta(Za.code),Za=ha(Za.description));
u({g:f?M.Vl:M.Wl,P:bc,C:Za})}}else w.error("Unable to parse NCCP response as xml",{Method:c}),u({g:M.bm})})}function u(a){w.trace("Executed NCCP method",{Method:c,Success:!!a.c},a.c?l:Va(a));p=p||g;a.method=c;a.hc=S;p(a)}var w=k.log,Oa=sb(),S=Se(a.hc),Db;w.trace("Executing NCCP method",{Method:c});m(S,c,f,h,Oa,k,function(a){a.c?q(a.ck):u(a)})}function t(c,d,f,h,k){function l(){n(c,d,f,h,function(d){var f=d.Ic,g;if(!d.c){var m;if(id(d.g))switch(f){case 7:Da[d.hc]=!0;if(d.dk){var n=ha(d.dk.nccpendpoint);
g=function(a,b){p.info("ActionId redirect",{Method:c,From:d.hc,To:n});var f=Se(n);Da[f]?b({g:M.li,C:"Loop detected: "+d.hc+", "+f}):(Uf({nccpControllerUrl:f}),b(fa))}}break;case 2:m=!0}else Wd(d.g)?a.Vr&&(m=!0):qc(d.g)&&2==d.Jc&&(m=!0);if(!g)if(m)if(m=b.kf,q<m){q++;var t=Hb(q);p.warn("Method failed, retrying",{Method:c,Attempt:q,WaitTime:t,RetryControl:m},Va(d));g=function(a,b){Ka(function(){b(fa)},t)}}else p.error("Method failed, retry limit exceeded, giving up",{Method:c,Attempt:q,RetryControl:m},
Va(d));else p.error("Method failed, not retrying",{Method:c},Va(d))}if(g){var aa={Method:c,ActionId:""+f,MslCode:""+d.Jc};p.info("Handling failed method",aa);g(h,function(a){a.c?(p.info("Handle success, retrying method",aa),l()):(p.error("Handle error",aa,Va(a)),k(a))})}else k(d)})}var p=h.log,q=0;k=k||g;l()}function u(){return v(sb())}function v(a){return a+b.wh}function A(b,c,d){var f={},g={movieid:b.movieId,sessionstart:b.sessionStartEpoch};c?(g.heartbeattype=d,f={heartbeatdata:g}):(g.sessionend=
b.sessionEpoch,f={},b.isLicensed&&!a.zn||x(f,{appid:b.appId,sessionid:b.sessionId,trackid:b.trackingId,xid:b.xid},{Ye:!0}),f.sessiondata=g,b.securestop&&(f.securestop=b.securestop));(d=b.playback)?(c=d.playTimes,g.firstpts={pts:N(d.startPosition),timestamp:d.startEpoch},g.lastpts={pts:N(b.position),timestamp:b.sessionEpoch},b=g.playbacktime={total:N(c.total)},ie(b,"videostreamplaytimes",c.video),ie(b,"audiostreamplaytimes",c.audio),ie(b,"timedtextstreamplaytimes",c.timedtext)):b.errorDisplayCode?
g.error={}:(g.lastpts=g.firstpts={pts:N(b.position),timestamp:b.sessionEpoch},g.playbacktime={total:"0"});return f}function z(c,f,g,h){function k(c){d.Pn(c,function(c){if(c.c){var d=1E3*b.Ve;l({c:!0,Hp:{responseType:Wg,url:q+"/"+a.xj("playdata")+"/playdata",kh:c.body,withCredentials:!0,Pb:d,Kd:d,Cb:"nccp-playdata"}})}else l(c)})}function l(a){h&&(a.method="playdata",h(a))}var p=sb(),q=Se(a.hc);m(q,"playdata",c,g.playbackTokens,p,f,function(a){a.c?k(a.ck):l(a)})}function ie(a,b,c){c&&c.length&&(a[b]=
{streamplaytime:c.map(B)})}function B(a){return{downloadableid:a.downloadableId,playtime:N(a.duration)}}function Za(a,b){var c=[];p(b,function(a,b){var d=w(b)?b:ab.stringify(b);c.push({name:a,value:d})});if(c.length){var d={};d[a]=c;return d}}function Se(a){return"/"==a[a.length-1]?a.substr(0,a.length-1):a}function Hb(a){a=1E3*Vg(2,ea(a-1,b.kf));return J(1E3,a)}var va=0,ga=H(["license"]),Da={};x(this,{ping:function(a,b){t("ping",l,l,a,b)},ev:function(a,b){var c=x({},a);c.S=l;h(c,b)},ea:h,ay:function(a,
b,c,d){h(x({ea:b,Ya:c},a),d)},$x:function(a,b,c,d){h(x({fj:b,jr:c},a),d)},md:function(a,b,c){var d={movieid:a.ma,appid:a.Sf,sessionid:a.xh},f=Za("authparam",a.ge);f&&(d.authparams=f);d.contentprofiles={videoprofiles:{videoprofile:a.Qh},audioprofiles:{audioprofile:a.Vf},timedtextprofiles:{timedtextprofile:a.ad}};t("authorization",d,a.Ia,b,function(a){if(a.c){var b=a.Yc;c({c:!0,En:b.authorizationdata||b,Ia:a.Ia})}else c(a)})},Yg:function(a,b,c){var d=b.log,f;f=a.ao;var g=a.Fr,h;switch(a.ic){case "playready":h=
"soapresponse";f={drmtype:"PlayReady",pssh:g,soaprequest:f};break;case "widevine":h="widevineceflicense";f={drmtype:"WidevineCEF",pssh:g,widevinecefchallenge:f};break;case "fps":h="fpslicense";f={drmtype:"FPS",pssh:g,fpschallenge:f};break;default:c({g:M.Zl});return}var g={playbacktype:a.or},U=Za("sessionparam",a.Zc);U&&(g.sessionparams=U);x(g,{downloadableid:a.J,appid:a.Sf,sessionid:a.xh,trackid:a.za,xid:a.qa,drmdata:f});t("license",g,a.Ia,b,function(a){if(a.c){var b=ha(a.Yc.licensedata[h]);y(b)?
c({c:!0,gq:b,Ia:a.Ia}):(d.error("no license response"),c({g:M.$l}))}else c(a)})},bf:function(a,b,c){var d=A(a,!1);t("playdata",d,a.playbackTokens,b,c)},eg:function(a,b,c){var d=A(a,!1);z(d,b,a,c)},Pg:function(a,b,c,d){b=A(a,!0,b);t("heartbeat",b,a.playbackTokens,c,d)},pq:function(a,b,d){va++;for(var g=",esn="+f.lc+",snum="+va+",lnum=",h,U=0;U<a.length;U++){var k=a[U],k=v(k.fo)+" "+k.qj()+g+(U+1);h=h?h+("\n"+k):k}a=h?c(h):"";t("logblob",{sequencenumber:va,logdata:a},l,b,d)},Jw:k,Kw:function(a,b,c){var d=
{Zj:a.so,Cq:a.Sx,Bq:a.Qq,Aq:a.Tu,Dq:ic(a.by)};x(d,b);h(d,function(d){d.c?k(a,b,function(a){a.c?(a.ea=d.ea,a.Ya=d.Ya,a.fh=d.fh,a.rh=d.rh,c(a)):c(d)}):c(d)})},Ag:function(a,b){t("fpsappdata",l,l,a,function(a){if(a.c){var c=a.Yc;a=ha(c.appcert);c=ta(c.expiration);b({c:!0,me:a,Zo:c})}else b(a)})},wd:u,po:v})}function uf(a,b,c){var d;return d={S:a,Kc:!0,qh:!1,Pe:X(),load:function(a){(a||g)(fa)},save:function(){d.Kc=!0},remove:function(a){d.Kc=!1;(a||g)(fa)},de:z.Ib.sk,Pc:function(){var a=Aa();return{ea:a[b],
Ya:a[c]}},Ik:function(a,d){(new RegExp("^"+b+"=.*")).test(a);(new RegExp("^"+c+"=.*")).test(d);eb.cookie=a;eb.cookie=d;Aa()[b]!=a.match(/[^=]*=([^;]*)/)[1]||"s"==He.href[5]&&(Aa(),d.match(/[^=]*=([^;]*)/))},co:function(){var a="=;Expires=Thu, 01 Jan 1970 00:00:00 GMT";eb.cookie=b+a;eb.cookie=c+a;a+=";Domain=.netflix.com;Path=/";eb.cookie=b+a;eb.cookie=c+a+";Secure";Aa()[b]||Aa()},Qj:!0}}function De(a){if(a=Xf[a])return Ue=a;throw new La("invalid accountKey");}function vf(a,b){var c=vi[a];c||(vi[a]=
c=rb(function(b){var c=Xf[a];c?b({c:!0,dc:c}):(c=new ce(a),Xf[a]=c,c.load(function(a){a.c?b({c:!0,dc:c}):b(a)}))}));c(b)}function ce(a){this.S=a}function Mc(a){var b={},c=X(),d={};a.forEach(function(a){var b=a.url;d[b]||(d[b]=[]);d[b].push(a)});var f=[];p(d,function(a,b){f.push(xf(b,c))});b.urls=ab.stringify(f);return b}function xf(a,b){var c=a[0],d={url:c.url,bitrate:c.f,cdnid:c.i&&c.i.id,dltype:c.Eo,id:c.J},f={};a.forEach(function(a){var b=a.c||a.c===l||a.g===M.Za||a.g===M.cd?"success":"fail";f[b]||
(f[b]=[]);f[b].push(a)});p(f,function(a,c){"fail"===a?d.failures=Af(c):"success"===a&&(d.downloads=wf(c,b))});return d}function wf(a,b){var c={};a.forEach(function(a){var b=a.ho;c[b]||(c[b]=[]);c[b].push(a)});var d=[];p(c,function(a,c){var f=[];c.forEach(function(a){f.push(a);(a=a.g===M.Za||a.g===M.cd?!0:void 0)&&(d.push(yf(f,b)),f=[])});0<f.length&&d.push(yf(f,b))});return d}function yf(a,b){var c=a[0],d=a[a.length-1],f=c.D,g=zf(a),c={time:f.requestTime,tresp:(f.O||b)-(f.requestTime||b),first:g,
ranges:Fe(a,g),dur:(d.D.M||b)-(c.D.O||b),trace:Hd(a,b),status:d.c?"complete":d.c===l?"open":d.g===M.Za?"abort":d.g===M.cd?"stall":"other"};z.re.length&&(c.servertcp=Gd(a));return c}function Gd(a){var b=z.re;return a.reduce(function(a,c){var d=[];if(c.Rk){var f={};c.Rk.split(";").forEach(function(a){a=a.split("=");2==a.length&&(f[a[0]]=a[1])});b.forEach(function(a){d.push(f[a])})}a.push(d);return a},[])}function zf(a){var b=0;a.forEach(function(a){a.Kb&&(b=ea(b,a.Kb[0]))});return b}function Fe(a,b){var c=
[];a.forEach(function(a){a.Kb?c.push([a.Kb[0]-b,a.Kb[1]-b]):c.push([0,-1])});return c}function Hd(a,b){var c=[],d;a.forEach(function(a){a=a.D;d&&(c.push([a.requestTime-d.M,-2]),c.push([(a.O||b)-a.requestTime,-3]));c.push([(a.M||b)-(a.O||b),a.X||0]);d=a});return c}function Af(a){var b=[];a.forEach(function(a){var c=a.D;b.push({time:c.requestTime,tresp:c.O-c.requestTime,dur:c.M-c.O,range:a.Kb||[0,-1],reason:a.Ca||a.g===M.bd?"http":a.g===M.Bf?"timeout":"network",httpcode:a.Ca,nwerr:fe(a.g)})});return b}
function Ee(a){var b=a.L,c=b.stream,d=b.track,f=b.url,g=Cf(d,f),h=l;switch(g){case hb:case Ra:h=b.stream.J;break;case Yg:case wi:h=d.J}c={f:c&&c.f,Eo:g,J:h,D:a.D,i:b.i,url:f};b.offset!==l&&b.length!=l&&(c.Kb=[b.offset,b.offset+b.length-1]);return a.Fo=c}function Bf(a){var b=a.Fo;b&&(b.P=a.P,b.Ca=a.Ca,b.g=a.g,b.c=a.c,b.Rk=a.headers&&a.headers["X-TCP-Info"],b.ho=Ie(a))}function Cf(a,b){if(a)return a.type;if(0<=b.indexOf("netflix.com")){if(0<=b.indexOf("nccp"))return"nccp";if(0<=b.indexOf("api"))return"api"}return"other"}
function Ie(a){if(a.headers&&(a=a.headers["X-Session-Info"]))return a=(a?a.split(";"):[]).filter(function(a){return 0==a.indexOf("port=")}).map(function(a){return a.split("=")[1]})[0],E(a)}function Ff(a,b){function c(a,f,g){for(var h,U,k,l,p,q=[];g;)k=a==Ra?g.videoprofile[ob]:g.audioprofile[ob],h=ta(g.bitrate),U=d(g.downloadurls.downloadurl,!0),h=new Nf(b,f,a,ha(g.downloadableid),h,ta(g.size),U,k),g.resolution&&(U=ta(g.resolution.width),k=ta(g.resolution.height),g.pixelaspect&&(l=ta(g.pixelaspect.width),
p=ta(g.pixelaspect.height),l>p?U=U*l/p:k=k*p/l),0<U&&0<k&&(h.width=ja(U),h.height=ja(k))),a==Ra&&(h.Sj=!!g.superhd,h.Xg=h.Sj||!!g.hd,U=ub(g,"hdcpversions","version"),h.xk=!(!U||"none"==ha(U))),h.xk&&"never"==z.Un||q.push(h),g=g[xb];q.sort(function(a,b){return a.f-b.f});x(q,le);a=Rb(a,z.Os,z.Ps);if(Ve&&Ve.length)var m=q.Ud(a),q=Ve.call(q,function(a){return 0<=m.indexOf(a.f)});q.sort(function(a,b){return a.f-b.f});x(q,le);return q}function d(a,b){for(var c={},f;a;)c[a.cdnid[ob]]=a.url[ob],b&&(f=ta(a.expiration),
0<f&&(m=m?ea(m,f):f)),a=a[xb];return c}var f=new b.log.r("NccpParseAuth"),g,h,k,p,q,m,n=[],t,u;for(k=ub(a,"locations","location");k;){if(t=ha(k.locationid))u={id:t,Wa:ta(k.rank),dq:ta(k.level),weight:ta(k.weight)},n.push(u);k=k[xb]}var w=z.Xn,y=z.Wn,v=[],A=[];for(k=ub(a,"cdns","cdn");k;)t=ta(k.cdnid),n.some(function(a){if(a.id===ha(k.locationid,""))return u=a,!0}),u||(u={id:t,Wa:ta(k.rank),dq:1,weight:ta(k.weight)}),(!w.length||0<=w.indexOf(t))&&0>y.indexOf(t)&&(k.lowgrade?A:v).push({id:t,location:u,
type:ha(k.type,"unknown"),Wa:ta(k.rank),name:k.name[ob],Rp:!!k.exclusive}),k=k[xb];v.sort(function(a,b){return a.Wa-b.Wa});n.forEach(function(a){var b=v.filter(function(b){return b.location.id===a.id});a.I=b});n.sort(function(a,b){return a.Wa-b.Wa});f.trace("Parsed cdns",{Count:v.length,LowGradeCount:A.length});if(!v.length)throw new La("no valid cdns");t=[];for(k=ub(a,"trickplay");k;){for(;k;)w=k.resolution,y=k.pixelaspect,w=new Gj(b,ha(k.trickplayid),ta(w.height),ta(w.width),ta(y.height),ta(y.width),
ta(k.size),d(k.downloadurls.downloadurl,!1)),t.push(w),k=k[xb];t.sort(function(a,b){return a.size-b.size})}w=[null];y={none:null};k=ub(a,"timedtexttracks","timedtexttrack");for(var va;k;){va=[];for(A=k.timedtextdownloadables.timedtextdownloadable;A;)va.push(A),A=A[xb];va.sort(function(a,b){return Je(a)-Je(b)});A=va[0];g=ha(k.timedtexttrackid);q=ha(k.timedtexttype);va=ha(A.timedtextprofile);p={};if("nflx-cmisc"==va){var ga=ub(A,"imagebasedtext");p.offset=ha(ga.masterindexoffset)|0;p.length=ha(ga.masterindexsize)|
0;ga=ub(ga,"resolution");p.gy={width:ha(ga.width),height:ha(ga.height)}}p=new Th(b,g,ha(A.downloadableid),d(A.downloadurls.downloadurl,!1),ha(k.language.bcp47),ha(k.language.displayname.text),xi[q]||We,q,va,p);w.push(p);y[g]=p;f.trace("Parsed timed text track",p);k=k[xb]}w.sort(Id);A=[];va={};for(ga=ub(a,"audiogroups","audiogroup");ga;){q=ga.audiotype.audiotypeid[ob];if(0==z.Pk.length||0<=z.Pk.indexOf(q))for(k=ga.audiotracks.audiotrack;k;){g=k.audiotrackid[ob];p={type:hb,ka:g,Xk:xi[q]||We,Oq:q,bb:ha(k.language.bcp47),
displayName:ha(k.language.displayname.text),isNative:!!k.isnative,Qi:ha(k.channels)};p.oa=c("audio",p,k.audiodownloadables.audiodownloadable);var Da=w,ra=[];if(k.disallowedtimedtexttracks){h={};for(var Tb=k.disallowedtimedtexttracks.timedtexttrackid;Tb;)h[Tb[ob]]=!0,ra.push(Tb[ob]),Tb=Tb[xb];Da=Da.filter(function(a){return!(a?h[a.ka]:h.none)})}p.gv=ra;p.Ma=Da;p.Ga={Bcp47:p.bb,TrackId:p.ka};f.trace("Parsed audio track",p,{StreamCount:p.oa.length,AllowedTimedTextTracks:p.Ma.length});p.oa.length?(va[g]=
p,A.push(p)):f.warn("Audio track has no streams",p);k=k[xb]}ga=ga[xb]}if(!A.length)throw new La("no valid audio tracks");A.sort(Id);g=[];for(k=ub(a,"videotracks","videotrack");k;)p={type:Ra},p.oa=c("video",p,k.videodownloadables.videodownloadable),f.trace("Parsed video track",{StreamCount:p.oa.length}),p.oa.length?g.push(p):f.warn("Video track has no streams"),k=k[xb];if(!g.length)throw new La("no valid video tracks");q=[];for(k=ub(a,"preferredtrackcombinations","preferredtrackcombination")||ub(a,
"defaulttrackcombinations","defaulttrackcombination");k;)p=ha(k.audiotrackid),Da=va[p],ga=ha(k.timedtexttrackid),ra=y[ga],Da&&0<=Da.Ma.indexOf(ra)?q.push({W:Da,$:ra,qk:ta(k.preferenceorder)}):f.warn("Invalid default track combination",{AudioTrackId:p,TimedTextTrackId:ga}),k=k[xb];q.sort(function(a,b){return a.qk-b.qk});p=q[0]||{};y=g[0];va=p.W||A[0];p=p.$||va.Ma[0];var Ca;(k=a.bookmark)&&(Ca={time:1E3*ta(k)});f.trace("Parsed bookmark",{Value:Ca?Ca.time:"None"});var B;(k=a.runtime)&&(B=1E3*ta(k));
B||(B=va.oa[0],ga=y.oa[0],B=pd(qa(8192*B.size/(1E3*B.f),8192*ga.size/(1E3*ga.f))),f.trace("Estimating runtime",{EstimatedRuntime:Ea(B)}));var D;(k=a.clientipaddr)&&(D=ha(k));f.trace("Parsed client IP address",{IP:D});b.I=v;b.Yn=n;b.Ab=A;b.Rh=g;b.ob===l&&(b.ob=Ca?Ca.time:0);b.Ma=w;b.$b=t;b.mj=B;b.Ek=D;b.vr=q;b.bc.set(y);b.W.set(va);b.$.set(p);n=1E3*(m-yb.wd());1E4<n?b.ld=X()+n:f.error("Invalid url expiration, ignoring")}function Je(a){var b=ha(a.timedtextprofile),c=z.ad.indexOf(b);return 0<z.Tk&&"dfxp-ls-sdh"===
b&&ta(a.size)>z.Tk?z.ad.length+1:0<=c?c:z.ad.length}function Id(a,b){if(!a)return-1;if(!b)return 1;var c=a.displayName,d=b.displayName;return c?d?c.localeCompare?c.localeCompare(d):c.charCodeAt(0)-d.charCodeAt(0):1:-1}function Wc(a){function d(){var c={accountKey:l,playbackTokens:q,isLicensed:!!m,appId:Za,sessionId:B,trackingId:a.za,xid:a.qa,movieId:a.ma,sessionStartEpoch:yb.po(a.Wj),sessionEpoch:yb.wd()};b(a.v.value)&&(c.position=a.v.value);n&&(c.playback={startPosition:u,startEpoch:w,playTimes:a.Md.yp()});
A&&z.Sd&&(c.keySessionId=A);var f=a.Da;f&&y(f.qd)&&(c.errorDisplayCode=f.qd);return c}function f(){f=g;Xc(a,p,k);a.fireEvent(yi)}function h(){h=g;a.fireEvent(Yf)}var k=new a.log.r("NccpPlayback"),l=a.dc.S,p={Ug:a.ua,log:new a.log.r("Nccp"),S:l},q,m,n,u,w,x,v,A,Za=z.Mq||me,B=z.Nq||me;a.addEventListener(Hc,function(){n=!0;u=a.v.value;w=yb.wd()});a.addEventListener(zi,function(a){A=a.Ne});return{Jd:p,md:function(b){var c=X();yb.md({Sf:Za,xh:B,Zc:a.Nd.Zc,ge:a.Nd.ge,ma:a.ma,za:a.za,Qh:z.Qh,Vf:z.Vf,ad:z.ad},
p,function(d){x=X()-c;if(d.c)try{q=d.Ia,Ff(d.En,a),b(fa),h()}catch(f){k.error("Exception processing authorization response",f),b({g:M.Ef})}else b(d)})},Yg:function(b,d){var g=X(),h=c(b.Er),l=c(b.data),n=q,u=a.Nd.Zc;if(z.Wb){var ma=b.hq;t(z.Vj)&&(ma=z.Vj);n=F(n);u=F(u);ma&&(u.limitedDuration=ma);n.mslServiceTokens=q.mslServiceTokens.filter(function(a){return a.name.match("movie")})}yb.Yg({Ia:n,Sf:Za,xh:B,Zc:u,qa:a.qa,J:a.U.J,za:a.za,or:"standard",ic:b.ic,Fr:h,ao:l},p,function(a){v=X()-g;if(a.c)try{q=
a.Ia,m=!0,d({c:!0,fq:{data:ic(a.gq)}}),f()}catch(b){k.error("Exception processing license response",b),d({g:M.Ef})}else d(a)})},Pg:function(a,b){yb.Pg(d(),a,p,function(a){a.c&&a.Ia&&(q=a.Ia);b&&b(a)})},bf:function(a,b){yb.bf(a,p,function(a){a.c&&a.Ia&&(q=a.Ia);b&&b(a)})},eg:function(a,b){yb.eg(a,p,b)},Ui:d,Ag:function(a){yb.Ag(p,a)},hp:function(){return x},vp:function(){return v}}}function Xc(a,b,c){Xc=g;if(yb.ea&&z.et){var d=a.dc;a=d.Pc().ea;a=pa(a);var f=z.Pq;if("usr"==a||y(Vf)&&Jb.lc!=Vf||y(f)&&
Jb.ij!=f)c.info("Upgrading NetflixId",{bt:a,prefix:f,downloadedEsn:Vf}),yb.ea(b,function(a){a.c?(c.trace("Setting upgraded NetflixId"),d.Ik(a.fh,a.rh),v(Pg(d.Pc().ea))):c.error("NetflixId upgrade failed",Va(a))})}}function gc(a,b,c,d){d=d||{};z.Fe&&(d.groupname=z.Fe);var f=sb();c={type:b,sev:c,devmod:Zg};Ai&&(c.nettype=Ai);x(c,d);x(c,{jssid:me,jsoffms:X(),client_utc:f,lver:vk||"2012.2-CAD"});a?x(c,{xid:a.qa,soffms:a.Ub(),mid:a.ma,lvpi:a.Uc}):c.xid=Bi;this.data=c;this.type=b;this.fo=f}function Gf(a){function c(d){var f=
{browserua:ac,browserhref:He.href,playdelay:L(a.Ub()),trackid:a.za,connection_type:"parallel"===z.dg?"multi":"single",bookmark:L(a.ob||0),pbnum:a.index,endianness:wa()};a.oo&&(f.controllerESN=a.oo);b(a.nd)&&(f.bookmarkact=L(a.nd));b(a.nd)&&(f.bookmarkact=L(a.nd));var g=B.hp();g&&(f.nccpat=g);(g=B.vp())&&(f.nccplt=g);(g=q())&&(f.downloadables=g);Jb&&t(Jb.jj)&&(f.esnSource=Jb.jj);Dc&&x(f,Dc,{prefix:"pi_"});f.usejsase=z.pa;if(a.state.value>=Sa)try{var h=a.Aa();if(h){var k=Of(h);C=R(k);f.maxbitrate=C}}catch(l){A.error("Exception computing max bitrate",
l)}try{var p=/wwwplayer.*js|coreplayer.*js/,m=Od.getEntries("resource").filter(function(a){return null!==p.exec(a.name)});if(m){var n=Ya(m[0].duration);f.pdltime=ab.stringify(n)}}catch(u){}try{x(f,a.dh,{prefix:"sm_"}),x(f,a.Ng(),{prefix:"vd_"})}catch(aa){}v("startplay",d,Ub|Zf|zb|$f|Xe|$g|ah,f)}function d(){v("playbackaborted",!1,Ub|zb,{waittime:L(a.Ub()),abortedevent:"startplay"})}function f(){if(a.I){var b;(b=Za%z.og?W.filter(function(a){return a.sg}):W)&&0<b.length&&(W=W.filter(function(a){return!a.D.M}),
b=Mc(b),z.re.length&&(b.tcpinfo=z.re.join(",")),v("dlreport",!1,zb,b))}}function h(b){var c=b.L,d=c.track;if(d){var f=!b.c&&b.g!=M.Za,g=d.type,k=b.D;if(f||a.Uc){k={dltype:g,url1:c.url,url2:b.url||"",cdnid:c.i.id,tresp:L(k.O-k.requestTime),brecv:T(k.X),trecv:L(k.M-k.O)};b.Kb&&(k.range=b.Kb);switch(g){case hb:k.adlid=c.stream.J;break;case Ra:k.vdlid=c.stream.J;break;case Yg:k.ttdlid=d.J}(c=fe(b.g))&&(k.nwerr=c);b.Ca&&(k.httperr=b.Ca);v("dlreq",f,zb,k)}}}function k(){try{var b=Od.timing.navigationStart-
(bd+(a.Tc||X())),c=Od.getEntries("resource"),d=c.length-z.aj;0<d&&(c=c.slice(d));var f=c.map(function(a){return{u:a.name,s:Ya(a.startTime+b),d:Ya(a.duration)}}),g={dlinfos:ab.stringify(f)};v("dlprestart",!1,Ub|zb,g)}catch(h){}}function p(){if(a.state.value==Sa){var b=n();b.midplayseq=ca++;var c=a.A.value;b.prstate=c==Ic?"playing":c==Ye?"paused":c==tc?"ended":"waiting";v("midplay",!1,Ub|zb|Xe|$f,b)}}function q(){if(a.Rh&&a.Ab){var b=[];a.Rh.concat(a.Ab).forEach(function(a){a.oa.forEach(function(a){b.push({dlid:a.J,
type:a.type,bitrate:a.f})})});return ab.stringify(b)}}function m(){function b(a,c){var g=a.cdnId,h=f[g];h||(h={cdnid:g,dls:[]},f[g]=h,d.push(h));g={bitrate:a.bitrate,tm:L(a.duration)};g[c]=a.downloadableId;h.dls.push(g)}var c=a.Md.gp(),d=[],f={};c.audio.forEach(function(a){b(a,"adlid")});c.video.forEach(function(a){b(a,"dlid")});return ab.stringify(d)}function n(){var c=a.Md,d={totaltime:N(c.Cj()),cdndldist:m(),reposcount:Pa,intrplaycount:E};try{var f={numskip:0,numlowqual:0},g=a.ha,h;h=g.Ce();b(h)&&
(d.totfr=h,f.numren=h);h=g.Oc();b(h)&&(d.totdfr=h,f.numrendrop=h);h=g.Ae();b(h)&&(d.totcfr=h,f.numrenerr=h);h=g.De();b(h)&&(d.totfdl=h);d.playqualvideo=ab.stringify(f);d.videofr=a.k.value.j.Bg.toFixed(3);d.abrdel=c.ip();var k=c.jp();k&&x(d,k);d.rbfrs=E;d.maxbitrate=C;var l=a.xa(),p,q,t,u;for(u=0;u<l.length;u++){p=l[u];if(t=a.Ue.sc(p)){d.maxbitrate=q?q.f:0;d.bitratefilters=t.join("|");break}q=p}if(a&&a.nb&&a.Ni&&a.aa){var aa=a.Ni,w={ab:ja(aa.Di),actual60:a.aa.Bj(),b20:ja(aa.Fi),b50:ja(aa.Gi),b90:ja(aa.Hi),
std:ja(aa.As),ns:aa.Us,ss:aa.lf,filt:aa.filter};d.expectedbw=ab.stringify(w)}a.xb&&(d.trickplay=a.xb.Aj());null!==a.Zb.he&&(d.avg_subt_delay=a.Zb.he)}catch(ma){A.error("Exception reading some of the endplay fields",ma)}x(d,a.Ng(),{prefix:"vd_"});return d}function u(a,b){a.browserua=ac;v("securestop",!a.success,Ub|Xe,a);b||(v=g)}function w(){var b,c=[];z.Eq&&(dc.addListener(bh,p),z.Fq.forEach(function(a){c.push(Ka(p,a))}),z.$j&&(b=cb(y,z.$j)),a.addEventListener(ib,function(){dc.removeListener(bh,p);
c.forEach(function(a){bb(a)});b&&gb(b)}))}function y(){dd.flush(!0)}function v(b,c,d,f,g){Hf(f,a,c,d);b=new gc(a,b,g||(c?"error":"info"),f);dd.tk(b)}var A=new a.log.r("NccpLogging"),Za=a.qa,B=a.ib,Hb,va=a.paused.value,ga,Da,ra,Tb,Ca,D,F=[],Pa=0,E=0,ca=0,G=0,W=[],H,C,J,Ec;(function(){function b(c){Ca="rebuffer";v("intrplay",!1,Ub|zb,{vdlid:a.k.value.J,cdnid:a.i.value.id,playingms:F[Ic]||0,pausedms:F[Ye]||0,cause:c.Ac,intrplayseq:E++});ga=X();Z(p)}function p(){if(ga&&a.A.value!=Ab){var b=X()-ga;v("resumeplay",
!1,Ub|Zf|zb,{playdelay:L(b),reason:Ca,intrplayseq:E-1});Da&&Da!=a.W.value&&v("audioswitch",!1,Ub|zb,{switchdelay:L(X()-ra),newtrackinfo:a.W.value.ka,oldtrackinfo:Da.ka});Ca=ga=l}}function q(){a.Fc.value&&a.Ra.value&&(a.Fc.removeListener(q),a.Ra.removeListener(q),k())}a.addEventListener(ke,h,1);z.og&&(a.addEventListener(Te,function(a){W.push(Ee(a))}),a.addEventListener(ke,Bf),G=cb(f,z.Go));a.paused.addListener(function(a){var b=a.newValue;a.ax&&b||b==va||(v("statechanged",!1,Ub|zb,{newstate:b?"Paused":
"Playing",oldstate:va?"Paused":"Playing"}),va=b)});a.addEventListener(Ze,b);a.addEventListener(wk,b);a.A.addListener(function(a){a=a.oldValue;var b=X();a==Ab?F=[]:F[a]=(F[a]||0)+(b-D);D=b});a.addEventListener(Pd,function(a){switch(a.Ac){case Ci:case Di:if(Ca&&ga){var b=X()-ga;v("playbackaborted",!1,Ub|zb,{waittime:L(b),abortedevent:"resumeplay",resumeplayreason:Ca})}else Hb||d();Ca="repos";v("repos",!1,Ub|zb,{moffold:N(a.hh),reposseq:Pa++});ga=X();Z(p)}});a.A.addListener(p);a.W.addListener(function(a){ra=
X();Da=a.oldValue});a.addEventListener(Hc,function(){Hb=!0;c(!1);w();z.Oj&&(H=Ka(function(){dd&&dd.flush(!1);H=l},z.Oj))});a.addEventListener(ib,function(){H&&bb(H);if(Hb){z.og&&(G&&gb(G),f());var b=!!a.Da,h=n();h.browserua=ac;h.usejsase=z.pa;a.xb&&"downloaded"===a.xb.Aj()&&(h.trickplay_ms=a.Wd.offset,h.trickplay_res=a.Wd.yk);h.endreason=b?"error":a.A.value==tc?"ended":"stopped";Dc&&x(h,Dc,{prefix:"pi_"});var k=a.Da,l,p;if(p=b&&k)k=k.errorCode,p=k==O.Ff||k==O.Cf;p&&(l="info");v("endplay",b,Ub|Zf|
zb|Xe|$f|ah,h,l)}else a.Da?c(!0):d();Ec||(v=g)});a.je&&a.je.addListener(function(a){v("bitraterestriction",!1,Ub|zb,a.newValue)});a.k.addListener(function(b){if(b.oldValue&&b.Ri){var c=b.oldValue,d=b.newValue,f=b.Ri;b=z.pa?a.rf:a.aa.le();c={moff:N(f),vbitrate:d.f,vbitrateold:c.f,vdlid:d.J,vdlidold:c.J,lbw:b};(d=a.Ra.value)?(b=Rc(d.dj),c.bw=ja(896E3/(b.Fd+896E3/b.rf)*7.8125)):c.bw=b;v("chgstrm",!1,zb,c)}});var m;a.ub.addListener(function(a){if(a.newValue){var b=a.newValue.stream;m!=b&&(m&&v("renderstrmswitch",
!1,zb,{moff:N(a.newValue.G.startTime),vbitrate:b.f,vdlidold:m.J,vdlid:b.J,vbitrateold:m.f}),m=b)}});a.i.addListener(function(b){if((b=b.newValue)&&Tb!=b){var c=Tb,d=a.Ra&&a.Ra.value&&a.Ra.value.dj,f=b.id,g={selcdnid:f};if(d){var h=Rc(d),d=h.Fd,h=ja(896E3/(h.Fd+896E3/h.rf)*7.8125);g.selcdnrtt=d;g.selcdnbw=h;g.cdnbwdata=ab.stringify([{id:f,rtt:d,bw:h}])}c&&(g.oldcdnid=c.id);x(g,b.fc);v("cdnsel",!1,$g,g);Tb=b}});z.aj&&(a.Fc.addListener(q),a.Ra.addListener(q));z.Sd&&a.state.addListener(function(){a.state.value==
Sa&&(J=a.rc,J.addEventListener(Ei,function(){Ec=!0;J.Yd().then(u)}))})})();this.gs=u}function fe(a){switch(a){case M.bd:return"http";case M.Bf:return"connectiontimeout";case M.cd:return"readtimeout";case M.Af:return"corruptcontent";case M.Za:return"abort";case M.Wh:case M.Xh:return"unknown"}}function Hf(a,b,c,d){d&Ub&&0<=b.v.value&&(a.moff=N(b.v.value));if(d&Zf){var f=b.i.value,g=b.Yb.value||b.Fc.value,h=b.ub.value||b.Ra.value;f&&(a.cdnid=f.id,a.cdnname=f.name);g&&(a.adlid=g.stream.J,a.abitrate=g.stream.f);
h&&(a.vdlid=h.stream.J,a.vbitrate=h.stream.f)}d&zb&&((f=b.n)&&0<=b.v.value&&(a.abuflmsec=L(f.qb()),a.vbuflmsec=L(f.Fa()),a.abuflbytes=T(f.pj()),a.vbuflbytes=T(f.Dj())),(f=b.R&&b.R.Fg&&b.R.Fg())&&(a.curdlstatename=f));if(d&$f){Le(a);try{var k=b.Xa.getBoundingClientRect();a.rendersize=k.width+"x"+k.height;a.renderpos=k.left+"x"+k.top}catch(l){}}d&Xe&&(k=Gb.hardwareConcurrency,0<=k&&(a.numcores=k),0<=b.ne&&(a.cpuspeed=b.ne),(k=b.sd&&b.sd.kp())&&(a.droppedFrames=ab.stringify(k)),k=b.sd&&b.sd.xp(z.No),
p(k,function(b,c){a["droppedFramesP"+b]=ab.stringify(c)}));if(d&$g)try{a.pricdnid=b.Od.id,a.cdninfo=ab.stringify(b.I.map(function(a){return{id:a.id,nm:a.name,rk:a.Wa,wt:a.location.weight}}))}catch(q){}c&&d&ah&&((b=b.Da)?Ke(a,b):a.errorcode=O.cc)}function Ke(a,b){a.errorcode=Tf+(b.errorCode||O.cc);b.g&&(a.errorsubcode=b.g);b.P&&(a.errorextcode=b.P);b.C&&(a.errordetails=b.C);b.Ca&&(a.httperr=b.Ca);b.td&&(a.nccperr=b.td);var c=fe(b.g);c&&(a.nwerr=c)}function Le(a){a.screensize=Ef.width+"x"+Ef.height;
a.screenavailsize=Ef.availWidth+"x"+Ef.availHeight;a.clientsize=m.innerWidth+"x"+m.innerHeight}function If(a){function b(){return pb.vh&&a.state.value==Sa&&B&&!v&&(0<pb.zd||t!=qd)}function c(a,d){var g=a||qd;g!=qd&&(t=g);b()&&(g=t!=qd?z.Qg:qa(z.Qg,1E3*pb.zd),g=qa(g-(X()-u),d||0),!d&&(!u||500>=g||w==qd&&t!=qd)?h():f(g))}function d(){x&&(bb(x),x=l)}function f(a){d();x=Ka(c,a)}function h(){if(b()){d();v=!0;var f=t;t=qd;a.ib.Pg(f,function(b){b.c||n.error("Heartbeat failed",{Type:f},Va(b));w=f;u=X();v=
!1;11==b.Ic?a.Pa(new mb(O.Yl,b)):c()})}}function k(){if(B){var b=a.ib.Ui();p(b);z.pr&&(ga=b,a.ib.eg(b,function(a){ga==b&&(va=a.c?a.Hp:l)}))}}function p(a,b){0<z.jh&&z.Wc?Wa.save(z.Wc,ab.stringify(a),!1,b):b&&b(fa)}function q(b){Jd(a,function(a){a.c&&(Kd(),k());b&&b(a)})}function m(){if(va){var b=z.Ib.Cr,c;try{if(y(b)){var d=va.url.match(/^[a-z]*:\/\/[^\/]*(.*)$/i)[1],b=b.replace(/^\//,"").replace(/\/$/,"").replace(/\/controller$/i,"").replace(/\/nccp$/i,"");c="/"+b+d}}catch(f){}c&&(n.info("Sending last playdata synchronously",
{Url:c}),va.url=c,b=rf(va),b.c&&/result[\s\S]*status[\s\S]*success[\s\S]*true[\s\S]*success[\s\S]*status[\s\S]*result/i.test(b.content))?Kd():(n.info("Sending last playdata asynchronously"),a.ua.N(va,g),k())}}var n=new a.log.r("PlayDataManager"),t=qd,u=0,w,x,v,A,B,va,ga;a.addEventListener(Yf,function(){ne&&q()});a.addEventListener(yi,function(){B=!0;0<z.jh&&(A=cb(k,z.jh));k()});a.addEventListener(ib,function(){function b(){c&&f&&h&&(b=g,a.Sq())}Xa.removeListener(uc,m);d();A&&(gb(A),A=l);var c,f,h,
k;if(B){a.cl();var q=a.ib.Ui();p(q,function(){function d(){a.ib.bf(q,function(d){d.c?Kd(function(b){b=b.c?d:b;k&&a.rc.Oh(b)}):(n.error("Unable to send playdata"),k&&a.rc.Oh(d));c=!0;b()})}z.Sd?(a.rc.Yd().then(function(){h=!0;b()}),a.rc.bl().then(function(a){a.c?(q.securestop=a.data,k=!0):h=!0;d()})):(h=!0,d())})}else h=c=!0;dd?(a.cl(),dd.flush(!1,function(a){a.c||n.error("Unable to send logblob");f=!0;b()})):f=!0});a.addEventListener(Pd,k);a.addEventListener(Hc,function(){a.A.addListener(function(){c(a.A.value==
Ic?xk:yk,a.A.value==tc?500:0)});b()&&f(qa(z.Qg,1E3*pb.zd));k()},1);Xa.addListener(uc,m);return{ps:function(b){ch?ch.then(function(){b(fa)}):ne&&ne.movieId==a.ma?q(b):b(fa)}}}function Jd(a,b){b=b||g;var c=ne;if(c){var d=c.accountKey;ne=null;if(d){var f;ch=new Nd(function(a){f=a});vf(d,function(g){var h=g.dc;if(g.c&&h){g=function(g){k=a?F(a.ib.Jd):{Ug:cd,log:new na.r("Nccp")};k.S=d;k.log.info("Sending persisted playdata",{PersistedXid:c.xid,SessionEpoch:c.sessionEpoch,MediaTime:c.position});g&&(c.securestop=
g.data);yb.bf(c,k,function(a){g?g.c&&(na.info("SecureStop Ack For Persisted Playback "),p.Oh(a)):(f(),b(a))})};var k,h=c.keySessionId,l=c.xid;if(a&&z.Ak)if(h){var p=new Vh(a,h);p.Rc();p.bl().then(g);p.Yd().then(function(c){f();b(fa);c.persisted=!0;c.previousXid=l;a.ek.gs(c,!0)})}else na.error("SSManager: prev keysession not available",{ErrorCode:O.Jm}),g();else g()}else f(),b(fa)})}else b(fa)}else b(fa)}function Kd(a){Wa&&z&&z.Wc&&Wa.remove(z.Wc,function(b){b.c||na.error("Error deleting playdata",
b);a&&a(b)})}function Me(a,b,c,d){this.V=a;this.jf=b;this.uf=c;this.tf=d;this.totalTime=this.jf+this.uf}function Jf(a){function b(){var a=1E3*ja(bd/1E3),c=w.uj(),d=w.vj(),f=w.ud(),g=w.Mg(),h=w.xd();c&&h&&(a=new Me(a+d,f,g,h),u&&(c in y||(y[c]=[]),y[c].push(a)))}function c(){u in A||(A[u]={});var a=A[u],b=0;p(y,function(c,d){var g;g=c in a?a[c]:[];for(var h=f(d,z.Sg),k=h.length;k--;)h[k].V>B&&g.push(h[k]),b<h[k].V&&(b=h[k].V);a[c]=g;B=b})}function d(){v||(v=!0);for(var a in y)y[a]=f(y[a],z.Sg);q()}
function f(a,b){var c=[],d=[],h=1E3*b,k;if(0<a.length){for(var l=a[0].V,U=0;U<a.length;U++)k=a[U],lc(l-k.V)<=h?d.push(k):(c.push(g(d)),l=k.V,d=[k]);0<d.length&&c.push(g(d))}return c}function g(a){for(var b=0,c=0,d=0,f=a.length,h=0;h<f;h++)b+=a[h].jf,c+=a[h].uf,d+=a[h].tf;return new Me(a[0].V,b,c,d)}function h(){if(k()>z.Jj){var a=[],b,c;p(A,function(d,f){f&&p(f,function(d,f){b=f.length;for(c=0;c<b;c++)a.push(f[c])})});a.sort(function(a,b){return b.V-a.V});var d=a[z.Jj-1].V;p(A,function(a,f){f&&(p(f,
function(a,g){b=g.length;for(c=0;c<b;c++)g[c].V<d&&(g.splice(c,1),--c,--b);0===g.length&&delete f[a]}),0===vb.keys(f).length&&delete A[a])})}}function k(){var a=0,b;for(b in A){var c=A[b],d;for(d in c)a+=c[d].length}return a}function l(){u&&Wa.load(Fi,function(a){if(a.c&&(a=a.data))a:{A=n(a);a=u;var b=zk(A),c=[],d;if(nb(a))d=z.Fp;else if(za(a))d=z.Gp;else{ga=c;break a}for(var f=0;f<b.length;f++)Qc(a,b[f],d)&&c.push(b[f]);ga=c}})}function q(){u&&(c(),h(),Wa.save(Fi,m(A)))}function m(a){var b={};vb.keys(a).forEach(function(c){b[c]=
{};vb.keys(a[c]).forEach(function(d){for(var f=a[c][d],g=f.length,h=[],k=0;k<g;k++)h.push({sT:f[k].V,rT:f[k].jf,trT:f[k].uf,tB:f[k].tf,toT:f[k].totalTime});b[c][d]=h})});return b}function n(a){var b={};vb.keys(a).forEach(function(c){b[c]={};vb.keys(a[c]).forEach(function(d){for(var f=a[c][d],g=f.length,h,k=[],l=0;l<g;l++)h={},"undefined"!==typeof f[l].sT&&"undefined"!==typeof f[l].rT&&"undefined"!==typeof f[l].trT&&"undefined"!==typeof f[l].tB&&"undefined"!==typeof f[l].toT&&(h.V=f[l].sT,h.jf=f[l].rT,
h.uf=f[l].trT,h.tf=f[l].tB,h.totalTime=f[l].toT,k.push(h));0<k.length&&(b[c][d]=k)});0===vb.keys(b[c]).length&&delete b[c]});return b}var t=this,u,w,x,v=!1;a.addEventListener(Yf,function(){a.Tg=t;w=a.aa;u=a.Ek;x=new Xd(1E3*z.Sg,d);x.Bh();a.addEventListener(ag,b);a.addEventListener(ib,function(){q();x.pd()});a.A.addListener(function(){a.A.value===tc&&x.pd()});l()});var y={},A={},ga=[],B=0;this.qp=function(a,b){var c;if(u){c=[];if(a in y&&v)return c=y[a],new ge(c,b,z.Gj,z.Kj,z.Ij,z.Hj,k());for(var d=
ga.length,f,g;d--;)if(f=ga[d],a in A[f])for(f=A[f],g=f[a],f=g.length;f--;)c.push(g[f]);if(0!==c.length)return new ge(c,b,z.Gj,z.Kj,z.Ij,z.Hj,k())}}}function ge(a,b,c,d,f,g,h){this.Iq=f;this.xq=g;a=Kf(a,b,c,d,this.Iq,this.xq);b=[];for(c=0;c<a.length;c++)b.push(7.8125*ya(a[c].tf/a[c].totalTime,dh,eh));this.Ze=C(b);this.lf=this.Ze.length;this.Di=I(this.Ze)/this.Ze.length;a=this.Ze;c=this.lf;d=this.Di;f=[];for(g=0;g<c;g++)f.push(Vg(a[g]-d,2));this.As=Ak(I(f)/f.length);this.Fi=Ja(b,.2);this.Gi=Ja(b,.5);
this.Hi=Ja(b,.9);this.filter=bg;this.Us=h}function Kf(a,b,c,d,f,g){var h=[],k=c,l=pd(b%604800/86400);b%=86400;var p,q,m;bg=c;if(k===Bk){for(m=0;m<a.length;m++)c=a[m],p=c.V%86400,q=pd(c.V%604800/86400),l===q&&lc(p-b)<=d&&h.push(c);h.length<f&&(bg=k=Gi,h=[])}if(k===Gi){for(m=0;m<a.length;m++)c=a[m],p=c.V%86400,q=pd(c.V%604800/86400),lc(p-b)<=d&&h.push(c);h.length<f&&(bg=Hi,h=[])}k===Hi&&(h=a,h.length<f&&(h=[]));h.length>g&&(h=h.sort(function(a,b){return a.V<b.V?-1:a.V>b.V?1:0}).slice(0,g));a=[];for(d=
0;d<h.length;d++)0<h[d].totalTime&&a.push(h[d]);return a}function Cb(){x(this,{S:"b",ma:0,Nd:{za:0,Zc:{},ge:{}},za:0,index:1,qa:0xceb86ce78ed,Xa:{align:"",fx:null,ex:null,contextMenu:null,Wv:{},Kx:null,Jx:null,Ix:null,Hx:null,Gx:null,onsubmit:null,Fx:null,onshow:null,onselect:null,Ex:null,Dx:null,onscroll:null,onresize:null,onreset:null,Bx:null,onprogress:null,Ax:null,zx:null,yx:null,onmousewheel:null,onmouseup:null,onmouseover:null,onmouseout:null,onmousemove:null,onmouseleave:null,onmouseenter:null,
onmousedown:null,onloadstart:null,xx:null,wx:null,onload:null,onkeyup:null,onkeypress:null,onkeydown:null,vx:null,oninput:null,onfocus:null,onerror:null,onended:null,ux:null,tx:null,sx:null,rx:null,qx:null,px:null,ox:null,nx:null,mx:null,ondblclick:null,lx:null,oncontextmenu:null,onclose:null,onclick:null,onchange:null,oncanplaythrough:null,kx:null,jx:null,onblur:null,onabort:null,spellcheck:!0,isContentEditable:!1,contentEditable:"",Nx:"",innerText:"",accessKey:"",hidden:!1,Vy:"",draggable:!1,tabIndex:-1,
dir:"",translate:!0,lang:"",title:"",ontouchstart:null,ontouchmove:null,ontouchend:null,ontouchcancel:null,childElementCount:2,lastElementChild:{},firstElementChild:{},children:{},Mx:null,Lx:null,nextElementSibling:null,previousElementSibling:null,onwheel:null,onselectstart:null,Cx:null,onpaste:null,oncut:null,oncopy:null,ix:null,hx:null,gx:null,shadowRoot:null,dataset:{},classList:{},className:"",outerHTML:"",innerHTML:"",scrollHeight:545,scrollWidth:2560,scrollTop:0,scrollLeft:0,clientHeight:545,
clientWidth:2560,clientTop:0,clientLeft:0,offsetParent:{},offsetHeight:545,offsetWidth:2560,offsetTop:0,offsetLeft:0,localName:"",prefix:null,namespaceURI:"",id:"",style:{},attributes:{},tagName:"",parentElement:{},textContent:"",baseURI:"",ownerDocument:{},nextSibling:null,previousSibling:null,lastChild:{},firstChild:{},childNodes:{},parentNode:{},nodeType:1,nodeValue:null,nodeName:""},Uc:!1,Ga:{Wt:0,uu:0,vu:0},dh:{Uv:0,Eu:0,at:0,yy:0,xy:0,fw:0,Iw:0,cw:0,sw:0,dw:0,Sy:0},log:{Ha:{}},state:{value:2},
v:{value:0},paused:{value:!1},muted:{value:!1},volume:{value:1},A:{value:1},o:{value:2},W:{value:{}},bc:{value:{}},$:{value:{}},ec:{value:null},Jh:{value:null},k:{value:{}},F:{value:{}},i:{value:{}},Yb:{value:null},ub:{value:null},te:{value:{}},ue:{value:{}},Fc:{value:{}},Ra:{value:{}},ke:{value:{}},ua:{},bh:{},aa:{},lg:{},af:{},nk:{},mk:{},sd:{},Ue:{},Tg:{},Tc:0,Wj:0,dc:{S:"",Kc:!0,qh:!1,Pe:0,de:{},Qj:!0},ta:{},ib:{Jd:{}},ek:{},I:[{},{},{},{},{}],Yn:[{},{},{},{},{}],Ab:[{}],Rh:[{}],ob:0,Ma:[null,
{}],$b:[{},{}],mj:0,Ek:0,vr:[{}],ld:0,Od:{id:0,location:{},type:0,Wa:1,name:"",Rp:!1,cq:0,fc:{}},Ls:[{},{},{}],Hh:[{},{},{}],Rs:0,ne:0,Xc:{track:{},type:"",J:0,f:0,size:0,Qa:{},j:{},Ga:{},Ie:!0},U:{track:{},type:"",J:0,f:0,size:0,Qa:{},j:{},Ga:{},width:0,height:0,Sj:!1,Xg:!1,xk:!1,Ie:!0,Ad:{}},n:{$a:{},yb:{}},duration:0,ac:{width:0,height:0},nd:0,ha:{},cb:{R:{},Y:{},Rb:{},eb:{},Db:0,pb:{},nb:!1},R:{},Zb:{he:null},Kh:{},Md:{},Jp:{},rc:{},Ih:{Dr:g,Jv:g,Gv:g,yu:g,us:g}})}function Uc(a){function b(){a.n.pe()}
var c=[];this.sc=function(a){for(var b=[],d=c.length;d--;){var f=c[d];f.sc(a)&&b.push(f.wg)}if(b.length)return b};Ii.forEach(function(b){(b=b(a))&&c.push(b)});0<c.length&&a.addEventListener(Hc,b)}function zc(a){Ii.push(a)}function jd(a,b){var c=a.length,d,f=b.length,g,h,k;for(d=0;d<c;d++)for(g=a[d],k=g[0],h=g[1],g=0;g<f;g++)if(b[g]>=h&&0>=--k)return!0}function Bc(a){function b(f){a.removeEventListener(fh,b);try{var g=f.data,h=g.length,k;f=0;for(var l,p,q,m={};f<0+h;){k=g[f];l=k&7;p=k>>3;var n=g,t=
f,u=t+1,w=n.length,x=u,v=0,y={},A=[],z=void 0,B=void 0,D=0;if(u>=w)throw new La("Invalid Range for Protobuf - start: "+u+" , len: "+w);for(;x<w;){v++;z=n[x];B=z&127;A.push(B);if(!(z&128))break;x++}for(var Ca=A.length-1;0<=Ca;Ca--)D<<=7,D|=A[Ca];y.count=v;y.value=D;y.start=t+v+1;q=y;if(!q.count)throw new La("Parsing error. bytes length is 0 for the tag "+k);f+=q.count+1;2==l&&(f+=q.value);m[p]={zv:p,Wy:l,value:q.value,count:q.count,start:q.start}}var F;var E;F=m&&(E=m[1])?E.value:void 0;1==F&&m[5]&&
m[5].value&&(d=!0,a.vs());c.trace("RA check",{HasRA:d})}catch(Pa){c.error("RA check exception",Pa)}}var c=new a.log.r("RAF"),d;a.addEventListener(fh,b);return{wg:"ra",sc:function(a){if(!d)return a.Xg}}}function hc(a,b){var c,d,f,g,h=a.$a,k=a.yb,h=h.Q.Ja||h.Q;d=ja(h.endTime/(h.index+1));h=k.Q.Ja||k.Q;f=ja(h.endTime/(h.index+1));c=d*f;g=.128*d*b.f;this.Ob=function(a,b){return ja(((c-f*(b+g/a))/d-b)*a/f*7.8125)}}function de(a){var b,c=[],d=100,f=128,g=0,h=0,k=0,l,p;a.addEventListener(ke,function(b){var g=
b.D,q=b.L;q.i&&(l=q.i.location.id);p=g.requestTime;if(b.c&&g.X>Ji&&b.type==jc){for(c.push(g);c.length>Ck;)c.shift();var m=0,n,t=c.length;h=k=0;if(0<t){var u,w;for(b=t;b--;)n=c[b],g=Qb(n),q=n.requestTime+g,m+=g,k+=n.X,n.M>u||(h+=w-u||0,w=n.M),u=q;h+=w-u||0;d=pd(m/t);f=ya(k/h,dh,eh);a.fireEvent(ag)}}});a.addEventListener(ib,function(){q&&q.wb()});var q=new tb(6E4,function(){g=f;q.wb()});q.jc();this.ud=function(){return d};this.Kg=function(){return f};this.Bj=function(){return g};this.xd=function(){return k};
this.Mg=function(){return h};this.uj=function(){return l};this.vj=function(){return p};this.ga=function(a){return d+a/f};this.Ob=function(){b=b||new hc(a.n,a.Xc);return b.Ob(f,d)};this.le=function(){return ja(896E3/(d+896E3/f)*7.8125)}}function Qb(a){a=ea(a.O-a.requestTime,(a.M-a.requestTime)*Dk);a=ja(a);return ya(a,Ek,Fk)}function Rc(a){var b=Qb(a);a=ya(ja(a.X/(a.M-(a.requestTime+b))),dh,eh);return{Fd:b,rf:a}}function Ge(a){function b(){d();var a=m.ba(0,!0);q=k(p,0,a);return 0>q.Gb||0>q.tb}function c(a){for(a=
f(a);a&&a.j;)a=a.lower;return a}function d(b){var c=a.Aa();if(b){b=a.xa().Ud(z.Pp);for(var f=c.length,g=[],h=0;h<f;h++)-1!==b.indexOf(c[h].f)&&g.push(c[h]);c=g}b=c.length;x(c,le);for(f=0;f<b;f++)c[f].lower=c[f-1],c[f].Ad=c[f+1];m=c}function f(b){var c=m.ba(b.f);if(!c.Ad)return c;var d=a.n.Mc(),d=Ma(z.Xf,d);b=Ma(z.Qk,b.f)[0];b=ea(b,p.Ob()/(1+d[2]/100));b=m.ca(b+1);return b.f<=c.f?c:b}function h(){for(var b,c=a.Ra.value.stream,d=f(c),g,l=a.n.Mc(),q=Ma(z.Ji,l),m=Ma(z.Xf,l),n,t;d;){if(d.j)if(b=d.f>c.f?
m:q,n=z.Va+(b[0]||0),t=z.Va+(b[1]||0),g=d,b=k(p,b[2],d),b.Gb<n||b.tb<t){if(d.f<=c.f&&z.bj&&l>z.bj)break}else break;d=d.lower}d||(d=g);return{k:d,Gb:b.Gb-n,tb:b.tb-t}}function k(b,c,d){function f(){for(;ma&&ma.media&&x<aa;)x+=ma.duration,ma=ma.next;for(;S&&S.media&&v<aa;)v+=S.duration,S=S.next}function h(){if(p>=y){for(var a=d.lower;a&&!a.j;a=a.lower);a&&(d=a,u=a.j.t);h=g}}var l=(c||0)/100+1,p=a.v.value,q=a.n,m=a.F.value,n=q.$a,t=q.yb,q=m.j.t,u=d.j.t,w=[];w.reduction=c;c=z.Gd;z.Hb&&(c=ea(c,ja(z.Hb/
(.192*(m.f+d.f)))));var aa=c-z.Ei,ma=n.fb(p),x=qa(ma.startTime-p,0),S=t.fb(p),v=qa(S.startTime-p,0);f();var y=p+v+z.Ep,m=z.Lk?p+ea(v,x)+z.Lk:145152E5,n=x;c=v;for(var A,Oa,Db;p<m;)if(f(),Db=t=Oa=0,A=ea(x-aa,v-aa),0<A&&(p+=A,x-=A,v-=A),ma&&(x<v||!S)?(A=q[ma.index],Oa=A.length,t=A.duration,ma=ma.next):S&&(h(),A=u[S.index])&&(Oa=A.length,Db=A.duration,S=S.next),0<Oa)Oa=b.ga(Oa)*l,p+=Oa,x-=Oa,v-=Oa,n>x&&(n=x),c>v&&(c=v),x+=t,v+=Db;else break;return{Gb:n,tb:c,zy:w}}var p=a.aa,q,m,n=z.sr;x(this,{Lc:function(b){var c=
p.le()/z.Cn;return a.Eb().ca(c,b)},gb:function(b){d(b);b=p.Ob();var f=Ya(Ma(z.rr,b)[0]);b=(b=m.ca(f+1,!0))||a.U;var g=a.n,h=z.pk,l=k(p,h[2],b),q=g.Fb(),t=g.Tb(),q=q?g.$a.Q.endTime-q.startTime:0,t=t?g.yb.Q.endTime-t.startTime:0,u=g.qb(),w=g.Fa(),g=-l.Gb+z.Va+(h[0]||0),h=-l.tb+z.Va+(h[1]||0),g=qa(g,z.lh-u),g=ea(g,qa(n-u,0),q),h=qa(h,z.mh-w),h=ea(h,qa(n-w,0),t),f=m.ca(f+1,!1);f==b&&f.j&&(f=c(b));return{k:b,Ua:f,jb:g,kb:h}},Nc:function(){d();var a=h(),b=a.k,f=c(b);f&&(a=ea(a.Gb,a.tb),p.ga(f.lj())<=a||
(f=m[0],f=f.j?null:f));return{k:b,Ua:f}},Dd:b,Dh:function(){var c=a.k.value.f,d=m.ba(0,!1).f;return a.n.wj()<z.pn&&c!==d&&b()},zj:function(a){var b=h(),b={Gb:b.Gb-z.fe[0],tb:b.tb-z.fe[1]},b=ea(b.Gb,b.tb);a=p.ga(a);a*=1+.01*z.fe[2];return a<b},Hg:function(){d();var b=k(p,z.Ji[2],m[m.length-1]);return a.n.Fa()-b.tb}});a.addEventListener(Qd,function(){q=l});a.addEventListener(Hc,function(){n=z.Jr})}function Ne(a){function b(){var c=z.Gd,d=a.F,f=a.k;z.Hb&&(c=ea(c,ja(z.Hb/(.192*(d.f+f.f)))));return c}
function c(a,b,d){var f=0;b=b||0;a=a.j.t;var g=a.length-b;d=Ba.min(d||g,g);G&&(b=0,d=a.length);0<d&&(b=a.slice(b,b+d),0<b.length&&(f=b.reduce(function(a,b){return{length:a.length+b.length}},{length:0}),f=f.length/d));return f}function d(a){a=a.j.t.slice(0,a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length>b.length?a:b}).length}function f(a,b,c){a=a.j.t.slice(b||0,c||a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length<b.length?a:b}).length}function g(){var a=
I.ba(0,!0),b=I.ca(Number.POSITIVE_INFINITY,!0);return 8*d(b)/a.f}function h(){return Q*A/100-K-V}function k(){return Ba.min(z.Va,2*da)}function p(a){var b=I.ba(0,!0),c=b.j.t,d=k(),f=0;if(!c)return v;for(var g=Ba.min(c.length,a+B),h=0;a<g;a++){var l=c[a],h=h+(8*l.length/b.f-l.duration);f<h&&(f=h)}f<d?f=d:f>Ba.min(Q,v)&&(f=Ba.min(Q,v));return f}function q(a,b){O.push(a);10<O.length&&(O=O.slice(-10));kc.push(b);10<kc.length&&(kc=kc.slice(-10))}function m(a,b,g){var h,k,l,p,U,q=I.ba(b.f,!0),n=I.ba(0,
!0);if(1>=kc.length||1>=g){if(1===Ec||H)k="historical"===z.Ii?N.xd()/(N.ud()+N.Mg()):N.Kg(),h=k>q.f*ba?q:k<b.f*ba?I.ca(b.f,!0):b;return h}k=2>kc.length?0:a-kc[kc.length-2];l=c(b,0,b.j.t.length);p=d(b);U=b.j.t[g-1].length;if(W)if(h=p/l,J&&(p=Ba.min(b.j.t.length-g-1,L),g+p+1<b.j.t.length&&(h=f(b,g,g+p)/l)),C?1>=h?a=1:(g=V+K+M,a=a>g?1:(h-1)*(g-a)/g+1):a=h,g=da-8*U/(q.f*a),k>g)h=q;else if(0<=k)h=b;else for(h=q,b=da-8*U/(h.f*a);k<b;){h=I.ca(h.f,!0);if(h===n)break;b=da-8*U/(h.f*a)}return h}function n(a,
b,d,f){var g=I.ca(b.f,!0),h=I.ba(b.f,!0),l=I.ba(0,!0),p,U;U=I.ba(0,!0).f*da/8;var q=I.ca(Number.POSITIVE_INFINITY,!0).f*da/8;U=(a-K-V)/M*(q-U)+U;U=Ba.max(0,U);var q=I.ba(0,!0),m=I.ca(Number.POSITIVE_INFINITY,!0),m=ba*da*m.f/8;ca&&(m=Da?(a-K)*q.f/8:(a-k())*q.xt/8);a=m;var t=m=0,u=g.j.t,w=h.j.t,x=b.j.t[d].length,q=b;U=Ba.min(U,a);u&&(m=c(g,d,f),1<f&&(m=Ba.max(m,u[d].length)));w&&(t=c(h,d,f),1<f&&(t=Ba.max(t,w[d].length)));if(ca&&x>a){for(;;){q=I.ca(q.f,!0);if(q.f===l.f){p=l;break}b=q.j.t[d].length;
if(b<a){p=q;break}}return p}if(0<t&&U>t)p=h;else if(0<m&&U<m)for(q=g,b=m;b>U;){p=q;q=I.ca(q.f,!0);if(q.f===l.f)break;b=c(q,d,f);1<f&&(b=Ba.max(b,q.j.t[d]))}else p=b;return p}function t(){var f=a.Ra.value.stream,u,w=I.ba(0,!0),x=a.n.Mc(),A=a.n.sb();u=A.duration;var Oa=0,z=2>kc.length?0:x-kc[kc.length-2],B,va=1;da===l&&(da=u);ba===l&&(ba=d(f)/c(f));Q===l&&(Q=b());1===Ec&&(oa=ra,P=0===O.length?f.f:O.reduce(function(a,b){return a+b},0),0<P&&(P/=O.length,P=Ba.min(P,O[O.length-1]),R=I.ca(P,!0)),kc=[],O=
[]);q(f.f,x);oa=ga?oa-1:-1;0===oa&&0<z?oa+=1:ga&&-1===oa&&(0<z?oa=1:B=!0);Da?(Oa=p(A.index),K<Oa&&(K=Oa)):D?(K=Ca,K<k()&&(K=k())):K=k();if(0>V||2===Ec||1===Ec)V=x-K,V=Ba.max(0,V),V+K>v&&(V=v-K),V>y&&(V=y),T=!1,x>=h()+K+V&&(T=!0);!F&&Da?M=h():F?(M=E,M<g()()?M=g():M>h()&&(M=h())):M=g();Pa&&(va=(x-K-V)/u,va=1>va?1:va);x<K+V?(u=w,T=!1):x>K+V+M-u?(u=I.ca(Number.POSITIVE_INFINITY,!0),T?u=0<z?I.ba(f.f,!0):f:oa=-1):(u=n(x,f,A.index,va),T&&(u=0<=z?f:I.ca(f.f,!0)));ga&&0<=oa?(x=m(x,f,A.index),R&&x.f<R.f&&(0<
z?x=I.ba(f.f,!0):0>z&&(R=l)),R&&x.f>=R.f&&(R=l),x.f>u.f&&(u=x)):B&&(0<z?u=f:u.f<=f.f/2?u=I.ca(f.f/2,!0):B=!1);Ec=0;u||(u=w);return u}var u=new Ge(a),w=z.On,v=w.zq,y=w.yq,A=w.uq,B=w.Tr,ga=w.Gs,Da=w.Qo,ra=w.Fs,D=w.Up,Ca=w.sq,F=w.Qp,E=w.rq,Pa=w.Tp,G=w.Xp,ca=w.Yp,H=w.Ys,W=w.Hs,C=w.Is,J=w.Ds,L=w.Es,Ec=0,N=a.aa,Q,I,K=0,M=0,kc=[],O=[],oa=ra,V=0,da,P,R,T,ba;a.addEventListener(Pd,function(){Ec=1});a.addEventListener(Ze,function(){Ec=2});return{Lc:u.Lc,gb:u.gb,Nc:function(){var b=a.Aa(),c=b.length;x(b,le);
for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ad=b[d+1];I=b;b=t();c=a.n;d=I.ba(b.f);if(d.Ad)var f=a.n.Mc(),f=Ma(z.Xf,f),g=Ma(z.Qk,b.f)[0],g=ea(g,N.Ob()/(1+f[2]/100)),f=I.ca(g+1),d=f.f<=d.f?d:f;for(;d&&d.j;)d=d.lower;d&&(c=ea(c.qb(),c.Mc())-da,N.ga(d.lj())<=c||(c=I[0],d=c.j?null:c));return{k:b,Ua:d}},Dd:u.Dd}}function kd(a){function b(c){c=a.xa().filter(c?Ac:Vc);return sa(c)}return{Lc:function(b){b=a.Eb().filter(b?Ac:Vc);return sa(b)},gb:function(){var c=a.n,d=c.qb(),f=c.Fa(),d=qa(z.lh+z.Va-d,0),f=qa(z.mh+
z.Va-f,0),g=c.Fb(),h=c.Tb(),h=h?c.yb.Q.endTime-h.startTime:0,d=ea(d,g?c.$a.Q.endTime-g.startTime:0),f=ea(f,h);return{k:b(!0),Ua:b(!1),jb:d,kb:f}},Nc:function(){return{k:b(!0),Ua:b(!1)}},Dd:function(){return!1},Dh:function(){return!1},zj:function(){return!0},Hg:function(){return 4E3}}}function Lf(a){function b(){var c=z.cp,d=a.n.Tb();if(d)for(var d=d.startTime,f,g=c.length,h,k=0,k=0;k<g;k++)if(h=c[k],d>=h[0])f=h[1];else break;c=a.Aa();f=le.gc.call(c,f||0);c=c.filter(Vc)[0];return{k:f,Ua:c}}x(this,
{Lc:function(b){b=a.Eb().filter(b?Ac:Vc);return sa(b)},gb:function(){var c=b(),d=a.n,f=d.qb(),g=d.Fa(),f=qa(z.lh+z.Va-f,0),g=qa(z.mh+z.Va-g,0),h=d.Fb(),k=d.Tb(),k=k?d.yb.Q.endTime-k.startTime:0,f=ea(f,h?d.$a.Q.endTime-h.startTime:0),g=ea(g,k);c.jb=f;c.kb=g;return c},Nc:b,Dd:function(){return!1},Dh:function(){return!1},zj:function(){return!0},Hg:function(){return 0}})}function Jg(a){function b(){for(var a,c,d,f,g=m.length,h=l.length,p=0;p<g;p++){var q=m[p];if(-1===l.indexOf(q)&&q<R(l))for(a=0;a<h-
1;a++)if(c=l[a],f=l[a+1],q>=f&&q<=c){a=k[c];d=k[f];k[q]=(q-c)/((f-c)/(d-a))+a;break}}}function c(){var b=[],d=a.Eb(),f=a.xa(),g=a.n.Fb().index,h=a.n.Tb().index,l=a.n.$a,q=a.n.yb;p(k,function(a,c){var k,p=d.gc(a,!0),U=f.gc(a,!0),m=0,n=0,t;k=ea(pd(z.Ki)/4,l.Q.index-g+1);for(t=0;t<k;t++)m+=p.j.t[g+t].length;k=ea(z.Ki,q.Q.index-h+1);for(t=0;t<k;t++)n+=U.j.t[h+t].length;k=qa((m+n)/k*2/128/c,a);p={};p.f=a;p.Qr=k;p.dv=c;b.push(p)});return b=b.sort(function(a,b){return sc(a.f)<sc(b.f)?-1:sc(a.f)>sc(b.f)?
1:0})}function d(){for(var a,b=q.length;b--;)if(a=q[b],a.Qr<=h)return a.f}var f,g,h,k={},l=[],q=[],m;this.tj=function(n){m=a.xa().Ud(z.Pj);if((f=a.Tg)&&n&&(g=f.qp(n,ja(bd/1E3)+X()))&&0!==g.lf)return p(z.Vn,function(a,b){k[a]=cc(b);l.push(E(a))}),l=C(l).reverse(),b(),q=c(),h=(20===z.Li?g.Fi:90===z.Li?g.Hi:g.Gi)*(1-.01*(z.pk[2]||0)),d()};this.pp=function(){return g}}function Yc(a,b,c){function d(a){if(m.state.value==$e||m.state.value==Kb||m.state.value==Sa)v.info("Playback closing",m,a?{ErrorCode:a.qd}:
l),Xa.removeListener(uc,k),u.B(gh,{pt:x}),m.Da=a,u.B(ib),m.state.set(hh),A||Z(f)}function f(){var a=m.Re;m.Re=l;a?Rd.Mr(a,function(){h()}):h()}function h(){h=g;var a=ed.indexOf(m);ed.splice(a,1);m.state.set(cg);u.B(dg,{},!0);u.Ec()}function k(){d()}function p(){var a=m.v.value;B!=a&&(v.trace("MediaTime changed",{MediaTime:Ea(a)}),B=a,u.B(af))}function q(a){a.newValue!=Ab&&(m.A.removeListener(q),u.B(Hc))}var m=this,n,t=new kb(1E3),u=new lb,w={},x={};eg?(n=eg,eg=l):n=1E4*sb()+ja(1E4*Qe());Bi=n;m.addEventListener=
u.addListener;m.removeEventListener=u.removeListener;m.fireEvent=u.B;m.S=a;m.ma=b;m.Nd=c||{};m.za=m.Nd.za||0;m.index=++Gk;m.qa=n;m.Xa=Y("DIV","position:relative;width:100%;height:100%;overflow:hidden");m.Uc=z.al&&!(n%z.al);m.Ga={MovieId:m.ma,TrackingId:m.za,Xid:m.qa,AccountKey:m.S};m.dh=w;a=new yc(m);m.log=a;fg||(fg=a);var v=new m.log.r("Playback");v.info("Playback created",m.Ga);m.Uc?v.info("Playback selected for trace playback info logging"):v.trace("Playback not selected for trace playback info logging");
m.state=new Fa($e);m.state.addListener(function(a){v.info("Playback state changed",{From:a.oldValue,To:a.newValue})});m.Wq=function(){m.log.Ha.Tc=m.Tc=X();m.Wj=sb();m.state.set(Kb)};m.Vq=function(){m.state.value==Kb&&m.state.set(Sa)};m.na=function(a){v.trace("Milestone",{Id:a});w[a]=m.Ub()};m.close=function(a){a&&(m.state.value==cg?a():m.addEventListener(dg,function(){a()}));d()};m.Pa=function(a){function b(){d(a)}if(m.state.value==$e)m.Da||(m.Da=a,m.load());else{var c=z.Wi&&a&&z.Wi[a.errorCode];
y(c)&&(c=E(c));v.error("Fatal playback error",{Error:""+a,HandleDelay:""+c});0<=c?Ka(b,c):b()}};m.cl=function(){A=!0};m.Sq=function(){f()};m.Xd=function(){u.B(Ki)};var A;Xa.addListener(uc,k,1);m.v=new Fa;var B;m.v.addListener(function(){t.lb(p)});m.dp=function(){p()};m.paused=new Fa(!1);m.paused.addListener(function(a){v.info("Paused changed",{From:a.oldValue,To:a.newValue,MediaTime:Ea(m.v.value)})});m.muted=new Fa(!1);m.volume=new Fa(z.zo/100);m.A=new Fa(Ab);m.A.addListener(function(a){v.info("PresentingState changed",
{From:a.oldValue,To:a.newValue,MediaTime:Ea(m.v.value)},m.n.Ee())});m.o=new Fa(Lb);m.o.addListener(function(a){v.info("BufferingState changed",{From:a.oldValue,To:a.newValue,MediaTime:Ea(m.v.value)},m.n.Ee())});m.W=new Fa(null);m.W.addListener(function(a){v.info("AudioTrack changed",a.newValue&&{ToBcp47:a.newValue.bb,To:a.newValue.ka},a.oldValue&&{FromBcp47:a.oldValue.bb,From:a.oldValue.ka},{MediaTime:Ea(m.v.value)});m.F.set(m.ta.Lc())});m.bc=new Fa(null);m.bc.addListener(function(){m.k.set(m.xa()[0])});
m.$=new Fa(null);m.$.addListener(function(a){v.info("TimedTextTrack changed",a.newValue?{ToBcp47:a.newValue.bb,To:a.newValue.ka}:{To:"none"},a.oldValue?{FromBcp47:a.oldValue.bb,From:a.oldValue.ka}:{From:"none"},{MediaTime:Ea(m.v.value)})});m.ec=new Fa(null);m.Jh=new Fa(null);m.k=new Fa(null);m.F=new Fa(null);m.i=new Fa(null);m.i.addListener(function(a){a=a.newValue;var b=m.I;b.splice(b.indexOf(a),1);b.unshift(a)});m.Yb=new Fa(null);m.ub=new Fa(null);m.te=new Fa(null);m.ue=new Fa(null);m.Fc=new Fa(null);
m.Ra=new Fa(null);m.je=new Fa(null);m.A.addListener(q);m.ke=new Fa;Kg(m);m.Ng=function(){u.B(gh,{pt:x});return x};m.vs=function(){x.HasRA=!0};ed.push(m);m.ua=new ze(m);m.bh=new sf(m);m.aa="sliding_window"===z.Ii?new Pc(m):new de(m);m.lg=new Pe;m.af=new Oe(m);m.nk=new Ld(m);m.mk=new If(m);m.Ue=new Uc(m);z.Ro&&(m.Tg=new Jf(m));Li.forEach(function(a){a(m)});Mf(this)}function Mf(b){function c(a){return"parallel"===z.dg?new ug(a):new Sf(a)}function d(a,c){l||(l=!0,b.Pa(new mb(a,c)))}var k=new b.log.r("Playback"),
l,q,m,n,t,u;b.load=function(a){this.load=f;t=a;b.state.value==$e&&(k.info("Playback loading",b),b.Wq(),gg(function(a){a.c?b.qo():d(a.errorCode||O.$d,a)}))};b.qo=function(){try{var a=b.S,c=a?De(a):Ue;b.S=c.S;b.dc=c;switch(z.Dp){case "random":b.ta=new kd(b);break;case "fixed":b.ta=new Lf(b);break;case "bb":b.ta=new Ne(b);break;default:b.ta=new Ge(b)}b.ib=new Wc(b);b.ek=new Gf(b);b.mt()}catch(f){d(O.Gl,{g:M.Nb,C:G(f)})}};b.mt=function(){if(b.Da)b.Pa(b.Da);else if(h(b.ma,1)){var a=b.dc.Pc();if(z.Rr){var c=
a.ea;if(!y(c)){d(O.ci);return}c=pa(c);if("usr"!=c&&"dbl"!=c){k.error("Invalid NetflixId",{bt:c});d(O.bi);return}}z.Sr&&!y(a.Ya)?d(O.ei):b.bo()}else d(O.tl)};b.bo=function(){var a=Rd.Fk;a?a.c?b.bg():d(O.fi,a):b.Qf()};b.bg=function(){z.bg?Cc(function(){b.Qf()},b):b.Qf()};b.Qf=function(){b.state.value==Kb&&(z.Vo?Rd.Bi(Hk,function(a){a.c?(b.Re=a.Re,b.nf()):d(O.di)}):b.nf())};b.nf=function(){b.state.value==Kb&&(b.na("ic"),b.mk.ps(function(a){a.error&&k.error("Error sending persisted playdata",Va(a));b.md()}))};
b.md=function(){b.state.value==Kb&&(k.info("Authorizing",b),b.na("ats"),b.ib.md(function(c){if(b.state.value==Kb){b.na("at");if(!c.c)switch(c.method){case "register":d(O.Tl,c);return;case "authenticationrenewal":d(O.Sl,c);return;default:d(O.Rl,c);return}var f;try{q=b.Eb().Ud(z.Op);m=b.xa().Ud(z.Pj);n=b.Eb().gc(q[0]||0);u=b.xa().gc(m[0]||0);f=Ve.call(b.I,function(b){return a(n.Qa[b.id])&&a(u.Qa[b.id])});b.Od=f[0];b.Ls=f;var g={};f.forEach(function(a){var b=a.location.id;g[b]||(g[b]=[]);g[b].push(a)});
var h=[];p(g,function(a,b){var c=b[0].location;c.I=b;h.push(c)});b.Hh=h.sort(function(a,b){return a.Wa-b.Wa});b.Od!=b.I[0]&&k.error("Primary CDN does not have downloadUrls for a/v streams",{CdnId:b.I[0].id})}catch(l){k.error("Exception while picking initial streams",l)}n&&u&&f.length?b.wr():d(O.Ul)}}))};b.wr=function(){t?(k.info("Processing post-authorize",b),t(b,function(a){a.c?b.cj():d(O.Kl,a)})):b.cj()};b.cj=function(){function a(){if(!(0<p)||t){var c=f.ba(0,!0),k=h.ba(0,!0);c&&k?(n=c,u=k,a=g,
b.qr()):0>=p&&(a=g,d(O.Jl,w))}}if(b.state.value==Kb){k.info("Downloading initial stream headers",b,{Audio:q.join("|"),Video:m.join("|")});b.na("shs");var c;z.zg&&(c=b.Ab.filter(function(a){return a.bb==z.zg||a.ka==z.zg}))&&c.length&&b.W.set(c[0]);z.ze&&(c=b.Ma.filter(function(a){return a?a.bb==z.ze||a.ka==z.ze:"none"==z.ze.toLowerCase()}))&&c.length&&b.$.set(c[0]);var f=b.Eb(),h=b.xa(),l=[f[0],h[0]],p=0,t=!1,w;q.forEach(function(a){a=f.gc(a);0<=l.indexOf(a)||l.push(a)});m.forEach(function(a){a=h.gc(a);
0<=l.indexOf(a)||l.push(a)});c=p=l.length;for(var x=0;x<c;x++)k.trace("Downloading header",{Type:l[x].type,Bitrate:l[x].f}),l[x].Ba(function(b){b.c||(w=b);p--;a()});Ka(function(){0<p&&k.debug("Not all initial headers downloaded within the deadline ("+z.Nj+" ms)");t=!0;a()},z.Nj)}};b.qr=function(){try{if(b.state.value==Kb){b.na("sh");k.trace("Initializing primary streams and MediaBuffer");z.pa||(b.F.set(b.Xc=b.ta.Lc(!0)),b.k.set(b.U=u));b.n=new zg(b);var a=b.n.$a,c=b.n.yb,f=a.Q.endTime,g=c.Q.endTime;
b.duration=qa(f,g);lc(f-g)>ea(a[0].duration,c[0].duration)&&k.error("Large audio and video duration gap",{AudioMS:f,VideoMS:g,MovieId:b.ma,AudioDlId:b.Xc.J,VideoDlId:b.U.J});var l={width:1,height:1};b.xa().forEach(function(a){l.width*l.height<a.width*a.height&&(l.width=a.width,l.height=a.height)});b.ac=l;var p=E(z.Ln[b.ma]);h(p)?(k.info("Overriding bookmark",{From:b.ob,To:p}),b.ob=p):((p=b.ob)&&p<of(z.Mn,b.duration)&&(k.trace("Ignoring bookmark because it's to close to beginning"),b.ob=0),p&&p>b.duration-
of(z.Nn,b.duration)&&(k.trace("Ignoring bookmark because it's to close to end"),b.ob=0));b.ro()}}catch(q){d(O.Hl,{g:M.Nb,C:G(q)})}};b.ro=function(){try{b.ha=new hd(b),b.R=c(b),b.Zb=new Cj(b),z.Pr&&(b.Kh=new Ae(b)),b.Md=new Dj(b),b.Jp=new Fj(b),Mi.forEach(function(a){a(b)}),b.Vq()}catch(a){d(O.Il,{g:M.Nb,C:G(a)})}}}function Kg(a){function c(){return a.state.value==Kb||a.state.value==Sa&&a.A.value==Ab}function d(){c()?m||(m=cb(f,100)):m&&(gb(m),m=l,Z(f))}function f(){var d=X(),m=g.value,m=m?m.df:0,
n,t=a.state.value==Kb||c()&&199<d-h,u,w,x;t&&a.state.value==Sa?(a.o.value==Vb?(w=m,u=!0):(n=d+(a.R.nc()||0),k=k||d,p=p||k+z.Gq+1,b(n)&&(n=qa(n,p),w=a.R.vd(),w=Ya(1E3*ya((d-k)/(n-k),0,w))/1E3)),w<m&&(m-w<z.yr/100?(w=m,q=l):q?d-q>z.xr?(x=!0,q=l):w=m:(q=d,w=m))):q=p=k=l;(d=t?{Mk:u,df:w,zr:x}:null)&&g&&g.value&&d.df===g.value.df||g.set(d)}var g=a.ke,h=0,k,p,q,m;a.state.addListener(function(){d();f()},1);a.A.addListener(function(a){if(a.oldValue!=Ab||a.newValue!=Ab)h=X();d()});a.o.addListener(function(){d()});
m||(m=cb(f,100))}function Cc(a,b){var c=ed[0];c==b&&(c=ed[1]);c?c.close(function(){Cc(a,b)}):a&&a(fa)}function ld(a,b){switch(a){case ih:Li.push(b);break;case hg:Mi.push(b)}}function he(a,b,c){return z.pa?new Cb:new Yc(a,b,c)}function Oe(a){function c(){if(!v){D=cb(k,1E3);a.Xa.appendChild(t);for(var b=y.length;b--;)y[b].addListener(q);for(b=A.length;b--;)a.addEventListener(A[b],q);v=!0}h()}function d(){if(v){gb(D);ga=F=l;a.Xa.removeChild(t);for(var b=y.length;b--;)y[b].removeListener(q);for(b=A.length;b--;)a.removeEventListener(A[b],
q);n.lb();v=!1}}function f(){v?d():c()}function g(){var c=a.n,d=[],f;d.push({Version:"2.0000.308.011",Esn:Jb?Jb.lc:"UNKNOWN",UserAgent:Gb.userAgent});try{d.push({MovieId:a.ma,TrackingId:a.za,Xid:a.qa+" ("+ed.map(function(a){return a.qa}).join(", ")+")",Position:Ea(a.v.value),Duration:Ea(a.duration),Volume:Ya(100*a.volume.value)+"%"+(a.muted.value?" (Muted)":"")})}catch(h){}try{var k=a.R?a.R.nc():l;d.push({"Player state":Da[a.state.value],"Buffering state":ra[a.o.value]+(b(k)?", ETA:"+Ea(k):""),"Rendering state":E[a.A.value]})}catch(q){}try{var m=
c.xd(),n=z.Hb,t=a.Yb.value,u=t&&t.stream,w=a.ub.value,x=w&&w.stream,v=a.i.value;d.push({"Playing bitrate (a/v)":u&&x?u.f+" / "+x.f+" ( "+x.j.Bo+" )":"?","Buffering bitrate (a/v)":a.F.value.f+" / "+a.k.value.f,"Buffer size in Bytes (a/v)":c.pj()+" / "+c.Dj(),"Buffer size in Bytes":m+(n?" ("+(100*m/n).toFixed(0)+"% of max)":""),"Buffer size in Seconds (a/v)":Ea(c.qb())+" / "+Ea(c.Fa()),"Will Rebuffer":a.ta.Dd(),"Current CDN":v.name+", Id: "+v.id})}catch(y){}try{var ma=a.Yb.value.stream,aa=ma.j,A=ma.track,
Oa=a.ub.value.stream.j,S=a.ec.value;d.push({"Audio Track":A.bb+", Id: "+A.ka+", Channels: "+A.Qi+", Codec: "+(aa&&aa.cg),"Video Track":"Codec: "+(Oa&&Oa.cg),"Timed Text Track":S?S.bb+", Profile: "+S.fk+", Id: "+S.ka:"none"})}catch(Db){}try{d.push({Framerate:a.k.value.j.Bg.toFixed(3),"Current Dropped Frames":b(F)?F:"","Total Frames":a.ha.Ce(),"Total Dropped Frames":a.ha.Oc(),"Total Corrupted Frames":a.ha.Ae(),"Total Frame Delay":a.ha.De(),"Main Thread stall/sec":jh?jh.tp().join(" "):"DISABLED",VideoDiag:ig(a.Ng())})}catch(Za){}try{a.n&&
(z.pa?d.push({Throughput:a.rf+" kbps"}):d.push({Latency:a.aa.ud()+" ms",Throughput:(7.8125*a.aa.Kg()).toFixed(0)+" KBPS","Bandwidth (normalized)":a.aa.le()+" KBPS","Max Sustainable Video Bitrate":a.aa.Ob()+" KBPS"}))}catch(D){}try{p(B,function(a,b){f=f||{};f[a]=ab.stringify(b)}),f&&d.push(f)}catch(Ca){}return d}function h(){if(u.selectionStart==u.selectionEnd){var a="";g().forEach(function(b){a=a?a+"\n":"";p(b,function(c){a+=c+": "+b[c]+"\n"})});u.style.fontSize=ya(ja(t.clientHeight/60),8,18)+"px";
u.value=a}}function k(){var b=a.ha.Oc();F=b-ga;ga=b;q()}function q(){n.lb(h)}function m(a){a.ctrlKey&&a.altKey&&a.shiftKey&&(68==a.keyCode||81==a.keyCode)&&f()}var n=new kb(1E3),t=Y("DIV","position:absolute;left:10px;top:10px;right:10px;bottom:10px",l,{"class":"player-info"}),u=Y("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;padding:10px;background-color:rgba(0,0,0,0.4);color:#fff;font-size:12px;font-family:Arial;overflow:auto"),w=Y("DIV","position:absolute;top:2px;right:2px"),
v,y=[a.v,a.i,a.Yb,a.ub,a.F,a.k,a.ec,a.state,a.o,a.A,a.volume,a.muted],A=[Qd,ag],B={},D,F,ga;this.rs=function(a){B.DFR=a};var Da={};Da[$e]="Not Loaded";Da[Kb]="Loading";Da[Sa]="Normal";Da[hh]="Closing";Da[cg]="Closed";var ra={};ra[Wb]="Normal";ra[Lb]="Pre-buffering";ra[Vb]="Network stalled";var E={};E[Ab]="Waiting for decoder";E[Ic]="Playing";E[Ye]="Paused";E[tc]="Media ended";u.setAttribute("readonly","readonly");t.appendChild(u);t.appendChild(w);var Ca=Y("BUTTON",null,"X");Ca.addEventListener("click",
d,!1);w.appendChild(Ca);Xa.addListener(rd,m);a.addEventListener(ib,function(){Xa.removeListener(rd,m);d()});x(this,{toggle:f,show:c,Rg:d,sp:g})}function Ld(a){function b(){A||(h(),a.Xa.appendChild(n),A=!0)}function c(){A&&(a.Xa.removeChild(n),A=!1)}function d(){A?c():b()}function f(){var b=[],c={ranges:[]};a.Aa().forEach(function(a){c.profile||(c.profile=a.no);c.ranges.push({min:a.f,max:a.f})});b.push(c);a.Ih.us(b);a.n.reset();a.Ih.seek(a.v.value)}function g(){var b=a.xa().filter(function(a){return B[a.f]});
b.length||b.push(a.U);return b}function h(){var b=a.W.value,c=a.bc.value,d=a.I;b&&(d=d.slice(),d.sort(function(a,b){return a.Wa-b.Wa}),q(w,b.oa.map(function(b){return{value:b.f,caption:b.f,selected:b==a.F.value}})));c&&(q(v,c.oa.map(function(b){var c=a.Ue.sc(b),d=b=b.f;c&&(d+=" ("+c.join("|")+")");return{value:b,caption:d,selected:a.Aa!=g?!c:B[b]}})),v.removeAttribute("disabled"));d&&(q(y,d.map(function(b){return{value:b.id,caption:"["+b.id+"] "+b.name,selected:b==a.i.value}})),y.removeAttribute("disabled"))}
function k(){A&&h()}function p(a){var b=Y("DIV","display:inline-block;vertical-align:top;margin:5px;");a=Y("DIV",l,a);var c=Y("select","width:120px;height:180px",l,{disabled:"disabled",multiple:"multiple"});b.appendChild(a);b.appendChild(c);t.appendChild(b);return c}function q(a,b){a.innerHTML="";b.forEach(function(b){var c={title:b.caption};b.selected&&(c.selected="selected");c=Y("option",l,b.caption,c);c.value=b.value;a.appendChild(c)})}function m(a){a.ctrlKey&&a.altKey&&a.shiftKey&&83==a.keyCode&&
d()}var n=Y("DIV","position:absolute;left:0;top:50%;right:0;bottom:0;text-align:center;color:#040;font-size:11px;font-family:monospace",l,{"class":"player-streams"}),t=Y("DIV","display:inline-block;background-color:rgba(255,255,255,0.86);border:3px solid #fff;padding:5px;margin-top:-90px"),u=Y("DIV","width:100%;text-align:center"),w=p("Audio Bitrate"),v=p("Video Bitrate"),y=p("CDN"),A,B={};n.appendChild(t);t.appendChild(u);var D=Y("BUTTON",l,"Override");D.addEventListener("click",function(){B={};
for(var b=v.options,d=b.length;d--;){var h=b[d];h.selected&&(B[h.value]=1)}a.Aa=g;a.n.pe();z.pa&&(a.R.ag(),f());if(b=a.I){var k=y.value;(b=b.filter(function(a){return a.id==k})[0])&&b!=a.i.value&&(b.fc={testreason:"streammanager",selreason:"userselection"},a.i.set(b))}c()},!1);u.appendChild(D);D=Y("BUTTON",l,"Reset");D.addEventListener("click",function(){delete a.Aa;a.n.pe();z.pa&&(a.R.ag(),f());c()},!1);u.appendChild(D);Xa.addListener(rd,m);a.addEventListener(ib,function(){Xa.removeListener(rd,m)});
a.i.addListener(k);a.W.addListener(k);a.bc.addListener(k);x(this,{toggle:d,show:b,Rg:c})}function Pe(){function a(){h=!1;for(var b=c.length,k;b--;)k=c[b],g[k]&&(g[k]=!1,f.B(k+"changed",{getModel:d[k]}))}function b(c){g[c]=!0;h||(h=!0,Z(a))}var c=[],d={},f=new lb,g={},h=!1;return{register:function(a,b){c.indexOf(a);d[a]=b;c.push(a)},gh:b,wp:function(a){return(a=d[a])?a():l},addEventListener:function(a,c){f.addListener(a,c);d[a]&&b(a)},removeEventListener:function(a,b){f.removeListener(a,b)}}}function Nf(c,
d,f,h,k,l,p,q){function m(a,h){v.trace("Downloading header",{Cdn:h.id},A);a=a||g;var l={responseType:jc,Xb:Lg,url:w.Qa[h.id],i:h,track:d,stream:w,offset:0,length:y||n(),Cb:f+"-"+k+"-hdr",zc:!0};c.ua.N(l,function(c){var d;if(c.c){try{var f=c.content;if(!y){var g=Xb(f,Mj);y=g.cr+g.bp;if(0<y&&!(y<=f.byteLength)){v.warn("Header size underestimated, retrying",{Estimated:f.byteLength,Actual:y},A);m(a,h);return}}if(!(0<=Xb(f,"ftyp").Ti.indexOf("dash")))throw new La("ftyp is not dash compatable");var k,l,
p=z.Np,g=[],q=p.length,U=0,n=0,t;p.indexOf("moov");for(k=0;k<q;k++)l=Xb(f,p[k]).Ka,g.push(l),U+=l.length;t=new Na(U);for(k=0;k<q;k++)l=g[k],t.set(l,n,l.length),n+=l.length;var x=Xb(kh(t),"moov"),ma=x.rb("trak/mdia/minf/stbl/stsd/mp4a|enca|ec-3|avc1|encv|hvcC");u(x,ma);var aa=Xb(f,"sidx"),Oa=ma.type,f={stream:w,cg:Oa,pg:"encv"==Oa||"enca"==Oa,Mp:t,Hd:x};k=0;switch(w.type){case hb:k=z.Uf;break;case Ra:k=z.nt;try{var S=ma.rb("4E657466-6C69-7846-7261-6D6552617465"),Db=S.$q/S.Ao;b(Db,1)&&(f.Bg=Db)}catch(B){}var D=
ma.rb("pasp"),F=ma.width,Sb=ma.height;D.xf<D.Ge?F=ja(F*D.Ge/D.xf):Sb=ja(Sb*D.xf/D.Ge);F==w.width&&Sb==w.height||v.error("Stream resolution does not match",{Nccp:w.width+"x"+w.height,Header:F+"x"+Sb},A);f.Bo="res: "+ma.width+"x"+ma.height+", par: "+D.Ge+"x"+D.xf}for(var ma=w,E,rc,S=[],nd=aa.sf,Hb=aa.Lr,G=Hb.length,H=Ya(k*nd/1E3),C,J=aa.Ka,L=J.byteOffset+J.byteLength+aa.ap,aa=0,I,K,J=0,N,Db=L,D=aa,F=0;F<G;F++)C=Hb[F],K=aa+C.duration,I=L+C.size,N=K-D,F<G-1&&lc(N-H)>lc(N+Hb[F+1].duration-H)||(E={index:J++,
stream:ma,offset:Db,length:I-Db,startTime:ja(1E3*D/nd),duration:ja(1E3*(K-D)/nd),all:S,next:null,Ja:null},E.Ga={Type:E.stream.type,Bitrate:E.stream.f,ChunkNum:E.index,StartTime:Ea(E.startTime),Duration:Ea(E.duration)},rc&&(E.Ja=rc,rc.next=E,lc(rc.duration-(E.startTime-rc.startTime)),rc.duration=E.startTime-rc.startTime),S.push(E),rc=E,D=K,Db=I),L=I,aa=K;f.t=S;f&&(v.trace("Header parsed",{Chunks:f.t.length},A),w.j=f);z.pa&&(fa.Ka=c.parsed?c.Ka:c.content,fa.Ka=fa.Ka.slice(0,y));d=fa}catch(Q){v.error("Exception while parsing header",
Q,A),d={c:!1,g:M.Af}}a(d)}else v.warn("Unable to download header",Va(c),A),a(c)})}function n(){return pd(Ik+c.mj*Jk)}function u(a,b){var d=z.Ip;d.length&&a.children.forEach(function(a){"pssh"==a.type&&0<=d.indexOf(a.rd)&&a.Ka&&a.Ka.set([102,114,101,101],4)});if(z.el&&f==hb){var g=a.rb("mvex/trex");g.kg.zk&&(v.trace("Applying sampleIsDifferenceSample workaround",A,{Box:"trex"}),gd(g))}if(z.ut&&"playready"==jb()&&"encv"==b.type){var h=function(){var a=c.U.j.Hd.children.filter(function(a){return"pssh"==
a.type&&"9A04F079-9840-4286-AB92-E65BE0885F95"==a.rd})[0],d;try{d=ic(Oc(a.data.subarray(10,a.data.length-10),"KID"))}catch(f){v.error("Exception parsing KID in PSSH",f)}d&&16==d.length&&b.children.map(function(a){try{if("sinf"==a.type)return a.rb("schi/tenc|8974DBCE-7BE7-4C51-84F9-7148F9882554")}catch(b){v.error("Exception finding TENC box",b)}}).filter(t).forEach(function(a){var b=a.Uj;if(b&&Qa(d,b)){var c=function(a,c){var d=b[a];b[a]=b[c];b[c]=d};v.trace("Applying KID byte order workaround",A,
{Box:a.type});c(0,3);c(1,2);c(4,5);c(6,7)}})};if(c.U)h();else{var k=function(a){a.newValue==Sa&&(c.state.removeListener(k),h())};c.state.addListener(k)}}}var w=this,v=new c.log.r("CadmiumMediaStream"),y,A={Type:f,Bitrate:k,DownloadableId:h};x(w,{track:d,type:f,J:h,f:k,no:q,size:l,Qa:p,j:null,lj:n,Ba:rb(function(b){function d(a){if(a.c)b(a);else{var c,h;for(h=0;h<g.length;h++)if(c=g[h],f[c.id]>z.Cp)c=null;else break;c?(f[c.id]=(f[c.id]||0)+1,m(d,c)):b(a)}}w.Ie=!0;var f={},g=Ve.call(c.I,function(b){return a(p[b.id])});
d({c:!1})}),Ga:A,toJSON:function(){return A},Wp:function(){var a=!1,b;f===Ra?b=c.Aa():f===hb&&(b=c.Eb());-1!==b.indexOf(this)&&(a=!0);return a}})}function Lg(a){var b=new Na(a),b=kh(b);b.byteLength=a.byteLength;return b}function Rb(a,b,c){if(a==hb)return b;if(a==Ra)return c}function Ac(a){return!!a.j}function Vc(a){return!a.j}function Of(a){return a.map(function(a){return a.f})}function zg(a){function b(d,f){var g=d.length,h=L-t(f);if(h>g)return!0;var k=a.v.value,p,q,m;m=k-J;p=G.first;for(q=C.first;p||
q;)if(p&&p.endTime>=m&&(p=l),q&&q.endTime>=m&&(q=l),p&&(!q||p.endTime<q.endTime)?(h+=c(p),p=p.next):q&&(h+=c(q),q=q.next),h>g)return!0;p=G.Q;for(q=C.Q;p||q;)if(p&&p.startTime<=d.startTime&&(p=l),q&&q.startTime<=d.startTime&&(q=l),p&&(!q||p.startTime>q.startTime)?(h+=c(p),p=p.Ja):q&&(h+=c(q),q=q.Ja),h>g)return!0;m=k-W*(d.startTime-k);p=G.first;for(q=C.first;p||q;)if(p&&p.endTime>=m&&(p=l),q&&q.endTime>=m&&(q=l),p&&(!q||p.endTime<q.endTime)?(h+=c(p),p=p.next):q&&(h+=c(q),q=q.next),h>g)return!0}function c(a){var b=
a.media;a.media=null;a.qc=l;a.va(Jc);return b?b.length:0}function f(){return ea(p(),m())}function g(){return L?z.Hb?ya((q()+n())/z.Hb,0,1):0:ya(f()/z.Gd,0,1)}function h(){return K?A(G):B(G)}function k(){return K?A(C):B(C)}function p(){var b=a.v.value,c=md(b,G);return c?qa(0,c.endTime-b):0}function q(){return Pf(a.v.value,G)}function m(){var b=a.v.value,c=md(b,C);return c?qa(0,c.endTime-b):0}function n(){return Pf(a.v.value,C)}function t(b){for(var c=Pa.length,d,f,g=0,h=a.k.value.j.t,k=a.F.value.j.t;c--;)d=
Pa[c],(f=d.media)?g+=f.length:b&&d.se&Kk&&(d.type===Ra?g+=h[d.index].length:d.type==hb&&(g+=k[d.index].length));return g}function u(a){a=a.first;for(var b=[];a;)a.media&&a.qc&&b.push(a.qc.Kv()),a=a.next;return b}function w(){return{AudioBufferLength:Ea(p()),VideoBufferLength:Ea(m())}}function v(b){for(var d=a.v.value,f,g,h=b.first,k=0;h;)h.media&&(f=f||h,g=h,k+=h.duration),h=h.next;d=qa(d-J,0);for(d=b.fb(d).index;k>ca&&f&&f.index<d;)f.media&&(c(f),k-=f.duration),f=f.next;for(b=b.fb((f?f.endTime:a.v.value)+
ca).index;k>ca&&g&&g.index>b;)g.media&&(c(g),k-=g.duration),g=g.Ja}function y(){v(G);v(C);if(z.pa){var b={};b[Lk]=u(G);b[Mk]=u(C);a.Ih.Dr(b,a.v.value)}}function A(b){for(b=b.fb(a.v.value);b&&(b.media||b.se!==Jc);b=b.next);return b}function B(b){for(b=b.fb(a.v.value);b&&b.media;b=b.next);return b}function F(){a.fireEvent(Qd);ra.gh("buffer")}function ga(b,d){E.trace("Disgarding media due to a track change");for(var f=d.first;f;)f.media&&f.media.stream.track!=b&&c(f),f=f.next;a.fireEvent(Ni);F()}var E=
new a.log.r("MediaBuffer"),ra=a.lg,G=Qf(a.Xc,145152E5),Ca=a.U,H=a.ta,C=Qf(a.U,z.io?G.Q.endTime+ja(1E3/(Ca.j.Bg||60)):l),Pa=G.concat(C),J=z.Ei,ca=z.Gd,L=z.Hb,W=z.Kn/100,I=ca-J,K="parallel"===z.dg,Ca=new Td(function(){var a;if(!(a=.9<=g())){a=h();var b=k();a=!(a||b)}return a}),N=a.U.j.t;N.length!=C.length&&(N=N[N.length-1],E.error("Clipping video chunks to be less than audio",{FromEndTime:Ea(N.startTime+N.duration),ToEndTime:Ea(C.Q.endTime),AudioEndTime:Ea(G.Q.endTime)}));if(!(0<=J&&ca>G.first.duration&&
ca>=2*J))throw new La("bad buffer size");a.W.addListener(function(a){ga(a.newValue,G)});a.bc.addListener(function(a){ga(a.newValue,C)});a.addEventListener(dg,function(){var a;for(a=G.first;a;)a.media=null,a.qc=null,a=a.next;for(a=C.first;a;)a.media=null,a.qc=null,a=a.next});x(this,{$a:G,yb:C,Fb:h,Tb:k,sb:function(){var b=a.v.value,c=h(),d=k();c&&c.startTime-b>I&&(c=null);d&&d.startTime-b>I&&(d=null);if(d)if(c){if(d.startTime<=c.startTime&&c.startTime>b)return d}else return d;return c},vf:L?b:d,Ld:function(b,
c,d,f,g,h,k){for(var p=0,q=0;q<b.length;q++){var m=b[q],n=c[q];if(d.type==hb&&d.track!=a.W.value||d.type==Ra&&d.track!=a.bc.value){E.trace("Rejecting received chunk because it doesn't match most recent track",m,d);return}if(m.media&&m.media.stream.f>=d.f){if(m.media.stream.Wp()){m.va(Oi);E.warn("Rejecting received chunk because it is lower bitrate than existing chunk",m,d);return}m.media=null;z.pa&&(m.qc=l)}var t=1<b.length?new Na(new Na(f.buffer,p,n.length)):f,p=p+n.length;m.media={stream:d,Tf:t,
length:t.length,i:g};m.va(Oi);z.pa&&k&&(m.qc=k,k.Du=!0);y();Rb(d.type,a.Fc,a.Ra).set({G:m,stream:d,i:g,dj:h});E.trace("Received chunk",m,{CdnId:g.id},w())}F()},Rq:function(a){a.Cd=!0;z.$i&&(a=a.media)&&(a.Tf=null)},Uq:function(a){a.Cd=l;z.$i&&c(a)},Tq:function(){for(var a=Pa.length,b,d;a--;)b=Pa[a],b.Cd=l,(d=b.media)&&!d.Tf&&c(b)},pe:function(){for(var b=a.Aa(),d=C.first,f;d;)d.media&&!d.Cd&&0>b.indexOf(d.media.stream)&&(c(d),f=!0),d=d.next;f&&(E.trace("Disgarding media based on stream filters"),
F())},Do:function(){for(var b=a.Aa(),d=C.first,f,g,h,k=H.Hg(),k=qa(k,8008);d;)d.media&&(d.Cd&&(g=d.index,h=g+k/d.duration),!(d.index>=g&&d.index<=h)&&0>b.indexOf(d.media.stream)&&(c(d),f=!0)),d=d.next;f&&(E.trace("Discarding media based on stream filters"),F())},mp:function(){var b=a.v.value,c=md(b,G),d=md(b,C),f;c&&d&&(f=ea(c.endTime,d.endTime));return D(f,b)},Mc:f,wj:g,qb:p,pj:q,Fa:m,Dj:n,Hv:u,xd:t,Iv:function(){var b=a.v.value,c=md(b,C);return c?c.endTime:b},Ee:w,Wg:Ca.get,compact:y,reset:function(){var a;
for(a=G.first;a;)a.media&&(c(a),a.va(Jc),a.Cd=l,a.qc=l),a=a.next;for(a=C.first;a;)a.media&&c(a),a=a.next},Ov:function(b){var c=a.v.value;return(b=b.G)&&b.startTime-c>I?!1:!0}})}function md(a,b){var c=b.fb(a);if(c.media){for(;c.next&&c.next.media;)c=c.next;return c}}function Pf(a,b){var c=b.fb(a),d=0;for(c&&c.media&&(d+=ja(ya((a-c.startTime)/c.duration,0,1)*c.media.length),c=c.next);c&&c.media;)d+=c.media.length,c=c.next;return d}function Qf(a,b){var c=a.j.t,d,f=[],g,h,k=c.length;if(1>=k)throw new La("few chunks");
for(var l=0;l<k;l++){d=c[l];g=d.startTime;d=d.duration;var p=g+d;if(p>b)break;g={type:a.type,index:l,startTime:g,duration:d,endTime:p,se:Jc,media:null,all:f,Ja:null,next:null,va:function(a){this.se=a}};g.Ga={Type:g.type,"Chunk index":g.index,StartTime:Ea(g.startTime),EndTime:Ea(g.endTime)};h&&(h.next=g,g.Ja=h);h=g;f.push(g)}f.fb=hf;f.first=f[0];f.Q=h;f.nn=2<=f.length?(f.length-1)/(f.Q.startTime-f.first.startTime):1;return f}function hf(a){for(var b=this[ya(ja(a*this.nn),0,this.length-1)];b.startTime>
a&&b.Ja;b=b.Ja);for(;b.endTime<a&&b.next;b=b.next);return b}function Zc(a,b,c){function d(a){if(a.c){var b=a.L;u[b.stream.type+"$"+b.i.id]=a.D}w--;f()}function f(){if(!(0<w)||x){var a,b,c,d,g=[],k;for(k=0;k<p.length;k++)a=p[k],c=u[hb+"$"+a.id],d=u[Ra+"$"+a.id],c&&d&&(c=qa(c.O-c.requestTime,d.O-d.requestTime),g.push({i:a,Fd:c}),b=b===l?c:ea(c,b));if(k=g.length){for(;k--&&1<g.length;)a=g[k],a.Fd>b+z.ms&&g.splice(k,1);h(g[0].i)}else 0>=w&&h()}}function h(a){a&&(a.fc={testreason:b,selreason:"relativelatency"});
h=f=g;c({c:!!a,mb:a})}var k=a.ua,p=a.I,q=a.F.value,m=a.k.value,n=a.n;a=n.Fb();for(var n=n.Fb(),t,u={},w=0,x,v,y=0;y<p.length;y++)t=p[y],v=Kc(t,q,a),t=Kc(t,m,n),v&&t&&(w+=2,k.N(v,d),k.N(t,d));Ka(function(){x=!0;f()},z.os)}function Kc(a,b,c){if(b.Qa[a.id])return{responseType:jc,url:b.Qa[a.id],Xb:Rf,offset:b.j.t[c?c.index:0].offset,length:8,i:a,track:b.track,stream:b,Cb:b.type+"-"+b.f+"-ping",zc:!0}}function Rf(a){a=new Na(a);a=new Gc(a);var b=a.l();if(8>b||b>Nk)throw new La("cdnping-badsize");if("moof"!=
a.Lb(4))throw new La("cdnping-badtype");return!0}function qe(a,b,c){function d(b,c){var h=x[b.da].I,k;c.type==Ra?(k=(a.o.value==Wb?u.Nc():u.gb()).k,k.j||(k=a.U)):k=a.F.value;for(var l=0;l<h.length;l++){var p=h[l];if(b.sa===l){var q=a.n.Fa(),q=sg(c,k,p,z.ie,q);n.trace("Downloading",{CdnId:p.id},c,k,{Count:q.wa.length,Offset:q.offset,Length:q.length});t.N(q,f)}else q=Kc(p,k,c),n.trace("Pinging",{CdnId:p.id},c,k),t.N(q,g)}}function f(a){var b=a.L;a.c?v.Ld(b.wa,b.Qc,b.stream,a.content,b.i,a.D):b.wa&&
b.wa.forEach(function(a){a.media=null;a.va(Jc)});h(a);k()}function g(a){h(a)}function h(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(y[d]||(y[d]={}),y[d][c]={i:b,D:a.D}):y[d]&&y[d][c]&&delete y[d][c]}function k(){var a,f=x[A.da];a=f.id;f=f.I[A.sa].id;a=y[a]&&y[a][f]?q(y[a][f].D):void 0;if(a>z.mf)a=x[A.da].I[A.sa],a.fc={testreason:b,selreason:"fastselection",fastselthreshold:z.mf},c({c:!0,mb:a});else{if(f=a=v.sb()){var f=A,g=x[f.da].id,h=x[f.da].I[f.sa].id;y[g]&&y[g][h]?f=l(f):(f.sa<x[f.da].I.length-
1?(f.sa++,g=!0):g=void 0,f=g||l(f))}f?d(A,a):(a=m(y),c({c:!!a,mb:a}))}}function l(a){if(a.da<x.length-1)return a.da++,a.sa=0,!0}function q(a){if(a)return 7.8125*a.X/(a.M-a.requestTime)}function m(a){var c,d=0;p(a,function(a,b){b&&p(b,function(a,b){var f=q(b.D)*b.i.location.weight;f>d&&(d=f,c=b.i)})});c&&(c.fc={testreason:b,selreason:"maxweightedbw"});return c}var n=new a.log.r("CdnSelBw"),t=a.ua,u=a.ta,w=a.aa,x=a.Hh,v=a.n,y={},A={da:0,sa:0},B=v.sb();B?d(A,B):c({c:!0,mb:a.i.value||a.Od});return{hb:function(){return w.ga(z.ie)*
(x.length-A.da)}}}function Mg(a,b,c,d,f){function g(b,f){var l=y[b.da].I,p;f.type==hb&&(p=a.F.value);for(var q=0;q<l.length;q++){var m=l[q];f.type==Ra&&((p=c.tj(m.location.id))?(p=d.ca(p+1,!0),B.push(m.location.id)):(p=x.gb(!0),p=p.k,p.j||(p=a.U)));if(b.sa===q){var n=a.n.Fa(),n=sg(f,p,m,z.ie,n);u.trace("Downloading",{CdnId:m.id},f,p,{Count:n.wa.length,Offset:n.offset,Length:n.length});w.N(n,h)}else n=Kc(m,p,f),u.trace("Pinging",{CdnId:m.id},f,p),w.N(n,k)}}function h(a){var b=a.L;a.c?A.Ld(b.wa,b.Qc,
b.stream,a.content,b.i,a.D):b.wa&&b.wa.forEach(function(a){a.media=null;a.va(Jc)});l(a);q()}function k(a){l(a)}function l(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(D[d]||(D[d]={}),D[d][c]={i:b,D:a.D}):D[d]&&D[d][c]&&delete D[d][c]}function q(){var c,d=y[F.da];c=d.id;d=d.I[F.sa].id;c=D[c]&&D[c][d]?n(D[c][d].D):void 0;if(c>z.mf)c=y[F.da].I[F.sa],c.fc={testreason:b,selreason:"fastselection",fastselthreshold:z.mf},f({c:!0,mb:c,nb:-1<B.indexOf(a.i.value)});else{if(d=c=A.sb()){var d=F,h=y[d.da].id,k=y[d.da].I[d.sa].id;
D[h]&&D[h][k]?d=m(d):(d.sa<y[d.da].I.length-1?(d.sa++,h=!0):h=void 0,d=h||m(d))}d?g(F,c):(c=t(D),f({c:!!c,mb:c,nb:-1<B.indexOf(a.i.value)}))}}function m(a){if(a.da<y.length-1)return a.da++,a.sa=0,!0}function n(a){if(a)return 7.8125*a.X/(a.M-a.requestTime)}function t(a){var c,d=0;p(a,function(a,b){b&&p(b,function(a,b){var f=n(b.D)*b.i.location.weight;f>d&&(d=f,c=b.i)})});c&&(c.fc={testreason:b,selreason:"maxweightedbw"});return c}var u=new a.log.r("CdnSelCarrera"),w=a.ua,x=a.ta,v=a.aa,y=a.Hh,A=a.n,
B=[],D={},F={da:0,sa:0},E=A.sb();E?g(F,E):f({c:!0,mb:a.i.value||a.Od,nb:-1<B.indexOf(a.i.value)});return{hb:function(){return v.ga(z.ie)*(y.length-F.da)}}}function Sf(a){function c(){cd.removeEventListener(oe,f);v&&v.response&&v.response.abort()}function d(){var a=w.sb();v&&v.response&&a!=v.G&&v.response.abort();f()}function f(){if(a.state.value==Sa&&a.A.value!=tc)if(a.ld&&a.ld<=X())a.o.value!=Wb&&a.Pa(new mb(O.yf));else if(a.o.value==Lb&&(fd()||a.o.set(Vb)),a.o.value==Vb&&fd()&&a.o.set(Lb),a.F.value.j)if(a.k.value.j)if(C)k(C),
C=l;else{var b=w.sb(),c;a.o.value!=Wb&&(c=t.gb(),0>=c.jb&&0>=c.kb&&h("Heuristics"),b||h("Full"));if(!(v||y&&y.stream.type==Ra&&y.stream.f>a.k.value.f)){if(b){a.o.value==Wb&&(c=t.Nc());var d=b.index,g;if(b.type==Ra)g=c.k,g.j&&g.j.t[d]||(m.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:g.f,BitrateNew:a.U.f}),g=a.U),g!=a.k.value&&(m.trace("Stream switch",{BitraetOld:a.k.value.f,BitrateNew:g.f}),a.k.set(g));else if(b.type==hb)g=a.F.value;else return;
var x=g.j.t[d];w.vf(x)||(g.type==hb&&w.qb()<z.Va?m.trace("Ignoring max buffer bytes",b,g):g.type==Ra&&w.Fa()<z.Va?(g=a.xa().ba(0,!0),x=g.j.t[d],m.trace("Ignoring max buffer bytes, and reverting to lowest video stream",b,g)):(h("NoRoom"),x=l));if(x){if(a.o.value==Lb&&c){for(var d=c.jb,A=c.kb,ma=w.Fb(),aa=w.Tb(),Db=a.F.value.j.t,G=a.k.value.j.t,ra=0;0<d&&ma;)ma.media||ma==b||(ra+=u.ga(Db[ma.index].length)),d-=ma.duration,ma=ma.next;for(;0<A&&aa;)aa.media||aa==b||(ra+=u.ga(G[aa.index].length)),A-=aa.duration,
aa=aa.next;E=ra;D=u.ud();F=qa(u.ga(x.length)-D,1)}else F=D=E=l;if(B>z.Ck){k("dlfail");return}x=a.i.value;d=a.n.Fa();d=sg(b,g,x,l,d);m.trace("Downloading chunk",b,g,{Offset:d.offset,Length:d.length});b.va(bf);Rb(g.type,a.te,a.ue).set({G:b,stream:g,i:x});v={type:lh,stream:g,G:b,response:n.N(d,q)}}}!y&&c&&c.Ua&&p(c.Ua)}}else p(a.k.value);else p(a.F.value)}function h(b){a.o.value!=Wb&&(m.trace("Buffering complete",{Cause:b},w),a.o.set(Wb),G||(G=!0,a.na("pb")))}function k(b){m.trace("Selecting a CDN");
v={type:Pi};switch(z.Dk){case "bandwidth":b=qe(a,b,q);v.hb=b&&b.hb;break;default:Zc(a,b,q)}}function p(a){function b(){y==c&&(y=null);c=null;f()}if(!(y&&y.stream==a||a.Ie)){m.trace("Downloading header",a);var c={stream:a,Cs:X()};y=c;a.Ba(b);Ka(b,z.Fj)}}function q(b){var c=v;v=null;a.state.value==Sa&&(c.type!=Qi&&(b.c?(B=0,c.type==lh?(c=b.L,a.o.value==Vb&&a.o.set(Lb),w.Ld(c.wa,c.Qc,c.stream,b.content,c.i,b.D)):a.i.set(b.mb)):b.g!=M.Za&&(v={type:Qi},Ka(q,A[B]),++B>=A.length&&(a.o.value==Lb&&a.o.set(Vb),
B=A.length-1))),f())}var m=new a.log.r("MediaDownloader"),n=a.ua,t=a.ta,u=a.aa,w=a.n,x=new kb(500),v,y,A=z.eb,B=0,D,F,E,G,C="startup";(function(){Z(f);a.addEventListener(af,function(){Z(f)});a.addEventListener(Ze,function(b){b.Ac==mh&&a.o.set(Lb);Z(f)});a.addEventListener(Pd,function(){var b;a.F.value.j&&a.k.value.j&&(b=t.gb());b&&0>=b.jb&&0>=b.kb?m.trace("Repositioned without rebuffer",w):(m.trace("Repositioned, buffering",w),a.o.set(Lb));x.lb(d)});cd.addEventListener(oe,f);a.addEventListener(ib,
c)})();this.nc=function(){var c;if(a.o.value==Lb&&v){var d;try{if(v.type==lh){var f=v.response,g=f.D;if(b(g.O))d=(1-(g.X||0)/f.L.length)*F;else{var h=X()-g.requestTime;d=qa(D-h,0)+F}}}catch(k){}c=(d||0)+(E||0);(d=v.hb&&v.hb())&&(c=qa(d,c))}return c};this.Fg=g;this.vd=function(){return.99}}function sg(a,b,c,d,f){var g=b.j.t,h=g[a.index].offset,k=0,l=[],p=[];do{var q=g[a.index],k=k+q.length;l.push(a);p.push(q);a=a.next}while(k<d&&a);a=z.Pb;t(f)&&z.kt&&!z.Hb&&(a=Ba.max(z.Hq,Ba.min(f/z.lo,z.Pb+f/z.Gd*
z.mo)));return{responseType:jc,Xb:Ua,url:b.Qa[c.id],offset:h,length:k,i:c,track:b.track,stream:b,wa:l,Qc:p,Cb:b.type+"-"+b.f+"-"+l.map(function(a){return a.index}).join("+"),zc:!0,Pb:a}}function tg(){var a;a=["avc1.640028","hev1.2.6.L153.B0","dvhe.01000000"].filter(function(a){a=Mb('{0}/mp4;codecs="{1}"',"video",a);return sd.isTypeSupported(a)});return Mb('{0}/mp4;codecs="{1}"',"video",a.join(", "))}function ug(a){function b(){fd()&&m&&m.Xd()}function c(a,b){k.trace(Mb("transitioning from {0} to {1}, reason: {2}",
m&&m.getName()||"null",a.getName(),b));m&&m.ug();m=a;m.Hc();d()}function d(){t.lb(f)}function f(){a.state.value==Sa&&(w(),m.update())}function h(){var a=z.ir;l.wj()>a&&(u.Y.yh(p),w=g)}var k=new a.log.r("ParallelMediaDownloader"),l=a.n,p=z.Yj,q,m,n,t=new kb(Ok),u={R:this,Y:{},Rb:new qb(z.Ck)},w=h;a.cb=u;u.Y="subchunk"===z.hr?new ua(p,p,a):new xd(p,a);u.Bc="startup";(function(){function f(){d()}q=new wd(a,u);"carrera"==z.Vg?c(q.Lp,"using carrera for initial playback."):c(q.Zf,"select first CDN before playback.");
n=cb(d,500);u.Y.addEventListener(jg,f);a.addEventListener(ib,function(){gb(n);t.Ec();cd.removeEventListener(oe,b);u.Y.removeEventListener(jg,f);u.Y.yc()});d();a.addEventListener(af,function(){d()});a.addEventListener(Ze,function(a){a.Ac==mh&&(u.Y.yh(1),w=h,m.dr(),d())});a.addEventListener(Pd,function(){m.lk();d()});a.addEventListener(Ki,function(){m.Xd()});cd.addEventListener(oe,b)})();this.Oa=c;this.nc=function(){return m.nc()};this.ag=function(a){u.Y.od();u.Y.yc(a)};this.Fg=function(){return m&&
m.getName()||"null"};this.vd=function(){return m.vd()}}function td(a){var b=a.cb,c,d=b.Y,f=b.R,h=b.pb;this.getName=function(){return"BaseState"};this.Rc=function(){this.log=new a.log.r(this.getName())};this.Rc();this.vd=function(){return.99};this.Xd=this.update=this.ug=this.Hc=g;this.dr=function(){a.o.set(Lb);f.Oa(h.Kr,"buffer underrun")};this.lk=function(){f.Oa(h.th,"user seek")};this.oj=function(){return c};this.nc=function(){return 0};this.uh=function(){return b.Rb.Jk(a.i.value)?(b.Bc="dlfail",
b.Db=0,f.Oa(h.Zf,"download failures"),!0):!1};this.ng=function(a,b){d.Gc({G:a,gf:b})};this.Ba=function(a){function b(){c==d&&(c=null);d=null}if(!(c&&c.stream==a||a.Ie)){this.log.trace("Downloading header",a);var d={stream:a,Cs:X()};c=d;a.Ba(b);Ka(b,z.Fj)}};this.Cg=function(b,c){if(b.type===Ra)var d=c.k;else if(b.type==hb)d=a.F.value;else return l;return d.j.t[b.index]}}function vg(a){function b(){f.Dh()&&(h.od(),h.yc())}var c=new td(a),d=a.cb,f=a.ta,g=a.n,h=d.Y,k=new kb(1E3);x(this,c);d.Bc="startup";
this.getName=function(){return"PlayingState"};this.Hc=function(){d.Rb.Si();a.o.set(Wb);z.ep&&a.A.set(Ic);d.Y.vb(!0)};this.update=function(){if(a.state.value==Sa&&a.A.value!=tc)if(k.lb(b),a.ld&&a.ld<=X())a.o.value!=Wb&&a.Pa(new mb(O.yf));else if(!a.F.value.j)this.Ba(a.F.value);else if(!a.k.value.j)this.Ba(a.k.value);else if(!this.uh()){var c=g.sb(),h=this.oj();if(!(h&&h.stream.type==Ra&&h.stream.f>a.k.value.f)&&c&&d.Y.Xe()){var l=f.Nc(),p=this.Cg(c,l);g.vf(p,!0)&&a.o.value==Wb&&this.ng(c,l);!h&&l&&
l.Ua&&this.Ba(l.Ua)}}}}function wg(a){function b(c){t.log.trace("in _exitBufferingState()");a.o.value!=Wb&&(t.log.trace("Buffering complete",{Cause:c},h),p||(p=!0,a.na("pb")));f.Oa(q.cf,"exiting buffering: "+c)}var c=new td(a),d=a.cb,f=d.R,g=d.Y,h=a.n,k=a.ha,l=a.aa,p,q=d.pb,m=a.ta,n,t=this;x(this,c);this.getName=function(){return"BufferingState"};this.Hc=function(){a.o.set(Lb);d.Y.vb(!0)};this.nc=function(){g.Lg();return n};this.update=function(){fd()?a.o.value==Vb&&a.o.set(Lb):a.o.set(Vb);if(!a.F.value.j)this.Ba(a.F.value);
else if(!a.k.value.j)this.Ba(a.k.value);else if(!this.uh()){var c=h.sb(),f=m.gb();if(k.ig()){if(0>=f.jb&&0>=f.kb){b("Heuristics");return}if(!c&&h.Wg()){b("Full");return}}for(var g=f.jb,p=f.kb,q=h.Fb(!0),u=h.Tb(!0),w=a.F.value.j.t,x=a.k.value.j.t,v=0;0<g&&q;)q.media||q==c||(v+=l.ga(w[q.index].length)),g-=q.duration,q=q.next;for(;0<p&&u;)u.media||u==c||(v+=l.ga(x[u.index].length)),p-=u.duration,u=u.next;n=v;g=this.oj();if(!(g&&g.stream.type==Ra&&g.stream.f>a.k.value.f)){if(c&&d.Y.Xe()){if(!f.k.j){this.Ba(f.k);
return}p=this.Cg(c,f);h.vf(p,!0)&&this.ng(c,f)}!g&&f&&f.Ua&&t.Ba(f.Ua)}}}}function xg(a){var b=new td(a),c=a.cb,d=c.R,f=c.Y,g=a.ta,h=a.n,k=c.pb;x(this,b);this.getName=function(){return"SeekingState"};this.Hc=function(){f.od();f.yc()};this.update=function(){var b;a.F.value.j&&a.k.value.j&&(b=g.gb());b&&0>=b.jb&&0>=b.kb&&a.o.value!==Vb?(this.log.trace("Repositioned without rebuffer",h),d.Oa(k.cf,"no buffering required during seek.")):(this.log.trace("Repositioned, buffering",h),d.Oa(k.o,"buffering required during seek."))}}
function yg(a){var b=new td(a),c=a.cb,d=c.R,f=c.Y,g=c.pb;x(this,b);this.getName=function(){return"RebufferingState"};this.Hc=function(){f.od();f.yc()};this.update=function(){c.Bc="buffer underrun";d.Oa(g.Zf,"CDN selection due to rebuffer.")}}function ud(a){function b(){fd()?u.lb(c):this.$f()}function c(){if(!q){q={type:Pi};var b=k.Bc;w.log.trace("Selecting a CDN");if("startup"===b&&"carrera"===z.Vg)b=Mg(a,b,w.Yf,w.oa,f),q&&(q.hb=b&&b.hb);else switch(z.Dk){case "bandwidth":b=qe(a,b,d);q&&(q.hb=b&&
b.hb);break;default:Zc(a,b,d)}}}function d(b){b.c?(a.i.set(b.mb),w.log.trace("cdn selected: ",{name:b.mb.name}),k.Bc=l,m||(a.o.value==Lb||a.o.value==Vb?k.R.Oa(k.pb.o,"underrun, buffer media before resume."):k.R.Oa(k.pb.cf,"buffer has media, resume playback"))):(w.$f(),a.o.value==Vb&&(u.zh(n[t]),t=t<n.length-1?t+1:n.length-1),q=null);m&&k.R.Oa(k.pb.th,"user seek")}function f(b){b.c?(a.i.set(b.mb),w.log.trace("cdn selected: ",{name:b.mb.name}),k.Bc=l,k.nb=b.nb):(w.$f(),a.o.value==Vb&&(u.zh(n[t]),t=
t<n.length-1?t+1:n.length-1),q=null);m&&k.R.Oa(k.pb.th,"user seek")}function g(){var b=a.Aa(),c=b.length;x(b,le);for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ad=b[d+1];return b}var h=new td(a),k=a.cb,p=k.Y,q,m,n=z.eb,t=0,u=new kb(0),w=this;"carrera"===z.Vg&&(w.Yf=new Jg(a),w.oa=g());x(this,h);this.getName=function(){return"CDNSelectionState"};this.nc=function(){var a=p.Lg()||0;if(q){var b=q.hb&&q.hb();b&&(a=qa(b,a))}return a};this.Hc=function(){u.zh(0);t=0;k.Rb.Si();m=!1};this.ug=function(){u.Ec();
q=null};this.Xd=function(){a.o.value==Vb&&fd()&&u.$r(c)};this.update=z.ft&&b||c;this.lk=function(){m=!0};this.$f=function(){a.o.value==Lb&&a.o.set(Vb)};this.vd=function(){return.5}}function vd(a){function b(c){t.log.trace("in _exitBufferingState()");a.o.value!=Wb&&(t.log.trace("Buffering complete",{Cause:c},g),q||(q=!0,a.na("pb")));f.Oa(p.cf,"exiting buffering: "+c)}var c=new ud(a),d=a.cb,f=d.R,g=a.n,h=a.ha,k=a.aa,l=a.ta,p=d.pb,q,m=!1,n,t=this;d.nb=!1;x(this,c);this.getName=function(){return"InitBitrateSelectionState"};
this.ug=function(){a.nb=d.nb;a.Ni=t.Yf.pp()};this.update=function(){if(a.i.value)a:if(!a.F.value.j)t.Ba(a.F.value);else if(!a.k.value.j)t.Ba(a.k.value);else{if(!t.uh()){var f=g.qb()>=z.Uf?0:z.Uf-g.qb(),p=g.Fa()>=z.Mi?0:z.Mi-g.Fa();if(d.nb&&0===p&&0===f&&h.ig())b("Carrera");else{n||m||(n=t.Yf.tj(a.i.value.location.id));m=!n;var q=g.sb();if(m){if(f=l.gb(!0),0>=f.kb&&0>=f.jb&&h.ig()){b("Heuristics");break a}}else{d.nb=!0;var u=t.oa.ca(n+1,!0),w=t.oa.ba(n+1,!1),f={k:u,Ua:w,jb:f,kb:p}}for(var p=f.jb,u=
f.kb,w=g.Fb(!0),x=g.Tb(!0),v=a.F.value.j.t,y=a.k.value.j.t,A=0;0<p&&w;)w.media||w==q||(A+=k.ga(v[w.index].length)),p-=w.duration,w=w.next;for(;0<u&&x;)x.media||x==q||(A+=k.ga(y[x.index].length)),u-=x.duration,x=x.next;q&&d.Y.Xe()&&(p=t.Cg(q,f),g.vf(p,!0)&&t.ng(q,f))}}}else c.update.apply(t)}}function wd(a,b){function c(b){b=new b(a);b.Rc.call(b);return b}b.pb=this;this.cf=c(vg);this.th=c(xg);this.Kr=c(yg);this.Zf=c(ud);this.o=c(wg);this.Lp=c(vd)}function Lc(a,b,c){function d(){!q&&l&&(p=a.Dc())&&
f(p)}function f(a){function c(a){var f;b.state.value==Sa&&(a&&a.c?(m.Db=0,f=a.L,h.Ld(f.wa,f.Qc,f.stream,a.content,f.i,a.D)):(p&&(f=p.G)&&(f.media=null,f.va(Jc)),a&&a.g==M.Za||(a&&(f=a.L,m.Rb.Mh(f.i,f.wa[0],f.stream)),++m.Db>=m.eb.length&&(m.Db=m.eb.length-1))),Z(d));n.B(Ri);p=null;q&&(q=null)}var l=a.G,t=a.gf,u=l.index;if(l.type===Ra)t=t.k,t.j&&t.j.t[u]||(g.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:t.f,BitrateNew:b.U.f}),t=b.U),t!=b.k.value&&
(g.trace("Stream switch",{BitrateOld:b.k.value.f,BitrateNew:t.f,"Chunk Index":u}),b.k.set(t,{Ri:t.j.t[u].startTime}));else if(l.type==hb)t=b.F.value;else return;if(t.j.t[u]){var w=b.i.value,u=ec(l,t,w);l.va(bf);Rb(t.type,b.te,b.ue).set({G:l,stream:t,i:w});q=l={type:Pk,stream:t,G:l};l.response=k.N(u,c);a.response=l.response}}var g=new b.log.r("MediaDownloadWorker"),h=b.n,k=b.bh,l=c,p,q,m=b.cb,n=new lb;this.addEventListener=n.addListener;m.eb=z.eb;m.Db=0;a.addEventListener(Si,function(a){!q&&l&&(a.Ej=
!0,d())});this.isEnabled=function(){return l};this.vb=function(a){l=a};this.Eg=function(){return p};this.Pf=function(a){q&&q.response&&p&&(a?a(p):1)&&(p.G.media=null,p.G.va(Jc),g.trace("Aborted download of chunk:",p.G.index),q.response.abort(),p=q=null)}}function ec(a,b,c){var d=b.j.t,f=d[a.index].offset,g=0,h=[],k=[];do{var l=d[a.index],g=g+l.length;h.push(a);k.push(l);a=a.next}while(void 0>g&&a);return{responseType:jc,Xb:Ua,url:b.Qa[c.id],offset:f,length:g,i:c,track:b.track,stream:b,wa:h,Qc:k,Cb:b.type+
"-"+b.f+"-"+h.map(function(a){return a.index}).join("+"),zc:!0}}function xd(a,c){var d=[],f=c.aa,g=new ka.zb,h=new lb;this.addEventListener=h.addListener;this.removeEventListener=h.removeListener;this.Gc=function(a){var b=g.Gc(a);a.G.va(nh);h.Ch(Si);return b};this.Dc=function(){return g.Dc()};this.$e=function(){return g.$e()};this.size=function(){return g.size()};this.contains=function(a,b){return g.contains(a,b)};this.forEach=function(a){return g.forEach(a)};this.vb=function(a){d.forEach(function(b){b.vb(a)})};
this.Lg=function(){var a=0;d.forEach(function(d){var f=d.Eg();if(f&&f.G.se===bf){d=f.G;var g=f.gf,g=d.type===Ra?g.k:c.F.value,h=f.response;h&&(f=f.response.D,a=b(f.O)?a+qa(h.L.length-(f.X||0),0):a+g.j.t[d.index].length)}});a=a||0;return f.ga(a)};this.yc=function(a){d.forEach(function(b){b.Pf(a)})};this.yh=function(a){var b=d.length;a=ya(a,0,b);for(var c=0;c<b;c++)d[c].vb(c<a)};this.od=function(){g.forEach(function(a){a.G.va(Jc)});g.clear()};this.Xe=function(){return 2>g.size()};for(var k=0;k<a;k++){var l=
new Lc(this,c,1>k);l.addEventListener(Ri,function(){h.B(jg)});d.push(l)}}function wc(a){var b=this;this.Je=a||65536;this.ko=function(a,c,d){var f=[],g,h;if(1===d||a.length<=b.Je)f.push({offset:a.offset,length:a.length,we:a.offset+a.length,Jb:c});else{var k=Ba.floor(Ba.floor(a.length/b.Je)/d)*b.Je||b.Je,l=Ba.floor(a.length/k),l=0<l?l-1:0,p=a.length-k*l;for(d=0;d<l;d++)g=a.offset+d*k,h=g+k-1,f.push({offset:g,length:k,we:h,Jb:c});0<p?(g=a.offset+l*k,f.push({offset:g,length:p,we:g+p,Jb:c})):f[f.length-
1].we+=1}a=f.length;for(d=0;d<a;d++)c=f[d].Jb,f[d].index=d+1,f[d].Ga={name:Mb("{0}_{1} - {2}/{3}",c.type,c.index,d+1,a)};return f}}function ua(a,c,d){function f(a){if(a){var b=a.G;a=a.gf;var c=b.type===Ra?a.k:b.type===hb?d.F.value:void 0;a=c.j.t[b.index];b.content=new Na(a.length);b.Mb=u.ko(a,b,t);b.Mb.forEach(function(a){a.i=d.i.value;a.stream=c;x.Gc(a);y.Ch(oh)})}}function g(a){a&&(a.media=null,a.va(Jc),a.Mb=null)}function h(a){function b(a){if(a.Mb){for(var c=a.Mb.length,d=0;d<c;d++){var f=a.Mb[d];
if(!f.response||!f.response.c)return!1}return!0}return!1}if(a){var c=a.Jb,p,q=d.cb;if(a.response.c){if(b(c)){c.Mb.forEach(function(a){c.content.set(a.response.content,a.offset-c.L.offset)});try{c.content=Bb(c.content),p=!0}catch(t){g(c),q.Rb.Mh(a.i,c,a.stream),l.warn("Exception parsing response",t,c)}delete w[c.type+"_"+c.index];p&&n.Ld([c],c.L.Qc,a.stream,c.content,a.i,k(c));c.Mb=null;c.content=null;a=v;v=null;f(a);y.B(jg)}}else a.response=null,q.Rb.Jk(a.i)&&m.vb(!1),x.Gc(a),y.Ch(oh)}}function k(a){var b=
{},c=a.Mb;a.Mb&&(b.requestTime=Fb(c,function(a){return a.response.D.requestTime}),b.O=Fb(c,function(a){return a.response.D.O}),b.M=R(c,function(a){return a.response.D.M}),b.X=a.content.length);return b}var l=new d.log.r("SubChunkDownloadJobManager"),p=[],q=d.aa,m=this,n=d.n,t=c,u=new wc(z.Ms),w={},x=new ka.zb,v,y=new lb;this.addEventListener=y.addListener;this.removeEventListener=y.removeListener;this.Gc=function(a){a.G.va(nh);f(a)};this.Xe=function(){return vb.keys(w).length<z.tq&&x.size()<=t};this.Dc=
function(){var a=x.Dc();if(!a)return null;a.i=d.i.value;var b=a.Jb;if(!w[b.type+"_"+b.index]){b.L=ec(b,a.stream,a.i);Rb(a.stream.type,d.te,d.ue).set({G:b,stream:a.stream,i:a.i});w[b.type+"_"+b.index]=b;b.va(bf);var c=b.index;if(b.type===Ra)b=a.stream,b.j&&b.j.t[c]||(l.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:b.f,BitrateNew:d.U.f}),b=d.U),b!=d.k.value&&(l.trace("Stream switch",{BitrateOld:d.k.value.f,BitrateNew:b.f}),d.k.set(b));else if(b.type!==
hb)throw new La("unexpected chunk type.");}return a};this.$e=function(){return x.$e()};this.size=function(){return x.size()};this.contains=function(a,b){return x.contains(a,b)};this.forEach=function(a){return x.forEach(a)};this.vb=function(a){p.forEach(function(b){b.vb(a)})};this.Lg=function(){var a=0;p.forEach(function(c){if(c=c.Eg()){var d=c.response;if(d){var f=d.D;a=b(f.O)?a+qa(d.L.length-(f.X||0),0):a+c.length}}});a=a||0;return q.ga(a)};this.yc=function(){vb.keys(w).forEach(function(a){g(w[a]);
delete w[a]});p.forEach(function(a){a.Pf()})};this.yh=function(a){var b=p.length;a=ya(a,0,b);for(var c=0;c<b;c++)p[c].vb(c<a)};this.od=function(){v&&(g(v.G),v=null);x.forEach(function(a){a&&g(a.Jb)});x.clear()};for(c=0;c<a;c++){var A=new $a(m,d,c<t);A.addEventListener(Ti,function(a){h(a)});p.push(A)}}function $a(a,b,c){function d(){!l&&k&&(l=a.Dc())&&f(l)}function f(a){var c=Ga(a),g={type:Qk,stream:a.stream,Ey:a};p=g;g.response=h.N(c,function(c){Z(d);var f=p;f&&b.state.value==Sa&&f.type!=Ui&&(c&&
c.c?q.Db=0:c&&c.g==M.Za||(q.Rb.Mh(a.i,a.Jb,a.stream),++q.Db>=q.eb.length&&(q.Db=q.eb.length-1)));m.B(Ti,l);l=null;p&&p.type!=Ui&&(p=null)});a.response=g.response}var g=new b.log.r("SubChunkDownloadWorker"),h=b.bh,k=c,l,p,q=b.cb,m=new lb;this.addEventListener=m.addListener;q.eb=z.eb;q.Db=0;a.addEventListener(oh,function(a){!l&&k&&(a.Ej=!0,d())});this.isEnabled=function(){return k};this.vb=function(a){k!=a&&(k=a)&&d()};this.Eg=function(){return l};this.Pf=function(){p&&p.response&&(g.trace("Aborted download of chunk:",
l),p.response.abort(),l=p=null)}}function Ga(a){var b=a.stream;return{responseType:jc,Xb:Ta,url:b.Qa[a.i.id],offset:a.offset,length:a.length,wa:[a.Jb],i:a.i,track:b.track,stream:b,Cb:b.type+"-"+b.f+"-"+a.Jb.index+"- sub."+a.index,zc:!0}}function Ta(a){return new Na(a)}function Pc(a){function b(){10>=p.length?c():b=g}function c(){a.state.value!=Sa&&a.state.value!=Kb||d()}function d(){var b=u,c;u=X();c=u-b;b=(k=k||a.n)&&k.Wg();if(!b||w){if(++v>=y&&(v=0,a.fireEvent(ag)),0<p.length){var b=ea(t,p[p.length-
1].M-p[0].requestTime),g=0,h=X(),l=b>=t?h-t:p[0].requestTime,l=h-l<=z.Fh?l:h-z.Fh;n=0;p.forEach(function(a){var b=a.M-a.requestTime,c=0;if(!(0>=b||a.M<l||a.requestTime>h)){if(a.requestTime>=l&&a.M<=h)c=1;else{var d=a.M;d>=l&&d<=h?c=(a.M-l)/b:(d=a.requestTime,d>=l&&d<=h&&(c=(h-a.requestTime)/b))}g++;n+=a.X*c}});n=ja(n);q=ja(qa(8,n/b));D=b;w=!1}}else b&&f(c)}function f(a){p.forEach(function(b){b.requestTime+=a;b.O+=a;b.M+=a})}function h(a){return ja(a/q)}var k,l,p=[],q=128,m=0,n=0,t=z.Fh,u=X(),w,x,
v=0,y=Ya(4),A,B,D,F=0;a.addEventListener(ke,function(a){var c=a.D,d=a.L;d.i&&(x=d.i.location.id);A=c.requestTime;if(a.c&&c.X>Ji&&a.type==jc){h(c.X);for(p.push(c);100<p.length;)p.shift();w=k&&k.Wg();b()}});this.Kg=function(){return q};this.Bp=function(){return ja(7.8125*q)};this.Bj=function(){return ja(7.8125*m)};this.xd=function(){return n};this.uj=function(){return x};this.vj=function(){return A};this.ga=h;this.Ob=function(){l=l||new hc(a.n,a.Xc);return l.Ob(q,0)};this.le=function(){return this.Bp()};
this.Mg=function(){return D};this.ud=function(){return 0};a.addEventListener(ib,function(){B&&gb(B)});B=cb(c,250);var E=new Xd(1E3,function(){60<F?E.pd():(m=(m*F+q)/(F+1),F+=1)});E.Bh()}function qb(a){var b={};this.Mh=function(a,c,d){a=a.name+"_"+(d.type+"_"+c.index);b[a]=b[a]?b[a]+1:1};this.Si=function(){b={}};this.Jk=function(c){return vb.keys(b).some(function(d){var f=b[d];return-1<d.indexOf(c.name)&&f>a})}}function Ua(a){return Bb(new Na(a))}function Bb(a){for(var b=kh(a),c,d,f,g=0;g<b.length;g+=
2){c=b[g];if("moof"!=c.type||"mdat"!=b[g+1].type)throw new La("data is not moof-mdat box pairs");if(z.tt&&"moof"==c.type&&(d=c.rb("traf/saio"),f=c.rb("traf/A2394F52-5A9B-4F14-A244-6C427C648DF4"),d&&f&&(f=f.Gn.byteOffset-c.Ka.byteOffset,d.Yr[0]!=f))){var h=d;d=f;f=new Gc(h.Ka);f.seek(h.size-h.X);h=f.H(1);f.H(3)&1&&(f.l(),f.l());h=1<=h?8:4;f.l();f.gl(d,h)}z.el&&"moof"==c.type&&(c=c.rb("traf/tfhd"),(d=c.kg)&&d.zk&&gd(c))}return a}function gd(a){var b=new Gc(a.Ka);b.seek(a.size-a.X);b.H(1);var c=b.H(3);
b.l();var d;switch(a.type){case "tfhd":c&1&&b.ja();c&2&&b.l();c&8&&b.l();c&16&&b.l();c&32&&(d=b.ia(2));break;case "trex":b.l(),b.l(),b.l(),d=b.ia(2)}d&&(d[1]&=254)}function Bd(a,b,c,d){var f=b.type;b=Rb(f,"ec-3"==b.j.cg?'audio/mp4; codecs="mp4a.a6"':'audio/mp4; codecs="mp4a.40.5"',z.ot);var g={Type:f},h,k=!1,l,p=this,q;z.Wb&&z.Qe&&(q=!0,p.yg=new Fa);d.trace("Adding source buffer",g,{TypeId:b});h=c.addSourceBuffer(b);Ph(h);kg&&(h.addEventListener("updatestart",function(){}),h.addEventListener("update",
function(){}),h.addEventListener("updateend",function(){k=!1;l&&l();q&&h.buffered.length&&(q=!1,p.yg.set(!0))}),h.addEventListener("error",function(){a.Pa(new mb(O.wm,Rb(f,M.ae,M.ce)))}),h.addEventListener("abort",function(){}));a.addEventListener(dg,function(){h=null});x(p,{type:f,appendBuffer:function(a){h[Vi](a);kg&&(k=!0)},remove:function(a,b){try{cf&&(h.remove(a,b),kg&&(k=!0))}catch(c){d.error("SourceBuffer remove exception",c,g)}},Sb:function(){return k},Gk:function(a){l=a},lp:function(){try{var a=
h.buffered,b,c,d,f=0;if(a)for(b=[],c=0,d=a.length,c=0;c<d;c++){var g=a.start(c),k=a.end(c),f=f+(k-g);b.push(g+"-"+k)}if(b)return{Buffered:f.toFixed(3),Ranges:b.join("|")}}catch(l){}}})}function Ph(a){Ph=g;Vi=a.appendBuffer?"appendBuffer":"append";cf=!z.Jn&&!!a.remove;kg=!!a.addEventListener}function Bg(a){function f(b){z.eo&&(W.removeAttribute("src"),W.load&&W.load(),W.webkitDeleteKey&&W.webkitDeleteKey(ba,od));df.revokeObjectURL(R);if(Y&&!b)try{Y.close()}catch(c){ca.error("Exception on keysession close ",
O.Gf,c)}Z&&sa&&"playready"==jb()&&(Z.Rc(),new Wh(a,od,Z));z.Zi&&W.removeEventListener("contextmenu",Rh);a.Xa.removeChild(W);W=da=null;R=""}function h(a){try{W&&(Ja=W.currentTime)}catch(b){ca.error("Exception while getting VIDEO.currentTime",b),a&&H(O.pm,b)}return Ya(1E3*Ja)}function k(){T&&T.ar&&T.br&&(T=l,Fc.B(Wi))}function p(a,b,d){z.gj&&ca.trace("KeySession update",a&&c(a));try{if(Y){var f=Y.update(a);f&&f.then&&f.then(B).catch(function(a){ca.error("keySession update promise rejected",a);a=Sh(a);
C(O.If,a)})}else W.webkitAddKey(ba,a,b,d)}catch(g){ca.error("Exception calling keySession.update or addKey",g),H(O.qm,g)}}function m(){ca.trace("Video element event: seeking");T?T.bx=!0:C(O.zm)}function n(){ca.trace("Video element event: seeked");T?(T.ar=!0,k()):C(O.ym)}function t(){T&&(T.br=!0,k());Fc.B(Xi)}function u(a){ca.trace("Received event: sourceopen");fa||(fa=!0,Fc.B(Yi,a))}function w(a){a=oc(a,Sc);ca.error("Video element event: error",a.Se);if(Z&&Z.Me()&&!z.ds){var b={ErrorCode:O.Vm};x(b,
Va(a.kc));Z.terminate(b)}else C(O.om,a.kc)}function v(a){var b=oc(a,Tc);ca.error("Received event: keyerror",b.Se);Z&&Z.Me(a)?((a=/Chrome/.test(ac)&&1==a.systemCode&&a.errorCode&&1==a.errorCode.code)&&na.error("SSManager , ignoring keyerror"),a||(a={ErrorCode:O.Em},x(a,Va(b.kc)),Z.terminate(a))):C(O.If,b.kc)}function y(b){ca.trace("Received event: "+b.type);if(W){var c;if(!ja){ja=!0;a.na("lg");try{var d=Rk[jb()];c=b.initData;c instanceof ArrayBuffer&&(c=new Na(c));d&&(c=d(c,a.U.j.Hd));pa||!vc||z.ur&&
W.webkitGenerateKeyRequest||(W.setMediaKeys?(P=new vc(ba),W.setMediaKeys(P)):W.msSetMediaKeys?(P=new vc(ba),W.msSetMediaKeys(P)):W.webkitSetMediaKeys&&(P=new vc(ba),W.webkitSetMediaKeys(P)));pa&&Gb.requestMediaKeySystemAccess(ba,[{initDataTypes:["cenc"],persistentState:"required",videoCapabilities:[{contentType:'video/mp4; codecs="avc1.640028"',robustness:"HW_SECURE_DECODE"},{contentType:'video/mp4; codecs="avc1.640028"',robustness:"SW_SECURE_DECODE"}]},{initDataTypes:["cenc"],persistentState:"required"}]).then(function(a){ca.trace("supportedconfig",
ab.stringify(a.getConfiguration()));return a.createMediaKeys()}).then(function(a){ua=a;return W.setMediaKeys(a)}).then(function(){var a=ua.createSession();a.addEventListener("message",A);a.addEventListener("keystatuseschange",function(a){ca.trace("Received event: "+a.type);try{a.target.keyStatuses.forEach(function(a){ca.trace("key status: "+a);"expired"==a&&C(O.ni);"internal-error"==a&&C(O.lm);"output-not-allowed"==a&&C(O.mm);"output-downscaled"!=a||wa||(wa=!0,ca.error("output-downscaled"))})}catch(b){ca.error("Exception in iterating keystatuses",
b)}});a.generateRequest(b.initDataType,c);Y=a}).catch(function(a){ca.error("Exception creating keySession",a);a=Sh(a);var b=O.km;a.g==M.ml&&(b=O.Jf);C(b,a)})}catch(f){ca.error("Exception creating MediaKeys",f);H(O.mi,f);return}if(!pa)try{var g;P?g=Y=P.createSession("video/mp4",c,null):(W.webkitGenerateKeyRequest(ba,c),g=W);g.addEventListener(Pa+"keyerror",v);g.addEventListener(Pa+"keymessage",A);g.addEventListener(Pa+"keyadded",B)}catch(h){ca.error("Exception generating key request",h),H(O.Jf,h)}}}}
function A(b){var d=b.messageType;ca.trace("Received event: "+b.type+(d?" , "+d:""));var f=b.sessionId||Y&&Y.sessionId,g=b.message;b=jb();g instanceof ArrayBuffer&&(g=new Na(g));z.gj&&ca.trace("KeySession message",g&&c(g));if(!ha&&z.ht){ha=!0;var h=[99,100,109,95,105,100,58],k=new Na(h.length+g.length);k.set(h,0);k.set(g,h.length);p(k,g,f)}else if(z.dl&&Qa([8,4],g))h=ic(z.dl),p(h,g,f);else if("fps"==b&&Qa([99,101,114,116,105,102,105,99,97,116,101],g))a.na("scs"),kf(a,function(b){b.c?(a.na("scr"),
p(b.me,g,f)):C(O.Xl,b)});else if(Z&&Z.$p()&&(Z.Nh({c:!0,Bb:g,ic:jb(),Ne:od}),Z.Sh().then(function(a){a.c&&p(a.kd,a.Bb,od)})),!ka||z.Wb&&ea!==Sk){ka=!0;try{od=f;var l;a.U.j.Hd.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.rd&&(l=a.data)});la="playready"==jb()?(h=Oc(g,"PlayReadyKeyMessage","Challenge"))?ic(h):g:g;k={ic:jb(),data:la,Er:l};z.Wb&&(ea++,k.hq=ea==Zi,ea==Tk&&(k.wk=!0));Fc.B($i,k)}catch(q){ca.error("Exception creating license challenge",q),H(O.rm,q)}}}
function B(a){ca.trace(a?"Received event: keyadded":"addKey promised resolved");if(sa){qa||(qa=!0,Fc.B(aj,{Ne:od}));var b;a:{if(z.Wb&&z.Qe&&(ea==Zi||ea==Uk))switch(jb()){case "fps":b=F;break a;case "playready":b=E;break a}b=void 0}b&&ta.then(function(){Aa=Ka(b,z.Qe)})}Z&&Z.Zp()&&Z.Zk()}function D(){!0===eb.hidden?X.forEach(function(a){a.refresh();a.Bs()}):X.forEach(function(a){a.refresh();a.Js()})}function F(){p($c("renew"));Aa=l}function E(){Q(Y,"removeEventListener");var b=ia(a.U.j.Hd),b=xa(b),
b=function(a){var b="";a.forEach(function(a){b+="<KeyID>"+a+"</KeyID>"});return new Na(Yb('<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="true"><KeyIDs>'+b+"</KeyIDs><CustomData></CustomData></LicenseAcquisition></PlayReadyCDMData>"))}([c(b)]);Y=P.createSession("video/mp4",new Na,b);Q(Y,"addEventListener");Aa=l}function C(b,c){a.Pa(new mb(b,c,void 0))}function H(b,c){var d={g:M.Nb,C:G(c)},f;try{(f=c.message.match(/(?:[x\W\s]|^)([0-9a-f]{8})(?:[x\W\s]|$)/i)[1].toUpperCase())&&
8==f.length&&(d.P=f)}catch(g){}a.Pa(new mb(b,d))}function J(a){function c(){var f=a();b(f)&&d.tn(f)}var d=new Ud;X.push(d);d.refresh=c;return function(){c();return d.np()}}function L(){X.forEach(function(a){a.refresh()})}function ra(){if(W&&2<=W.readyState){var a=W.webkitDecodedFrameCount;if(0<a||a===l)return V.Yi=ra=d,!0}return!1}function I(a){if(W){a=a.pt;var b=W&&W.msGraphicsTrustStatus;b&&(a.ConstrictionActive=b.constrictionActive,a.Status=b.status);try{W&&(a.readyState=""+W.readyState,a.currentTime=
""+W.currentTime)}catch(c){}for(var b=oa.length,d;b--;)d=oa[b],x(a,d.lp(),{prefix:d.type})}}function K(){if(W)return W.getVideoPlaybackQuality&&W.getVideoPlaybackQuality()||W.videoPlaybackQuality||W.playbackQuality}function N(b){function c(a){c=g;d.wb();b(a)}var d=new tb(500,function(){c()});d.jc();try{var f=a.k.value.j.Hd.children.filter(function(a){return"pssh"==a.type&&"9A04F079-9840-4286-AB92-E65BE0885F95"==a.rd})[0];(new vc(ba)).createSession("video/mp4",f.Ka,null).addEventListener(Pa+"keyerror",
function(a){a=oc(a,Tc);c(a.kc)})}catch(h){c()}}function Q(a,b){a[b](Pa+"keyerror",v);a[b](Pa+"keymessage",A);a[b](Pa+"keyadded",B)}var Pa=Qh(),V=this,ca=new a.log.r("MediaPresenter"),Fc=new lb,W=Bj(a.ac),oa=[],da,P,R,T,ba=z.Oe[0],Y,od,la,Ja=0,X=[],Aa,pa,fa,ja,ka,ha,sa,qa,ea=z.Wb?Vk:Wk,Z,Ma=g,ta=Nd.resolve(),wa,ua;z.Wb&&z.Qe&&(ta=new Nd(function(b){Ma=b;a.addEventListener(ib,b)}));z.Sd&&a.state.addListener(function(){a.state.value==Sa&&(Z=a.rc)});z.Ar&&(q(Gb.requestMediaKeySystemAccess)?pa=!0:ca.error("Promise based eme requested but platform does not support it",
{browserua:ac}));x(V,{addEventListener:Fc.addListener,removeEventListener:Fc.removeListener,qt:W,rj:h,seek:function(a){L();var b=h(!0);if(!(lc(b-a)<=ph))try{ca.trace("Setting video elements currentTime",{From:Ea(b),To:Ea(a)}),T={},W.currentTime=a/1E3}catch(c){ca.error("Exception while setting VIDEO.currentTime",c),H(O.sm,c)}},Ap:function(){return!!T},addSourceBuffer:function(b){var c=new Bd(a,b,da,ca);oa.push(c);b.type==Ra&&c.yg&&c.yg.addListener(Ma);return c},endOfStream:function(){ca.trace("Calling endOfStream on mediaSource");
z.Sn&&da.endOfStream()},sn:function(a){a=a.data;sa=!0;p(a,la,od);z.Wb&&ea++},Yi:ra,Dg:function(){var a=W&&W.msGraphicsTrustStatus;return!(!a||1!=a.constrictionActive)},open:function(){a.addEventListener(gh,I);if(bj){if(a.k.value.j.pg){if(!Xk){C(O.oi);return}if(vc&&vc.isTypeSupported)try{if(!vc.isTypeSupported(ba,"video/mp4")){N(function(a){C(O.Hf,a)});return}}catch(b){H(O.Hf,b);return}}try{da=new sd}catch(c){H(O.gm,c);return}try{R=df.createObjectURL(da)}catch(d){H(O.hm,d);return}try{da.addEventListener("sourceopen",
u);da.addEventListener(Pa+"sourceopen",u);W.addEventListener("error",w);W.addEventListener("seeking",m);W.addEventListener("seeked",n);W.addEventListener("timeupdate",t);W.addEventListener(pa?"encrypted":Pa+"needkey",y);var f=a.Xa,g=f.lastChild;g?f.insertBefore(W,g):f.appendChild(W);z.Zi&&W.addEventListener("contextmenu",Rh);W.src=R;Xa.addListener(qh,D);D()}catch(h){H(O.im,h)}}else C(O.pi)},close:function(){if(R)if(L(),Xa.removeListener(qh,D),Z&&sa&&"playready"!=jb()){Z.Rc();try{Y?Y.close():W.webkitCancelKeyRequest(ba,
od)}catch(a){ca.error("Exception on keysession close ",O.Gf,a),Z.terminate({ErrorCode:O.Gf})}Z.Yd().then(f)}else f();Aa&&bb(Aa)},Ce:J(function(){if(W){var a=K();return a?a.totalVideoFrames:W.webkitDecodedFrameCount}}),Oc:J(function(){if(W){var a=K();return a?a.droppedVideoFrames:W.webkitDroppedFrameCount}}),Ae:J(function(){if(W){var a=K();return a&&a.corruptedVideoFrames}}),De:J(function(){if(W){var a=K();return a&&Ya(1E3*a.totalFrameDelay)}})})}function jb(){return/widevine/i.test(z.Oe[0])?"widevine":
/fps/i.test(z.Oe[0])?"fps":"playready"}function Qh(){return m.WebKitMediaKeys||ef.prototype.webkitGenerateKeyRequest?"webkit":ef.prototype.msSetMediaKeys?"ms":""}function Bj(a){var b;b=m.devicePixelRatio||1;b={width:Yk||m.screen.width*b,height:Zk||m.screen.height*b};a=a.width/a.height*b.height;var c=(b.width-a)/2;return z.ws?Y("VIDEO","position:absolute;width:"+a+"px;height:"+b.height+"px;left:"+c+"px;top:0px"):Y("VIDEO","position:absolute;width:100%;height:100%")}function Rh(a){a.preventDefault();
return!1}function Oc(a,b){var c="",d,f=a.length,g;for(d=0;d<f;d++)g=a[d],0<g&&(c+=$k(g));f="\\s*(.*)\\s*";for(d=arguments.length-1;0<d;d--){g=arguments[d];if(0>c.search(g))return;g="(?:[^:].*:|)"+g;f="[\\s\\S]*<"+g+"[^>]*>"+f+"</"+g+">[\\s\\S]*"}if(c=c.match(new RegExp(f)))return c[1]}function kf(a,b){function c(a){var d;try{var f=a.match(/-----BEGIN CERTIFICATE-----([\s\S]*)-----END CERTIFICATE-----/)[1];if(!y(f))throw new La("bad PEM");d={c:!0,me:ic(f)}}catch(g){d={g:M.Nb,C:G(g)}}b(d)}var d=a.ib;
Wa.load("fpsappdata",function(a){if(a.c){a=a.data;var f=a.certificate;if(a.expiration>yb.wd()){c(f);return}}d.Ag(function(a){if(a.c){var d=a.me;Wa.save("fpsappdata",{certificate:d,expiration:a.Zo});c(d)}else b(a)})})}function oc(a,c){var d=a.target,f=d&&d.error,g=a.errorCode,d=f&&f.code;t(d)||(d=g&&g.code);g=f&&f.msExtendedCode;t(g)||(g=f&&f.systemCode);t(g)||(g=a.systemCode);f=x({},{code:d,systemCode:g},{Ye:!0});d={g:c(d),C:ig(f)};g=E(g);b(g)&&(d.P=Vd(g));return{kc:d,Se:f}}function Sh(a){var b={};
b.g=t(a.code)?Tc(a.code):M.Nb;try{var c=a.message.match(/\((\d*)\)/)[1];b.P=Vd(c)}catch(d){}b.C=G(a);return b}function hd(a){function b(){function h(){!D&&x&&v&&(h=f,I.addEventListener(Wi,g),I.addEventListener(Xi,function(){g();a.fireEvent(rh)}),K.addEventListener("ended",function(){B.trace("Video element event: ended");g()}),K.addEventListener("play",function(){B.trace("Video element event: play");g()}),K.addEventListener("pause",function(){B.trace("Video element event: pause");g();a.fireEvent(sh)}),
K.addEventListener("playing",function(){B.trace("Video element event: playing")}),F=!0,q(),B.trace("Video element initialization complete"),a.na("vi"),z.Xi?Ka(function(){E=!0;g()},z.Xi):E=!0,k(),Z(g))}function k(){if(z.Vi){var b=function(){a.A.value==Ab&&a.state.value==Sa&&a.o.value==Wb?T.jc():T.wb()};T=new tb(z.Vi,function(){y(O.jm)});a.A.addListener(b);a.o.addListener(b);a.state.addListener(b);b()}}B.trace("Video element initializing");var l=a.Xc,m=a.k.value,t=l.j,u=m.j.pg||t.pg,x,v;K=I.qt;I.addEventListener(Yi,
function(){try{ca.La=I.addSourceBuffer(l)}catch(b){y(O.Kf,{g:M.ae,C:G(b)});return}try{Q.La=I.addSourceBuffer(m)}catch(c){y(O.Kf,{g:M.ce,C:G(c)});return}n(l)&&n(m)&&(u?B.trace("Waiting for needkey"):B.warn("Movie is not DRM protected",{MovieId:a.ma,DownloadableId:m.J}),B.trace("Waiting for loadedmetadata"))});u?(I.addEventListener($i,function(b){D||(B.info("Requesting license"),b.wk||a.na("lc"),a.ib.Yg(b,function(c){B.info("Received license");if(!D)if(b.wk||a.na("lr"),c.c){c=c.fq;try{I.sn(c),B.trace("Added license")}catch(d){B.error("Exception adding license",
d),y(O.fm)}}else y(O.am,c)}),a.fireEvent(fh,b))}),I.addEventListener(aj,function(b){x=!0;a.na("ld");Z(function(){h()});a.fireEvent(zi,b)})):x=!0;oa(K,function(){B.trace("Video element event: loadedmetadata");v=!0;a.na("md");a.addEventListener(Qd,c);ca.La.Gk(c);Q.La.Gk(c);c();Z(function(){h()})});Xa.addListener(uc,A,-1);a.addEventListener(ib,A,-1);a.addEventListener(Ni,d);a.paused.addListener(g);a.muted.addListener(p);a.volume.addListener(p);a.o.addListener(g);I.open();w(a.ob||0,th);p()}function c(){F?
g():z.An&&q()}function d(){var b=a.v.value-z.ls,b=qa(b,J);w(b,Di)}function g(){if(!D&&F){var b=I.Ap();b||q();cf||q();var c=a.o.value==Wb,d=a.A.value,f=d==Ab?da:V,p;p=k(ca,f)&&k(Q,f);a.paused.value||!p||!c||b||L?t():K.ended||!E||!N&&N!==l||(B.trace("Calling play on element"),K.play(),N=!1);if(!b)if(L&&c&&p)I.seek(H),L=!1,cf||v(),Z(g);else{var m=I.rj(!0);L||b?d=Ab:K.ended?d==Ic&&(H=a.duration,d=tc,t()):c&&p?I.Yi()?d=K.paused?Ye:Ic:ba.lb(h):d=Ab;d!=Ab&&d!=tc&&(m<H?(b=H-m,m&&b>ph&&(m={ElementTime:Ea(m),
MediaTime:Ea(H)},b>al?(B.error("VIDEO.currentTime became much smaller",m),y(O.xm)):B.warn("VIDEO.currentTime became smaller",m))):H=ya(m,0,a.duration));a.v.set(H);u();m=d==Ab&&a.A.value==Ic;a.A.set(d,{Xv:!0});m&&a.fireEvent(Ze,{Ac:C.Mc()>f?bl:mh})}}}function h(){z.Yq&&!ca.La.Sb()&&ca.La.appendBuffer(new Na([0,0,0,8,102,114,101,101]));g()}function k(a,b){if(!a.Vc)return!0;var c=a.oe;return(c=c&&c.G)&&c.endTime-H>=b}function p(){D||(K.volume=a.volume.value,K.muted=a.muted.value)}function q(){m(ca);
m(Q);D||ca.Vc||Q.Vc||ca.La.Sb()||Q.La.Sb()||R||(R=!0,I.endOfStream())}function m(a){if(!D){var b=a.La,c=a.Cc;b.Sb()||(a.oe=c[c.length-1],a.Eh&&(a.Eh=!1,b.remove(0,Rb(a.type,C.$a,C.yb).Q.endTime/1E3)));for(var d=a.Vc;d&&d.media&&d.startTime-H<=P;){R=!1;var f;a:{f=d;var g=f.media,h=f.type,k=W[h];if(!n(g.stream)||D||k.La.Sb())f=void 0;else{try{var l=g.Tf;B.trace("Feeding media segment to decoder",f,{Bytes:g.length});k.La.appendBuffer(l);k.Cc.push({G:f,stream:g.stream,i:g.i});L&&!cf||C.Rq(f)}catch(p){B.error("Exception while appending media",
f,p);y(O.um,Rb(h,M.ae,M.ce));f=void 0;break a}f=!0}}if(!f)break;d=d.next}a.Vc=d;b.Sb()||(a.oe=c[c.length-1])}}function n(a){if(!a||!a.j)return!1;var b=a.type,c=W[b];if(c.uo!=a)try{if(c.La.Sb())return;var d=a.j.Mp;B.trace("Feeding init segment to decoder",a,{Bytes:d.length});c.La.appendBuffer(d);c.uo=a}catch(f){B.error("Exception while appending initialization segment",f,{Type:b});y(O.vm,Rb(b,M.ae,M.ce));return}return!0}function t(){K.ended||!E||N&&N!==l||(B.trace("Calling pause on element"),K.pause(),
N=!0)}function u(b){if(b){for(var c=W[b],d=c.Cc,f,g;(f=d[0])&&f.G.startTime<=H;)if(H<f.G.endTime){b=Rb(b,a.Yb,a.ub);la(f,b.value)||(g=!0,b.set(f));break}else d.shift(),C.Uq(f.G);g&&!R&&(f=(f=f.G.Ja)&&f.startTime-1,0<f&&(c=c.La,c.Sb()||c.remove(0,f/1E3)))}else u(hb),u(Ra)}function w(b,c){if(!D){var d=C.yb.fb(ya(b,0,145152E5)),f=d.startTime;z.tr&&(f=b);var h=C.$a.fb(f);!d.next&&d.Ja&&(d=d.Ja,f=d.startTime,h=C.$a.fb(f));z.Bk&&(f+=z.Bk);c==th&&(a.nd=f);u();var k=H;B.info("Seeking",{Requested:Ea(b),Actual:Ea(f),
Cause:c});a.fireEvent(cj,{hh:k,gk:f,Ac:c});a.A.set(Ab);ca.sh=h;Q.sh=d;v();c!=th&&(ca.Eh=!0,Q.Eh=!0);J=H=f;a.Yb.set(null);a.ub.set(null);a.v.set(H);a.dp();a.fireEvent(Pd,{hh:k,gk:f,Ac:c});L=!0;g()}}function v(){ca.Vc=ca.sh;ca.Cc=[];ca.oe=l;Q.Vc=Q.sh;Q.Cc=[];Q.oe=l;C.Tq()}function y(b,c){D||a.Pa(new mb(b,c,void 0))}function A(){if(!D){B.info("Closing.");Xa.removeListener(uc,A);D=!0;try{z.Lq&&(K.volume=0,K.muted=!0),t(),I.close()}catch(a){}}}var B=new a.log.r("MediaPresenter"),D,F,E,C=a.n,H=0,J,L,I=
new Bg(a),K,N,ca={type:hb,Cc:[]},Q={type:Ra,Cc:[]},W={},V=z.Va,da=z.er,P=z.vq,R,T,ba=new kb(ph);W[hb]=ca;W[Ra]=Q;try{b()}catch(Y){B.error("Exception while initializing",Y),y(O.em)}x(this,{seek:function(a){w(a,Ci)},Be:function(){return I.rj(!1)},Ce:I.Ce,Oc:I.Oc,Ae:I.Ae,De:I.De,Dg:I.Dg,ig:function(){var b=a.A.value==Ab?da:V;return k(ca,b)&&k(Q,b)}})}function Th(a,b,c,d,f,g,h,k,p,q){function m(b){function c(){a.state.removeListener(c);d()}function d(){a.state.value==Sa?E?x(function(a){a.c?A.info("Loaded image subtitle manager"):
(A.error("Unable to load image subtitles manager",a),B=uh,F=rb(m));b(a)}):n(function(a){a.c?(A.trace("Entries parsed",{Length:a.entries.length},D),H.i=a.i,B=cl):(A.error("Unable to retreive timed text track",Va(a),D,{url:a.url}),B=uh,F=rb(m));b(a)}):b({})}B=dj;a.state.value!=Kb?d():a.state.addListener(c)}function n(b){function c(g){if(g.c)b(g);else{var h,k,l;for(l=0;l<a.I.length;l++)if(h=a.I[l],k=d[h.id],f[h.id]>z.Sk||!k)h=null;else break;h&&k?(f[h.id]=(f[h.id]||0)+1,u(k,h,c)):b(g)}}if(w(d))u(d,l,
b);else if(ad.isArray(d))b({c:!0,entries:d,track:H});else{var f={};c({c:!1})}}function u(b,c,d){A.trace("Downloading",c&&{cdn:c.id},D);var g={responseType:Wg,url:b,track:H,i:c,Cb:"tt-"+f};a.ua.N(g,function(b){if(b.c){var f=a.ac;E?d({c:!0,entries:[]}):Cd(b.content,f.width/f.height,z.Uk,z.Vk,function(a){if(a.c){a=a.entries;var b=z.Ts;if(b){var f=0;a.forEach(function(a){a.startTime=f;a.endTime=f+=b})}d({c:!0,entries:a,i:c,track:H})}else a.url=g.url,d(a)})}else d(b)})}function x(b){function c(a){if(t(a)){q.url=
d[G];f.url=q.url;l[a]=(l[a]||0)+1;var p=new dl(g,f);p.on("ready",function(){C=p;b({c:!0,track:H})});p.on("error",function(d){var f={c:!1},g;for(g in d)f[g]=d[g];f.url=q.url;A.error("ImageSubtitleManager error event",f);l[a]<=z.Sk?c(G):(G=h[k++])?c(G):b({c:!1,msg:"all cdns failed for image subs"})})}else b({c:!1,msg:"cdnId is not defined for image subs downloadUrl"})}var f={type:"image",ak:q.offset,bk:q.length,ef:a.v.value||0},g={yj:function(){return a.ha.Be()},Xj:A,L:v},h=vb.keys(d),k=0,l={};G=h[k++];
c(G)}function v(b,c){A.trace("Downloading",b);var d={url:b.url,responseType:jc,headers:{},i:y(G)};d.headers.Range="bytes="+b.offset+"-"+(b.offset+b.size-1);a.ua.N(d,function(a){A.trace("imgsub: request status "+a.c);a.c?c(null,new Na(a.content)):c({errorSubCode:a.g,errorExternalCode:a.P})})}function y(b){if(a.I)return a.I.filter(function(a){return a.id==b})[0]}var A=new a.log.r("TimedTextTrack"),B=el,D={Bcp47:f,TrackId:b,DownloadableId:c},F=rb(m),E=p&&"nflx-cmisc"==p,C,G,H={type:Yg,ka:b,Xk:h,Oq:k,
fk:p,J:c,bb:f,displayName:g,getEntries:function(a){F(function(b){a(b)})},Ig:function(){return B},Ga:D,Rj:E,up:function(){return C}};return H}function Cj(a){function b(){x.start();a.A.value!=Ic&&x.stop()}function c(){A&&n.info("Deactivating",A);a.ec.set(null);x.Hk(w=l);g();var b=a.$.value;b&&(n.info("Activating",b),b.getEntries(d));A=b;f()}function d(b){var c=b.track;if(c==a.$.value){if(c.Rj)b.c?(z=c.up(),m("addListener"),n.info("Activated",c),a.ec.set(c),Z(function(){z.tc(a.ha.Be())})):n.error("Failed to activate img subtitle ",
b,c);else{var g=b.entries;g?(x.Hk(w=g),n.info("Activated",c),a.ec.set(c)):n.error("Failed to activate",Va(b),c)}f()}}function f(){var b;a.state.value==Sa&&a.A.value!=Ab&&(w?b=x.fp():a.$.value&&(b=u[a.$.value.Ig()]));b&&b.startTime&&(v++,y+=x.Gg()-b.startTime,t.he=pd(y/(v+0)));a.Jh.set(b)}function g(){z&&(z.stop(),m("removeListener"));z=l}function h(a){t.fireEvent(fl,a);n.debug("showsubtitle",a)}function k(a){t.fireEvent(gl,a);n.debug("removesubtitle",a)}function p(){z.tc(a.ha.Be())}function q(){z.pause()}
function m(b){z[b]("showsubtitle",h);z[b]("removesubtitle",k);"addListener"==b?(a.addEventListener(rh,p),a.addEventListener(sh,q)):(a.removeEventListener(rh,p),a.removeEventListener(sh,q))}var n=new a.log.r("TimedTextManager"),t=this,u={},w,x=new Zb,v=0,y=0,A,B=new lb,z;this.he=null;t.addEventListener=B.addListener;t.removeEventListener=B.removeListener;t.fireEvent=B.B;this.Rf=function(b,c){var d="custom"+ ++hl,f=new Th(a,d,"1",b,"xx",c||d,We,"primary","custom",{});a.Ma.push(f);a.Ab.forEach(function(a){a=
a.Ma;0>a.indexOf(f)&&a.push(f)});a.fireEvent(ej);return f};u[dj]={gw:!0};u[uh]={vv:!0};a.$.addListener(c);a.addEventListener(Hc,c);a.A.addListener(b);a.addEventListener(af,b);a.addEventListener(ib,function(){w=l;g();x.stop();f()});x.Gg=a.ha.Be;x.ih=f}function Ae(a){function b(){d.Or()}var c=a.Xa,d=new lf(z.Ss),f=a.ac;d.qs(f.width/f.height);c.appendChild(d.sj());a.Jh.addListener(function(a){d.ts(a.newValue)});a.addEventListener(ib,function(){Xa.removeListener(vh,b);c.removeChild(d.sj())});Xa.addListener(vh,
b);this.Ah=d.Ah}function Dj(a){function b(){f(a.v.value);for(var c=0,d=t.length;d--;)c+=t[d].endTime-t[d].startTime;return c}function c(a){f(a.hh);w=a.gk;q=k=l;m&&(m.startTime=w)}function d(b){h(m,u,a.v.value);m=b.newValue?{i:b.newValue.i,track:b.newValue,startTime:a.v.value,endTime:145152E5}:l}function f(a){k&&q&&(a=ea(a,k.endTime),a=ea(a,q.endTime),h(k,n,a),k.startTime=a,h(q,t,a),q.startTime=a,m&&(h(m,u,a),m.startTime=a),w=a)}function g(b,c,d){b&&h(b,c,ea(b.endTime,a.v.value));if(d)return b=d.G,
c=d.stream,{i:d.i,track:c.track,stream:c,startTime:qa(b.startTime,w),endTime:b.endTime}}function h(a,b,c){a&&c>=a.startTime&&(a={i:a.i,track:a.track,stream:a.stream,startTime:a.startTime,endTime:c},(c=b[b.length-1])&&c.track==a.track&&c.stream==a.stream&&c.i==a.i&&c.endTime==a.startTime?c.endTime=a.endTime:b.push(a))}var k,q,m,n=[],t=[],u=[],w=a.v.value,v={},y=!1,A={},B=z.qn,D=B.length;(function(){a.addEventListener(cj,c);a.Yb.addListener(function(a){k=g(k,n,a.newValue)});a.ub.addListener(function(a){q=
g(q,t,a.newValue)});a.ec.addListener(d)})();for(v.abrdel=0;D--;)A["abrdel"+B[D]]=0,v["abrdel"+B[D]]=0;x(this,{Cj:b,gp:function(){f(a.v.value);return{audio:$d(n,Uh),video:$d(t,Uh)}},yp:function(){return{total:b(),audio:$d(n,tf),video:$d(t,tf),timedtext:$d(u,tf)}},ip:function(){f(a.v.value);var b=$d(t,Ej),c,d,g=0;for(d=b.length;d--;)c=b[d],g+=c.duration;if(!g)return 0;var h=0;for(d=b.length;d--;)c=b[d],h+=c.f*c.duration/g;v.abrdel=Ya(h);return v.abrdel},jp:function(){if(!y){for(var a=B.length,c=b();a--;){var d=
B[a];if(0==A["abrdel"+d]&&c>1E3*d){for(var f=0,g=t.length,h,k=0,l=0;l<g&&!(h=t[l],f+=h.stream.f*(h.endTime-h.startTime),k+=h.endTime-h.startTime,h=h.stream.f,k>1E3*d);l++);f&&(A["abrdel"+d]=Ya((f-h*(k-1E3*d))/(1E3*d)))}}0!==A["abrdel"+B[B.length-1]]&&(y=!0);p(A,function(a,b){v[a]=0==b?v.abrdel:b})}return v}})}function $d(a,b){var c=[],d,f,g={},h,k,l=a.length,p;for(p=0;p<l;p++)h=a[p],k=b(h),f=k.key,d=g[f],h=h.endTime-h.startTime,d?d.duration+=h:(delete k.key,d=k,d.duration=h,c.push(d),g[f]=d);return c}
function tf(a){var b,c=a.stream;c?(a=c.J,b=c.f):a=a.track.J;return{key:a+"$"+(b||0),downloadableId:a,bitrate:b}}function Uh(a){var b=tf(a);a=a.i.id;b.key+="$"+a;b.cdnId=a;return b}function Ej(a){a=(a=a.stream)?a.f:0;return{key:a,f:a}}function Fj(a){var b=z.kr;if(b){var c=function(){a.state.value!=Sa||a.A.value!=Ye&&a.A.value!=tc?d.wb():d.jc()},d=new tb(b,a.Pa.bind(a,new mb(O.Ff))),f;a.A.addListener(c);a.state.addListener(c);if(z.Mj){var g=X();f=new Xd(z.Mj,function(){var c=X();c-g>b&&(a.Pa(new mb(O.Cf)),
f.pd());g=c});f.Bh()}a.addEventListener(ib,function(){d.wb();t(f)&&f.pd()})}}function Gj(a,b,c,d,f,g,h,k){function l(a){var b;p(a,function(a,c){if(!b){var d=v[c];d?d<z.Zs+1&&(v[c]++,b={url:c,Pi:a}):(v[c]=1,b={url:c,Pi:a})}});return b}function q(b){t.trace("Downloading",b.url,w);a.ua.N({responseType:jc,i:m(b.Pi),url:b.url,track:n},function(b){if(b.c)try{A=Kj(b.content),u=wh,t.trace("TrickPlay parsed",{Images:A.images.length},w),a.fireEvent(fj)}catch(c){u=gj,t.error("TrickPlay parse failed.",c)}else u=
hj,t.error("TrickPlay download failed.",Va(b),w)})}function m(b){for(var c=0;c<a.I.length;c++){var d=a.I[c];if(d&&d.id==b)return d}}var n=this,t=new a.log.r("TrickPlay"),u=hj,w={},v={},y=!0,A;x(n,{type:wi,id:b,N:function(){var a=l(k);a?(u=xh,q(a)):y=!1},rp:function(a){if(A&&(a=ja(a/A.j.Wk),0<=a&&a<A.images.length))return{image:A.images[a],time:a*A.j.Wk,height:c,width:d,pixelAspectHeight:f,pixelAspectWidth:g}},zp:function(){return y},Ig:function(){return u},Aj:function(){switch(u){case wh:return"downloaded";
case xh:return"loading";case il:return"downloadfailed";case gj:return"parsefailed";default:return"notstarted"}},Ga:w,size:h})}function Hj(a){function b(){var d=a.xb,f=d.Ig();f!=xh&&(f!=wh&&d.zp()?(d=!1,a.Md.Cj()<z.ct&&(d=a.k.value.f>z.$s),d&&(d=a.$b[a.$b.length-1],c(d.size))?a.Wd.yk="h":(d=a.$b[0],c(d.size)?a.Wd.yk="l":d=void 0),d&&(a.Wd.offset=X(),a.xb=d,a.xb.N())):a.removeEventListener(Qd,b))}function c(b){var d=ea(a.n.Fa(),a.n.qb());b=a.aa.ga(b);b*=1+.01*z.fe[2];return b<d*z.dt}a.Wd={};a.$b&&0<
a.$b.length&&(a.xb=a.$b[a.$b.length-1],a.xb&&a.addEventListener(Hc,function(){a.addEventListener(Qd,b)}))}function Vh(a,b){function d(){return k===yh}function f(a){x(a,{success:!1,state:k});x(a,J);dd.flush();v&&bb(v);y&&bb(y);A.resolve(a);B.resolve(a);D.resolve(a);F.resolve(a);k=zh;z.cs&&ij.show()}function g(a,b){return Ka(function(){f({ErrorCode:O.Tm,ErrorDetails:a.name+" promise expired"})},b)}var h=this,k,p,q,m=new a.log.r("SSManager"),n=new lb,u=z.fs,w=z.es,v,y,A,B,D,F,E,C,H,J={};x(h,{Rc:function(){m.trace("initiaing");
A=Df("keymessage");B=Df("server_response");D=Df("keyadded");F=Df("complete");k=yh;b&&z.Ak&&("playready"==jb()&&(b=c("*")),new Wh(a,b,h),u=z.js);v=g(A,u);F.Pd.then(m.info.bind(m,"complete"));E=X();n.B(Ei)},addEventListener:n.addListener,removeEventListener:n.removeListener,Me:function(){return k>=yh&&k<zh},bl:function(){return A.Pd},$p:d,Nh:function(a){C=X();J.ss_km=C-E;if(d()){k=jj;p=a.Bb;q=a.ic;var b={},f,g;"widevine"==q?(f="widevinecef",g=c(a.Bb)):"fps"==q?(f="fps",g=c(a.Bb)):"playready"==q&&(f=
"playreadynative",g=a.Bb);b[f+"securestop"]=g;A.resolve({c:!0,data:b});bb(v);v=l}},Sh:function(){return B.Pd},Oh:function(a){H=X();J.ss_sr=H-C;var b=B;if(k===jj){if(a.c)if("widevine"==q){var c="";try{c=ha(a.Yc.securestopack.widevinecefsecureack),b.resolve({c:!0,kd:ic(c),Bb:p}),k=lg}catch(d){f({ErrorCode:O.ri,ErrorDetails:G(d)})}}else if("fps"==q)b.resolve({c:!0,kd:$c("acknowledged")}),k=lg;else{if("playready"==q)try{c=ha(a.Yc.securestopack.playreadysecureack),b.resolve({c:!0,kd:ic(c),Bb:p})}catch(h){f({ErrorCode:O.ri,
ErrorDetails:G(h)})}}else b=a.g&&0<=[M.si,M.Lf].indexOf(a.g)?O.Um:O.Fm,f({ErrorCode:b,ErrorDetails:a.C||"",ErrorNccpCode:a.td||"",ErrorSubCode:a.g||""});k==lg&&(y=g(D,w))}},Ty:function(){return D.Pd},Zp:function(){return k===lg},Zk:function(a){J.ss_ka=X()-H;k=zh;var b={success:!0};t(a)&&(b.attempts=a);x(b,J);F.resolve(b);bb(y);y=l},Yd:function(){return F.Pd},terminate:f})}function Df(a){var b={},c=new Nd(function(a,c){b.resolve=a;b.reject=c});b.name=a;b.Pd=c;return b}function Wh(a,b,c){function d(){try{if("fps"===
E)D=new vc(F),v.webkitSetMediaKeys(D),kf(a,function(a){a.c?(J=a.me,f()):(H.error("fps certificate failed"),n(O.Mm,l,a))});else if("playready"===E){D=new vc(F);var b=new Na(Yb('<PlayReadyCDMData type="SecureStop"><SecureStop version="1.0" ><SessionID encoding="base64encoded">'+B+'</SessionID><ServerCert encoding="base64encoded">Q0hBSQAAAAEAAAUMAAAAAAAAAAJDRVJUAAAAAQAAAfwAAAFsAAEAAQAAAFhr+y4Ydms5rTmj6bCCteW2AAAAAAAAAAAAAAAJzZtwNxHterM9CAoJYOM3CF9Tj0d9KND413a+UtNzRTb/////AAAAAAAAAAAAAAAAAAAAAAABAAoAAABU8vU0ozkqocBJMVIX2K4dugAAADZodHRwOi8vbnJkcC5uY2NwLm5ldGZsaXguY29tL3Jtc2RrL3JpZ2h0c21hbmFnZXIuYXNteAAAAAABAAUAAAAMAAAAAAABAAYAAABcAAAAAQABAgAAAAAAglDQ2GehCoNSsOaaB8zstNK0cCnf1+9gX8wM+2xwLlqJ1kyokCjt3F8P2NqXHM4mEU/G1T0HBBSI3j6XpKqzgAAAAAEAAAACAAAABwAAAEgAAAAAAAAACE5ldGZsaXgAAAAAH1BsYXlSZWFkeSBNZXRlcmluZyBDZXJ0aWZpY2F0ZQAAAAAABjIwMjQ4AAAAAAEACAAAAJAAAQBAU73up7T8eJYVK4UHuKYgMQIRbo0yf27Y5EPZRPmzkx1ZDMor7Prs77CAOU9S9k0RxpxPnqUwAKRPIVCe0aX2+AAAAgBb65FSx1oKG2r8AxQjio+UrYGLhvA7KMlxJBbPXosAV/CJufnIdUMSA0DhxD2W3eRLh2vHukIL4VH9guUcEBXsQ0VSVAAAAAEAAAL8AAACbAABAAEAAABYyTlnSi+jZfRvYL0rk9sVfwAAAAAAAAAAAAAABFNh3USSkWi88BlSM6PZ2gMuceJFJ9hzz0WzuCiwF9qv/////wAAAAAAAAAAAAAAAAAAAAAAAQAFAAAADAAAAAAAAQAGAAAAYAAAAAEAAQIAAAAAAFvrkVLHWgobavwDFCOKj5StgYuG8DsoyXEkFs9eiwBX8Im5+ch1QxIDQOHEPZbd5EuHa8e6QgvhUf2C5RwQFewAAAACAAAAAQAAAAwAAAAHAAABmAAAAAAAAACATWljcm9zb2Z0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAUGxheVJlYWR5IFNMMCBNZXRlcmluZyBSb290IENBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAMS4wLjAuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAIAAAAkAABAECsAomwQgNY0bm6U6Au9JRvwjbNnRzmVkZi+kg7npnRQ2T+4LgyrePBdBRQ3qb/jxXkn++4sOFa7vjRpFBzV0MMAAACAIZNYc/yJW5CLFaLPCgAHPs+FSdlhYS6BSG3mxgo2TbeHYJqj8Pm5/p6kNXKKUbx9kou+59dz/5+Q060QpP6xas=</ServerCert></SecureStop></PlayReadyCDMData>'));
C=D.createSession("video/mp4",new Na,b);u(C,"addEventListener")}else H.error("Unsupported drm type ",E),n(O.Hm)}catch(c){H.error("Exception on webkitSetMediaKeys",c),n(O.Pm,c)}}function f(){L++;try{C=D.createSession("keyrelease",J),u(C,"addEventListener")}catch(a){H.error("create session error",a),n(O.Gm,a)}}function g(a){var b=a.message;"fps"==jb()?Jj(b,B).then(function(a){a?h(b):(k($c("acknowledged")),I=!0,K=Ka(function(){n(O.Om)},z.hs))}).catch(function(a){H.error("exception on matching persisted keysessionId",
a);n(O.Rm,a)}):"playready"==jb()&&(b=Oc(b,"PlayReadyKeyMessage","Challenge"),c.Nh({c:!0,Bb:b,ic:jb(),Ne:B}),c.Sh().then(function(a){a.c&&k(a.kd)}))}function h(a){c.Nh({c:!0,Bb:a,ic:jb(),Ne:B});c.Sh().then(function(a){a.c&&k(a.kd)});I=!1}function k(a){try{C&&C.update(a)}catch(b){H.error("Exception calling keySession.update ",b),n(O.Qm,b)}}function p(){I?(I=!1,bb(K),u(C,"removeEventListener"),C.close(),L<N?f():n(O.Km)):(c.Zk(L),C.close())}function q(a){var b=oc(a,Tc);H.error("Received event: keyerror",
b.Se);var d;a:{try{var f=a.target.error,g=f.code,h=f.systemCode;if("fps"==jb()){if(2==g&&"560820082"==h){d=!0;break a}}else if("playready"==jb()&&1==g&&-2147024637==h){d=!0;break a}}catch(k){}d=void 0}d?n(O.Nm):c.Me()&&n(O.Im,l,Va(b.kc))}function m(a){a=oc(a,Sc);H.error("Video element event: error",a.Se);c.Me()&&n(O.Sm,l,Va(a.kc))}function n(a,b,d){a={ErrorCode:a};b&&(a.ErrorDetails=G(b));d&&x(a,d);a.attempts=L;c.terminate(a)}function u(a,b){a[b](w+"keyerror",q);a[b](w+"keymessage",g);a[b](w+"keyadded",
p)}var w=Qh(),v=Y("VIDEO"),y,A,B=b,D,F=z.Oe[0],E=jb(),C,H=new a.log.r("SSManagerPersisted"),J,L=0,I,K,N=z.ks;(function(){var b=a.Xa,c=b.lastChild;c?b.insertBefore(v,c):b.appendChild(v)})();try{A=new sd,A.addEventListener("sourceopen",d),v.addEventListener("error",m),y=df.createObjectURL(A),v.src=y}catch(ca){H.error("Exception creating MediaSource",ca),n(O.Lm,ca)}c.Yd().then(function(){try{v.removeAttribute("src"),v.load&&v.load()}catch(b){H.error("Exception clearing element context",b)}t(y)&&df.revokeObjectURL(y);
C&&C.close();try{a.Xa.removeChild(v)}catch(c){H.error("Exception removing temporary video element from Dom",c)}v=A=null;y=""})}function Jj(a,b){return new Nd(function(c){var d=mg(a),f;zd(d,function(a){f=a.object.dict.string[ob];c(f==b)})})}function Kj(a){if(!a)throw new La("invalid array buffer");var b=new Na(a);a=new Gc(b);var c=function(a){if(a.Ea()<kj.length+4+4+4+lj)throw new La("array buffer too short");kj.forEach(function(b){if(b!=a.Z())throw new La("BIF has invalid magic.");});var b=a.Rd();
if(b>jl)throw new La("BIF version in unsupported");var c=a.Rd();if(0==c)throw new La("BIF has no frames.");var d=a.Rd(),f=a.ia(lj);return{version:b,Zq:c,Wk:d,fy:f}}(a);a=function(a){for(var d=[],f=0;f<=c.Zq;f++){var g,h={timestamp:a.Rd(),offset:a.Rd()};g!=l&&d.push(b.subarray(g.offset,h.offset));g=h}return d}(a);return{j:c,images:a}}function Ij(b,c,d){function f(){n.Zb.addEventListener("showsubtitle",function(a){h(kl,a)});n.Zb.addEventListener("removesubtitle",function(a){h(ll,a)})}function h(a,b,
c){b=b||{};b.target=m;u.B(a,b,!c)}function k(){k=g;n.load(function(a,b){try{h(ml,l,!0),b(fa)}catch(c){b({g:M.Nb,C:G(c)})}})}function p(){w.set(n.state.value==Sa&&n.A.value==tc)}function q(){if(n.state.value==Sa){for(var a,b,c;b=y.shift();)a=n.Zb.Rf(b.url,b.name),b.Fn&&(c=a);c&&n.$.set(c)}}var m=this,n=he(b,c,d);b=n.lg;var t=new n.log.r("VideoPlayer"),u=new lb,w=new Fa(!1,function(){h(Ah)}),v,y=[];(function(){n.addEventListener(af,function(){h(mj)});n.addEventListener(Qd,function(){h(nj)});n.addEventListener(Pd,
function(){h(nj)});n.paused.addListener(function(){h(Bh)});n.muted.addListener(function(){h(nl)});n.volume.addListener(function(){h(ol)});n.A.addListener(p);n.state.addListener(p);n.ke.addListener(function(a){v||n.state.value!=Sa||a.newValue||(v=!0,h(pl));h(ql)});n.W.addListener(function(a){h(rl);a.oldValue&&a.oldValue.Ma==a.newValue.Ma||h(oj);Z(function(){var a=n.W.value.Ma;0<=a.indexOf(n.$.value)||(t.info("Changing timed text track to match audio track"),n.$.set(a[0]))})});n.$.addListener(function(){h(oj)});
n.addEventListener(ej,function(){h(pj)});n.addEventListener(fj,function(){h(sl)});n.state.addListener(function(a){switch(a.newValue){case Sa:h(tl);h(ul);h(vl);h(pj);h(qj);q();f();break;case hh:n.Da&&h(wl,n.Da.Lh());break;case cg:h(xl),u.Ec()}})})();x(m,{addEventListener:u.addListener,removeEventListener:u.removeListener,getElement:function(){return n.Xa},prepare:function(){},load:function(){k()},close:function(a){k=g;n.close(a)},play:function(){k();n.paused.set(!1)},pause:function(){k();n.paused.set(!0)},
getPaused:function(){return n.paused.value},getMuted:function(){return n.muted.value},setMuted:function(a){n.muted.set(!!a)},getVolume:function(){return n.volume.value},setVolume:function(a){n.volume.set(ya(a,0,1))},getEnded:function(){return w.value},getBusy:function(){var a=n.ke.value;if(a)return{networkStalled:!!a.Mk,stalled:!!a.Mk,progress:a.df,progressRollback:!!a.zr}},getError:function(){var a=n.Da;return a&&a.Lh()},getCurrentTime:function(){return n.v.value},getBufferedTime:function(){var a=
n.n;if(a)return a.mp()},getDuration:function(){return n.duration},seek:function(a){n.ha?n.ha.seek(a):n.ob=a},getVideoSize:function(){return n.ac?{width:n.ac.width,height:n.ac.height}:null},getAudioTrackList:function(){for(var a=[],b=0;b<n.Ab.length;b++)a.push(ee(n.Ab[b]));return a},getAudioTrack:function(){return ee(n.W.value)},setAudioTrack:function(a){for(var b,c=0;c<n.Ab.length;c++)if(b=n.Ab[c],ee(b)==a){n.W.set(b);return}t.error("Invalid setAudioTrack call")},getTimedTextTrackList:function(){for(var a=
n.W.value.Ma,b=[],c=0;c<a.length;c++)b.push(ee(a[c]));return b},tryRecoverFromStall:function(){n.Xd()},getTimedTextTrack:function(){return ee(n.$.value)},setTimedTextTrack:function(a){for(var b=n.W.value.Ma,c,d=0;d<b.length;d++){c=b[d];if(!a&&null==c){n.$.set(null);return}if(ee(c)==a){t.info("Setting Timed Text, profile:"+c.fk);n.$.set(c);return}}t.error("Invalid setTimedTextTrack call")},setTimedTextBounds:function(a){n.Kh&&n.Kh.Ah(a)},getTrickPlayFrame:function(a){if(n.xb)return n.xb.rp(a)},getXid:function(){return n.qa},
getAdditionalLogInfo:function(){return x({playerver:"2.0000.308.011",jssid:me,groupName:z.Fe,xid:n.qa,pbi:n.index},Dc,{prefix:"pi_"})},induceError:function(a){n.Pa(new mb(O.nl,M.cc,a))},loadCustomTimedTextTrack:function(b,c,d){if(!a(b))throw new La("invalid url");y.push({url:b,name:c,Fn:d});q()},diagnostics:{addEventListener:b.addEventListener,removeEventListener:b.removeEventListener,getModel:b.wp,getTime:X,getGroups:function(){return n.af.sp()}}})}function ee(a){return a?(a.oh=a.oh||{trackId:a.ka,
bcp47:a.bb,displayName:a.displayName,trackType:a.Xk,channels:a.Qi},a.Rj&&(a.oh.isImageBased=!0),a.oh):null}function Lj(a,b,c){function d(){m.set(!1);h()<c-1&&a.play()}function f(){m.set(!0);a.pause()}function g(){var b=h()>=c||a.getEnded();b&&a.pause();m.value?f():d();n.set(b)}function h(){return ya(a.getCurrentTime()-b,0,c)}function k(d){a.seek(ya(b+d,b,b+c-2E3));g()}var l=vb.create(a),p=new lb,q=H([Bh,Ah]),m=new Fa(!1,function(){p.B(Bh)}),n=new Fa(!1,function(){p.B(Ah)});k(b||0);a.addEventListener(qj,
function(){var d=a.getDuration();b=ea(d-2E3,b||0);c=ea(d-b,c||d);k(0)});a.addEventListener(mj,g);x(l,{addEventListener:function(b){(q[b]?p.addListener:a.addEventListener).apply(null,arguments)},removeEventListener:function(b){(q[b]?p.removeListener:a.removeEventListener).apply(null,arguments)},play:d,pause:f,getPaused:function(){return m.value},getEnded:function(){return n.value},getCurrentTime:h,getDuration:function(){return c},seek:k});return l}var fa={c:!0},Ig=["en-US"],Mj=["4E657466-6C69-7850-6966-665374726D21",
"4E657466-6C69-7848-6165-6465722E7632"],Gb=m.navigator,ac=Gb.userAgent,He=m.location,Ef=m.screen,Od=m.performance,eb=m.document,ad=m.Array,ng=ad.prototype,Nj=ng.sort,Og=ng.slice,Ve=ng.filter,dk=ng.forEach,vb=m.Object,og=vb.create,zk=vb.keys,Ch=m.Date,Re=Ch.now,$k=m.String.fromCharCode,sc=m.parseInt,cc=m.parseFloat,Ba=m.Math,ja=Ba.floor,pd=Ba.ceil,Ya=Ba.round,qa=Ba.max,ea=Ba.min,Qe=Ba.random,lc=Ba.abs,Vg=Ba.pow,Ak=Ba.sqrt,La=m.Error,ab=m.JSON,pg=m.escape,Pg=m.unescape,Md=m.encodeURIComponent,Zh=m.decodeURIComponent,
ui=m.XMLHttpRequest,Na=m.Uint8Array,Nd=m.Promise,df=m.URL||m.webkitURL,ef=m.HTMLVideoElement,sd=m.MediaSource||m.WebKitMediaSource,vc=m.MediaKeys||m.WebKitMediaKeys||m.MSMediaKeys,pk=m.XMLSerializer,ok=m.DOMParser,ff=m.nfCrypto||m.webkitCrypto||m.msCrypto||m.crypto,mc=ff&&(ff.webkitSubtle||ff.subtle),yl=m.nfCryptokeys||m.webkitCryptokeys||m.msCryptokeys||m.cryptokeys,Tg,Ug,nc,Dh,rj=m.PERSISTENT,zl=m.requestFileSystem||m.webkitRequestFileSystem,bk=m.Blob,gi=m.FileReader,Eh=Gb.persistentStorage||Gb.webkitPersistentStorage,
Al=Eh?l:m.storageInfo||m.webkitStorageInfo;try{Tg=m.indexedDB}catch(Bl){Ug=Bl||"noex"}try{nc=m.localStorage}catch(Cl){Dh=Cl||"noex"}var Ng=/^\S+$/,bi=function(){function a(c){return b[c]}var b={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"},c=/[&'"<>]/g;return function(b){return b.replace(c,a)}}(),Yh=function(){var a=/^\s+|\s+$/gm;return function(b){return b.replace(a,"")}}(),ek,Tf,Fh,Zg,nk,vk,Zk,Yk,Ai,sj,Dc,ji,lk,mk,ki,li,ni,oi,hk,jk,qi,ri,kk,pi,ik,mi,tj=/CrOS/.test(ac),uj=/OPR/.test(ac);
Tf=tj?"C":uj?"O":"M";Fh=/OPR/.test(ac)?"NFCDOP-01-":/Windows NT/.test(ac)?"NFCDCH-02-":/Intel Mac OS X/.test(ac)?"NFCDCH-MC-":/CrOS/.test(ac)?"NFCDCH-01-":"NFCDCH-LX-";Zg=tj?"chromeos-cadmium":uj?"opera-cadmium":"chrome-cadmium";sj=/CrOS/.test(ac);ki=["heaac-2-dash"];li=["playready-h264mpl30-dash","playready-h264mpl31-dash"];ni=["dfxp-ls-sdh","simplesdh","nflx-cmisc"];oi=["com.widevine.alpha"];qi=!!m.MediaSource;ri=!m.MediaSource;mi=function(a){return a};pi={MONOSPACED_SERIF:"font-family:Courier New,Arial,Helvetica;font-weight:bolder",
MONOSPACED_SANS_SERIF:"font-family:Consolas,Lucida Console,Menlo,Monaco,Arial,Helvetica;font-weight:bolder",PROPORTIONAL_SERIF:"font-family:Georgia,Times New Roman,Arial,Helvetica;font-weight:bolder",PROPORTIONAL_SANS_SERIF:"font-family:Arial,Helvetica;font-weight:bolder",CASUAL:"font-family:Gabriola,Segoe Print,Comic Sans MS,Chalkboard,Arial,Helvetica;font-weight:bolder",CURSIVE:"font-family:Lucida Handwriting,Brush Script MT,Segoe Script,Arial,Helvetica;font-weight:bolder",SMALL_CAPITALS:"font-family:Copperplate Gothic,Copperplate Gothic Bold,Copperplate,Arial,Helvetica;font-variant:small-caps;font-weight:bolder"};
ji={droppedFrameRateFilterEnabled:!0,promiseBasedEme:!0};var vj=Q(),qg;if(!(qg=vj))a:{try{Gb.plugins.refresh();qg=Q();break a}catch(Ql){}qg=void 0}var Dl=qg,El=!!ba("name",/Chrome Remote Desktop Viewer/i),Fl=!!ba("name",/Chromoting Viewer/i),Gh;a:{try{Gh=sd.isTypeSupported('video/mp4; codecs="avc1.640028"');break a}catch(Rl){}Gh=void 0}var Gl=Gh,Hh;a:{try{Hh=Y("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"');break a}catch(Sl){}Hh=void 0}var Hl=Hh,Ih;a:{try{if(q(Gb.requestMediaKeySystemAccess))V();
else{Ih=Y("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"',"com.widevine.alpha");break a}}catch(Tl){}Ih=void 0}Dc={wvp:vj,wvp2:Dl,crdvp:El,cvp:Fl,itsh264:Gl,cpth264:Hl,cpth264wv:Ih};var wj=n(10),mg=wj.hg,$c=wj.qg,Xh=n(3),ic=Xh.hg,Gc=n(4),kh=n(5).Gr,dl=n(7);q(ArrayBuffer.prototype.slice)||(ArrayBuffer.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.byteLength);a=Ba.floor(a);b=Ba.floor(b);0>a&&(a+=this.byteLength);0>b&&(b+=this.byteLength);a=Ba.min(Ba.max(0,a),this.byteLength);
b=Ba.min(Ba.max(0,b),this.byteLength);if(0>=b-a)return new ArrayBuffer(0);var c=new ArrayBuffer(b-a),d=new Na(c),f=new Na(this,a,b-a);d.set(f);return c});var bd=Re()-1,Qg=0,me=""+(1E4*sb()+ja(1E4*Qe())),na={addSink:function(a){pe.push(a)},removeSink:function(a){pe.splice(pe.indexOf(a),1)},write:function(a,b,c){a={Ha:this.Ha,level:a,message:b,fields:c||{},time:X(),index:Il++,category:this.Oi||"General"};this.mg&&(a.mg=!0);for(b=0;b<pe.length;b++)pe[b](a)},$o:function(a,b){this.write(fb.FATAL,a,pc(arguments))},
error:function(a,b){this.write(fb.ERROR,a,pc(arguments))},warn:function(a,b){this.write(fb.WARN,a,pc(arguments))},info:function(a,b){this.write(fb.INFO,a,pc(arguments))},trace:function(a,b){this.write(fb.TRACE,a,pc(arguments))},debug:function(a,b){this.write(fb.DEBUG,a,pc(arguments))},log:function(a,b){this.write(fb.DEBUG,a,pc(arguments))}};na.fatal=na.$o;na.error=na.error;na.warn=na.warn;na.info=na.info;na.trace=na.trace;na.debug=na.debug;na.log=na.log;(na.r=function(a){this.Oi=a}).prototype=na;
yc.prototype=na;var fb={MIN:0,FATAL:0,ERROR:1,WARN:2,INFO:3,TRACE:4,DEBUG:5,MAX:5},pe=[],Il=0,Oj=/^\w*Error$/,Qj=/[\r\n]+ */g,Pj=H(["Details","Exception","StackTrace"]),Rj={0:"F",1:"E",2:"W",3:"I",4:"T",5:"D"},Sj=0,Xa=new lb,uc=1,rd=2,vh=3,qh=4;Z(function(){function a(b,d){if(c)c.on(b,d);else m.addEventListener(b,d)}var b=m.jQuery,c=b&&b(m),b=(b=m.netflix)&&b.cadmium&&b.cadmium.addBeforeUnloadHandler,d=eb.hidden;b?b(function(a){Xa.B(uc,a)}):a("beforeunload",function(a){Xa.B(uc,a)});a("keydown",function(a){Xa.B(rd,
a)});a("resize",function(){Xa.B(vh)});eb.addEventListener("visibilitychange",function(){d!==eb.hidden&&(d=eb.hidden,Xa.B(qh))})});var ij=function(){function a(){eb.body&&!c()&&(eb.body.appendChild(h),f(!0))}function b(){c()&&eb.body.removeChild(h)}function c(){return h.parentNode==eb.body}function d(){g.lb(f)}function f(a){var b=E(t.value),c=w.value?new RegExp(w.value):null,d=u.checked,g="",p,l,n=q.length;for(l=0;l<n;l++)if(p=q[l],p.level<=b&&(p=Nc(p,d,d),!c||c.test(p)))g+=p+"\n";k.value="Version: 2.0000.308.011\n"+
(Jb?"Esn: "+Jb.lc+"\n":"")+"JsSid: "+me+", Epoch: "+sb()+", Start: "+ja(bd/1E3)+", TimeZone: "+(new Ch).getTimezoneOffset()+"\nHref: "+He.href+"\nUserAgent: "+Gb.userAgent+"\n--------------------------------------------------------------------------------\n"+g;h.style.cssText=m?"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;height:30%":"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px";a&&Z(function(){k.scrollTop=k.scrollHeight})}var g=new kb(1E3),
h=Y("DIV","position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px",l,{"class":"player-log"}),k=Y("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"),p=Y("DIV","position:absolute;top:2px;right:2px;opacity:0.8;background-color:white"),q=[],m=!0,n;k.setAttribute("wrap","off");k.setAttribute("readonly","readonly");k.addEventListener("focus",
function(){n=!0;f(!1);k.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.86)"});k.addEventListener("blur",function(){n=!1;f(!1);k.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"});h.appendChild(k);
h.appendChild(p);var t=Y("SELECT",null,'<option value="1">Error</option><option value="2">Warn</option><option value="3" selected>Info</option><option value="4">Trace</option><option value="5">Debug</option>');t.addEventListener("change",f,!1);p.appendChild(t);var u=Y("INPUT","display:inline-block;border:1px solid black;padding:3px;");u.setAttribute("type","checkbox");u.setAttribute("checked","true");u.setAttribute("title","Details");u.addEventListener("change",f,!1);p.appendChild(u);var w=Y("INPUT",
"display:inline-block;border:1px solid black;padding:3px;;width:150px");w.addEventListener("keydown",d,!1);w.addEventListener("change",d,!1);w.setAttribute("title","Filter (RegEx)");p.appendChild(w);var v=Y("BUTTON","display:inline-block;border:1px solid black;padding:3px;","Update");v.addEventListener("click",f,!1);p.appendChild(v);v=Y("BUTTON","display:inline-block;border:1px solid black;padding:3px;","Clear");v.addEventListener("click",function(){q=[];f()},!1);p.appendChild(v);v=Y("BUTTON","display:inline-block;border:1px solid black;padding:3px;",
"M");v.addEventListener("click",function(){m=!m;f()},!1);p.appendChild(v);v=Y("BUTTON","display:inline-block;border:1px solid black;padding:3px;","X");v.addEventListener("click",b,!1);p.appendChild(v);Xa.addListener(rd,function(d){d.ctrlKey&&d.altKey&&d.shiftKey&&76==d.keyCode&&(m=!1,c()?b():a())});na.addSink(function(a){q.push(a);z&&(a=z.lq,0<=a&&q.length>a&&q.shift());c()&&!n?d():g.lb()});return{show:function(){m=!1;a()},Rg:b,toggle:function(){m=!1;c()?b():a()}}}();na.addSink(function(a){var b=
a.level;if(!z||b<=z.oq){a=Nc(a,!0,!0);var c=m.console;1>=b?c.error(a):2>=b?c.warn(a):c.log(a)}});var Tj=0;x(Ud.prototype,{He:!1,$c:0,Vd:0,Ke:0,Bd:!1,Le:0,tn:function(a){b(a)&&(a<this.$c&&(this.Vd+=this.$c),this.$c=a,this.He=!0)},np:function(){if(this.He)return this.Bd?this.Le-this.Ke:this.Vd+this.$c-this.Ke},Bs:function(){this.Bd||(this.He&&(this.Le=this.Vd+this.$c),this.Bd=!0)},Js:function(){this.Bd&&(this.He&&(this.Ke+=this.Vd+this.$c-this.Le),this.Le=0,this.Bd=!1)}});Gc.prototype.fl=function(a){a=
new Gc(a);for(var b,c;;)if(b=a.Ea(),c=b>>>14)c=ea(4,c),this.Th(192|c),this.Zd(a,16384*c);else{128>b?this.Th(b):this.gl(b|32768,2);this.Zd(a,b);break}};Gc.prototype.uk=function(){for(var a=[],b=new Gc(a),c;;){c=this.Z();if(c&128)if(128==(c&192))c&=63,c=(c<<8)+this.Z(),b.Zd(this,c);else if(c&=63,0<c&&4>=c){b.Zd(this,16384*c);continue}else throw new La("bad asn1");else b.Zd(this,c);break}return new Na(a)};var Uj="0123456789ABCDEF",ig,xj;(function(){function a(b){return c[b]}var c={'"':'""',"\r":"","\n":" "},
d=/["\r\n]/g,f=/[", ]/;xj=function(c){return b(c)?c:w(c)?c.replace(d,a):!0===c||!1===c?c:""};ig=function(a){var b=xj,c="";p(a,function(a,d){var g=b(a)+"="+b(d);f.test(g)&&(g='"'+g+'"');c=c?c+(","+g):g});return c}})();mb.prototype.toString=function(){var a="[PlayerError #"+this.qd+"]";this.C&&(a+=" "+this.C);this.qe&&(a+=" (CustomMessage: "+this.qe+")");return a};mb.prototype.Lh=function(){var a;this.qe&&(a=["streaming_error"]);a||"80080017"==this.P&&(a=["admin_mode_not_supported","platform_error"]);
if(!a)switch(this.errorCode){case O.Ff:case O.Cf:case O.yf:case O.ni:a=["pause_timeout"];break;case O.di:case O.fi:a=this.g?["platform_error"]:["multiple_tabs"];break;case O.ci:case O.bi:case O.ei:a=["should_signout_and_signin"];break;case O.ai:case O.pi:case O.oi:case O.Kf:case O.mi:a=["platform_error","plugin_error"];break;case O.Jf:a=["no_cdm","platform_error","plugin_error"];break;case O.Hf:a=this.g?["platform_error","plugin_error"]:["no_cdm","platform_error","plugin_error"];break;case O.If:switch(this.P){case "FFFFD000":a=
["device_needs_service","platform_error"];break;case "48444350":a=["unsupported_output","platform_error"];break;case "00000024":a=["private_mode"]}}!a&&Wd(this.g)&&(a=["internet_connection_problem"]);if(!a)switch(this.g){case M.Mf:a=["should_upgrade"];break;case M.ki:case M.Df:a=["should_signout_and_signin"];break;case M.li:a=["internet_connection_problem"];break;case M.wi:case M.xi:case M.ti:a=["storage_quota"];break;case M.Cm:case M.Am:case M.Dm:case M.Bm:case M.Uh:a=["platform_error","plugin_error"];
break;case M.kl:case M.Yh:case M.Zh:a=["private_mode"]}switch(this.g){case M.$h:case M.vi:case M.yi:case M.Lf:z.yn&&(a=["please_call"])}a=a||[];a.push(Tf+this.errorCode);this.g&&a.push(""+this.g);a={display:{code:this.qd,text:this.qe},messageIdList:a};this.Ic&&(a.nccpActionId=this.Ic);this.Jc&&(a.mslErrorCode=this.Jc);return a};var O={cc:7001,$d:7010,tl:7014,ci:7016,bi:7017,ei:7018,di:7020,fi:7022,Kl:7029,Jl:7031,Gl:7041,Hl:7042,Il:7043,Cl:7051,vl:7052,Dl:7053,El:7054,Ht:7055,Kt:7056,Ot:7057,wl:7058,
ai:7059,Jt:7060,It:7061,Nt:7062,xl:7063,zl:7064,yl:7065,Al:7066,Bl:7067,Pt:7068,ul:7069,Lt:7081,Mt:7082,Fl:7083,Rl:7111,Tl:7113,Sl:7115,Ul:7117,am:7121,Xl:7123,Yl:7125,Xt:7130,du:7131,bu:7133,em:7202,km:7330,mu:7331,ni:7332,lm:7333,mm:7334,pi:7351,oi:7352,jm:7353,Hf:7354,Kf:7355,mi:7356,Jf:7357,rm:7358,fm:7359,ou:7360,om:7361,If:7363,Gf:7364,pm:7365,sm:7367,um:7371,vm:7373,zm:7375,ym:7376,xm:7377,nu:7379,wm:7381,qm:7385,gm:7391,hm:7392,im:7393,nl:7400,Ff:7500,Cf:7502,yf:7510,Tm:7600,Em:7601,Vm:7602,
Fm:7603,ri:7604,Um:7605,Jm:7620,Nm:7621,Km:7622,Lm:7623,Pm:7624,Gm:7625,Mm:7626,Rm:7627,Om:7628,Im:7631,Sm:7632,Qm:7633,Hm:7634},M={cc:1001,Nb:1003,il:1011,jl:1013,hl:1015,Wh:1101,Xh:1102,bd:1103,Vh:1104,Bf:1105,cd:1106,Za:1107,Af:1108,pl:1110,ae:1203,ce:1204,Ol:1250,Qt:1251,Tt:1252,Rt:1253,Ut:1254,St:1255,ll:1260,Dt:1261,yt:1262,Ct:1263,Bt:1264,At:1265,zt:1266,ml:1269,au:1303,bm:1305,Ef:1309,cu:1311,eu:1312,$t:1313,Zt:1315,Yt:1317,Wl:1321,Vl:1323,cm:1331,ki:1333,li:1337,fu:1341,Zl:1343,$l:1344,uc:1402,
su:1403,wi:1405,xi:1407,ui:1411,vi:1412,gn:1414,yi:1415,si:1417,Lf:1418,ti:1421,cn:1423,tu:1425,Zm:1427,bn:1429,$m:1431,dn:1432,fn:1451,en:1453,lu:1501,ku:1502,gu:1504,iu:1506,hu:1508,ju:1515,Uh:1553,kl:1555,Cm:1603,Am:1605,Dm:1607,Bm:1609,ru:1625,pu:1627,qu:1629,Ft:1701,ol:1713,Gt:1715,Et:1721,zf:1723,Yh:1802,sl:1803,Zh:1804,rl:1805,$h:1807,ql:1809,Vt:1901,Pl:1911,ii:1913,Ql:1915,gi:1931,ji:1933,hi:1935,Df:1957,Mf:2103,hn:2105,jn:2107},gg,Eb,rg,Jh,ai={};(function(){var a=new na.r("loadAsync"),b=
[];Eb=function(a,c){b.push({iq:c,jo:a})};gg=rb(function(c){function d(){var c,g,p;if(c=b.shift())try{g=c.iq,h=p=c.jo,k.wb(),k.jc(),g(function(a){a.c?d():(a.errorCode=a.errorCode||p,f(a))})}catch(l){a.error("Exception while loading component",l),f({errorCode:p,g:M.il,C:""+l})}else f(fa)}function f(a){Jh=X();f=g;k.wb();c(a)}rg=X();var h=0,k=new tb(z.Bn,function(){a.error("Load timed out");f({errorCode:h,g:M.jl})});d()})})();var Vj=/^[0-9.]*$/,Wj=/^([a-fA-F0-9]*:){2}[a-fA-F0-9:.]*$/,ka={};(function(){ka.Yu=
function(a,b){return a<b?-1:a===b?0:1};ka.jg=function(a,b){return a===b};ka.cv=function(a){return null===a?"BUCKETS_NULL":ka.Ed(a)?"BUCKETS_UNDEFINED":ka.Vp(a)?a:a.toString()};ka.Sp=function(a){return"function"===typeof a};ka.Ed=function(a){return a===l};ka.Vp=function(a){return"[object String]"===vb.prototype.toString.call(a)};ka.hy=function(a){return ka.Sp(a)?function(b,c){return-1*a(b,c)}:function(a,b){return a<b?1:a===b?0:-1}};ka.Ou=function(a){return function(b,c){return 0===a(b,c)}};ka.fa=function(){this.la=
this.T=null;this.ya=0};ka.fa.prototype.add=function(a,b){ka.Ed(b)&&(b=this.ya);if(0>b||b>this.ya||ka.Ed(a))return!1;var c=this.createNode(a);if(0===this.ya)this.la=this.T=c;else if(b===this.ya)this.la=this.la.next=c;else if(0===b)c.next=this.T,this.T=c;else{var d=this.hk(b-1);c.next=d.next;d.next=c}this.ya++;return!0};ka.fa.prototype.first=function(){return null!==this.T?this.T.element:l};ka.fa.prototype.Q=function(){return null!==this.la?this.la.element:l};ka.fa.prototype.indexOf=function(a,b){var c=
b||ka.jg;if(ka.Ed(a))return-1;for(var d=this.T,f=0;null!==d;){if(c(d.element,a))return f;f++;d=d.next}return-1};ka.fa.prototype.contains=function(a,b){return 0<=this.indexOf(a,b)};ka.fa.prototype.remove=function(a,b){var c=b||ka.jg;if(1>this.ya||ka.Ed(a))return!1;for(var d=null,f=this.T;null!==f;){if(c(f.element,a))return f===this.T?(this.T=this.T.next,f===this.la&&(this.la=null)):(f===this.la&&(this.la=d),d.next=f.next,f.next=null),this.ya--,!0;d=f;f=f.next}return!1};ka.fa.prototype.clear=function(){this.la=
this.T=null;this.ya=0};ka.fa.prototype.equals=function(a,b){var c=b||ka.jg;return a instanceof ka.fa&&this.size()===a.size()?this.Xo(this.T,a.T,c):!1};ka.fa.prototype.Xo=function(a,b,c){for(;null!==a;){if(!c(a.element,b.element))return!1;a=a.next;b=b.next}return!0};ka.fa.prototype.Nr=function(){if(!(0>=this.ya)){if(1===this.ya)this.la=this.T=null;else{var a=this.hk(-1);null===a?this.T=this.T.next:a.next===this.la&&(this.la=a);null!==a&&(a.next=a.next.next)}this.ya--}};ka.fa.prototype.forEach=function(a){for(var b=
this.T;null!==b&&!1!==a(b.element);)b=b.next};ka.fa.prototype.reverse=function(){for(var a=null,b=this.T,c=null;null!==b;)c=b.next,b.next=a,a=b,b=c;c=this.T;this.T=this.la;this.la=c};ka.fa.prototype.size=function(){return this.ya};ka.fa.prototype.hk=function(a){if(0>a||a>=this.ya)return null;if(a===this.ya-1)return this.la;for(var b=this.T,c=0;c<a;c++)b=b.next;return b};ka.fa.prototype.createNode=function(a){return{element:a,next:null}};ka.zb=function(){this.list=new ka.fa};ka.zb.prototype.Gc=function(a){return this.list.add(a)};
ka.zb.prototype.Dc=function(){if(0!==this.list.size()){var a=this.list.first();this.list.Nr();return a}return l};ka.zb.prototype.$e=function(){return 0!==this.list.size()?this.list.first():l};ka.zb.prototype.size=function(){return this.list.size()};ka.zb.prototype.contains=function(a,b){return this.list.contains(a,b)};ka.zb.prototype.clear=function(){this.list.clear()};ka.zb.prototype.forEach=function(a){this.list.forEach(a)}})();var Xj=function(){function a(b){if(y(b)){b=b.toLowerCase();if("#"==
b[0]){if(7==b.length)return b;if(4==b.length)return"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]}return Jl[b]}}function b(a,c,d){c=c[a];0<=c||(c=cc(a));if(0<=c)return ea(c,d)}function c(a,b){var d=a.length,f=a[d-1];if("t"===f)return cc(a)*b|0;if("s"===f)return"m"===a[d-2]?cc(a)|0:1E3*cc(a)|0;if((d=a.match(da))&&4<=d.length)return 1E3*(3600*sc(d[1],10)+60*sc(d[2],10)+cc(d[3]))|0;throw new La("dfxp-badtime");}function d(a,b,c,f,g){var h;if(a){var k=a.style;c=k?c[k]:l;f=(k=a.region)?f[k]:l;for(var p=k=g.length,
q,m,n,t,u,p=0;p<k;p++)if(q=g[p],m=a[q],m===l&&c&&(m=c[q]),m===l&&f&&(m=f[q]),m!==l&&m!==b[q]){if(!h)for(h={},n=0;n<k;n++)t=g[n],u=b[t],u!==l&&(h[t]=u);h[q]=m}}return h||b}function f(a,b,c,g,h,p,q,m,n){function u(a,f,y){var A=a[Ib],B=A.style||f.style||"",z=A.region||f.region||"",D,E;B||z?(D=B+"/"+z,E=c[D]):E=b;if(!E){E=b;var C;C=F(g);x(C,h[B]);E=t(E,C,q,m,n);c[B+"/"]=E;z&&(x(C,p[z]),x(C,h[B]),E=t(E,C,q,m,n),c[D]=E)}if(!y)a:{for(y=Q.length;y--;)if(A[Q[y]]!==l){y=!0;break a}y=void 0}y&&(A=d(A,f,h,p,
V),E=t(E,A,q,m,n));f=(a=a[Xg])&&a.length;for(B=0;B<f;B++)z=a[B],k(z)?O.test(z[Wf])?v++:u(z,A,y):(w.push({text:z,lineBreaks:v,style:E}),v=0)}var w=[],v=0;u(a,g,!1);0<v&&w.push({text:"",lineBreaks:v,style:b});return w}function q(a,b,c,d,f,g,h,k){var p;c&&(c=L[c]||"top",a.verticalAlignment!==c&&(a.verticalAlignment=c));d&&(c=I[d]||"left",a.horizontalAlignment!==c&&(a.horizontalAlignment=c));var l;f?((l=k[f])?(d=l.marginLeft,c=l.marginTop):(p=f.split(" "),d=v(p[0],h.x)||0,c=v(p[1],h.y)||0,l={Sa:0,marginLeft:d,
marginTop:c,vn:d*b.Og+b.yd,xn:c*b.Ph+b.wf},30>k.Sa&&(k.Sa++,k[f]=l)),a.marginLeft=l.vn,a.marginTop=l.xn):(c=d=0,(l=k["default"])||(k["default"]=l={Sa:0}));g&&(f=l[g],f||(p=g.split(" "),f={wn:(1-(d+(v(p[0],h.x)||0)))*b.Og+b.yd,un:(1-(c+(v(p[1],h.y)||0)))*b.Ph+b.wf},30>l.Sa&&(l.Sa++,l[g]=f)),a.marginRight=f.wn,a.marginBottom=f.un)}function m(a,b,c,d,f){var g=a.displayAlign,h=a.textAlign,k=a.origin;a=a.extent;c=F(c);q(c,b,g,h,k,a,d,f);c.id=J++;return c}function n(c,d,f,g){var h=b(f.characterSize||d.characterSize,
Kl,2)||1,k;k=(k=c.fontSize)&&P.test(k)?ya(E(k),25,200):void 0;h*=k/100||1;k=c.textOutline;var p,l,q;if(k&&"none"!=k){l=k.split(" ");var m;R.test(l)?(m=0,q=c.color):(m=1,q=a(l[0]));p=w(l[m]);l=w(l[m+1])}return{characterStyle:f.characterStyle||Ll[c.fontFamily]||d.characterStyle,characterSize:h*g,characterColor:a(f.characterColor||c.color||d.characterColor),characterOpacity:b(D(f.characterOpacity,c.opacity,d.characterOpacity),Kh,1),characterEdgeAttributes:f.characterEdgeAttributes||k&&("none"===k?Ml:
l?Rg:ci)||d.characterEdgeAttributes,characterEdgeColor:a(f.characterEdgeColor||q||d.characterEdgeColor),characterEdgeWidth:p,characterEdgeBlur:l,characterItalic:"italic"===c.fontStyle,characterUnderline:"underline"===c.textDecoration,backgroundColor:a(f.backgroundColor||c.backgroundColor||d.backgroundColor),backgroundOpacity:b(D(f.backgroundOpacity,c.opacity,d.backgroundOpacity),Kh,1)}}function t(a,b,c,d,f){b=n(b,c,d,f);var g;p(b,function(b,c){c!==a[b]&&(g||(g=og(a)),g[b]=c)});return g||a}function u(a,
b,c,f,g,h,k,l){var p=a[Ib];c=d(a[Ib],b,c,g,oa);b=c.region;a=p.displayAlign;c=c.textAlign;g=p.origin;p=p.extent;b||a||c||g||p?((f=f[b])?f=og(f):a||g||p?(f=og(N),f.id=J++):f=og(K),q(f,h,a,c,g,p,k,l)):f=K;return f}function w(a){a=E(a);return h(a,0,100)?a:0}function v(a,b){var c=a[a.length-1];if("%"===c)return ya(.01*cc(a),0,1);if("c"===c)return ya(E(a)/b,0,1)}function A(a){for(var b=a.length,c=a[--b].endTime;b--;)c=ea(a[b].endTime,c);return c}function z(b){p(b,function(c,d){0<=c.toLowerCase().indexOf("color")&&
(b[c]=a(d))})}function C(a,b){var c=a.extent,d=a.pixelAspectRatio,f,g,h={yd:0,Og:1,wf:0,Ph:1};c&&(c=c.split(" "),2<=c.length&&(d=(d||"").split(" "),f=cc(c[0])*(cc(d[0])||1),g=cc(c[1])*(cc(d[1])||1)),f=0<f&&0<g?f/g:1280/720,d=b||1280/720,c=f/d,.01<lc(d-f)&&d>=f&&(h.yd=(1-c)/2,h.Og=c));return h}function H(a,b){var c;if(c=a.cellResolution)if(c=c.split(" "),2<=c.length){var d=E(c[0]);c=E(c[1]);if(0<d&&0<c)return{x:d,y:c}}c=a.extent;var f,g;if(c&&(c=c.split(" "),2<=c.length)){var d=E(c[0]),h=E(c[1]);if(c=
a.pixelAspectRatio)c=c.split(" "),f=E(c[0]),g=E(c[1]);if(d&&h)return 1.5<d*(f||1)/(h*(g||1))?yj:zj}return 1.5<b?yj:zj}var J=1,L={before:"top",center:"center",after:"bottom"},I={left:"left",start:"left",center:"center",right:"right",end:"right"},K={id:J++,verticalAlignment:"bottom",horizontalAlignment:"center",marginTop:.1,marginLeft:.1,marginRight:.1,marginBottom:.1},N={id:J++,verticalAlignment:"top",horizontalAlignment:"left",marginTop:0,marginLeft:0,marginRight:0,marginBottom:0},Q="fontFamily fontSize fontStyle textDecoration color opacity backgroundColor textOutline".split(" "),
V=Q.concat(["style","region"]),oa=["region","textAlign","displayAlign","extent","origin"],da=/^([0-9]+):([0-9]+):([0-9.]+)$/,O=/^br$/i,P=/^[0-9]{1,3}%$/,R=/^[0-9]/;return function(h,k,p,q,t){function w(){try{for(var a;je;)if(T=je[Ib],ia.push({id:J++,startTime:c(T.begin,K),endTime:c(T.end,K),region:u(je,fa,O,R,P,Q,ra,va),textNodes:f(je,ja,ka,ea,O,P,ga,Ja,la)}),je=je[xb],a=Re(),100<a-xa){xa=Ch.now();ha=Ka(w,1);return}}catch(b){y({g:M.zf,C:G(b)});return}ha=Ka(v,1)}function v(){try{var a=function(a,d){for(var f,
g=[],h={},k,p=c.length;p--;)f=c[p],k=f.region.id,h[k]||(h[k]=1,g.unshift(f));(f=b[b.length-1])&&f.endTime==a&&Qa(f.blocks,g)?f.endTime=d:b.push({id:J++,startTime:a,endTime:d,blocks:g})};if(!ia.length){y({c:!0,entries:[]});return}B(ia);var b=[],c=[],d=ia[0],f,g=ia[0].startTime,h,k;for(h=1;c.length||d;){for(;!c.length||d&&d.startTime==g;)c.push(d),g=d.startTime,d=ia[h++];f=A(c);if(!d||f<=d.startTime)for(a(g,f),g=f,k=c.length;k--;)c[k].endTime<=g&&c.splice(k,1);else a(g,d.startTime),g=d.startTime,c.push(d),
d=ia[h++]}for(h=b.length;h--;)b[h].index=h,b[h].previous=b[h-1],b[h].next=b[h+1]}catch(p){y({g:M.zf,C:G(p)});return}y({c:!0,entries:b})}function y(a){Ka(function(){L.abort=g;t(a)},1)}var L={abort:function(){ha&&bb(ha)}};try{var I=h[Ib],K=1E3/(E(I.tickRate)||1),Q=C(I,k),da=x(N,{marginLeft:Q.yd,marginTop:Q.wf,marginRight:Q.yd,marginBottom:Q.wf}),O={},P={},R={},T,Sb,ba,Pa=h.head,Y=h.body,ra=H(I,k),la=1/ra.y*Q.Ph,ga=x({characterStyle:"PROPORTIONAL_SANS_SERIF",characterColor:"#EBEB64",characterEdgeAttributes:Rg,
characterEdgeColor:"#000000",characterSize:1},p,{Ye:!0}),Ja=q||{},va={Sa:0};if(Pa){var X=Pa.styling;if(X)for(ba=X.style;ba;)T=ba[Ib],z(T),O[T.id]=T,ba=ba[xb];var Z=Pa.layout;if(Z)for(var Aa=Z.region;Aa;){T=Aa[Ib];var $h=T.id;Sb=F(O[T.style]);Sb=x(Sb,T);for(ba=Aa.style;ba;)x(Sb,ba[Ib]),ba=ba[xb];z(Sb);P[$h]=Sb;R[$h]=m(Sb,Q,da,ra,va);Aa=Aa[xb]}}var pa=Y.div,je=pa.p,ia=[],ea={},ea=d(Y[Ib],ea,O,P,V),ea=d(pa[Ib],ea,O,P,V),fa={},fa=d(Y[Ib],fa,O,P,oa),fa=d(pa[Ib],fa,O,P,oa),ja=n(ea,ga,Ja,la);x(ja,{windowColor:a(Ja.windowColor||
ga.windowColor),windowOpacity:b(D(Ja.windowOpacity,ga.windowOpacity),Kh,1),cellResolution:ra},{Ye:!0});var ka={};pa.p=l;pa[Xg]=[]}catch(sa){y({g:M.zf,C:G(sa)});return}var xa=Re(),ha;ha=Ka(w,1);return L}}(),Ll={"default":"PROPORTIONAL_SANS_SERIF",monospaceSansSerif:"MONOSPACED_SANS_SERIF",monospaceSerif:"MONOSPACED_SERIF",proportionalSansSerif:"PROPORTIONAL_SANS_SERIF",proportionalSerif:"PROPORTIONAL_SERIF",casual:"CASUAL",cursive:"CURSIVE",smallCapitals:"SMALL_CAPITALS",monospace:"MONOSPACED_SANS_SERIF",
sansSerif:"PROPORTIONAL_SANS_SERIF",serif:"PROPORTIONAL_SERIF"},Kl={SMALL:.5,MEDIUM:1,LARGE:2},Kh={NONE:0,SEMI_TRANSPARENT:.5,OPAQUE:1},Jl={black:"#000000",silver:"#c0c0c0",gray:"#808080",white:"#ffffff",maroon:"#800000",red:"#ff0000",purple:"#800080",fuchsia:"#ff00ff",magenta:"#ff00ff",green:"#00ff00",lime:"#00ff00",olive:"#808000",yellow:"#ffff00",navy:"#000080",blue:"#0000ff",teal:"#008080",aqua:"#00ffff",cyan:"#00ffff",orange:"#ffa500",pink:"#ffc0cb"},Ml="NONE",Zj="RAISED",ak="DEPRESSED",ci="UNIFORM",
Rg="DROP_SHADOW",zj={x:40,y:19},yj={x:52,y:19},Yj=10,Sg={"class":"player-timedtext-text-container"},Lh;Eb(O.Cl,function(a){function b(){Eh?Eh.requestQuota(g,c,d):Al.requestQuota(rj,g,c,d)}function c(d){d>=g?(Lh=d,a(fa)):h?(f.error("Quota request granted insufficent bytes"),a({g:M.xi})):(h=!0,b())}function d(){f.error("Request quota error");a({g:M.wi})}var f=new na.r("RequestQuota"),g=z.Ks,h;0<g?b():(Lh=0,a(fa))});var di;Eb(O.vl,function(a){var b=new na.r("FileSystem");"fs"!=z.Ok?a(fa):zl(rj,Lh,function(b){di=
b;a(fa)},function(){b.error("Error calling requestFileSystem");a({g:M.ti})})});var fi={},ei={create:!0},ck={create:!0,exclusive:!0},Wa;Eb(O.Dl,function(a){var b;switch(z.Ok){case "fs":b=xe;break;case "idb":b=Zd;break;case "none":b=Eg}b(function(b){b.c?(Wa=b.Gh,a(fa)):a(b)})});var Rd;Eb(O.El,function(a){function b(){b=g;var a=cb(c,z.kq);Xa.addListener(uc,function(b){b&&b.isPopStateEvent?d.trace("popstate event, Lock timers can stay"):(p(f,function(a,b){nc.removeItem(b.pc)}),gb(a))},-1)}function c(){var a=
sb();p(f,function(b,c){nc.setItem(c.pc,a)})}var d=new na.r("StorageLock"),f={};Rd={Bi:function(a,c){function g(){nc.setItem(p,k);var a={pc:p};f[p]=a;d.trace("Lock acquired",{Name:a.pc});c({c:!0,Re:a})}if(nc){b();var k=sb(),p="lock-"+a;try{if(p in nc){var l=E(nc.getItem(p)),q;h(l,0,void 0)&&(q=l);1E3*lc(k-q)<z.jq?c({c:!1}):(d.error("Lock was expired or invalid, ignoring",{Epoch:k,LockEpoch:q}),g())}else g()}catch(m){d.error("Error acquiring Lock",m),c({g:M.Nb,C:G(m)})}}else Dh?c({g:M.en,C:G(Dh)}):
c({g:M.fn})},Mr:function(a,b){if(nc){try{nc.removeItem(a.pc),delete f[a.pc],d.trace("Lock released",{Name:a.pc})}catch(c){d.error("Unable to release Lock",{Name:a.pc},c)}b&&b(fa)}}};z.Wo?Rd.Bi("session",function(b){Rd.Fk=b;a(fa)}):a(fa)});Eb(O.Fl,function(a){yd()?mc&&mc.generateKey&&mc.importKey&&mc.unwrapKey?"PSK"!=z.Wf&&"MGK"!=z.Wf||yl?(Nb("wcs"),Ha(mc.generateKey({name:"AES-CBC",length:128},!0,["encrypt","decrypt"])).then(function(){Nb("wcdone");a(fa)},function(b){b=""+b;var c;0<=b.indexOf("missing crypto.subtle")?
c=M.Mf:0<=b.indexOf("timeout waiting for iframe to load")&&(c=M.jn);a({g:c,C:b})})):a({g:M.hn}):a({g:M.Mf}):a(fa)});var z,Uf,jh;Eb(O.wl,function(a){var b=z.qq,c=-6/(b-2-2);if(h(b,1)){var d=[],f=ja(X()/1E3);cb(function(){var a=ja(X()/1E3);if(a!=f){for(var b=ea(a-f,30);b--;)d.push(0);(b=qa(d.length-31,0))&&d.splice(0,b);f=a}d[d.length-1]++},1E3/b);jh={tp:function(){for(var a=[],f=d.length-1;f--;){var g=d[f];a.unshift(0>=g?9:1>=g?8:g>=b-1?0:Ya((g-2)*c+7))}return a}}}a(fa)});var Jb,si=/^(SDK-|SLW32-|SLW64-|SLMAC-|.{10})([A-Z0-9-=]{4,})$/,
Vf;Eb(O.ai,function(a){function b(g){y(g)&&y(c)?(Jb=new Gg(g,c,d,f),Nb("devdone"),a(fa)):a({g:M.Uh})}var c=Fh,d,f,g=new na.r("Device");Nb("devs");Wa.load("deviceid",function(d){function h(){Wa.save("deviceid",k,!1,function(d){d.c?b(c+k):a(d)})}var k;d.c&&(k=d.data);y(k)?(f="storage",b(c+k)):d.g==M.uc?z.tg&&pf()?Ob(function(a){a.c?(k=a.content,f="downloaded from server"):(g.error("Error downloading esn",Va(a)),f="generated: error downloading",k=re());h()}):(f="generated: "+(z.tg?"netflix id not device bound":
"no config esnurl"),k=re(),h()):(d.c=l,a(d))})});var cd=function(){function b(){f.B(Nl);f.B(oe)}function c(){f.B(Mh);f.B(oe)}var d=new na.r("Http"),f=new lb,h=0;Eb(O.$d,function(a){z.jt&&(m.addEventListener("online",b),m.addEventListener("offline",c),fd=Ed);a(fa)});return{addEventListener:f.addListener,removeEventListener:f.removeListener,N:function(b,c,k){function p(){J&&(bb(J),J=null);J=Ka(k?u:t,H?F:D)}function q(){q=g;J&&(bb(J),J=null);f.removeListener(Mh,n);C&&(C.onreadystatechange=null,C.onprogress=
null,C.onerror=null,C.onload=null,C.onabort=null);E.c?(b.i&&(b.i.cq=X()),v.trace("Download success",x)):(b.i&&(b.i.$v=X()),E.g!=M.Za?v.warn("Download failed",x,Va(E)):v.trace("Download aborted",x));var a=y;y=l;for(var c=a.length;c--;)(function(){var b=a[c];Z(function(){b(E)})})();f.B(Ol,E,!0)}function m(a,b,c){E.c=!1;E.g=a;a=X();E.D.O=E.D.O||a;E.D.M=E.D.M||a;0<b&&(E.Ca=E.P=b);c&&(E.C=c);q()}function n(){fd()||(m(M.Vh),C.abort())}function t(){m(H?M.cd:M.Bf);C.abort()}function u(){E.c===l&&(k.jk++,
k.nr.ping(k))}function w(a){m(M.Za);try{!a&&C&&C.abort()}catch(b){}}var v=b.Ha&&b.Ha.log&&new b.Ha.log.r("Http")||d,x={Num:h++},y=[c],A={requestTime:X()},B,D=b.Pb||z.Pb,F=b.Kd||z.Kd,E=function(){var a=g,c=g;return{L:b,type:b.responseType,D:A,abort:w,timeout:t,Ci:function(a){q!==g&&y&&y.unshift(a)},kk:function(b){a(b)},dx:function(a){c(a)},wy:function(b){a=b},vy:function(a){c=a}}}();k&&(k.stream=b.stream,k.G=b.wa[0],k.Ns=p,k.nj=t);var C,H,J;f.B(Pl,E,!0);Z(function(){if(a(b.url))try{qf(b,E),B=E.url,
x.Url=B,fd()?(v.trace("Download starting",x),C=new ui,C.onreadystatechange=function(){if(2==C.readyState){H=!0;A.O=X();C.onreadystatechange=null;p();for(var a=E,c=C.getAllResponseHeaders().split("\n"),d=c.length,f,g,h={};d--;)if(f=c[d])g=f.indexOf(": "),1<=g&&g<f.length-1&&(h[f.substr(0,g)]=f.substr(g+2));a.headers=h;z.pa&&E.kk({timestamp:A.O,connect:!0,mediaRequest:b,start:A.requestTime,rt:[A.O-A.requestTime]})}},C.onprogress=function(a){H=!0;A.X=a.loaded;p();z.pa&&(a={mediaRequest:b,bytes:a.loaded,
tempstamp:X()},E.kk(a))},C.onload=function(){if(q!==g){var a;A.M=X();A.O=A.O||A.M;if(200<=C.status&&299>=C.status)if(a=Pb(C,E),b.Xb)try{E.content=b.Xb(a,E),E.c=!0,z.pa&&(E.parsed=!0,E.Ka=a)}catch(c){v.warn("Exception parsing response",c,x),m(M.Af,l,G(c))}else z.pa&&(E.parsed=!1),E.content=a,E.c=!0;else m(M.bd,C.status);q()}},C.onabort=w,C.onerror=function(){0<C.status?m(M.bd,C.status):m(M.Wh)},ye(C,B,!1,b),p(),f.addListener(Mh,n)):Z(m.bind(l,M.Vh))}catch(c){v.error("Exception starting download",c,
x),m(M.Xh)}else m(M.pl)});return E}}}(),fd=d,Pl=1,Ol=2,Nl=3,Mh=4,oe=5,Wg=1,ti=2,jc=3,Ib="$attributes",Xg="$children",Wf="$name",ob="$text",rk="$parent",xb="$sibling",qk=1,sk=3,tk=4,uk=9,Sd;Eb(O.xl,function(a){function b(f){g({esn:Jb.lc,esnPrefix:Jb.ij,authenticationType:z.Wf,authenticationKeyNames:z.Dn,systemKeyWrapFormat:z.Qs,serverIdentityId:"MSL_TRUSTED_NETWORK_SERVER_KEY",serverIdentityKeyData:A,storeState:f,notifyMilestone:Nb,log:q},{result:function(a){c(a)},timeout:function(){a({g:M.ii})},error:function(b){a(d(M.ii,
l,b))}})}function c(b){function f(){y&&Wa.save(t,p,!1,function(a){a.c||q.error("Error persisting msl store",Va(a))})}var g=new kb(100),p,l=h.extend({init:function(a){this.Ai=a},getResponse:function(a,b,c){b=this.Ai;var d=b.Jd.Ug||d;a=u(a.body)?mg(a.body):a.body;a={url:b.url,kh:a,withCredentials:!0,Cb:"nccp-"+b.We};b=this.Ai.timeout;a.Pb=b;a.Kd=b;var f=d.N(a,function(a){try{if(a.c)c.result({body:a.content});else throw x(new k("HTTP error, SubCode: "+a.g+(a.Ca?", HttpCode: "+a.Ca:"")),{cadmiumResponse:a});
}catch(b){c.error(b)}});return{abort:function(){f.abort()}}}});n&&b.addEventHandler("shouldpersist",function(a){p=a.storeState;g.lb(f)});Sd={send:function(a,c){var f=a.Jd,g=f.S,h=g&&De(g),k={nccpMethod:a.We,nonReplayable:a.ik,encrypted:a.hj,userId:a.$k,body:a.body,serviceTokens:a.pf,timeout:2*a.timeout,httpLocation:new l(a),allowTokenRefresh:y};f.fj?(k.email=f.fj,k.password=f.jr||""):f.ea?(k.netflixId=f.ea,k.secureNetflixId=f.Ya):f.Zj?(k.mdxControllerToken=f.Zj,k.mdxPin=f.Cq,k.mdxNonce=f.Bq,k.mdxEncryptedPinB64=
f.Aq,k.mdxSignature=f.Dq):v&&h&&h.Qj?(f=h.Pc(),k.netflixId=f.ea,k.secureNetflixId=f.Ya):h&&(k.getIdCookies=function(){var a=h.Pc();return{netflixId:a.ea,secureNetflixId:a.Ya}});b.send(k,{result:function(a){v&&k.netflixId&&(v=!1);c({c:!0,body:a.body,pf:a.serviceTokens})},timeout:function(){c({g:M.ji})},error:function(a){var f=b.isErrorReauth(a)?M.Df:b.isErrorHeader(a)?M.hi:M.gi,g=b.getErrorCode(a);c(d(f,g,a))}})},Pn:function(a,c){b.buildPlayDataRequest({nccpMethod:a.We,nonReplayable:a.ik,encrypted:a.hj,
userId:a.$k,body:a.body,serviceTokens:a.pf,timeout:a.timeout,allowTokenRefresh:!1},{result:function(a){c({c:!0,body:a})},timeout:function(){c({g:M.ji})},error:function(a){var f=b.isErrorReauth(a)?M.Df:b.isErrorHeader(a)?M.hi:M.gi,g=b.getErrorCode(a);c(d(f,g,a))}})},eh:b};a(fa)}function d(a,b,c){var f,g;a={g:a,Jc:b};if(c){if(f=c.cadmiumResponse)return f;f=c.errorMessage||""+c;if(g=c.stack)g=""+g,f=0<=g.indexOf(f)?g:f+g;g=E(c.internalCode)||E(c.error&&c.error.internalCode)}f&&(a.C=f);g&&(a.P=g);return a}
if(yd())if(ff&&mc&&mc.unwrapKey){try{var f=m.netflix.msl,g=f.createMslClient,h=f.IHttpLocation,k=f.MslIoException}catch(p){a({g:M.Pl});return}var q=new na.r("Msl"),f=z.Jq,n=z.Kq,t=z.xe?"mslstoretest":"mslstore",w=Rd.Fk,v=!0,y=!w||w.c,A=ic(z.xe?"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAm84o+RfF7KdJgbE6lggYAdUxOArfgCsGCq33+kwAK/Jmf3VnNo1NOGlRpLQUFAqYRqG29u4wl8fH0YCn0v8JNjrxPWP83Hf5Xdnh7dHHwHSMc0LxA2MyYlGzn3jOF5dG/3EUmUKPEjK/SKnxeKfNRKBWnm0K1rzCmMUpiZz1pxgEB/cIJow6FrDAt2Djt4L1u6sJ/FOy/zA1Hf4mZhytgabDfapxAzsks+HF9rMr3wXW5lSP6y2lM+gjjX/bjqMLJQ6iqDi6++7ScBh0oNHmgUxsSFE3aBRBaCL1kz0HOYJe26UqJqMLQ71SwvjgM+KnxZvKa1ZHzQ+7vFTwE7+yxwIDAQAB":
"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlibeiUhffUDs6QqZiB+jXH/MNgITf7OOcMzuSv4G3JysWkc0aPbT3vkCVaxdjNtw50zo2Si8I24z3/ggS3wZaF//lJ/jgA70siIL6J8kBt8zy3x+tup4Dc0QZH0k1oxzQxM90FB5x+UP0hORqQEUYZCGZ9RbZ/WNV70TAmFkjmckutWN9DtR6WUdAQWr0HxsxI9R05nz5qU2530AfQ95h+WGZqnRoG0W6xO1X05scyscNQg0PNCy3nfKBG+E6uIl5JB4dpc9cgSNgkfAIeuPURhpD0jHkJ/+4ytpdsXAGmwYmoJcCSE1TJyYYoExuoaE8gLFeM01xXK5VINU7/eWjQIDAQAB");f?Wa.remove(t,function(){b()}):n?Wa.load(t,function(c){c.c?b(c.data):c.g==M.uc?b():(q.error("Error loading msl store",
Va(c)),Wa.remove(t,function(c){c.c?b():a(c)}))}):b()}else a({g:M.Ql});else a(fa)});Eb(O.ul,function(a){var b=z.xe,c;c=b?"browsertest":"browser";b=new uf(c,b?"NetflixIdTest":"NetflixId",b?"SecureNetflixIdTest":"SecureNetflixId");Ue=Xf[c]=b;a(fa)});ce.prototype={Kc:!1,qh:!1,Pe:0,de:Ig,Jg:function(){return"acc-"+this.S},load:function(a){var b=this,c=b.S;Wa.load(b.Jg(),function(d){var f;d.c&&(f=d.data);f&&(b.Kc=!0,b.Pe=f.lastAccessTime||0,b.de=f.UILanguages||Ig,b.ea=f.netflixId,b.Ya=f.secureNetflixId,
b.Qn=f.cTicket,b.Rn=E(f.cTicketExpiration)||0,b.bq=f.keyPairHash,b.Xq=f.nrdpStorage,Sd&&(b.qh=!!Sd.eh.hasUserIdToken(c)));a(fa)})},save:function(){this.Kc=!0;Wa.save(this.Jg(),{lastAccessTime:this.Pe,UILanguages:this.de,netflixId:this.ea,secureNetflixId:this.Ya,cTicket:this.Qn,cTicketExpiration:this.Rn,keyPairHash:this.bq,nrdpStorage:this.Xq})},remove:function(a){var b=this,c=b.S;Wa.remove(b.Jg(),function(){var d=[];p(b,function(a){d.push(a)});for(var f=d.length;f--;)delete b[d[f]];b.S=c;Sd&&Sd.eh.removeUserIdToken(c);
a(fa)})},Pc:function(){return{ea:this.ea,Ya:this.Ya}},Ik:g,co:g};var Xf={},vi={},Ue,pb;Eb(O.zl,function(a){Wa.load("deviceparameters",function(b){function c(a,b,f,g){a=d[a];return h(a,f,g)?a:b}var d={};b.c&&(d=b.data);pb={wh:c("servertimeoffset",0,l,l),kf:c("retrycontrol",3,0,1E3),Ve:c("mintimeout",59,0,1E3),Zg:c("loginterval",60,0,1E3),ah:c("maxlogsize",2E6,100,1E9),Te:d.loglevel||"error",vh:!!d.sendheartbeats,zd:c("heartbeatinterval",60,1,1E3),gh:function(){dc.B(gf);Wa.save("deviceparameters",{servertimeoffset:pb.wh,
retrycontrol:pb.kf,mintimeout:pb.Ve,loginterval:pb.Zg,maxlogsize:pb.ah,loglevel:pb.Te,sendheartbeats:pb.vh,heartbeatinterval:pb.zd})}};a(fa)})});var yb;Eb(O.yl,function(a){var b=z.Ib;(new na.r("Nccp")).info("Creating NCCP instance",{Url:b.hc,Version:b.nh,Msl:yd()});yd()?(yb=new Ce(b,pb,Sd,Jb),a(fa)):a({g:M.hl})});var dc=new lb,xk="resume",yk="suspend",qd="interval",gf=1,bh=4,dd;Eb(O.Al,function(a){function b(){var a={browserua:ac,browserhref:He.href,browserdm:""+eb.documentMode,initstart:rg,initdelay:Jh-
rg};Le(a);var d=Od&&Od.timing;d&&z.nq.map(function(b){var c=d[b];c&&(a["pt_"+b]=c-bd)});var f=new gc(fg&&fg.Ha,"startup","info",a);c(f)}function c(a){q.push(a);Z(function(){dc.B(3,{mq:a});for(var b=q,c=b.length,f=c*n;c--;)f+=b[c].qj().length;f>pb.ah?d():k()})}function d(a,b){b=b||g;if(q.length||a){h();dc.B(bh);var c=q;q=[];yb.pq(c,{Ug:cd,log:new na.r("Nccp"),S:Ue.S},b)}else b(fa);k()}function f(){var a=pb.Zg;t!=a&&(t=a,h(),k())}function h(){m&&(bb(m),m=null)}function k(){m||(m=Ka(p,1E3*t))}function p(){h();
d()}var l=new na.r("NccpLogBatcher"),q=[],m,n,t;l.mg=!0;n=33+Jb.lc.length;dc.addListener(gf,f);f();gg(function(){Z(b)});dd={tk:c,flush:function(a,b){l.trace("Flushing");h();dc.B(2);Z(function(){d(a,b)})}};a(fa)});(function(){function a(b){p.push(b)}function b(){dc.removeListener(gf,b);dc.removeListener(2,c);na.removeSink(a);na.addSink(f);d()}function c(){g=z.Ib.ye?fb[z.Ib.ye]:h[pb.Te];d()}function d(){var a=p;p=[];for(var b=a.length,c=0;c<b;c++)f(a[c])}function f(a){if(!a.mg&&a.level<=g){var b={debugMessage:a.message,
debugCategory:a.category};x(b,a.fields,{prefix:"debug"});a=new gc(a.Ha,"debug",k[a.level],b);dd.tk(a)}}var g,h={fatal:fb.FATAL,error:fb.ERROR,warn:fb.WARN,info:fb.INFO,debug:fb.DEBUG},k={};k[fb.FATAL]="fatal";k[fb.ERROR]="error";k[fb.WARN]="warn";k[fb.INFO]="info";k[fb.TRACE]="debug";k[fb.DEBUG]="debug";var p=[];na.addSink(a);dc.addListener(gf,function(){g=z.Ib.ye?fb[z.Ib.ye]:h[pb.Te]});dc.addListener(gf,b);dc.addListener(2,c)})();var We="PRIMARY",xi={assistive:"ASSISTIVE",closedcaptions:"ASSISTIVE",
directorscommentary:"COMMENTARY",comentary:"COMMENTARY",subtitles:We,primary:We};gc.prototype.qj=function(){this.zi||(this.zi=ig(this.data));return this.zi};var Ub=1,Zf=2,zb=4,$f=8,Xe=16,$g=32,ah=64,ne,ch;Eb(O.Bl,function(a){var b=new na.r("PlayDataManager");z.nf&&z.Wc?Wa.load(z.Wc,function(c){if(c.c){var d=c.data,f;try{f=ab.parse(d)}catch(g){}}f?(ne=f,ed.length||Jd(l,function(a){a.c&&Kd()})):c.g!=M.uc&&(b.error("Unable to parse persisted playdata"),Kd());a(fa)}):a(fa)});var Fi="HistoricalBandwidth",
Hi="none",Bk="dayOfWeekTimeOfDay",Gi="timeofDay",bg;Cb.prototype={Eb:function(){},xa:function(){},Aa:function(){},Ub:function(){}};var Ii=[];zc(function(a){function b(a){if(a.lower&&a.height>A)return a.height>=h()}function c(){var b=a.A.value==Ic&&a.state.value==Sa;F?b||(gb(F),x=F=l,H&&(gb(J),J=l)):b&&(F=cb(d,1E3),H&&(J=cb(f,G)))}function d(){var b=a.ub.value,b=(b=b&&b.stream)&&b.height;if(0<b){var c=X(),f=a.ha.Oc();if(x&&2E3>c-x.time&&b==x.height){var g=f-x.Ho,h=n[b];h||(n[b]=h=[],b>A&&(v.push(b),
C(v)));0<g&&!(D<b)&&(D=b);h.push(g);h.length>y&&h.shift();(h=u[b])||(u[b]=h={});var k=h[g];h[g]=k?k+1:1}x={time:c,Ho:f,height:b};a.af.rs(n)}}function f(){Wa.save(Nh,{xid:a.qa,data:u})}function g(){a.addEventListener(ib,function(){f()});w=[];Wa.load(Aj,function(a){a.c&&(w=a.data);var b={};Wa.load(Nh,function(a){a.c&&(b=a.data);b&&b.data&&vb.keys(b.data).length&&(w.push(b),w.length>H&&w.shift(),Wa.save(Aj,w),Wa.save(Nh,{}))})})}function h(){!I&&z.ej&&z.ve&&a.ne<z.ej[L]&&(B=ea(B,z.ve),a.je.set({reason:"droppedFramesPreviousSession",
height:z.ve}));I=!0;if(D){var b=v.length,c,d,f;for(c=0;c<b;c++)if(d=v[c],d>=D&&d<B&&(f=n[d])&&jd(t,f)&&B!=d)return m.warn("Restricting resolution due to high number of dropped frames",{MaxHeight:d}),a.je.set({reason:"droppedFrames",height:d}),z.Mo?(a.R.ag(function(a){return a.gf.k.height>=d}),Z(a.n.Do)):Z(a.n.pe),z.ve=B=d;D=l}return B}function k(){var a={};u&&v.forEach(function(b){var c=u[b];if(c){var d=0,f=0;p(c,function(a,b){f+=E(a);d+=b});a[b]=f/d}});return a}function q(a){var b={};a.forEach(function(a){b[a]=
{}});u&&(C(a),v.forEach(function(c){var d=u[c];if(d){var f=0,g=0;p(d,function(a,b){f+=b});var h=vb.keys(d);C(h);for(var k=h.length-1,l=h[k],q=a.length-1;0<=q;q--){for(var m=a[q];l>=m&&0<=k;)(l=d[l])&&(g+=l),l=h[--k];b[m][c]=Ya(g/f*100)}}}));return b}var m=new a.log.r("DFF"),n={},t=z.Lo,u={},w=[],v=[],x,y=z.Jo,A=z.Ko,B=1E5,D,F,H=z.Po,G=z.Oo,J,L=Gb.hardwareConcurrency||0,I;if(z.Io)return H&&a.addEventListener(Yf,g),a.sd={kp:k,xp:q},a.state.addListener(c),a.A.addListener(c),{wg:"df",sc:b}});var Aj="DroppedFramesHistory",
Nh="DroppedFramesSession";zc(function(a){return{wg:"op",sc:function(b){if(b=b.Xg){var c=a.ha;if(c&&c.Dg())return b}}}});sj&&zc(Bc);var dh=12.8,eh=5120,Ek=1,Fk=2E3,Dk=.8,Ck=10,Ji=1024;Yc.prototype={Eb:function(){return this.W.value.oa},xa:function(){return this.bc.value.oa},Aa:function(){var a=this;return a.xa().filter(function(b){return!a.Ue.sc(b)})},Ub:function(){var a=this.Tc;return a?X()-a:0}};var Gk=0,ed=[],Li=[],Mi=[],ih=1,hg=3,fg,eg=1E4*sb()+ja(1E4*Qe()),Bi=eg,af=1,ib=2,Ze=3,cj=4,Pd=5,Hc=6,
Yf=7,yi=8,dg=9,wk=10,ej=11,gh=12,Ki=13,fj=14,zi=15,Te=21,ke=22,Qd=30,Ni=31,ag=41,fh=51,sh=52,rh=53,mh="network",bl="media",th=1,Ci=2,Di=3,$e=0,Kb=1,Sa=2,hh=3,cg=4,Wb=1,Lb=2,Vb=3,Ab=1,Ic=2,Ye=3,tc=4,Hk="playback";ld(ih,function(a){function b(c){if(c.newValue>=Kb){a.state.removeListener(b);var d;try{var g=""+sb();nc.setItem("player$test",g);var h=nc.getItem("player$test");nc.removeItem("player$test");d=g==h?"success":"mism"}catch(k){d="ex: "+k}c="type=openplay&sev=info&locstor="+pg(d)+"&browserdm=";
var p;try{p=""+eb.documentMode}catch(q){p="ex: "+q}l(c+pg(p));t=X();f()}}function c(){k("type=startplay&sev=info&outcome=success")}function d(){var b=a.Da;if(b){var c="type=startplay&sev=error&outcome=error",f={};Ke(f,b);p(f,function(a,b){c+="&"+pg(a)+"="+pg(b||"")});k(c)}else k("type=startplay&sev=info&outcome=abort")}function f(){var a=u.shift();if(0<a){var b=qa(a-(X()-t),0);n=Ka(function(){l("type=startstall&sev=info&kt="+a);f()},b)}}function h(){k("type=startplay&sev=info&outcome=unload")}function k(b){k=
g;b+="&initstart="+rg+"&initend="+Jh;l(b);bb(n);a.removeEventListener(Hc,c);a.removeEventListener(ib,d);Xa.removeListener(uc,h)}function l(b){b=w+"&jsoffms="+X()+"&soffms="+a.Ub()+"&do="+Gb.onLine+"&"+b+"&"+K(x({},ai,{prefix:"im_"}))+"&"+K(x({},a.dh,{prefix:"sm_"}));q.N({url:m,kh:b,withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},Cb:"track"},g)}var q=a.ua,m=z.Xs,n,t,u=z.Ws.slice(),w;if(z.Vs&&m){w="cat=cadplayback&dev="+Md(Zg)+"&ep="+Md(Fh)+"&ver="+Md("2.0000.308.011")+
"&jssid="+me+"&xid="+a.qa+"&pbi="+a.index+"&groupName="+Md(z.Fe);if(Dc){var v=x({},Dc,{prefix:"pi_"});w+="&"+K(v)}a.state.addListener(b);a.addEventListener(Hc,c);a.addEventListener(ib,d);Xa.addListener(uc,h,-1)}});var hb="audio",Ra="video",Yg="timedtext",wi="trickplay",Ik=2292,Jk=.006,le={gc:function(a,b){var c=this;b&&(c=c.filter(Ac));return c.reduce(function(b,c){return b&&lc(b.f-a)<lc(c.f-a)?b:c})},ba:function(a,b){var c=this;b&&(c=c.filter(Ac));return c.reduce(function(b,c){return c.f>a&&c.f<
b.f?c:b},c[c.length-1])},ca:function(a,b){var c=this;b&&(c=c.filter(Ac));return c.reduce(function(b,c){return c.f<a&&c.f>b.f?c:b},c[0])},Ud:function(a){var b=this.map(function(a){return a.f});ad.isArray(a)&&(b=Ia(b,a));return b}},Jc=1,nh=2,bf=4,Oi=8,Kk=nh|bf,Lk=0,Mk=1,Nk=1E6,lh=1,Qi=2,Pi=3;ld(ih,function(a){function b(c){(c=c.L)&&4E3<c.length&&(a.removeEventListener(Te,b),Z(function(){for(var b=2E3,c=Od.now(),d=c,f=[],g=0;g<b;g++){for(var h=10;h--;)a.Rs=Ba.atan2(h,h);h=Od.now();f.push(h-d);d=h}c=
d-c;h=c/b;d=[];for(g=0;g<f.length;g++)f[g]>5*h&&d.push(g);g=d.reduce(function(a,b){return a+f[b]},0);b-=d.length;a.ne=Ba.round(b/(c-g))}))}a.addEventListener(Te,b)});var Ok=200,Pk=1,Ui=2,Ri=1,Si=1,jg=2,oh=1,Qk=1,Ti=1,Vi,cf,kg,bj=sd&&ef&&df&&ef.prototype.play,Xk=bj&&(ef.prototype.webkitGenerateKeyRequest||vc),gk=!0,fk=sd&&sd.isTypeSupported&&sd.isTypeSupported('audio/mp4; codecs="mp4a.a6"'),Wk=0,Vk=1,Zi=2,Uk=3,Tk=4,Sk=5,Yi=1,Xi=2,Wi=3,$i=4,aj=5,Rk={clearkey:function(a,b){return ia(b)},fps:function(a,
b){var d;b.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.rd&&(d=a.data)});if(!d)throw new La("no-netflix-pssh");var f="skd://netflix/"+c(d);return $c(f)}},ph=50,al=1E3,el=0,dj=1,cl=2,uh=3,hl=0,fl="showsubtitle",gl="removesubtitle";ld(hg,function(a){function b(d){if(d.ctrlKey&&d.altKey&&d.shiftKey&&84==d.keyCode){var f=Y("INPUT",l,l,{type:"file"});f.addEventListener("change",function(){var b=f.files[0];if(b){var d=b.name;c.info("Loading file",{FileName:d});
var g=new gi;g.readAsText(b);g.addEventListener("load",function(){var b=a.ac;Cd(g.result,b.width/b.height,z.Uk,z.Vk,function(b){b.c?(b=b=a.Zb.Rf(b.entries,d),a.$.set(b)):c.error("Inavlid custom DFXP")})})}});f.click()}}var c=new a.log.r("TimedTextCustomTrack");if(z.gg){c.info("Loading url",{Url:z.gg});var d=a.Zb.Rf(z.gg,"custom");a.$.set(d)}Xa.addListener(rd,b);a.addEventListener(ib,function(){Xa.removeListener(rd,b)})});var hj=0,xh=1,wh=2,il=3,gj=4;ld(hg,function(a){z.So&&(a.Py=new Hj(a))});ld(hg,
function(a){z.Sd&&(a.rc=new Vh(a))});var Ei=1,yh=1,jj=2,lg=3,zh=4,kj=[137,66,73,70,13,10,26,10],jl=0,lj=44,ml="loadedtracks",qj="loadedmetadata",pl="loaded",wl="error",xl="closed",mj="currenttimechanged",nj="bufferedtimechanged",tl="durationchanged",ul="videosizechanged",Bh="pausedchanged",Ah="endedchanged",ql="busychanged",vl="audiotracklistchanged",rl="audiotrackchanged",pj="timedtexttracklistchanged",oj="timedtexttrackchanged",sl="trickplayframeschanged",nl="mutedchanged",ol="volumechanged",kl=
"showsubtitle",ll="removesubtitle",Oh={};Eb(O.$d,function(a){function b(a,d){return{encrypt:function(b,d){var f=w(b)?$c(b):b,g=ff.getRandomValues(new Na(16));Ha(mc.encrypt({name:"AES-CBC",iv:g},a,f)).then(function(a){a=new Na(a);var b=[],f=new Gc(b);f.Th(2);f.fl(g);f.fl(a);a=c(b);d({success:!0,encryptedDataAsn1Base64:a})},function(){d({success:!1})})},decrypt:function(b,c){var d=Dd(b);Ha(mc.decrypt({name:"AES-CBC",iv:d.aq},a,d.Uo)).then(function(a){a=new Na(a);c({success:!0,text:mg(a)})},function(){c({success:!1})})},
hmac:function(a,b){var f=w(a)?$c(a):a;Ha(mc.sign({name:"HMAC",hash:{name:"SHA-256"}},d,f)).then(function(a){a=new Na(a);b({success:!0,hmacBase64:c(a)})},function(){b({success:!1})})}}}Oh.mdx={getEsn:function(){return Jb.lc},getServerEpoch:function(){return yb.wd()},createCryptoContext:function(a){var b=Sd.eh.getStateForMdx(Ue.S),d=b.cryptoContext,f=b.masterToken,b=b.userIdToken;f&&b?(f=["1",c(ab.stringify(f.toJSON())),c(ab.stringify(b.toJSON()))].join(),a({success:!0,cryptoContext:{cTicket:f,encrypt:function(a,
b){var f=w(a)?$c(a):a;d.encrypt(f,{result:function(a){a=c(a);b({success:!0,mslEncryptionEnvelopeBase64:a})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},decrypt:function(a,b){var c=ic(a);d.decrypt(c,{result:function(a){b({success:!0,text:mg(a)})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},hmac:function(a,b){var f=w(a)?$c(a):a;d.sign(f,{result:function(a){b({success:!0,hmacBase64:c(a)})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})}}})):
a({success:!1})},createCryptoContextFromSharedSecret:function(a,c){var d=ic(a),f=d.subarray(32,48),d=d.subarray(0,32);if(16!=f.length||32!=d.length)throw new La("Bad shared secret");Nd.all([Ha(mc.importKey("raw",f,{name:"AES-CBC"},!1,["encrypt","decrypt"])),Ha(mc.importKey("raw",d,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]))]).then(function(a){c({success:!0,cryptoContext:b(a[0],a[1])})},function(){c({success:!1})})}};a(fa)});m.netflix=m.netflix||{};m.netflix.player={VideoSession:function(){var a=
this;Fg(arguments);a.createPlayer=function(a,b){var c;b&&(c=k(b)?{za:b.trackingId,Zc:b.sessionParams,ge:b.authParams}:{za:b});c=new Ij(b.accountKey,a,c);var d=b.clipStart,f=b.clipDuration;return 0<d||0<f?Lj(c,d,f):c};a.closeAllPlayers=function(a){Cc(function(){a&&a()})};a.init=function(b){gg(function(c){c.c?(x(a,Oh),b&&b(x({success:!0},Oh))):b&&(c=(new mb(c.errorCode||O.$d,c,void 0)).Lh(),b({success:!1,error:c}))})};a.applyConfig=function(a){Uf(a)}},diag:{togglePanel:function(a,b){var c;switch(a){case "info":c=
ed.map(function(a){return a.af});break;case "streams":c=ed.map(function(a){return a.nk});break;case "log":c=[ij]}c&&c.forEach(function(a){t(b)?b?a.show():a.Rg():a.toggle()})},addNccpLogMessageSink:function(a){dc.addListener(3,function(b){a({data:b.mq.data})})}},log:new na.r("Ext"),LogLevel:fb,addLogSink:function(a){pe.push(a)}}})(window)},{10:10,3:3,4:4,5:5,7:7}],2:[function(n,m){function l(){this.q=this.q||{};this.dd=this.dd||void 0}function c(c){return"function"===typeof c}function d(c){return"object"===
typeof c&&null!==c}m.Ta=l;l.EventEmitter=l;l.prototype.q=void 0;l.prototype.dd=void 0;l.wo=10;l.prototype.setMaxListeners=function(c){if("number"!==typeof c||0>c||isNaN(c))throw TypeError("n must be a positive number");this.dd=c;return this};l.prototype.emit=function(f){var g,l,k,m;this.q||(this.q={});if("error"===f&&(!this.q.error||d(this.q.error)&&!this.q.error.length)){g=arguments[1];if(g instanceof Error)throw g;throw TypeError('Uncaught, unspecified "error" event.');}l=this.q[f];if(void 0===
l)return!1;if(c(l))switch(arguments.length){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:g=arguments.length;k=Array(g-1);for(m=1;m<g;m++)k[m-1]=arguments[m];l.apply(this,k)}else if(d(l)){g=arguments.length;k=Array(g-1);for(m=1;m<g;m++)k[m-1]=arguments[m];l=l.slice();g=l.length;for(m=0;m<g;m++)l[m].apply(this,k)}return!0};l.prototype.addListener=function(f,g){var m;if(!c(g))throw TypeError("listener must be a function");
this.q||(this.q={});this.q.Zw&&this.emit("newListener",f,c(g.Sc)?g.Sc:g);this.q[f]?d(this.q[f])?this.q[f].push(g):this.q[f]=[this.q[f],g]:this.q[f]=g;d(this.q[f])&&!this.q[f].st&&(m=void 0===this.dd?l.wo:this.dd)&&0<m&&this.q[f].length>m&&(this.q[f].st=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this.q[f].length),"function"===typeof console.trace&&console.trace());return this};l.prototype.on=l.prototype.addListener;
l.prototype.once=function(d,g){function l(){this.removeListener(d,l);k||(k=!0,g.apply(this,arguments))}if(!c(g))throw TypeError("listener must be a function");var k=!1;l.Sc=g;this.on(d,l);return this};l.prototype.removeListener=function(f,g){var l,k,m;if(!c(g))throw TypeError("listener must be a function");if(!this.q||!this.q[f])return this;l=this.q[f];m=l.length;k=-1;if(l===g||c(l.Sc)&&l.Sc===g)delete this.q[f],this.q.removeListener&&this.emit("removeListener",f,g);else if(d(l)){for(;0<m--;)if(l[m]===
g||l[m].Sc&&l[m].Sc===g){k=m;break}if(0>k)return this;1===l.length?(l.length=0,delete this.q[f]):l.splice(k,1);this.q.removeListener&&this.emit("removeListener",f,g)}return this};l.prototype.removeAllListeners=function(d){var g;if(!this.q)return this;if(!this.q.removeListener)return 0===arguments.length?this.q={}:this.q[d]&&delete this.q[d],this;if(0===arguments.length){for(g in this.q)"removeListener"!==g&&this.removeAllListeners(g);this.removeAllListeners("removeListener");this.q={};return this}g=
this.q[d];if(c(g))this.removeListener(d,g);else for(;g.length;)this.removeListener(d,g[g.length-1]);delete this.q[d];return this};l.prototype.listeners=function(d){return this.q&&this.q[d]?c(this.q[d])?[this.q[d]]:this.q[d].slice():[]};l.listenerCount=function(d,g){return d.q&&d.q[g]?c(d.q[g])?1:d.q[g].length:0}},{}],3:[function(n,m){function l(b,a,c){for(var d="",f=0,g=b.length,k=g-2,l;f<k;){l=(b[f++]<<16)+(b[f++]<<8)+b[f++];if(!(0<=l&&16777215>=l))throw Error("not bytes");d+=a[l>>>18]+a[l>>>12&
63]+a[l>>>6&63]+a[l&63]}if(f==k){l=(b[f++]<<8)+b[f++];if(!(0<=l&&65535>=l))throw Error("not bytes");d+=a[l>>>10]+a[l>>>4&63]+a[l<<2&63]+c}else if(f==g-1){l=b[f++];if(!(0<=l&&255>=l))throw Error("not bytes");d+=a[l>>>2]+a[l<<4&63]+c+c}return d}var c=Array.prototype.slice,d=c.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),f=c.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),g={},t={},k={},u={},b=/\s+/g;[d,f].forEach(function(b){for(var a=b.length,c;a--;)c=
b[a],g[c]=a<<18,t[c]=a<<12,k[c]=a<<6,u[c]=a});m.Ta={qg:function(b){return l(b,d,"=")},sv:function(b){return l(b,f,"")},hg:function(c){c=c.replace(b,"");var a=c.length,d;d=c.charAt(a-1);"="!==d&&"."!==d||a--;d=c.charAt(a-1);"="!==d&&"."!==d||a--;d=3*(a>>2);var f=0;switch(a%4){case 2:f=1;break;case 3:f=2;break;case 1:throw Error("bad base64");}for(var a=new Uint8Array(d+f),l=0,p=0,m;p<d;){m=g[c[l++]]+t[c[l++]]+k[c[l++]]+u[c[l++]];if(!(0<=m&&16777215>=m))throw Error("bad base64");a[p++]=m>>>16;a[p++]=
m>>>8&255;a[p++]=m&255}if(0<f&&(m=g[c[l++]]+t[c[l++]],a[p++]=m>>>16,1<f&&(m+=k[c[l++]],a[p++]=m>>>8&255),!(0<=m&&16776960>=m&&0===(m&(1<f?255:65535)))))throw Error("bad base64");return a}}},{}],4:[function(n,m){function l(c){this.buffer=c;this.position=0}l.prototype={seek:function(c){this.position=c},skip:function(c){this.position+=c},Ea:function(){return this.buffer.length-this.position},Z:function(){return this.buffer[this.position++]},ia:function(c){var d=this.position;this.position+=c;c=this.buffer;
return c.subarray?c.subarray(d,this.position):c.slice(d,this.position)},H:function(c){for(var d=0;c--;)d=256*d+this.buffer[this.position++];return d},Lb:function(c){for(var d="";c--;)d+=String.fromCharCode(this.buffer[this.position++]);return d},Hr:function(){for(var c="",d;d=this.Z();)c+=String.fromCharCode(d);return c},K:function(){return this.H(2)},l:function(){return this.H(4)},ja:function(){return this.H(8)},vk:function(){return this.H(2)/256},ph:function(){return this.H(4)/65536},Qd:function(c){for(var d,
f="";c--;)d=this.Z(),f+="0123456789ABCDEF"[d>>>4]+"0123456789ABCDEF"[d&15];return f},ff:function(){return this.Qd(4)+"-"+this.Qd(2)+"-"+this.Qd(2)+"-"+this.Qd(2)+"-"+this.Qd(6)},Ir:function(c){for(var d=0,f=0;f<c;f++)d+=this.Z()<<(f<<3);return d},Rd:function(){return this.Ir(4)},Th:function(c){this.buffer[this.position++]=c},gl:function(c,d){this.position+=d;for(var f=1;f<=d;f++)this.buffer[this.position-f]=c&255,c=Math.floor(c/256)},vt:function(c){for(var d=c.length,f=0;f<d;f++)this.buffer[this.position++]=
c[f]},Zd:function(c,d){this.vt(c.ia(d))}};m.Ta=l},{}],5:[function(n,m){function l(a,b,c){this.type=a;this.size=b;this.X=c}function c(b){var c;a:{c=b.position;var d,f;if(8<=b.Ea()){d=b.l();f=b.Lb(4);if(!w.test(f))throw b.seek(c),Error("mp4-badtype");if(1==d){if(8>b.Ea()){b.seek(c);c=void 0;break a}d=b.ja()}if(!(8<=d))throw b.seek(c),Error("mp4-badsize");if("uuid"==f){if(16>b.Ea()){b.seek(c);c=void 0;break a}f=b.ff()}c={type:f,offset:c,size:d,X:c+d-b.position}}else c=void 0}if(c&&c.X<=b.Ea()){var g=
c.type;d=c.size;var h=c.X;f=new l(g,d,h);g=y[g];if(b.Ea()<h)throw Error("mp4-shortcontent");g?(h=new a(b.ia(h)),g(f,h)):b.skip(h);b.seek(c.offset);f.Ka=b.ia(d);return f}}function d(a,b){for(var d=[],f={},g,h;0<b.Ea();){g=c(b);if(!g)throw Error("mp4-badchildren");h=g.type;d.push(g);f[h]||(f[h]=g)}a.children=d;a.xg=f}function f(a,b){a.version=b.H(1);a.mc=b.H(3)}function g(a,b){b.skip(6);a.vo=b.K();b.skip(8);a.Nu=b.K();a.lf=b.K();b.skip(4);a.qy=b.K();b.skip(2);d(a,b)}function t(a,b){b.skip(6);a.vo=b.K();
b.skip(16);a.width=b.K();a.height=b.K();a.Tv=b.l();a.Ry=b.l();b.skip(4);a.Fv=b.K();var c=b.Z();a.Qu=b.Lb(c);b.skip(31-c);a.depth=b.K();b.skip(2);d(a,b)}function k(a,b){f(a,b);a.Xu=b.H(3);a.av=b.Z();a.Uj=b.ia(16)}function u(a,b){for(var c=[],d;b--;)d=a.K(),c.push(a.ia(d));return c}function b(a){var b=a.ia(2);a={py:b[1]>>1&7,zk:!!(b[1]&1),jy:a.K()};h(a,(b[0]<<8|b[1])>>4);return a}function h(a,b){a.ky=b>>4&3;a.oy=b>>2&3;a.my=b&3;return a}var a=n(4),w=/^[a-zA-Z0-9-]{4,4}$/;l.prototype.rb=function(a){var b=
this;a=a.split("/");var c,d,f,g;for(f=0;f<a.length&&b;f++){d=a[f].split("|");c=void 0;for(g=0;g<d.length&&!c;g++)c=d[g],c=b.xg&&b.xg[c];b=c}return b};l.prototype.toString=function(){return"["+this.type+"]"};var y={ftyp:function(a,b){a.tw=b.Lb(4);a.Tw=b.l();for(a.Ti=[];4<=b.Ea();)a.Ti.push(b.Lb(4))},moov:d,sidx:function(a,b){f(a,b);a.Zx=b.l();a.sf=b.l();a.kv=1<=a.version?b.ja():b.l();a.ap=1<=a.version?b.ja():b.l();b.skip(2);for(var c=b.K(),d=[],g,h;c--;){g=b.l();h=g>>31;if(0!==h)throw Error("mp4-badsdix");
g&=2147483647;h=b.l();b.skip(4);d.push({size:g,duration:h})}a.Lr=d},moof:d,mvhd:function(a,b){f(a,b);var c=1<=a.version?8:4;a.fg=b.H(c);a.modificationTime=b.H(c);a.sf=b.l();a.duration=b.H(c);a.Xx=b.ph();a.volume=b.vk();b.skip(70);a.$w=b.l()},pssh:function(a,b){f(a,b);a.rd=b.ff();var c=b.l();a.data=b.ia(c)},trak:d,mdia:d,minf:d,stbl:d,stsd:function(a,b){f(a,b);b.l();d(a,b)},encv:t,avc1:t,mp4a:g,enca:g,"ec-3":g,avcC:function(a,b){a.version=b.Z();a.Gu=b.Z();a.Vx=b.Z();a.Fu=b.Z();a.ew=(b.Z()&3)+1;a.uy=
u(b,b.Z()&31);a.Rx=u(b,b.Z())},pasp:function(a,b){a.Ge=b.l();a.xf=b.l()},sinf:d,frma:function(a,b){a.Vu=b.Lb(4)},schm:function(a,b){f(a,b);a.as=b.Lb(4);a.sy=b.l();a.mc&1&&(a.ry=b.Hr())},schi:d,tenc:k,mvex:d,trex:function(a,c){f(a,c);a.ka=c.l();a.bv=c.l();a.xo=c.l();a.yo=c.l();a.kg=b(c)},traf:d,tfhd:function(a,c){f(a,c);a.ka=c.l();var d=a.mc;d&1&&(a.Ju=c.ja());d&2&&(a.ly=c.l());d&8&&(a.xo=c.l());d&16&&(a.yo=c.l());d&32&&(a.kg=b(c))},saio:function(a,b){f(a,b);a.mc&1&&(a.Hn=b.l(),a.In=b.l());for(var c=
1<=a.version?8:4,d=b.l(),g=[];d--;)g.push(b.H(c));a.Yr=g},mdat:function(a,b){a.data=b.ia(b.Ea())},tkhd:function(a,b){f(a,b);var c=1<=a.version?8:4;a.fg=b.H(c);a.modificationTime=b.H(c);a.ka=b.l();b.skip(4);a.duration=b.H(c);b.skip(8);a.aw=b.K();a.Cu=b.K();a.volume=b.vk();b.skip(2);b.skip(36);a.width=b.ph();a.height=b.ph()},mdhd:function(a,b){f(a,b);var c=1<=a.version?8:4;a.fg=b.H(c);a.modificationTime=b.H(c);a.sf=b.l();a.duration=b.H(c);c=b.K();a.language=String.fromCharCode((c>>10&31)+96)+String.fromCharCode((c>>
5&31)+96)+String.fromCharCode((c&31)+96);b.skip(2)},mfhd:function(a,b){f(a,b);a.ty=b.l()},tfdt:function(a,b){f(a,b);a.Ku=b.H(1<=a.version?8:4);8==b.Ea()&&b.skip(8)},saiz:function(a,b){f(a,b);a.mc&1&&(a.Hn=b.l(),a.In=b.l());for(var c=b.Z(),d=b.l(),g=[];d--;)g.push(c||b.Z());a.ny=g},trun:function(a,c){f(a,c);var d=c.l(),g=a.mc;g&1&&(a.Wu=c.l());g&4&&(a.Cv=b(c));for(var h=[],k;d--;)k={},g&256&&(k.duration=c.l()),g&512&&(k.size=c.l()),g&1024&&(k.mc=c.l()),g&2048&&(k.Pu=c.l()),h.push(k);a.Zr=h},sdtp:function(a,
b){f(a,b);for(var c=[];0<b.Ea();)c.push(h({},b.Z()));a.Zr=c},"4E657466-6C69-7850-6966-665374726D21":function(a,b){f(a,b);a.fileSize=b.ja();a.sf=b.ja();a.duration=b.ja();a.cx=b.ja();a.Ay=b.ja();1<=a.version&&(a.Vw=b.ja(),a.Ww=b.l(),a.cr=b.ja(),a.bp=b.l(),a.Av=b.ff())},"A2394F52-5A9B-4F14-A244-6C427C648DF4":function(a,b){f(a,b);a.mc&1&&(a.Bu=b.H(3),a.Yv=b.Z(),a.Zv=b.ff());a.iy=b.l();a.Gn=b.ia(b.Ea())},"4E657466-6C69-7846-7261-6D6552617465":function(a,b){f(a,b);a.$q=b.l();a.Ao=b.K()},"8974DBCE-7BE7-4C51-84F9-7148F9882554":k};
m.Ta={Yx:function(b,d){var f=new a(b);d&&f.seek(d);return c(f)},Gr:function(b,d){if(!b)throw Error("mp4-badinput");var f=new a(b),g=[],h;for(d&&f.seek(d);h=c(f);)g.push(h);return g}}},{4:4}],6:[function(n,m){function l(a){y.call(this);this.jd=a.url;this.ed=a.L;this.op=k;this.Of=a.ef||0;this.mn=this.fd=this.xc=null;this.ee={};this.Nf={};this.ed({url:this.jd,offset:a.offset,size:a.size},d.bind(this))}function c(a){if(!a)throw Error("Assertion Failed");}function d(a,b){if(a)this.emit(p.ERROR,w(a,x.Ll));
else try{var c=new q(b),d=g(c);this.xc=d;var h=d.startOffset,k=d.entries.reduce(function(a,b){return a+b.size},0);if(k){var l={url:this.jd,offset:h,size:k};this.emit(p.Nl,this.xc);this.ed(l,f.bind(this))}else this.emit(p.ERROR,w({},x.dm))}catch(m){this.emit(p.ERROR,w(m,x.Ml))}}function f(a,b){var d=this;if(a)d.emit(p.ERROR,w(a,x.Wm));else{var f=new q(b),g=0,k=[],l=[],m=0;try{d.xc.entries.forEach(function(a){var b={},d=0;f.position=g;b.identifier=f.Lb(4);c("sidx"===b.identifier);b.Kp=f.ia(36);b.duration=
f.H(4);b.Sa=f.K();b.entries=[];for(b.Vb=[];d<b.Sa;){var h={};h.Qb=f.H(4);h.duration=f.H(4);h.fr=f.K();h.gr=f.K();h.xs=f.K();h.ys=f.K();h.oc=f.ja();h.Lj=f.H(4);d++;b.entries.push(h)}k.push(b);a.Kk=b;d=b.entries;d.length&&(b.startTime=d[0].Qb,b.endTime=d[d.length-1].Qb+d[d.length-1].duration);l.push.apply(l,b.entries);g+=a.size;m++})}catch(n){d.emit(p.ERROR,w(n,x.Xm));return}d.fd=k;d.mn=l;d.emit(p.Ym,this.fd);var u=t.call(d,d.Of);u.length?h.call(d,u,function(){d.emit(p.qi)}):d.emit(p.qi)}}function g(a){var b=
{};a.position=0;b.identifier=a.Lb(4);c("midx"===b.identifier);b.version=a.H(4);c(0===b.version);b.Kp=a.ia(36);b.fg=a.ja();b.Ox=a.ja();b.ma=a.ja();b.Wr=a.K();b.Xr=a.K();b.language=a.ia(16);b.Gy=a.ia(16);b.startOffset=a.ja();b.Sa=a.K();for(var d=[],f=0;f<b.Sa;f++){var g={};g.duration=a.H(4);g.size=a.K();d.push(g)}b.entries=d;return b}function t(b){var d=[],f;c(a(b));var g=this.ee,h=g.qf,k=g.index,l;h&&(0===k&&b<=h.startTime?(l=!0,f=g):b>=h.startTime&&b<=h.endTime?(l=!0,f=g):(g=this.fd[k+1])&&b>=h.endTime&&
b<=g.endTime&&(l=!0,f={qf:g,index:k+1}));if(!l)for(h=this.xc.entries,k=h.length,l=0;l<k;l++)if(g=h[l].Kk,b<=g.startTime||b>g.startTime&&b<=g.endTime){f={qf:h[l].Kk,index:l};break}f&&(this.ee=f);if(!f)return d;b=f.qf;f=this.fd[f.index+1];b.Vb.length||d.push(b);f&&!f.Vb.length&&d.push(f);return d}function k(b){var c=t.call(this,b);c.length&&h.call(this,c);var d=this.ee.qf,f=this.ee.index,c=[],f=a(f)&&this.fd[f+1];d&&d.Vb.length&&(c=u(d,b,[],this.xc));f&&f.Vb.length&&(b=u(f,b,c,this.xc),c.push.apply(c,
b));return c}function u(a,c,d,f){var g=a.entries,h=g.length,k=[],l,p=0;if(!g.length)return k;for(;p<h;){l=g[p];if(l.Qb<=c)l.Qb+l.duration>=c&&k.push(b(l,a.Vb[p],f));else{var m=k.length&&k[k.length-1]||d.length&&d[d.length-1];if(m&&m.Qb>c&&m.Qb!==l.Qb)break;m.oc!==l.oc&&k.push(b(l,a.Vb[p],f))}p++}return k}function b(a,b,c){var d={};d.displayTime=a.Qb;d.duration=a.duration;d.originX=a.fr;d.originY=a.gr;d.sizeX=a.xs;d.sizeY=a.ys;d.imageData=b;d.id=a.oc;d.rootContainerExtentX=c.Wr;d.rootContainerExtentY=
c.Xr;return d}function h(b,d){var f=this,g=b[0],h=b[b.length-1],k,l;0<g.Sa&&(k=g.entries[0].oc,l=g.entries[g.entries.length-1]);0<h.Sa&&(a(k)||(k=h.entries[0].oc),l=h.entries[h.entries.length-1]);if(k){var g=l.oc+l.Lj-k,p="o_"+k+"s_"+g;f.Nf[p]||(f.Nf[p]=!0,f.ed({url:f.jd,offset:k,size:g},function(a,g){setTimeout(function(){delete f.Nf[p]},1E3);if(a)d&&d(a);else{var h=new q(g);b.forEach(function(a){a.entries.forEach(function(b,d){h.position=b.oc-k;a.Vb[d]=h.ia(b.Lj);var f=a.Vb[d];c("P"==String.fromCharCode(f[1]));
c("N"==String.fromCharCode(f[2]));c("G"==String.fromCharCode(f[3]))})});d&&d(null)}}))}else d&&d(null)}function a(a){return"undefined"!==typeof a}function w(a,b){var c=Object.create(a);a.errorString=b;return c}var y=n(2).EventEmitter,q=n(4),p=l.events={Nl:"midxready",Ym:"sidxready",qi:"ready",ERROR:"error"},x={Ll:"midxdownloaderror",Ml:"midxparseerror",dm:"nosidxfoundinmidx",Wm:"sidxdownloaderror",Xm:"sidxparseerror"};l.prototype=Object.create(y.prototype);l.prototype.constructor=l;m.Ta=l},{2:2,4:4}],
7:[function(n,m){var l=n(2).EventEmitter,c=n(9),d=n(8)(),f=n(6),g=function k(d,b){var g=this;if(!(g instanceof k))return new k(d,b);l.call(g);g.wc=d.Xj||console;g.ed=d.L;g.vc=d.yj;g.ra=null;g.wu=b.type;g.jd=b.url;g.Of=b.ef;g.gd=new f({url:g.jd,offset:b.ak,size:b.bk,L:g.ed,ef:g.Of});g.gd.on("ready",function(){g.wc.info("ready event fired by subtitle stream");g.emit("ready");g.ra=new c(g.vc,g.gd.op.bind(g.gd),g.wc);g.ra.on("showsubtitle",g.emit.bind(g,"showsubtitle"));g.ra.on("removesubtitle",g.emit.bind(g,
"removesubtitle"))});g.gd.on("error",g.emit.bind(g,"error"))};g.prototype=Object.create(l.prototype);g.prototype.tc=function(c){null!==this.ra&&this.ra.tc(c)};g.prototype.stop=function(){this.wc.info("stop called");this.gd.removeAllListeners(["ready"]);null!==this.ra&&this.ra.stop()};g.prototype.pause=function(){this.wc.info("pause called");null!==this.ra&&this.ra.pause()};g=d([{L:"function",yj:"function",Xj:"object"},{type:"string",url:"string",ak:"number",bk:"number",ef:"number"}],g);m.Ta=g},{2:2,
6:6,8:8,9:9}],8:[function(n,m){function l(c){return Object.keys(c).every(function(d){return"function"===typeof c[d]})}m.Ta=function(c){function d(b,c,a){a="undefined"!==typeof a.key?"Types: expected "+a.key:"Types: expected argument "+a.index;throw new TypeError(a+(" to be '"+b+"' but found '"+c+"'"));}function f(b,c,a){var f=k[b];"undefined"!==typeof f?f(c)||d(b,c,a):b!==typeof c&&d(b,c,a)}function g(b,c){var a;a=b.filter(function(a){return"object"!==typeof a&&-1===n.indexOf(a)});a=a.concat(b.filter(function(a){return"object"===
typeof a}).reduce(function(a,b){return a.concat(Object.keys(b).map(function(a){return b[a]}).filter(function(a){return-1===n.indexOf(a)}))},[]));if(0<a.length)throw Error(a.join(",")+" are invalid types");return function(){var a=Array.prototype.slice.call(arguments);if(a.length!==b.length)throw new TypeError("Types: unexpected number of arguments");b.forEach(function(b,c){var d=a[c];if("string"===typeof b)f(b,d,{index:c});else if("object"===typeof b)Object.keys(b).forEach(function(a){f(b[a],d[a],
{key:a})});else throw Error("Types: unexpected type in type array");});return c.apply(this,a)}}var m="number boolean string object function symbol".split(" "),k;k={array:function(b){return Array.isArray(b)}};if("undefined"!==typeof c){if("object"!==typeof c||!l(c))throw new TypeError("Types: extensions must be an object of type definitions");Object.keys(c).forEach(function(b){if("undefined"!==typeof k[b]||"undefined"!==typeof m[b])throw new TypeError("Types: attempting to override a built in type with "+
b);k[b]=c[b]})}var n=Object.keys(k).concat(m);return g(["array","function"],g)}},{}],9:[function(n,m){function l(d,b){return b.reduce(c.bind(this,d),[])}function c(c,b,d){var a=d.displayTime-c;c=d.displayTime+d.duration-c;var f=0<b.length?b[0].timeout:Infinity;return 0<a&&a<f?[{timeout:a,type:"showsubtitle",rg:d}]:a===f?b.concat([{timeout:a,type:"showsubtitle",rg:d}]):0<c&&c<f?[{timeout:c,type:"removesubtitle",rg:d}]:c===f?b.concat([{timeout:c,type:"removesubtitle",rg:d}]):b}function d(c,b){return-1<
b.map(function(b){return b.id}).indexOf(c.id)}function f(c,b){return c.filter(function(c){return c!==b})}var g=n(2).EventEmitter,t=n(8)({}),k=function b(c,a,d){if(!(this instanceof b))return new b(c,a,d);g.call(this);var f=this;f.vc=c;f.kn=a;f.Na=[];f.wc=d||console;f.ra=setTimeout(function(){f.tc(c())},10)};k.prototype=Object.create(g.prototype);k.prototype.stop=function(){var b=this;clearTimeout(b.ra);b.Na.forEach(function(c){b.emit("removesubtitle",c)});b.Na=[]};k.prototype.pause=function(){clearTimeout(this.ra)};
k.prototype.tc=function(b,c){var a=this,g;clearTimeout(this.ra);g=a.kn(b);c="number"===typeof c?c:0;a.Na.forEach(function(c){c.displayTime<=b&&b<c.displayTime+c.duration||(a.Na=f(a.Na,c),a.emit("removesubtitle",c))});if(null!==g&&0<g.length){g.forEach(function(c){c.displayTime<=b&&b<c.displayTime+c.duration&&!d(c,a.Na)&&(a.emit("showsubtitle",c),a.Na=a.Na.concat([c]))});var k=l(a.vc(),g);0<k.length&&(a.ra=setTimeout(function(){k[0].displayTime>=a.vc()&&k.forEach(function(b){"showsubtitle"===b.type&&
(a.Na=a.Na.concat([b.rg]));"removesubtitle"===b.type&&(a.Na=f(a.Na,b.rg));a.emit(b.type,b.rg)});a.tc(a.vc())},k[0].timeout))}else g=250*Math.pow(2,c),a.wc.warn("rebuffering subtitles, checking buffer again in "+g+"ms"),a.ra=setTimeout(function(){a.tc(a.vc(),c+1)},g)};m.Ta=t(["function","function","object"],k)},{2:2,8:8}],10:[function(n,m){m.Ta={qg:function(l){var c=l.length,d;d=0;var f,g=0,m;if(!(0<=c))throw Error("bad string");for(f=c;f--;)m=l.charCodeAt(f),128>m?d++:d=2048>m?d+2:d+3;d=new Uint8Array(d);
for(f=0;f<c;f++)m=l.charCodeAt(f),128>m?d[g++]=m:(2048>m?d[g++]=192|m>>>6:(d[g++]=224|m>>>12,d[g++]=128|m>>>6&63),d[g++]=128|m&63);return d},hg:function(l){for(var c=0,d,f=l.length,g="";c<f;){d=l[c++];if(!(0<=d&&255>=d))throw Error("bad utf8");if(d&128)if(192===(d&224))d=((d&31)<<6)+(l[c++]&63);else if(224===(d&240))d=((d&15)<<12)+((l[c++]&63)<<6)+(l[c++]&63);else throw Error("unsupported utf8 character");g+=String.fromCharCode(d)}return g}}},{}]},{},[1])})();window.netflix=window.netflix||{};
netflix.cadmium=netflix.cadmium||{};netflix.cadmium.ui=netflix.cadmium.ui||{};netflix.cadmium.ui.mdx=netflix.cadmium.ui.mdx||{};netflix.mdx=netflix.mdx||{};netflix.mdx.ui=netflix.mdx.ui||{};
netflix.mdx.EVENTS=Object.freeze({mdx_init:"init",mdx_initerror:"initerror",mdx_state:"mdxstate",READY:"READY",NOT_READY:"NOT_READY",sessionstartresponse:"startSessionResponse",sessionended:"sessionended",messagedelivered:"messagedelivered",messagingerror:"messagingerror",pairingdeleted:"pairingdeleted",pairingresponse:"pairingresponse",regpairresponse:"regpairresponse",devicefound:"devicefound",devicelost:"devicelost",remoteDeviceReady:"remoteDeviceReady",pairingtimeout:"pairingtimeout",sessiontimeout:"sessiontimeout",
heartbeat:"heartbeat"});
netflix.mdx.bootstrap=function(){function r(){f=!0;var g=document.documentElement,b=document.createElement("script");b.src=netflix.constants.page.merchMdxJs;c.fromEvent(b,"load").take(1).doAction(d,d,n).subscribe(d,d);g.appendChild(b)}function n(){g=!0;m()}function m(){function c(){a.init(function(a){a.success?(netflix.player.nccp=a.nccp,netflix.player.mdx=a.mdx,netflix.mdx.Manager.INSTANCE.start()):f.log("init error",a.error)})}var b=netflix.cadmium,d=b.objects.videoPlayer(),a=b.objects.videoSession(),
f=b.logging,g=b.UiEvents,b=b.objects;null!=d?b.videoPlayerLoaded()?c():d.addEventListener("loaded",function(){c()}):g.addEventListener(g.knownEvents.NEW_PLAYER_CREATED,function(){m()})}function l(){if(chrome.cast&&chrome.cast.isAvailable)f||r();else{window.__onGCastApiAvailable=function(b,a){f||(b?r():console.log(a))};var c=document.getElementsByTagName("script")[0],b=document.createElement("script");b.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js";c.parentNode.insertBefore(b,c)}}var c=
Rx.Observable,d=function(){},f=!1,g=!1;if(0<=navigator.userAgent.toLowerCase().indexOf("chrome")&&0>navigator.userAgent.indexOf("Edge/")){var t=function(c){"complete"===document.readyState&&(clearTimeout(k),document.removeEventListener("readystatechange",t),l())},k=setTimeout(function(){document.removeEventListener("readystatechange",t);l()},1E3);document.addEventListener("readystatechange",t)}return{readyToInit:function(){return g&&f},tryInitMdx:m}}();
netflix.cadmium.util=function(){return{isEmptyObject:function(r){for(var n in r)if(r.hasOwnProperty(n))return!1;return!0},isArray:function(r){return Array.isArray?Array.isArray(r):"[object Array]"===Object.prototype.toString.call(r)},isObject:function(r){return"[object Object]"===Object.prototype.toString.call(r)},mix:function(r,n,m){r=r||{};n=n||{};m=m||{};for(var l in r)!m.hasOwnProperty(l)&&r.hasOwnProperty(l)&&(n[l]=r[l]);return n},NOOP:function(){},tryCatch:function(r,n,m){try{return r.apply(n,
m)}catch(l){return l}}}}();
(function(){var r=netflix.cadmium.util.NOOP;Rx.Observable.fromEvent||(Rx.Observable.fromEvent=function(n,m){return Rx.Observable.create(function(l){function c(){l.onNext.apply(l,arguments)}return n.addEventListener(m,c),function(){n.removeEventListener(m,c)}})});Rx.Observable.prototype.filter||(Rx.Observable.prototype.filter=Rx.Observable.prototype.where);Rx.Observable.prototype.map||(Rx.Observable.prototype.map=function(n,m){return Rx.Observable.prototype.select.call(m||this,n)});Rx.Observable.throw||
(Rx.Observable.throw=Rx.Observable.throwException);Rx.Observable.flatMap||(Rx.Observable.prototype.flatMap=Rx.Observable.prototype.selectMany);Rx.Observable.return||(Rx.Observable.return=Rx.Observable.returnValue);Rx.Observable.wrap||(Rx.Observable.wrap=function(n){return 0===arguments.length?Rx.Observable.empty():n instanceof Rx.Observable?n:n instanceof Error?Rx.Observable.throw(n):Rx.Observable.create(function(m){return m.onNext(n),m.onCompleted(),r})});Rx.Observable.catch||(Rx.Observable.catch=
Rx.Observable.catchException);Rx.Observable.prototype.catch||(Rx.Observable.prototype.catch=Rx.Observable.prototype.catchException);Rx.Observable.prototype.share||(Rx.Observable.prototype.share=function(){return this.publish().refCount()});Rx.Observable.prototype.shareValue||(Rx.Observable.prototype.shareValue=function(n){return this.publishValue(n).refCount()});Rx.Observable.prototype.shareReplay||(Rx.Observable.prototype.shareReplay=function(n,m,l){return this.replay(null,n,m,l).refCount()});Rx.Observable.prototype.retryWithBackoff=
function(n,m){n=n||5;m=m||1E3;var l=this,c=m,d=1,f=Rx.Observable.defer(function(){return Rx.Observable.timer(c).flatMap(function(){return c=Math.pow(2,d++)*m,l})});return this.catch(f.retry(n))}})();
netflix.cadmium.animate=function(){function r(m){"opacity"==m.propertyName&&.1>window.getComputedStyle(m.target).opacity&&m.currentTarget.classList.add(n)}"use strict";var n="display-none";return{fadeIn:function(m){m.removeEventListener("transitionend",r,!1);m.classList.remove(n);requestAnimationFrame(function(){m.classList.remove("opacity-transparent")})},fadeOut:function(m){m.removeEventListener("transitionend",r,!1);m.addEventListener("transitionend",r,!1);m.classList.add("opacity-transparent")}}}();
(function(){var r=!1,n=/\b_super\b/,m=function(l,c){return function(){var d=this._super,f;return this._super=c,f=l.apply(this,arguments),this._super=d,f}};netflix.cadmium.Class=function(){};netflix.cadmium.Class.extend=function(l){var c=this.prototype,d,f,g,t,k,u;r=!0;d=new this;r=!1;for(f in l)l.hasOwnProperty(f)&&(g=l.__lookupGetter__(f),t=l.__lookupSetter__(f),g||t?(g&&d.__defineGetter__(f,g),t&&d.__defineSetter__(f,t)):(g=l[f],d[f]="function"==typeof g&&"function"==typeof(k=c[f])&&n.test(g)?m(g,
k):g));return u=function(){!r&&this.init&&this.init.apply(this,arguments)},u.prototype=d,u.constructor=u,u.extend=arguments.callee,u}})();
netflix.cadmium.browser=function(){var r=!1,n=function(){var l=window.getComputedStyle(document.documentElement,""),l=Array.prototype.slice.call(l).join("").match(/-(moz|webkit|ms)-/)[1];return{dom:"WebKit|Moz|MS|O".match(new RegExp("("+l+")","i"))[1],lowercase:l,css:"-"+l+"-",js:l[0].toUpperCase()+l.substr(1)}}(),m=Object.freeze({pen:"pen",mouse:"mouse",touch:"touch"});return function(){var l=new Image;l.onload=function(c){r="load"===c.type&&1===l.width};l.onerror=function(c){r=!1};l.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="}(),
{prefix:function(){return n},pointerTypes:m,isMetroMode:function(){if("ms"===n.lowercase){var l=window.innerHeight===screen.height,c=!1,d="#metroForce"===window.location.hash;try{c=!!new ActiveXObject("htmlfile")}catch(f){}return l&&!c||d}return!1},supportsWebP:function(){return r}}}();
netflix.cadmium.customerEvents=function(){var r=function(n,m){if(!n)return"";var l=0,c=[],d;for(d in n)n.hasOwnProperty(d)&&(0!==l&&c.append(m),c.append(encodeURIComponent(d)),c.append("="),c.append(encodeURIComponent(n[d])),l++);return c.join("")};return{send:function(n,m,l,c){var d={legacy:!1,authURL:netflix.cadmium.objects.initParams().xsrfToken};"number"==typeof n?d.eventId=n:"string"==typeof n&&(d.custEventDef=n);m&&(d.eventData=r(m,","));l&&(d.trackId=l);var f=new XMLHttpRequest;f.onreadystatechange=
function(){4===f.readyState&&"200"===f.status&&c&&c(f.response)};f.open("GET","/LogCustomerEvent?"+r(d,"&"),!0);f.send()}}}();Function.prototype.debounce=function(r,n){var m=this,l;return function(){var c=this,d=arguments;l?clearTimeout(l):n&&m.apply(c,d);l=setTimeout(function(){n||m.apply(c,d);l=null},r||100)}};
netflix.cadmium.dom=function(){for(var r="DIV P LI UL SPAN IMG H1 H2 H3 SECTION A BUTTON INPUT".split(" "),n={},m=function(c,f){if(void 0!==f&&null!==f)if(f.nodeType)c.appendChild(f);else if("string"==typeof f||"number"==typeof f){var g=document.createTextNode(f);c.appendChild(g)}else if(f.constructor===Array)for(g=0;g<f.length;g++)m(c,f[g]);else for(g in f)f.hasOwnProperty(g)&&c.setAttribute(g,f[g])},l=function(c){return function(){for(var f=arguments.length,g=document.createElement(c),l=0;l<f;l++)m(g,
arguments[l]);return g}},c=0;c<r.length;c++)n[r[c]]=l(r[c]);return n.get=l,n}();
netflix.cadmium.element=function(){function r(c,f,g){c=document.createElement(c);return f&&(f.id&&(c.id=f.id),f.class&&(c.className=f.class)),g&&g.appendChild(c),c}function n(c,f){return[f.x-c.x,f.y-c.y]}function m(c,f,g){function l(b,a){return b[0]*a[0]+b[1]*a[1]}var k=l(c,c),m=l(c,f);c=l(c,g);var b=l(f,f);f=l(f,g);g=1/(k*b-m*m);b=(b*c-m*f)*g;k=(k*f-m*c)*g;return 0<=b&&0<=k&&1>b+k}function l(c,f){f=f||{};var g=(parseInt(getComputedStyle(c).getPropertyValue("line-height"),10)||parseInt(getComputedStyle(c).getPropertyValue("font-size"),
10))*f.maxLines,m=c.getBoundingClientRect().height;isNaN(m)||isNaN(g)||m<=g||(g=c.textContent.replace(/\s{2,}/g," ").split(" "),m=g.length,f.isClamped?g.splice(m-2,1):(g.pop(),g.push("&hellip;"),f.isClamped=!0),c.innerHTML=g.join(" "),l(c,f))}var c=null;return{getTransparentImage:function(){return null!==c?c:(c=r("img"),c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",c)},create:r,getDimensions:function(c){c=c.getBoundingClientRect();return{x:c.left,y:c.top,w:c.width,
h:c.height}},intendsToBeVisible:function(c){var f=function(c){c=window.getComputedStyle(c);return"visible"===c.visibility&&1<=parseInt(c.opacity)},g=f(c);if(!g)return!1;for(;c=c.offsetParent;)if(!f(c)){g=!1;break}return g},remove:function(c){if(c&&0<c.length)for(var f=c.length,g=0;g<f;++g){var l=c[g];l&&l.parentNode&&l.parentNode.removeChild(l)}else c&&c&&c.parentNode&&c.parentNode.removeChild(c)},vector:n,isPointInCachedTriangle:function(c,f,g,l){return m(g,l,n(f,c))},isPointInTriangle:function(c,
f,g,l){return m(n(f,l),n(f,g),n(f,c))},calcScaledScreenOffset:function(c,f){var g;return c.w/c.h>4/3?(g="-"+(c.w-4*c.h/3)/2/(c.h/f)+"em",g):"0"},limitLinesOfText:l,classNames:Object.freeze({visible:"player-visible",active:"player-active",hidden:"player-hidden",animate:"player-animate"})}}();
(function(){var r=netflix.cadmium;r.Eventable=r.Class.extend({init:function(){this.events={}},addEventListener:function(n,m,l){m={handler:m,scope:l};this.events.hasOwnProperty(n)?this.events[n].push(m):this.events[n]=[m]},removeEventListener:function(n,m,l){if(this.events.hasOwnProperty(n))for(var c=0;c<this.events[n].length;c++){var d=this.events[n][c];if(d.handler==m&&d.scope==l){this.events[n].splice(c,1);break}}},fireEvent:function(n,m){if(this.events.hasOwnProperty(n)){m&&m.length||(m=[]);for(var l=
this.events[n].slice(0),c=l.length,d=0;d<c;d++)l[d].handler&&l[d].handler.apply(l[d].scope,m)}}})})();
netflix.cadmium.logging=function(){function r(m,l){l=Array.prototype.slice.call(l);var c=netflix.player&&netflix.player.log,d=netflix.cadmium.objects;c&&d&&d.videoSession()&&c[m].apply(c,l)}"use strict";var n=/logging=true/.test(window.location.search);return{log:function(){n&&window.console&&console.log.apply(console,arguments);r("trace",arguments)},info:function(){n&&window.console&&console.info.apply(console,arguments);r("info",arguments)},error:function(){n&&window.console&&console.error.apply(console,
arguments);r("error",arguments)},uilog:function(){n&&window.console&&console.log.apply(console,arguments);r("trace",arguments)},onErrorLogger:function(){var m,l;1<arguments.length?(l=arguments[0],m=arguments[1],l=l+"\n"+(m&&m.stack||m)):(m=arguments[0],l=m&&m.stack||m);n&&console.error(m);r("error",l)}}}();
netflix.cadmium.time=function(){function r(n){n=parseInt(n);var m=0,l=0;return 3600<n&&(m=parseInt(n/3600),n%=3600),60<n&&(l=parseInt(n/60),n%=60),{h:m,m:l,s:n}}return{convert:function(n){var m="";n=r(n);return 0<n.h&&(m=n.h+":",10>n.m&&(m+="0")),m+=n.m+":",m+(10<=n.s?n.s:"0"+n.s)},convertUsingKey:function(n,m,l,c){var d=r(n),f=function(c){return m&&10>c?"0"+c:c};n=function(c){return netflix.I18n.getWithParams(c,["H","M","S"],[d.h,f(d.m),f(d.s)])};return 0<d.h?0<d.m?0<d.s&&!l?n(c+"-hours-minutes-seconds"):
n(c+"-hours-minutes"):d.s&&0< !l?n(c+"-hours-seconds"):n(c+"-hours"):0<d.m?0<d.s&&!l?n(c+"-minutes-seconds"):n(c+"-minutes"):n(c+"-seconds")},getFloored:function(n,m){return m=m||10,Math.max(0,(n/m>>0)*m)}}}();
netflix.cadmium.url=function(){function r(){var a,b;a=location.search.substr(1);b=a.indexOf("#");0<=b&&(a=a.substr(0,b));var c=n(a);return r=function(){return c},c}function n(a){for(var b=/[+]/g,c=(a||"").split("&"),d={},f,g=0;g<c.length;g++)a=w(c[g]),f=a.indexOf("="),0<=f?d[decodeURIComponent(a.substr(0,f).replace(b,"%20")).toLowerCase()]=decodeURIComponent(a.substr(f+1).replace(b,"%20")):d[a.toLowerCase()]=null;return d}var m=Object.freeze({EPISODE_ID:"episodeId",VIDEO_ID:"videoId",COMMENTARY_PREFERRED:"commentaryPreferred",
TRACK_ID:"trackId",BOOKMARK:"t"}),l,c={},d=function(){var a=window.location.hash;return 0<a.length&&"#"===a[0]&&(a=a.substring(1)),a},f=function(a,b){d()!==l&&k();c[a]=b;u()},g=function(a){delete c[a];u()},t=function(a){var b=d();return b!==l&&(l=b,k()),c[a]},k=function(){c={};var a=d();if(0<a.length)for(var a=a.split("&"),b=0;b<a.length;b++){var f=a[b].split("=");c[f[0]]=f[1]}},u=function(){var a="",b;for(b in c)c.hasOwnProperty(b)&&(a=a+b+"="+c[b]+"&");0<a.length&&(a=a.substring(0,a.length-1));
if(l||a)l=a,window.location.hash=a},b=function(b){a();f(m.VIDEO_ID,b)},h=function(b){a();f(m.EPISODE_ID,b)},a=function(){g(m.EPISODE_ID);g(m.VIDEO_ID);g(m.BOOKMARK)},w=function(){var a=/^\s+|\s+$/gm;return function(b){return b.replace(a,"")}}(),y;return{setNextVideo:function(a,c,d){d=d||0;c=parseInt(c,10);if(netflix.cadmium.ui.master.isAkira()){var g={};g[a]=c;g.trackId=g.trackingId=d;history.replaceState(g,"",c+"?trackId="+d)}else(a===m.EPISODE_ID?h:b)(c),d&&f(m.TRACK_ID,d)},getNextVideo:function(){var a=
window.history.state||{};if(a.videoId||a.episodeId)return a;var b=+t(m.EPISODE_ID),c=+t(m.VIDEO_ID),d=+t(m.TRACK_ID)||0;if(b||c)a={},a[b?"episodeId":"videoId"]=b||c,a.trackId=a.trackingId=d;return a},addHash:f,getHash:t,addVideoIDHash:b,addEpisodeIDHash:h,removeHash:g,constructUrl:function(a,b){a+="?";for(var c in b)b.hasOwnProperty(c)&&(a+=c+"="+b[c]+"&");return a.substr(0,a.length-1)},getOriginFromUrl:function(a){a=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(a);
return a[1]+":"+a[2]+a[3]},getQueryString:r,urlContains:function(a){return a instanceof RegExp?a.test(window.location.search):!1},CONSTANTS:m,getSecureApiPath:function(){if(!y){var a;netflix&&netflix.cadmium&&netflix.cadmium.objects&&netflix.cadmium.objects.initParams()&&netflix.cadmium.objects.initParams().apiUrl?a=netflix.cadmium.objects.initParams().apiUrl.replace("http://","https://"):a="https://"+location.hostname+"/api/";y=a}return y}}}();
netflix.cadmium.xhr=function(){function r(d){return d=d||{},Rx.Observable.create(function(g){function l(){g.onError(k)}var k=new XMLHttpRequest,m=d.url,b=d.method,h=d.headers,a=d.data||null;k.onload=function(){var a=k.status;a&&200<=a&&300>a?(g.onNext(k),g.onCompleted()):l()};k.onerror=l;k.open(b,m,!0);c(d,k);n(k,h);try{k.send(a)}catch(r){g.onError(r)}return function(){k&&4!==k.readyState&&k.abort()}})}function n(c,d){if(!c||!d)return c;for(var l in d)c.setRequestHeader(l,d[l]);return c}function m(c){function g(b,
c){m.push(encodeURIComponent(b)+"="+encodeURIComponent(c))}var m=[],k,n;if(d.isObject(c))for(k in c)c.hasOwnProperty(k)&&l(k,c[k],g);else for(k in c)c.hasOwnProperty(k)&&g(k,c[k]);return 0===m.length?n="":n=m.join("&").replace(/%20/g,"+"),n}function l(c,g,m){var k=/\[\]$/;if(d.isArray(g))g.forEach(function(b,g){k.test(c)?m(c,g):l(c+"["+(d.isObject(g)||d.isArray(g)?b:"")+"]",g,m)});else if(d.isObject(g))for(var n in g)g.hasOwnProperty(n)&&l(c+"["+n+"]",g[n],m);else m(c,g)}function c(c,d){c=c||{};d=
d||{};for(var l in c)c.hasOwnProperty(l)&&("requestType"===l||"withCredentials"===l)&&(d[l]=c[l]);return d}"use strict";var d=netflix.cadmium.util;return{get:function(c,g){g=g||{};netflix.constants&&netflix.constants.page&&netflix.constants.page.xsrf&&g.data&&(g.data.authURL=netflix.constants.page.xsrf);var l=m(g.data),k={method:"GET",responseType:"json"};return l?k.url=c+"?"+l:k.url=c,d.mix(g,k,{data:!0}),r(k).map(function(c){c=c.response;return"string"==typeof c&&(c=JSON.parse(c)),c})},post:function(c,
g){g=g||{};var l={url:c,method:"POST",requestType:"json"};return d.mix(g,l,{data:!0}),g.data&&(l.headers=l.headers||{},netflix.constants&&netflix.constants.page&&netflix.constants.page.xsrf&&(g.data.authURL=netflix.constants.page.xsrf),g.urlEncoded?(l.headers["Content-Type"]="application/x-www-form-urlencoded",l.data=m(g.data)):(l.headers["Content-Type"]="application/json",l.data=JSON.stringify(g.data))),r(l).map(function(c){c=c.response;return"string"==typeof c&&c&&(c=JSON.parse(c)),c})}}}();
netflix.cadmium.popup=function(){function r(){k&&k.onNext();c&&c.close();u=k=t=g=f=d=c=null}function n(b){return b&&b.origin===t}var m=netflix.cadmium.util,l=netflix.cadmium.url,c,d,f,g,t,k,u;return{open:function(b){b=b||{};if(!c||c.closed||b.url!==d){r();d=b.url;f=b.name;b=b.features;var h=b.width||300,a=b.height||200,w={width:h,height:a},y={};if(b.centered){var q=document.body.getBoundingClientRect(),p=q.width;w.top=q.height/2-a/2+screenTop;w.left=p/2-h/2+screenLeft}g=(m.mix(b,y,{centered:!0}),
m.mix(w,y));k=new Rx.Subject;b=g;var h="",x,A;for(A in b)b.hasOwnProperty(A)&&(x=b[A],!0===x?x="yes":!1===x?x="no":x+="",h+=(h.length?",":"")+A+"="+x);c=window.open(d,f,h);t=l.getOriginFromUrl(d);c&&!c.closed&&(u=Rx.Observable.fromEvent(window,"message").takeUntil(k).filter(n))}else c.focus();return u},close:r}}();
(function(){function r(){for(var c="",d,f=[],g=0;g<arguments.length;g++)if(d=arguments[g],"string"==typeof d)c&&(c+=": "),c+=d;else{f=[c,d];break}return f.length?f:[c]}"use strict";var n=netflix.cadmium,m=n.logging,l=n.Class.extend({init:function(c){this._namespace=c},log:function(){this._logit("log",arguments)},error:function(){this._logit("error",arguments)},info:function(){this._logit("info",arguments)},getErrorHandler:function(c){var d=this;return function(f){d.error.apply(d,r(d._namespace,c,
f&&f.stack||f))}},_logit:function(c,d){Array.prototype.unshift.call(d,this._namespace);m[c].apply(m,r.apply(null,d));"error"===c&&console.error.apply(console,d)}});l.create=function(c){return new l(c)};n.Logger=l})();
(function(){function r(){var c=m().initParams&&m().initParams();return!!c&&!!c.enableTrickPlay}function n(d){var f;if(r())a:{var g=m().videoPlayer&&m().videoPlayer();if(g=(g=g&&g.getTrickPlayFrame(d))&&g.image)try{f=URL.createObjectURL(new Blob([g],{type:"image/jpeg"}));break a}catch(n){f=(l.log(n&&n.stack||n),null);break a}f=null}else{f=d/1E3;var k=((netflix.cadmium&&netflix.cadmium.metadata||{}).getActiveVideo&&(netflix.cadmium&&netflix.cadmium.metadata||{}).getActiveVideo()||{}).progressImageRoot;
d=null;f=(k&&(g=f/10,d=k+c.substring((g+"").length)+g+".jpg"),d)}return f}function m(){return netflix.cadmium&&netflix.cadmium.objects||{}}"use strict";var l=netflix.cadmium.Logger.create("trickplay"),c="00000";netflix.cadmium.trickplay={getImageUrlAtTime:n,setImageTagSourceAtTime:function(c,f,g){(f=n(f))&&c?(c.src=f,r()?c.onload=function(){window.URL.revokeObjectURL(this.src);g&&g(!0)}:g&&g(!0)):g&&g(!1)}}})();
(function(){netflix.cadmium.mixins={mixin:function(r,n,m){(m||Object.keys(n)).forEach(function(l){r[l]=n[l]})},ui:{}}})();
netflix.cadmium.MutationUtils=function(){function r(n,m){return window.MutationObserver?Rx.Observable.create(function(l){var c;return c=new window.MutationObserver(function(c){l.onNext(c)}),c.observe(n,m),function(){c.disconnect()}}):Rx.Observable.empty()}return"use strict",{createMutationObserver:r,observeAndRemoveUnsafeNodes:function(n,m){return n&&m?r(n,{childList:!0,subtree:!1}).flatMap(function(l){return Rx.Observable.fromArray(l)}).filter(function(l){return l.addedNodes&&l.addedNodes.length}).flatMap(function(l){return Rx.Observable.fromArray([].slice.call(l.addedNodes))}).filter(function(l){return m.some(function(c){return l!==
c})}).doAction(function(l){l&&l.remove()}):Rx.Observable.throw("Must provide a target element and whitelist.")}}}();
(function(){var r=netflix.cadmium.Eventable.extend({knownEvents:Object.freeze({SHOW_MENU:"showmenu",HIDE_MENU:"hidemenu",METADATA_LOADED:"metadata-loaded",SHOWN_TRICKPLAY_PREVIEW:"trickplay-shown",HIDDEN_TRICKPLAY_PREVIEW:"trickplay-hidden",CINEMA_MODE_ENTER:"cinema-enter",CINEMA_MODE_EXIT:"cinema-exit",KEYBOARD_SEEK_ENTER:"keyboard-seek-enter",DRAG_MODE_ENTER:"drag-enter",FORCE_SHOW_MENU:"force-show-menu",REMOVE_FORCE_SHOW_MENU:"remove-force-show-menu",DRAG_START_SCRUBBER:"drag-start-scrubber",DRAG_FINISH_SCRUBBER:"drag-finish-scrubber",
AUTOPLAY_NEXT_EPISODE:"autoplay-next-episode",SHOW_AUTOPLAY_INTERRUPTER:"show-autoplay-interrupter",HIDE_AUTOPLAY_INTERRUPTER:"hide-autoplay-interrupter",FULLSCREEN_CHANGE:"fullscreenchange",PAUSE_TOGGLED:"pause-toggled",VIDEO_FIRST_PLAY:"videoFirstPlay",VIDEO_ENDED:"VideoEnded",VIDEO_POSTPLAY_ENTER:"videoPostplayEnter",NEW_PLAYER_CREATED:"playerCreated",NEW_PLAYER_DOM_CREATED:"playerDomCreated",MDX_LOADED:"mdxLoaded",WINDOW_RESIZE:"resize",ERROR:"ui-error",SHUTDOWN:"ui-shutdown"}),init:function(){this._super()},
destroy:function(){this.events={}}});netflix.cadmium.UiEvents=new r})();
(function(){function r(){var d=netflix.cadmium.playbackShutdown;Rx.Observable.merge(Rx.Observable.fromEvent(window,"beforeunload"),Rx.Observable.fromEvent(window,"popstate").filter(function(){var c=location.pathname.toLowerCase();return 0>c.indexOf("watch")&&0>c.indexOf("wiplayer")})).takeUntil(g).takeUntil(d).take(1).doAction(function(c){var d={isPopStateEvent:c instanceof window.PopStateEvent,event:c};for(c=0;c<f.length;c++)f[c](d)},n,n).subscribe(c,l.getErrorHandler("beforeUnload"),c)}function n(){g.onNext();
g=c=l=null;d=!1}"use strict";var m,l,c,d=!1,f=[],g;netflix.cadmium.playbackShutdown=netflix.cadmium.playbackShutdown||new Rx.Subject;netflix.cadmium.addBeforeUnloadHandler=function(c,d){"function"!=typeof c?l.error("Handler is not a function."):d?f.unshift(c):f.push(c)};netflix.cadmium.removeBeforeUnloadHandler=function(c){f.forEach(function(d,g){d===c&&f.splice(g,1)})};netflix.cadmium.unloadActions={init:function(){d&&n();d=!0;m=netflix.cadmium;l=m.Logger.create("UnloadActions");c=m.util.noop;g=
new Rx.Subject;r()}}})();
netflix.cadmium.playbackEvents=function(){function r(){var a;if(a=c())a=t.playerWrapper(),a=!(a&&a.classList.contains("player-postplay"));a&&m(!0);k.fireEvent(k.knownEvents.VIDEO_ENDED)}function n(){a[y]||m()}function m(b){a[y]=!0;k.fireEvent(k.knownEvents.VIDEO_POSTPLAY_ENTER,{hidePlayer:!!b})}function l(){if(!B){B=!0;var a;g.videoIsKnown(y)&&(a=g.getActiveVideo(),x=a.creditsOffset||A,x&&c()&&u.fromEvent(p,"currenttimechanged").takeUntil(H).sample(w).filter(function(){return p?(F=p.getCurrentTime()/
1E3,!p.getPaused()&&F>=x):!1}).doAction(n).subscribe(E,h.getErrorHandler("event|currenttimechanged"),E));q?u.fromEvent(p,"currenttimechanged").takeUntil(H).sample(w).filter(function(){return p?(F=p.getCurrentTime(),F>=A-1500):!1}).doAction(r).subscribe(E,h.getErrorHandler("event|webkit-currenttimechanged"),E):u.fromEvent(p,"endedchanged").takeUntil(H).filter(function(){return p&&p.getEnded()}).doAction(r).subscribe(E,h.getErrorHandler("event|endedchanged"),E)}}function c(){var a=g.getActiveVideo()||
{};return!f.ui.preplay.preplayNeeded()&&!b.getClipValues(a)}function d(){H&&H.onNext();h.log("deinit");h=b=u=k=t=g=null;a={};F=A=x=p=y=null;B=!1;E=H=null;D=!1}"use strict";var f=netflix.cadmium,g,t,k,u=Rx.Observable,b,h,a={},w=500,y=null,q="webkit"===f.browser.prefix().lowercase,p,x,A,F,D=!1,B=!1,H,E;return{init:function(){D&&d();D=!0;g=f.metadata;t=f.objects;k=f.UiEvents;b=f.clips;h=f.Logger.create("playback.events");u=Rx.Observable;h.log("init");H=new Rx.Subject;a={};E=f.util.NOOP;var c=u.fromEvent(k,
k.knownEvents.VIDEO_FIRST_PLAY).delay(3E3),m=u.fromEvent(k,k.knownEvents.METADATA_LOADED);u.concat(c,m).take(1).takeUntil(H).doAction(function(){y=t.videoId();p=t.videoPlayer();A=p.getDuration();l()}).subscribe(E,h.getErrorHandler("events|firstplay+metadataloaded"),E)},deinit:d}}();
netflix.cadmium.ui.errors=function(){function r(f,g){var m=l+f+(g&&"-"+g||""),k=[],r;switch(f){case c.UI_NO_METADATA:k.push("ui_no_metadata");break;case c.UI_PLAYER_CREATION_EXCEPTION:k.push("ui_player_creation_exception");break;case c.UI_TITLE_UNAVAILABLE:r=n&&n.objects&&n.objects.getCountry();d[r]?k.push("title-unavailable-"+r):k.push("title-unavailable");break;default:k.push("default")}return k.push(m),{messageIdList:k,display:{code:m,text:null}}}"use strict";var n=netflix.cadmium,m=n.UiEvents,
l="UI",c=Object.freeze({UI_UNKNOWN:3E3,UI_NO_METADATA:3001,UI_PLAYER_CREATION_EXCEPTION:3002,UI_TITLE_UNAVAILABLE:3003}),d={us:"us",ca:"ca",mx:"mx",br:"br",uk:"uk",ie:"ie",dk:"dk",fi:"fi",no:"no",se:"se",nl:"nl",fr:"fr",de:"de",ch:"ch",at:"at",be:"be",lu:"lu"};return{type:c,throwUIError:function(c,d){m.fireEvent(m.knownEvents.ERROR,[r(c,d)])}}}();
netflix.cadmium.cinemamode=function(){function r(){q=!1}function n(){q=!0;f()}function m(){B=!0}function l(){B=!1}function c(){var b=!1;if(a&&q&&!B){if(F&&(b=y&&y.some(function(a){return a&&a.contains(F)&&E.intendsToBeVisible(F)}))){N.log("Not entering cinema mode",{lastMouseTarget:F&&F.toString()});return}N.log("Entering cinema mode",{lastMouseTarget:F&&F.toString()});p&&clearTimeout(p);J.fireEvent(J.knownEvents.CINEMA_MODE_ENTER)}else N.log("Can't enter cinema mode",{initialized:a,cinemaModeEnabled:q,
modal:B})}function d(){a&&(clearTimeout(p),J.fireEvent(J.knownEvents.CINEMA_MODE_EXIT),T.getBusy()||f())}function f(){clearTimeout(p);p=setTimeout(c,ba)}function g(){clearTimeout(p);q=!1;w.removeEventListener("mousemove",V,!1);w.removeEventListener("mousemove",Q,!1);J.removeEventListener(J.knownEvents.KEYBOARD_SEEK_ENTER,g);J.removeEventListener(J.knownEvents.DRAG_START_SCRUBBER,g);J.addEventListener(J.knownEvents.DRAG_MODE_ENTER,t);J.addEventListener(J.knownEvents.DRAG_FINISH_SCRUBBER,t)}function t(){n();
f();w.addEventListener("mousemove",V,!1);w.addEventListener("mousemove",Q,!1);J.removeEventListener(J.knownEvents.DRAG_MODE_ENTER,t);J.removeEventListener(J.knownEvents.DRAG_FINISH_SCRUBBER,t);J.addEventListener(J.knownEvents.KEYBOARD_SEEK_ENTER,g);J.addEventListener(J.knownEvents.DRAG_START_SCRUBBER,g)}function k(a){d()}function u(){d()}function b(){a&&(T.getBusy()||d())}function h(){a&&(N.log("cinemamode.manager.deinit"),a=!1,clearTimeout(p),w.removeEventListener("mousemove",V),w.removeEventListener("mousemove",
Q),document.body.removeEventListener("keydown",k),T.removeEventListener("busychanged",b),T.removeEventListener("pausedchanged",u),J.removeEventListener(G.FORCE_SHOW_MENU,r),J.removeEventListener(G.REMOVE_FORCE_SHOW_MENU,n),J.removeEventListener(G.SHOW_AUTOPLAY_INTERRUPTER,m),J.removeEventListener(G.HIDE_AUTOPLAY_INTERRUPTER,l),J.removeEventListener(G.KEYBOARD_SEEK_ENTER,g),J.removeEventListener(G.DRAG_START_SCRUBBER,g),J=G=T=w=y=L=E=H=F=null,N.log("cinemamode.manager.deinit complete"))}"use strict";
var a=!1,w=null,y=[],q=!0,p=null,x=null,A=null,F=null,D=!0,B=!1,H,E,J,G,L,N,T,ba=2200,Q=function(a){x=a.clientX;A=a.clientY;F=a.target},V=function(a){B||(D?(a.clientX!=x||a.clientY!=A)&&d():d())}.debounce(20,!0);return{init:function(){a&&h();a=!0;H=netflix.cadmium;J=H.UiEvents;E=H.element;L=H.objects;N=H.logging;G=J.knownEvents;T=L.videoPlayer();w=L.playerWrapper();var c=H.url.getQueryString().trackpointerpos;c&&(D="true"===c);y=[];N.log("cinemamode.manager.init",{playerWrapperEl:w&&w.toString()});
w.addEventListener("mousemove",V,!1);w.addEventListener("mousemove",Q,!1);document.body.addEventListener("keydown",k,!1);T.addEventListener("busychanged",b);T.addEventListener("pausedchanged",u);J.addEventListener(G.FORCE_SHOW_MENU,r);J.addEventListener(G.REMOVE_FORCE_SHOW_MENU,n);J.addEventListener(G.SHOW_AUTOPLAY_INTERRUPTER,m);J.addEventListener(G.HIDE_AUTOPLAY_INTERRUPTER,l);J.addEventListener(G.KEYBOARD_SEEK_ENTER,g);J.addEventListener(G.DRAG_START_SCRUBBER,g);d()},deinit:h,addExclusionEls:function(a){a&&
Array.isArray(a)&&(y=y.concat(a))},disableCinemaMode:r,enableCinemaMode:n}}();
netflix.cadmium.metadata=function(){function r(a){return g&&a.video.type===w.show}function n(c){function d(a,c){f.video.seasons[a].episodes[c].active=!0;k=l[a];u=k.episodes[c];k.episodes[c+1]?(h=k,b=k.episodes[c+1]):l[a+1]&&(h=l[a+1],b=h.episodes[0])}h=b=k=u=null;a=[];if(f&&f.video&&f.video.type)if(g=!0,r(f)){var l=f.video.seasons,m;l.forEach(function(b,g){b.id===c&&d(g,0);m=b.episodes;m.forEach(function(b,h){a.push(b.id);b.id===c?d(g,h):f.video.seasons[g].episodes[h].active=!1})});null===u&&d(0,
0)}else f.video.active=!0,u=f.video,a.push(u.id);else g=!1}function m(a,b,c){a=+a;var d=netflix.cadmium,g=d.UiEvents;b&&(f=b,n(a),t=a);g.fireEvent(g.knownEvents.METADATA_LOADED);d.logging.log("success loading metadata");c&&"function"==typeof c&&c(f)}function l(a,b,d){function h(a){a&&null!=a.version?m(n,a,b):l({status:y.INVALID_METADATA})}function k(a){a&&null!=a.version?m(n,a,b):(g=!1,d&&"function"==typeof d&&d())}function l(a){g=!1;d&&"function"==typeof d&&d(a.status)}var n=+a;a=(netflix&&netflix.cadmium&&
netflix.cadmium.objects&&"function"==typeof netflix.cadmium.objects.initParams&&netflix.cadmium.objects.initParams()||{}).akiraMetadataStrategy;if(t!==n)if(c(n))m(n,f);else if(netflix.cadmium.ui.master.isAkira()&&a!==x)if(a===A)p||(p=Requireify.require("js/utils/player/playerMetadata.js")),p.getMetadataCall(n,window.pathEvaluator).timeout(15E3).retryWithBackoff(3,1E3).doAction(k).subscribe(q,l,q);else if(a===F){var r=new XMLHttpRequest;a=netflix.cadmium.objects.initParams().apiUrl+"metadata?movieid="+
n+"&imageFormat="+(netflix.cadmium.browser.supportsWebP()?"webp":"jpg");netflix.cadmium.objects.initParams().environment===D&&(a+="&revision=latest");r.onload=function(){var a;try{a=JSON.parse(r.responseText)}catch(b){}a?h(a):l(r)};r.onerror=function(){l(r)};r.open("GET",a,!0);r.withCredentials=!0;r.send()}else p||(p=Requireify.require("js/utils/player/playerMetadata.js")),p.getMetadata(n,window.pathEvaluator).timeout(15E3).retryWithBackoff(3,1E3).doAction(k).subscribe(q,l,q);else{a=(netflix.cadmium.objects.initParams().metadataBaseServer||
"")+"/WiPlayerMetadata?id="+n+"&type=cadmium";var u=new XMLHttpRequest;u.onload=function(){var a;try{a=JSON.parse(u.responseText)}catch(b){}a?h(a):l(u)};u.onerror=function(){l(u)};u.open("GET",a,!0);u.withCredentials=!0;u.send()}else m(n)}function c(b){return a&&0<=a.indexOf(b)}function d(a,b){var c,d=0,f=null;return a&&0<a.length&&a.forEach(function(a,g){c=a.h*a.w;b(c,d)&&(d=c,f=g)}),null!==f?a[f]:null}"use strict";var f=null,g=!1,t=null,k,u,b,h,a,w=Object.freeze({show:"show",movie:"movie"}),y=Object.freeze({INVALID_METADATA:1E3}),
q=netflix.cadmium.util.NOOP,p,x="merchweb",A="shakti",F="shaktiNativeXhr",D="test";return{prepare:function(a,b,d){b&&(f=b,n(a));b&&c(a)?m(a,b):l(a,null,d)},setMetadata:m,setMetadataField:function(a,b){for(var c=a.split("."),d=f,g=0;g<c.length;g++)g==c.length-1?d[c[g]]=b:d&&(d=d[c[g]])},retrieveData:l,getMetadata:function(){return f},getActiveVideo:function(){return u},getActiveSeason:function(){return r(f)?k:null},getTotalEpisodeCount:function(b){return c(b)?r(f)?a.length:0:0},getSeasonEpisodeCount:function(a){var b;
return f.video.seasons.forEach(function(c){if(c.id===a)return c.episodes.length;b=c.episodes;b.forEach(function(b){if(b.id===a)return c.episodes.length})}),0},getNextEpisode:function(){return r(f)?b:null},getNextEpisodeSeason:function(){return r(f)?h:null},getLargestImage:function(a){return d(a,function(a,b){return a>b})},getSmallestImage:function(a){return d(a,function(a,b){return 0>=b||a<b})},isShowData:r,videoTypes:w,videoIsKnown:c,clear:function(){f=null;g=!1;h=b=u=k=t=null;a=[]}}}();
netflix.cadmium.clips=function(){return{getClipValues:function(r,n){return n||(n=netflix.cadmium.objects.initParams()),n&&n.clipsMode&&n.clipsMode[r]}}}();
netflix.cadmium.objects=function(){function r(a){d=a||d}function n(a){0<=a&&(f=a)}function m(){t.removeEventListener(p,m);b=!1}function l(k,u,F){r(k);n(u);var D,B,H,E,J=a.UiEvents,G=a.ui.errors,L;b?t.close(function(){b=!1;l(k,u,F)}):(H={},E={},D={trackingId:f},B=netflix.cadmium.clips.getClipValues(d),B&&(D.clipStart=B.start,D.clipDuration=B.duration),H.uiplaycontext=c(),w.info("Setting play context:",y,",trackId: "+f),D.sessionParams=H,h.assistiveAudioPreferred&&(E.assistiveAudioPreferred=!0),E.pinCapableClient=
!!h.pinConfig&&!!h.pinConfig.isEnabled,D.authParams=E,L=netflix.cadmium.util.tryCatch(g.createPlayer,g,[d,D]),L instanceof Error?(w.error(L),G.throwUIError(G.type.UI_PLAYER_CREATION_EXCEPTION),F&&F(Error(G.type.UI_PLAYER_CREATION_EXCEPTION))):(t=L,a.timedtext.create(t,h),J.fireEvent(J.knownEvents.NEW_PLAYER_CREATED),t.addEventListener("loaded",function T(a){q=!0;h&&h.bookmarkByMovieId&&delete h.bookmarkByMovieId[d];t.removeEventListener("loaded",T)}),t.load(),t.addEventListener(p,m),b=!0,F&&F(null,
t)))}function c(){h&&h.playcontext&&!y&&(y=h.playcontext,delete h.playcontext);return y?{row:void 0!=y.row?y.row:-99,rank:void 0!=y.rank?y.rank:-99,location:y.location||"unknown",request_id:y.request_id||"unknown"}:null}"use strict";var d,f=0,g=null,t=null,k=null,u=null,b=!1,h=null,a=netflix.cadmium,w=a.Logger.create("object.pool"),y=null,q=!1,p="closed";return{videoSession:function(){return g},createVideoSession:function(){if(null!==g)return w.log("reusing video session"),!1;var a=h;return a.renderTimedText=
!0,g=new netflix.player.VideoSession(a),!0},destroyVideoSession:function(){g=null},videoPlayer:function(){return t},createVideoPlayer:l,videoPlayerCreated:function(){return b},trackId:function(){return f},setTrackId:n,clearTrackId:function(){f=0},videoId:function(){return d},setVideoId:r,initParams:function(){return h},setInitParams:function(a){h=a},playerWrapper:function(){return k},setPlayerWrapper:function(a){k=a},videoPlayerLoaded:function(){return q},mdxManager:function(){return u},setMdxManager:function(a){u=
a},playContext:c(),setPlayContext:function(a){y=a},overrideBookmark:function(a,b){h&&(a=parseInt(a,10),b=parseInt(b,10),isNaN(a)||isNaN(b)?w.error("Invalid params videoId="+a+", position="+b):(h.bookmarkByMovieId=h.bookmarkByMovieId||{},h.bookmarkByMovieId[a]=b,g&&g.applyConfig(h)))},getCountry:function(){var b;return a&&a.ui&&a.ui.master&&a.ui.master.isAkira&&a.ui.master.isAkira()?b=netflix&&netflix.contextData&&netflix.contextData.userContext&&netflix.contextData.userContext.data&&netflix.contextData.userContext.data.geo&&
netflix.contextData.userContext.data.geo.preferredLocale&&"string"==typeof netflix.contextData.userContext.data.geo.preferredLocale.country&&netflix.contextData.userContext.data.geo.preferredLocale.country.toLowerCase()||"":b=netflix&&netflix.constants&&netflix.constants.page&&netflix.constants.page.COUNTRY&&"string"==typeof netflix.constants.page.COUNTRY&&netflix.constants.page.COUNTRY.toLowerCase()||"",b},drain:function(a){function c(){a||(g=null,h=null,d=null,k=null,y=null,f=0,u=null,w.log("full drain"));
t=null;q=b=!1;w.log("drained")}try{g?g.closeAllPlayers(c):c()}catch(l){c()}}}}();
netflix.cadmium.sizing=function(){function r(){f&&(f=!1,window.removeEventListener("resize",y,!1));g=1;b.removeEventListener(b.knownEvents.FULLSCREEN_CHANGE,w)}function n(){m&&!f&&(u.initParams().windowScaling&&(f=!0,window.addEventListener("resize",y,!1)),b.addEventListener(b.knownEvents.FULLSCREEN_CHANGE,w),""===c.style.fontSize||d&&""===d.style.fontSize?setTimeout(w,h):g=parseFloat(c.style.fontSize)||1)}var m=!1,l,c,d,f=!1,g=1,t,k,u,b,h=17,a="MS"===netflix.cadmium.browser.prefix()?10:40,w=function(){var a=
k.getDimensions(c).h,b=k.getDimensions(l).h,a=a/100,f;b>a?(f=b/a,g/=f):a>b&&(f=a/b,g*=f);c.style.fontSize=g+"em";d&&(d.style.fontSize=g+"em")},y=function(){w();b.fireEvent(b.knownEvents.WINDOW_RESIZE)}.debounce(a,!1);return{init:function(a){t=netflix.cadmium;k=t.element;u=t.objects;b=t.UiEvents;c=a;m||(m=!0,l=k.create("div",{"class":"player-sizing"},c));n()},deinit:function(){r();k.remove(l);m=!1;d=c=l=null;f=!1;g=1;b=u=k=t=null},start:n,stop:r,setMdxControlWrapperEl:function(a){d=a;d.style.fontSize=
g+"em"},clearMdxControlWrapperEl:function(){d=null}}}();
netflix.cadmium.fullscreen=function(){function r(){var c=netflix.cadmium.objects.playerWrapper();return c?c.msRequestFullscreen?document.msFullscreenElement:void 0!==document.webkitIsFullScreen?document.webkitIsFullScreen:void 0!==document.mozFullScreen?document.mozFullScreen:(d.error("Could not determine fullscreen status."),!1):!1}function n(){var c=netflix.cadmium.objects.playerWrapper();c&&(c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?
c.mozRequestFullScreen():c.webkitRequestFullScreen())}function m(){var c=netflix.cadmium.objects.playerWrapper();if(c)if(c.exitFullscreen)document.exitFullscreen();else if(c.msRequestFullscreen)document.msExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.webkitCancelFullScreen)return d.error("Could not exit fullscreen"),!1;document.webkitCancelFullScreen()}}function l(){netflix.cadmium.UiEvents.fireEvent(netflix.cadmium.UiEvents.knownEvents.FULLSCREEN_CHANGE,
[r()])}function c(){document.removeEventListener("webkitfullscreenchange",l);document.removeEventListener("MSFullscreenChange",l);document.removeEventListener("mozfullscreenchange",l);f=!1}"use strict";var d=netflix.cadmium.Logger.create("fullscreen"),f=!1;return netflix.cadmium.playbackShutdown.take(1).doAction(c).subscribe(netflix.cadmium.util.NOOP,function(c){console.error(c)}),{init:function(){f&&removeListeners();document.addEventListener("webkitfullscreenchange",l,!1);document.addEventListener("MSFullscreenChange",
l,!1);document.addEventListener("mozfullscreenchange",l,!1);f=!0},deinit:c,isFullscreen:r,enter:n,exit:m,toggle:function(){r()?m():n()}}}();
(function(){function r(b){var d=b.keyCode;l.isFullscreen()&&b.preventDefault();d==t?(b=c.tryCatch(l&&l.toggle),b instanceof Error&&m.error(b)):u[d]&&this.fireEvent(u[d],[b])}"use strict";var n=netflix.cadmium,m=n.Logger.create("keyboard.events"),l=n.fullscreen,c=n.util,d=null,f=!0,g=function(){},t="70",k={TOGGLE_MUTE:"togglemute",DECREASE_VOLUME:"decreasevolume",INCREASE_VOLUME:"increasevolume",SEEK_BACKWARD:"seekbackward",SEEK_FORWARD:"seekforward",TOGGLE_PLAY:"toggleplay"},u={};u["77"]=k.TOGGLE_MUTE;
u["40"]=k.DECREASE_VOLUME;u["38"]=k.INCREASE_VOLUME;u["37"]=k.SEEK_BACKWARD;u["39"]=k.SEEK_FORWARD;u["32"]=k.TOGGLE_PLAY;u["13"]=k.TOGGLE_PLAY;k=n.Eventable.extend({init:function(){this._super();d=new Rx.Subject;Rx.Observable.fromEvent(document,"keydown").takeUntil(d).filter(function(){return f}).doAction(r.bind(this)).subscribe(g,m.getErrorHandler("keydown"),g)},enableShortcut:function(){f=!0},disableShortcut:function(){f=!1},knownEvents:k});n.keyboard=new k})();
netflix.cadmium.session=function(){function r(){b.keepAlive()}function n(a){k.log("session.manager",a&&a.stack||a)}function m(){h&&h.onNext()}function l(a){return w?c(a).currentSessionData:null}function c(a){var b=d(),c=localStorage.getItem(y);if(c)try{c=JSON.parse(c)}catch(f){c=null}var c=c||{},g=c[b]||{};return{id:b,localStorageData:c,sessionData:g,currentSessionData:g.data&&g.data[a]}}function d(){var a=u.getCurrentSession("userSession");return a&&a.sessionId}"use strict";var f,g,t,k,u=netflix.clientNotifications,
b=netflix.session,h,a,w=!1,y="NFPlaybackSession",q=Object.freeze({PIN:"pin",AUDIO:"audio",SUBTITLE:"subtitle",VOLUME:"volume"});return{init:function(){if(!w)if(f=netflix.cadmium,g=f.UiEvents,t=f.objects,k=f.Logger.create("session.manager"),k.log("init"),b&&u){w=!0;h=h||new Rx.Subject;a=a||new Rx.Subject;var c=g.knownEvents,d=Rx.Observable.fromEvent(g,c.VIDEO_FIRST_PLAY),c=Rx.Observable.fromEvent(g,c.VIDEO_ENDED),l=f.util.NOOP;d.takeUntil(a).take(1).map(function(){return t.videoPlayer()}).flatMap(function(a){return Rx.Observable.interval(6E5).map(function(){return a})}).takeUntil(a).takeUntil(h).takeUntil(c).filter(function(a){return a&&
!a.getPaused()}).doAction(r).subscribe(l,n,l)}else k.log("consolidated logging library failed to load.")},deinit:function(){w&&(m(),a&&a.onNext(),k.log("deinit"),a=h=k=t=g=f=null,w=!1)},heartBeat:r,isExpired:function(a){a=l(a);return b.newSession()||!a},setSessionData:function(a,b){if(w){var f=c(a),g=f.id,h=f.localStorageData,f=f.sessionData,k=d(),l;for(l in h)h.hasOwnProperty(l)&&l!==k&&delete h[l];f.timestamp=Date.now();f.data=f.data||{};f.data[a]=b;h[g]=f;localStorage.setItem(y,JSON.stringify(h))}},
getSessionData:l,endSession:m,log:function(a,b){u.notify(a,b)},SESSION_TYPES:q}}();
(function(){function r(){m=netflix.cadmium;l=m.xhr;c=m.objects;d=m.UiEvents;f=m.url;g=Rx.Observable;t=m.util;k=t.NOOP;u=m.Logger.create("postplay.data");u.log("init");b&&w&&0<w.length&&(u.info("Getting post play data in queue."),w.shift());b=!0;h=h||new Rx.Subject;var a=c.initParams()||{};q=a.postPlayBaseUrl;p=a.postPlayApiRevision;w&&w.length||(h.onNext(),n(q,c.videoId()))}function n(b,n){if(b)if(isNaN(n))a=g.throw(Error("Invalid movie id.")).takeUntil(h);else{var q=g.fromEvent(d,d.knownEvents.VIDEO_FIRST_PLAY),
r=g.return(c.videoPlayer()).filter(function(a){return!!a}),t=g.fromEvent(d,d.knownEvents.VIDEO_ENDED),G=g.fromEvent(d,d.knownEvents.VIDEO_POSTPLAY_ENTER);a=g.merge(q,r,t,G).take(1).takeUntil(h).flatMap(function(){var a={withCredentials:!0,urlEncoded:!0,data:{movieid:n}},d=c.initParams()||{};return p&&(a.data.revision=p),"prod"!==d.environment&&f.urlContains(/forcepromo=true/)&&(a.data.debugPromoPhase=!0),m.browser.supportsWebP()&&(a.headers={Accept:"image/webp, */*;"}),l.get(b,a).takeUntil(h).timeout(x).retryWithBackoff(A,
F).doAction(function(a){u.log("data received",a)},u.getErrorHandler("request error"))}).map(function(a){return y=a.requestId,a=a.postplay,a instanceof Array||(a=[a]),a}).doAction(function(a){w=a}).shareReplay();a.subscribe(k,u.getErrorHandler("dataAsObservable.subscribe"),k)}else a=g.throw(Error("No post play url available.")).takeUntil(h)}"use strict";var m,l,c,d,f,g,t,k,u,b=!1,h,a,w,y,q,p,x=1E4,A=5,F=1E3;netflix.cadmium.PostPlayData={init:r,deinit:function(){b&&(u.log("deinit"),h.onNext(),p=q=y=
w=a=h=u=k=t=g=f=d=c=l=m=null,b=!1)},getData:function(){b||r();return w&&0<w.length?(delete w[0].replay,g.return(w[0])):a.map(function(a){return a&&a.length&&a[0]}).takeUntil(h)},repeatCurrentPostPlayData:function(){var a=w[0];a&&!a.replay&&(a.replay=!0,a?w.unshift(a):u.error("Cannot enqueue a null object."))},getRequestId:function(){return y},recordImpression:function(a){a=a||{};u.info("Recording impression",a);var b={withCredentials:!0,urlEncoded:!0,data:{}};return p&&(b.data.revision=p),t.mix(a,
b.data,null),h=h||new Rx.Subject,l.get(q,b).takeUntil(h).timeout(x).retryWithBackoff(A,F).doAction(function(a){u.log("Impression logged:",a)}).subscribe(k,u.getErrorHandler("xhr|impression"),k)}}})();
(function(){function r(){if(a){g.log("scanning...");try{var c=document.querySelectorAll("["+J+"]"),d=Date.now(),f=[[],[],[],[]],h;g.log("Trackable items",c.length);for(var k=0,l;l=c[k];k++)h=n(l,d),f[h].push(l);h=A;A=[];if(x){k=[];l=0;for(var m=h.length;l<m;l++)k.push(h[l].row+","+h[l].rank+" "+h[l].video_id);g.log(k.join("\n"))}var p=JSON.parse(localStorage.getItem(Qa)||"[]");x&&g.log("saved impressions: "+p.length+"\nnew impressions: "+h.length+"\nmax impressions: "+H);var q=p.length+h.length;q>
H&&(g.log("Buffer is full."),p.splice(0,q-H),x&&console.log("removing "+(q-H)+" items from storage to keep length <= "+H));p=p.concat(h);try{localStorage.setItem(Qa,JSON.stringify(p)),x&&localStorage.setItem(sa,"true")}catch(r){F=F.concat(p)}if(x){var t=[f[Q].length+" new elements",c.length+" trackable",Date.now()-d+" ms"].join(", ");console.log("ui scan: "+t);b&&b.updateOverlays(f)}}catch(u){g.error(u)}}}function n(a,f){f=f||Date.now();var h;if(B)h=B;else{if(0>D){var k=document.getElementById(L);
k&&"fixed"==d(k,"position")?D=k.getBoundingClientRect().bottom:D=0}var k=window,l=document,p=l.documentElement,l=l.getElementsByTagName("body")[0];h=(B={left:0,top:D,right:k.innerWidth||p.clientWidth||l.clientWidth,bottom:k.innerHeight||p.clientHeight||l.clientHeight},B)}l=a.getBoundingClientRect();k=N;p=a.classList.contains(G);if(x){var n=a.getAttribute(J);g.log("el rect: ",n,l);g.log("window rect",h)}if(c(l,h)){k=T;a:{h=[];for(n=a.parentNode;n&&9!==n.nodeType;)1===n.nodeType&&h.push(n),n=n.parentNode;
var n=[],q,r;for(q=0;r=h[q];q++){if("hidden"==d(r,"visibility")){l=!1;break a}var t=d(r,"overflow");t&&t.match(/hidden|scroll|auto/)&&n.push(r)}for(q=0;r=n[q];q++)if(!c(l,r.getBoundingClientRect())){l=!1;break a}l="hidden"!=d(a,"visibility")}l&&(k=ba,p||(k=Q))}k===Q&&(l=f,h=m(a),b&&b.markAsVisible(a),g.info("Registering impression.",h),h?(h.time=l,A.push(h)):g.log("Impression: No trackingContext for element",a),a.classList.add(G));return p&&k<ba&&a.classList.remove(G),k}function m(a){a=a.getAttribute(J);
if(!a)return null;a=a.split(",");return 4>a.length?null:{video_id:l(a[0]),track_id:l(a[1]),row:l(a[2]),rank:l(a[3]),request_id:a[4]||y||la,location:a[5]||q||la}}function l(a){return a=parseInt(a,10),isNaN(a)&&(a=V),a}function c(a,b){var c=a.left+(a.right-a.left)/2,d=a.top+(a.bottom-a.top)/2;return a.left==a.right||b.left==b.right?!1:c>=b.left&&c<=b.right&&d>=b.top&&d<=b.bottom}function d(a,b){var c=document.defaultView;return c&&c.getComputedStyle?c.getComputedStyle(a,null).getPropertyValue(b):a.currentStyle?
a.currentStyle[b]:""}"use strict";var f=netflix.cadmium,g=f.Logger.create("presentation.tracking"),t,k=f.util.NOOP,u=Rx.Observable,b,h,a=!1,w=!1,y=null,q=null,p=null,x=!1,A=[],F=[],D=-1,B=null,H=250,E=null,J="data-uitrack",G="uitracking-state-visible",L="hd",N=0,T=1,ba=2,Q=3,V=-99,la="unknown",Qa,sa="uitracking.debug";netflix.cadmium.UITracking={init:function(c){a||(a=!0,p=c||{},g.log("init"),Qa=p.localStorageKey||"uitracking.impressions",t=f.UiEvents,h=f.UITrackingBuffer,H=p.maxRecords||250,w=!!p.enabled,
y=p.requestId,q=p.location,(x=p.debug)&&(b=netflix.UITrackingOverlay),E=new Rx.Subject,g.log("Initiating event listeners."),u.fromEvent(window,"resize").merge(u.fromEvent(t,t.knownEvents.FULLSCREEN_CHANGE)).takeUntil(E).throttle(1E3).doAction(r).subscribe(k,g.getErrorHandler("window|resize"),k),h.initPolling(p))},deinit:function(){if(a){E&&E.onNext();w=!1;q=y=null;A=[];F=[];D=-1;E=B=null;a=!1;if(x)for(var b=document.querySelectorAll(".uitracking-debug-overlay")||[],c=0,d;c<b.length;c++)(d=b[c])&&
d.remove&&d.remove();x=!1}},scan:r,trackElement:function(a,c){for(var d=["video_id","track_id","row","rank"],f=[],h=0;h<d.length;h++){var k=d[h];c.hasOwnProperty(k)||g.log("trackElement - trackingContext field not found: "+k);f.push(c[k])}f.push(c.request_id||"");f.push(c.location||"");a.setAttribute(J,f.join(","));n(a);b&&b.updateOverlays()},getTrackingContext:m,getFallbackSendBuffer:function(){return w&&F&&F.length?F:[]},TRACKING_ATTRIBUTE:J}})();
netflix.UITrackingOverlay=function(){function r(l,c){-1<l.className.indexOf(c)||(l.className+=" "+c)}function n(l,c){for(var d,f=Array.prototype.slice.call(document.getElementsByClassName(l));d=f.shift();)c(d)}function m(l,c){for(var d in c)c.hasOwnProperty(d)&&(l.style[d]=c[d])}return{updateDebugStates:function(l){n("uitracking-debug-state-inwindow",function(c){c.className=c.className.replace("uitracking-debug-state-inwindow","")});for(var c=0;c<l.length;c++)for(var d=l[c],f=0,g=d.length;f<g;f++){var m=
d[f];m.setAttribute("uitracking-debug-state",c);1<=c&&r(m,"uitracking-debug-state-inwindow");3<=c&&(m.className=m.className.replace("uitracking-debug-state-sent",""))}},markAsVisible:function(l){r(l,"uitracking-debug-state-visible")},markOverlaysAsSent:function(){var l=this;n("uitracking-debug-state-visible",function(c){r(c,"uitracking-debug-state-sent");c.className=c.className.replace("uitracking-debug-state-visible","")});n("uitracking-debug-overlay",function(c){l.setOverlayColor(c,"#480c44")})},
updateOverlays:function(l){l&&this.updateDebugStates(l);n("uitracking-debug-overlay",function(c){c.parentNode.removeChild(c)});var c=this;n("uitracking-debug-state-inwindow",function(d){c.addDebugOverlay(d)})},addDebugOverlay:function(l){var c=l.getAttribute("uitracking-debug-state",c)||0,d=2<=c?"solid":"dotted",f=3<=c?"#c11":"#de6400";2>c&&(f="#000");-1<l.className.indexOf("uitracking-debug-state-sent")&&(f="#480c44");c=netflix.cadmium.UITracking.getTrackingContext(l);l=l.getBoundingClientRect();
var g=document.createElement("div");m(g,{position:"fixed",zIndex:1E3,"pointer-events":"none",left:l.left+"px",top:l.top+"px",width:l.width-4+"px",height:l.height-4+"px",border:d+" 2px"});r(g,"uitracking-debug-overlay");d=document.createElement("span");d.className="has-color";m(d,{font:"10pt arial",padding:"5px",margin:0,color:"#fff","float":"left"});d.innerHTML=c.row+","+c.rank+" &nbsp; "+c.video_id;g.appendChild(d);d=document.createElement("div");d.className="has-color";m(d,{margin:"0 auto",position:"relative",
top:Math.floor(l.height/2)-4-16+"px",width:"16px",height:"16px",borderRadius:"8px"});g.appendChild(d);document.getElementsByTagName("body")[0].appendChild(g);this.setOverlayColor(g,f)},setOverlayColor:function(l,c){m(l,{borderColor:c});for(var d=l.getElementsByClassName("has-color"),f=0;f<d.length;f++)m(d[f],{backgroundColor:c})}}}();
(function(){var r,n,m,l,c,d,f,g,t,k,u,b,h,a,w={initPolling:function(y){y=y||{};f=!0;r=netflix.constants;n=netflix.cadmium;m=n.Logger.create("presentation.tracking.sender");l=n.UITracking;c=n.xhr;d=n.util.NOOP;t="uitracking.debug";k=r.page.UITRACKING_SEND_RATE_MS||8E3;b=r.page.UITRACKING_SEND_RATE_MAX_DECAY_MULTIPLIER||5;h=1;a=0;g=y.localStorageKey||"uitracking.impressions";u=y.endpoint||"https://presentationtracking.netflix.com/users/presentationtracking";w.flush();m.log("Init polling at "+k);var q=
this;setInterval(function(){m.log("Attempting to flush buffer...");try{++a>=h&&q.flush()}catch(b){m.log("Error flushing.",b)}},k)},flush:function(){if(f){m.log("Flush.");var c=[];try{c=l.getFallbackSendBuffer(),c.length||(c=JSON.parse(localStorage.getItem(g)||"[]"),l.retrySend||localStorage.setItem(g,"[]"))}catch(d){m.log("Error flushing.",d)}c&&c.length&&(a=0,h=Math.max(h++,b),this.send(c),localStorage.getItem(t)&&(this._logSentTitles(c),netflix.UITrackingOverlay&&netflix.UITrackingOverlay.markOverlaysAsSent(),
localStorage.removeItem(t)))}},send:function(a){m.log("Sending.");var b=r.page;a={esn:b.ESN||null,esnPrefix:b.ESNPrefix||null,country:b.COUNTRY,application_name:b.APP_NAME,application_v:b.APP_VERSION,sw_version:b.UITRACKING_USER_AGENT||"",data:JSON.stringify(a)};m.log("sending",a);a=c.post(u,{withCredentials:!0,urlEncoded:!1,data:a}).retryWithBackoff(5,1E3).doAction(function(a){m.log("Response:",a)});return a.subscribe(d,m.getErrorHandler("xhr|post"),d),a},_logSentTitles:function(a){for(var b=[],
c=0;c<a.length;c++)b.push(a[c].video_id);b=b.sort();console.log("SENT TITLES: "+b.length,b);console.log("----------------------------------------------------")}};netflix.cadmium.UITrackingBuffer=w})();
(function(){function r(c,d){var f,g;for(f in d)g=d[f],g.ns?c.setAttributeNS(g.ns,f,g.value):c.setAttribute(f,g)}function n(c,d){var f=c.getTimedTextTrack();c.ui=c.ui||{};c.ui.timedText&&c.ui.timedText.destroy();f&&f.isImageBased?c.ui.timedText=new l(c,d):c.ui.timedText=new m(c,d)}"use strict";var m=netflix.cadmium.Class.extend({_player:null,_config:null,init:function(c,d){this._player=c;this._config=d||{}},destroy:function(){this._player=null},setBounds:function(c){this._player&&this._player.setTimedTextBounds(c)}}),
l=m.extend({_elementsInView:null,_containerEl:null,_boundingReferenceEl:null,_timedTextContainerEl:null,_debugEl:null,_disposed:null,_recycledImageTags:null,_bounds:null,_viewBox:null,_config:null,init:function(c,d){this._super(c);this._elementsInView={};this._disposed=new Rx.Subject;this._recycledImageTags=[];this._config=d||{};this._createElements();this._createEventSubscriptions()},destroy:function(){this._disposed&&!this._disposed.isStopped&&(this._disposed.onNext(),this._disposed.onCompleted(),
this._containerEl&&this._containerEl.parentNode&&this._containerEl.parentNode.removeChild(this._containerEl),this._config=this._viewBox=this._bounds=this._boundingReferenceEl=this._recycledImageTags=this._disposed=this._timedTextContainerEl=this._containerEl=this._elementsInView=this._player=null)},show:function(c){this._addTimedText(c)},hide:function(c){this._removeTimedText(c.id)},setBounds:function(c){if(this._disposed&&!this._disposed.isStopped&&(c=c||{},void 0!==c.bottom&&c.bottom!==(this._bounds&&
this._bounds.bottom))){this._player.ui._timedTextBounds=this._bounds=c;var d=this;requestAnimationFrame(function(){d._disposed&&!d._disposed.isStopped&&(d._containerEl.style.bottom=d._getBottomOffset(d._bounds.bottom)+"px",d._forceRedraw())})}},_getBottomOffset:function(c){var d=this._boundingReferenceEl.getBoundingClientRect().top;c=Math.floor(d-c);d=0;return 0>c&&(d=-1*c),d},_createElements:function(){this._elementsInView={};this._recycledImageTags=[];this._containerEl=document.createElement("div");
this._containerEl.style.cssText="display: block;position: absolute;top: 0;right: 0;bottom: 0;left: 0;transform: translateZ(0);-webkit-transform: translateZ(0);";this._timedTextContainerEl=document.createElementNS("http://www.w3.org/2000/svg","svg");r(this._timedTextContainerEl,{width:"100%",height:"100%",style:"position: absolute; top: 0; bottom: 0; left: 0; right: 0;"});this._boundingReferenceEl=document.createElementNS("http://www.w3.org/2000/svg","rect");r(this._boundingReferenceEl,{fill:"none",
stroke:"none",x:"0",y:"0"});this._timedTextContainerEl.appendChild(this._boundingReferenceEl);this._containerEl.appendChild(this._timedTextContainerEl);this._player.getElement().appendChild(this._containerEl)},_createEventSubscriptions:function(){var c=Rx.Observable,d=netflix.cadmium.util.NOOP,f=c.fromEvent(this._player,"closed");c.fromEvent(this._player,"showsubtitle").takeUntil(this._disposed).takeUntil(f).doAction(this.show.bind(this)).subscribe(d,function(c){console.error(c)},d);c.fromEvent(this._player,
"removesubtitle").takeUntil(this._disposed).takeUntil(f).doAction(this.hide.bind(this)).subscribe(d,function(c){console.error(c)},d)},_createTimedTextElement:function(c){var d=URL.createObjectURL(new Blob([c.imageData],{type:"image/png"})),f=this._createImageTag();return f.onload=function(){URL.revokeObjectURL(this.href)},r(f,{href:{ns:"http://www.w3.org/1999/xlink",value:d},width:c.sizeX,height:c.sizeY,x:c.originX,y:c.originY}),f},_createImageTag:function(){return this._recycledImageTags.pop()||
document.createElementNS("http://www.w3.org/2000/svg","image")},_addTimedText:function(c){var d=this._createTimedTextElement(c);this.setBounds(this._player.ui._timedTextBounds);this._viewBox||(this._viewBox="0 0 "+c.rootContainerExtentX+" "+c.rootContainerExtentY,r(this._timedTextContainerEl,{viewBox:this._viewBox}),r(this._boundingReferenceEl,{width:c.rootContainerExtentX,height:c.rootContainerExtentY,fill:"none"}));this._timedTextContainerEl.appendChild(d);this._elementsInView[c.id]=d;window.DEBUG?
(this._debugEl||(this._debugEl=this._boundingReferenceEl,r(this._debugEl,{stroke:"yellow","stroke-width":"4",fill:"none"}),this._timedTextContainerEl.appendChild(this._debugEl)),d='<g xmlns="http://www.w3.org/2000/svg"><rect x="'+c.originX+'" y="'+c.originY+'" width="'+c.sizeX+'" height="'+c.sizeY+'" fill="rgba(0,0,0,0)" stroke="yellow"></rect><text x="'+c.originX+'" y="'+(c.originY-6)+'" font-size="18" fill="yellow">( '+[c.originX,c.originY,c.sizeX,c.sizeY].join(", ")+" )</text></g>",d=(new DOMParser).parseFromString(d,
"text/xml").firstChild,this._timedTextContainerEl.appendChild(d),this._elementsInView[c.id+"_debug"]=d):this._debugEl&&(r(this._debugEl,{stroke:"none"}),this._debugEl=null)},_removeTimedText:function(c){var d=this._elementsInView[c],f=this._elementsInView[c+"_debug"];d&&this._timedTextContainerEl.removeChild(d);f&&this._timedTextContainerEl.removeChild(f);this._recycleImageTag(d);d&&delete this._elementsInView[c];f&&delete this._elementsInView[c+"_debug"];this._forceRedraw()},_forceRedraw:function(){if(this._config.forceCCPaint){var c=
this;this._containerEl.style.display="none";requestAnimationFrame(function(){c._containerEl.style.display=""})}},_recycleImageTag:function(c){if(c&&c.attributes){var d,f;for(d=0;d<c.attributes.length;d++)(f=c.attributes.item(d))&&c.removeAttribute(f.name);this._recycledImageTags.push(c)}}});window.netflix.cadmium.timedtext={create:function(c,d){var f=netflix.cadmium.util.NOOP,g=Rx.Observable.fromEvent(c,"closed");n(c,d);Rx.Observable.fromEvent(c,"timedtexttrackchanged").takeUntil(g).map(function(c){return c.target}).doAction(n).subscribe(f,
function(c){console.error(c)},f)}}})();netflix.cadmium.views=function(){var r=Object.freeze({standard:1,fatal:2}),n,m={},l=!1;for(n in r)r.hasOwnProperty(n)&&(n=r[n],m[n]=[]);return{types:r,register:function(c,d){m[d].push(c)},show:function(c,d){l||(m[r.standard].forEach(function(c){c.deinit()}),0<=m[r.fatal].indexOf(c)&&(l=!0),c.init.apply(this,d))},deinit:function(){l=!1}}}();
(function(){var r=netflix.cadmium;r.ui.Component=r.Eventable.extend({parentNode:null,initialized:!1,config:{id:"player-component"},destroy:function(){if(this.initialized){this.initialized=!1;this.events={};for(var n in this)this.hasOwnProperty(n)&&(this[n]=null)}},init:function(n,m){this._super();this.initialized&&this.destroy();this.initialized=!0;this.parentNode=n;this.config=m||this.config}})})();
(function(){var r=netflix.cadmium,n=r.element,m=n.classNames.hidden,l=n.classNames.active,c=r.dom.DIV;r.ui.RadialProgressComponent=r.ui.Component.extend({progressEl:null,percent:0,destroy:function(){this.initialized&&(this.initialized=!1,n.remove(this.progressEl),this._super())},init:function(d,f){this._super(d,f);var g;g=["player-progress-round",this.config.hideWhenEmpty?m:l].join(" ");this.progressEl=c({"class":g,id:this.config.id},c({"class":"player-progress-loading"}),g=c({"class":"player-progress-val"},
"0%"));this.progressVal=g;this.parentNode.appendChild(this.progressEl)},update:function(c){c=Math.floor(c);if(this.initialized&&this.percent!==c){this.percent=c;var f=this;0===this.percent&&this.config.hideWhenEmpty||100===this.percent&&this.config.hideWhenFull?(f.progressEl.classList.remove(l),requestAnimationFrame(function(){f.progressEl.classList.add(m)})):(this.progressEl.classList.add(l),requestAnimationFrame(function(){f.initialized&&f.progressEl.classList.remove(m)}));this.progressVal.textContent=
this.percent+"%"}}})})();
(function(){var r=netflix.cadmium,n=r.element,m=r.objects,l=r.UiEvents,c=r.browser.pointerTypes,d=n.classNames,f=d.active,g=d.hidden,t=d.animate;r.ui.ScrubberComponent=r.ui.Component.extend({config:{id:"scrubber-component"},value:0,max:0,buffer:0,dragging:!1,pointerEventData:null,dragIncorrectDirectionPercentAllowed:.3,knownEvents:Object.freeze({DRAG_START:"dragstart",DRAG_END:"dragend",NEW_VALUE:"newvalue",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_MOVE:"mousemove",CLICK:"click"}),orientation:null,
wrapperEl:null,progressEl:null,completedEl:null,handleEl:null,snapbackDragEl:null,type:null,playerWrapperEl:null,setupPointerData:function(c){this.setupPointerDataDimensions();this.pointerEventData.drag={start:{value:this.value,max:this.max},pointer:{x:c.pageX,y:c.pageY}}},setupPointerDataDimensions:function(){var c=this.progressEl;if(c&&this.max){var d=this.value/this.max;this.pointerEventData.dimensions={handleEl:{left:d*c.offsetWidth,top:d*c.offsetHeight,dimensions:n.getDimensions(this.handleEl)},
wrapperEl:n.getDimensions(this.wrapperEl),playerWrapperEl:n.getDimensions(this.playerWrapperEl)}}},pointerDownHandler:function(c){this.wrapperEl.contains(c.target)&&(c.component=this,this.dragging||(this.setupPointerData(c),this.dragging=!0,this.pointerEventData.drag.current=this.determineEventValues(c,!1),this._updateSnapBackEl(this.pointerEventData.drag.current),this.fireEvent(this.knownEvents.MOUSE_ENTER,[c,this]),this.fireEvent(this.knownEvents.DRAG_START,[c,this])))},pointerMoveHandler:function(c){var d=
!1;c.component=this;if(this.dragging){var b=this.pointerEventData.dimensions.wrapperEl,g=this.pointerEventData.dimensions.playerWrapperEl;this.isValidEventLocation(c)&&(Math.abs(c.pageY-this.pointerEventData.drag.pointer.y)>g.h*this.dragIncorrectDirectionPercentAllowed&&(d=!0),c.wrapperDimensions=b,this.pointerEventData.drag.current=this.determineEventValues(c,d),this._updateDOM(this.pointerEventData.drag.current))}else this.isValidPointerType(c)&&this.wrapperEl.contains(c.target)&&((!this.pointerEventData||
!this.pointerEventData.dimensions)&&this.setupPointerData(c),this.isValidEventLocation(c)&&(this.handleEl.contains(c.target)||this.handleEl.classList.remove(f),this.pointerEventData.drag.current=this.determineEventValues(c,d),this.fireEvent(this.knownEvents.MOUSE_MOVE,[c,this])))},pointerUpHandler:function(d){var f=d.pointerType;d.component=this;this.dragging?(this.dragging=!1,(!this.pointerEventData||!this.pointerEventData.dimensions)&&this.setupPointerData(d),d.wrapperDimensions=this.pointerEventData.dimensions.wrapperEl,
d.haveHandleTargetted=this.handleEl.contains(d.target)&&f===c.mouse,this.fireEvent(this.knownEvents.DRAG_END,[d,this])):this.isValidPointerType(d)&&this.wrapperEl.contains(d.target)&&((!this.pointerEventData||!this.pointerEventData.dimensions)&&this.setupPointerData(d),this.pointerEventData.drag.current=this.determineEventValues(d,!1),this.fireEvent(this.knownEvents.CLICK,[d,this]))},pointerEnterHandler:function(c){this.isValidPointerType(c)&&this.isValidEventLocation(c)&&(c.component=this,(!this.pointerEventData||
!this.pointerEventData.dimensions)&&this.setupPointerData(c),this.pointerEventData.drag.current=this.determineEventValues(c,!1),this.fireEvent(this.knownEvents.MOUSE_ENTER,[c,this]))},pointerLeaveHandler:function(c){!this.dragging&&this.isValidPointerType(c)&&(c.component=this,this.handleEl.classList.remove(f),this.fireEvent(this.knownEvents.MOUSE_LEAVE,[c,this]))},mouseDownHandler:function(d){d.pointerType=c.mouse;this.pointerDownHandler(d)},mouseMoveHandler:function(d){d.pointerType=c.mouse;this.pointerMoveHandler(d)},
mouseUpHandler:function(d){d.pointerType=c.mouse;this.pointerUpHandler(d)},mouseOverHandler:function(d){this.wrapperEl.contains(d.relatedTarget)||(d.component=this,d.pointerType=c.mouse,(!this.pointerEventData||!this.pointerEventData.dimensions)&&this.setupPointerData(d),this.isValidEventLocation(d)&&(this.pointerEventData.drag.current=this.determineEventValues(d,!1),this.fireEvent(this.knownEvents.MOUSE_ENTER,[d,this])))},mouseOutHandler:function(d){this.dragging||this.wrapperEl.contains(d.relatedTarget)||
(d.component=this,d.pointerType=c.mouse,this.handleEl.classList.remove(f),this.fireEvent(this.knownEvents.MOUSE_LEAVE,[d,this]))},isValidEventLocation:function(c){var d=this.pointerEventData&&this.pointerEventData.dimensions&&this.pointerEventData.dimensions.wrapperEl;return d?this.orientation==this.type.orientations.horizontal?c.pageX>=d.x&&c.pageX<=d.x+d.w:c.pageY>=d.y&&c.pageY<=d.y+d.h:!1},isValidPointerType:function(d){d=d.pointerType;return d===c.touch||d===c.mouse||d===c.pen},determineEventValues:function(c,
d){var b=c.wrapperDimensions||n.getDimensions(this.wrapperEl),f,a,g,l,m=!1;return this.orientation===this.type.orientations.horizontal?(d?(a=this.pointerEventData.dimensions.handleEl.left,f=this.pointerEventData.drag.start.value,m=!0):(a=c.pageX-b.x,l=Math.min(100,Math.max(0,a/b.w)),f=l*this.max),g=c.pageX):(d?(a=this.pointerEventData.dimensions.handleEl.bottom,f=this.max-this.pointerEventData.drag.start.value,m=!0):(a=this.max-(c.pageY-b.y),l=Math.min(100,Math.max(0,a/b.h)),f=l*this.max),g=c.pageY),
{value:f,animate:m,relativePosition:a,absolutePosition:g,wrapperDimensions:b}},_updateSnapBackEl:function(c){c=c||{};this.value="undefined"!=typeof c.value?c.value:this.value;this.max=c.max||this.max;this.snapbackDragEl.style[this.orientation===this.type.orientations.horizontal?"left":"bottom"]=this.value/this.max*100+"%"},_updateDOM:function(c){c=c||{};this.value="undefined"!=typeof c.value?c.value:this.value;this.max=c.max||this.max;this.buffer=c.buffer||this.buffer;var d=this.value/this.max;c=
c.animate?"add":"remove";var b=100*d+"%",f=100*(this.buffer/this.max-d)+"%",a=this;this.fireEvent(this.knownEvents.NEW_VALUE,[this]);this.handleEl.classList[c](t);this.completedEl.classList[c](t);window.setTimeout(function(){a.orientation===a.type.orientations.horizontal?(a.handleEl.style.left=b,a.completedEl.style.width=b,a.bufferedTimeEl.style.width=f):(a.handleEl.style.bottom=b,a.completedEl.style.height=b)},1)},update:function(c,d,b){this.dragging||this._updateDOM({value:c,max:d,buffer:b,animate:!1})},
incrementScrubberPosition:function(c){var d,b;c=Math.min(this.max,Math.max(0,this.value+c));var f=c/this.max,a=n.getDimensions(this.wrapperEl);this.orientation===this.type.orientations.horizontal?(d=a.w*f,b=a.x+d):(d=a.h*f,b=a.y-(100-d));this.pointerEventData||(this.pointerEventData={});this.pointerEventData.drag||(this.pointerEventData.drag={});this.pointerEventData.drag.current={value:c,animate:!1,relativePosition:d,absolutePosition:b,wrapperDimensions:a};this.update(c,this.max)},updatePercent:function(c){var d=
c*this.max;window.requestAnimationFrame(function(){this._updateDOM({value:d})}.bind(this))},show:function(){this.wrapperEl.classList.add(g)},hide:function(){this.dragging||this.wrapperEl.classList.remove(g)},destroy:function(){this.initialized&&(this.initialized=!1,window.navigator.msPointerEnabled?(this.playerWrapperEl.removeEventListener("MSPointerDown",this.boundPointerDownHandler,!1),this.playerWrapperEl.removeEventListener("MSPointerMove",this.boundPointerMoveHandler,!1),this.playerWrapperEl.removeEventListener("MSPointerUp",
this.boundPointerUpHandler,!1),this.wrapperEl.removeEventListener("MSPointerEnter",this.boundPointerEnterHandler,!1),this.wrapperEl.removeEventListener("MSPointerLeave",this.boundPointerLeaveHandler,!1)):(this.playerWrapperEl.removeEventListener("mousedown",this.boundMouseDownHandler,!1),this.playerWrapperEl.removeEventListener("mousemove",this.boundMouseMoveHandler,!1),this.playerWrapperEl.removeEventListener("mouseup",this.boundMouseUpHandler,!1),this.wrapperEl.removeEventListener("mouseover",this.boundMouseOverHandler,
!1),this.wrapperEl.removeEventListener("mouseout",this.boundMouseOutHandler,!1)),l.removeEventListener(l.knownEvents.WINDOW_RESIZE,this.setupPointerDataDimensions),n.remove([this.handleEl,this.completedEl,this.progressEl,this.wrapperEl]));this._super()},init:function(c,d){this._super(c,d);this.type=r.ui.ScrubberComponent;this.pointerEventData=d&&d.pointerEventData||{};this.orientation=d&&d.orientation||this.type.orientations.horizontal;this.wrapperEl=n.create("div",{"class":"player-scrubber "+this.orientation.clazz,
id:this.config.id||null});this.progressEl=n.create("div",{"class":"player-scrubber-progress"});this.completedEl=n.create("div",{"class":"player-scrubber-progress-completed"},this.progressEl);this.bufferedTimeEl=n.create("div",{"class":"player-scrubber-progress-buffered"},this.progressEl);this.wrapperEl.appendChild(this.progressEl);this.handleEl=n.create("button",{"class":"player-scrubber-target"},this.wrapperEl);this.indicatorEl=n.create("div",{"class":"player-scrubber-handle"},this.handleEl);this.snapbackDragEl=
n.create("div",{"class":"trickplay-position trickplay-snapback"},this.progressEl);this.parentNode.appendChild(this.wrapperEl);this.playerWrapperEl=m.playerWrapper();this.boundPointerDownHandler=this.pointerDownHandler.bind(this);this.boundPointerMoveHandler=this.pointerMoveHandler.bind(this);this.boundPointerUpHandler=this.pointerUpHandler.bind(this);this.boundPointerEnterHandler=this.pointerEnterHandler.bind(this);this.boundPointerLeaveHandler=this.pointerLeaveHandler.bind(this);this.boundMouseDownHandler=
this.mouseDownHandler.bind(this);this.boundMouseMoveHandler=this.mouseMoveHandler.bind(this);this.boundMouseUpHandler=this.mouseUpHandler.bind(this);this.boundMouseOverHandler=this.mouseOverHandler.bind(this);this.boundMouseOutHandler=this.mouseOutHandler.bind(this);window.navigator.msPointerEnabled?(this.playerWrapperEl.addEventListener("MSPointerDown",this.boundPointerDownHandler,!1),this.playerWrapperEl.addEventListener("MSPointerMove",this.boundPointerMoveHandler,!1),this.playerWrapperEl.addEventListener("MSPointerUp",
this.boundPointerUpHandler,!1),this.wrapperEl.addEventListener("MSPointerEnter",this.boundPointerEnterHandler,!1),this.wrapperEl.addEventListener("MSPointerLeave",this.boundPointerLeaveHandler,!1)):(this.playerWrapperEl.addEventListener("mousedown",this.boundMouseDownHandler,!1),this.playerWrapperEl.addEventListener("mousemove",this.boundMouseMoveHandler,!1),this.playerWrapperEl.addEventListener("mouseup",this.boundMouseUpHandler,!1),this.wrapperEl.addEventListener("mouseover",this.boundMouseOverHandler,
!1),this.wrapperEl.addEventListener("mouseout",this.boundMouseOutHandler,!1));l.addEventListener(l.knownEvents.WINDOW_RESIZE,this.setupPointerDataDimensions,this)}});r.ui.ScrubberComponent.orientations=Object.freeze({horizontal:{id:1,clazz:"horizontal"},vertical:{id:2,clazz:"vertical"}})})();
(function(){var r=netflix.cadmium,n=r.UiEvents,m=r.element,l=m.classNames,c=l.visible,d=l.active,f=r.browser.pointerTypes,g=Rx.Observable,t=function(){};r.ui.MenuComponent=r.ui.Component.extend({openerEl:null,config:{id:"menu-component"},useMouseTriangleDetection:!1,menuMouseTriangle:null,hideMenuTimeout:null,hideMenuDelay:300,showEvent:"mouseover",mouseOverEvent:"menu-mouseover",menuEl:null,destroy:function(){this.initialized&&(this.initialized=!1,window.navigator.msPointerEnabled&&(document.removeEventListener("MSPointerMove",
this.boundPointermoveHandler),this.menuEl.removeEventListener("MSPointerOut",this.boundPointeroutMenuHandler),this.menuEl.removeEventListener("MSPointerOver",this.boundPointeroverMenuHandler)),this.openerEl.removeEventListener(this.showEvent,this.boundMouseoverOpenerHandler),this.openerEl.removeEventListener("mouseout",this.boundMouseoutOpenerHandler),n.removeEventListener(n.knownEvents.SHOW_MENU,this.boundMenuShownHandler),document.removeEventListener("mousemove",this.boundMousemoveHandler),this.menuEl.removeEventListener("mouseout",
this.boundMouseoutMenuHandler),this.menuEl.removeEventListener("mouseover",this.boundMouseoverMenuHandler),this.menuEl.removeEventListener("transitionend",this.boundFadeoutEndedHandler),m.remove(this.menuEl),this.menuMouseTriangle=null,this.menuEl=null);this._super()},init:function(c,d,b){this._super(c,b);this.openerEl=d;this.hideMenuDelay=b.hideMenuDelay||this.hideMenuDelay;this.showEvent=b.showEvent||this.showEvent;this.menuEl=m.create("div",{"class":"player-menu",id:this.config.id||null},this.parentNode);
this.boundMouseoverOpenerHandler||(window.navigator.msPointerEnabled?(this.boundPointermoveHandler=this.pointermoveHandler.bind(this),this.boundPointeroutMenuHandler=this.pointeroutMenuHandler.bind(this),this.boundPointeroverMenuHandler=this.pointeroverMenuHandler.bind(this)):(this.boundMousemoveHandler=this.mousemoveHandler.bind(this),this.boundMouseoutMenuHandler=this.mouseoutMenuHandler.bind(this),this.boundMouseoverMenuHandler=this.mouseoverMenuHandler.bind(this)),this.boundMouseoverOpenerHandler=
this.mouseoverOpenerHandler.bind(this),this.boundMouseoutOpenerHandler=this.mouseoutOpenerHandler.bind(this),this.boundMenuShownHandler=this.menuShownHandler.bind(this),this.boundFadeoutEndedHandler=this.fadeoutEndedHandler.bind(this),this.boundHide=this.hide.bind(this));this.openerEl.addEventListener(this.showEvent,this.boundMouseoverOpenerHandler);this.openerEl.addEventListener("mouseout",this.boundMouseoutOpenerHandler);n.addEventListener(n.knownEvents.SHOW_MENU,this.boundMenuShownHandler)},update:function(c){this.initialized&&
(c?this.show():this.hide())},show:function(){if(!this.isShowing()){window.navigator.msPointerEnabled?document.addEventListener("MSPointerMove",this.boundPointermoveHandler):document.addEventListener("mousemove",this.boundMousemoveHandler);this.useMouseTriangleDetection=!1;window.clearTimeout(this.hideMenuTimeout);this.menuEl.classList.add(c);this.openerEl.classList.add(d);var f=this;window.setTimeout(function(){if(this.initialized){var c=m.getDimensions(f.menuEl),b=m.getDimensions(f.openerEl);n.fireEvent(n.knownEvents.SHOW_MENU,
[f.config.id]);f.menuMouseTriangle={a:{x:b.x+b.w/2,y:b.y+b.h},b:{x:c.x,y:c.y+.95*c.h},c:{x:c.x+c.w,y:c.y+.95*c.h}};f.menuEl.classList.add(d);window.navigator.msPointerEnabled?(f.menuEl.addEventListener("MSPointerOut",f.boundPointeroutMenuHandler),f.menuEl.addEventListener("MSPointerOver",f.boundPointeroverMenuHandler)):(f.menuEl.addEventListener("mouseout",f.boundMouseoutMenuHandler),f.menuEl.addEventListener("mouseover",f.boundMouseoverMenuHandler))}}.bind(this),1)}},showTickler:function(){this.show();
n.fireEvent(n.knownEvents.FORCE_SHOW_MENU);g.timer(3E3).takeUntil(g.fromEvent(this,this.mouseOverEvent)).doAction(this.hide.bind(this),t,function(){n.fireEvent(n.knownEvents.REMOVE_FORCE_SHOW_MENU)}).subscribe()},hide:function(){this.isShowing()&&(window.navigator.msPointerEnabled?(document.removeEventListener("MSPointerMove",this.boundPointermoveHandler),this.menuEl.removeEventListener("MSPointerOut",this.boundPointeroutMenuHandler),this.menuEl.removeEventListener("MSPointerOver",this.boundPointeroverMenuHandler)):
(document.removeEventListener("mousemove",this.boundMousemoveHandler),this.menuEl.removeEventListener("mouseout",this.boundMouseoutMenuHandler),this.menuEl.removeEventListener("mouseover",this.boundMouseoverMenuHandler)),n.fireEvent(n.knownEvents.HIDE_MENU,[this.config.id]),this.menuEl.addEventListener("transitionend",this.boundFadeoutEndedHandler),this.menuEl.classList.remove(d),this.openerEl.classList.remove(d))},fadeoutEndedHandler:function(f){f.target===this.menuEl&&(f.stopPropagation(),this.menuEl.classList.contains(d)||
this.menuEl.classList.remove(c),this.menuEl.removeEventListener("transitionend",this.boundFadeoutEndedHandler))},menuShownHandler:function(c){c!==this.config.id&&this.update(!1)},mousemoveHandler:function(c){this.useMouseTriangleDetection&&null!==this.menuMouseTriangle&&(m.isPointInTriangle({x:c.pageX,y:c.pageY},this.menuMouseTriangle.a,this.menuMouseTriangle.b,this.menuMouseTriangle.c)||this.hide())},pointermoveHandler:function(c){c.pointerType!==f.mouse?(c.preventDefault(),!this.menuEl.contains(c.target)&&
!this.openerEl.contains(c.target)&&this.update(!1)):this.mousemoveHandler(c)},mouseoverMenuHandler:function(){this.useMouseTriangleDetection=!1;this.fireEvent(this.mouseOverEvent);window.clearTimeout(this.hideMenuTimeout)},pointeroverMenuHandler:function(c){c.pointerType!==f.mouse?c.preventDefault():(this.fireEvent(this.mouseOverEvent),this.mouseoverMenuHandler())},mouseoutMenuHandler:function(c){c=c.relatedTarget;this.menuEl.contains(c)||this.openerEl.contains(c)||(this.hideMenuTimeout=window.setTimeout(this.boundHide,
this.hideMenuDelay))},pointeroutMenuHandler:function(c){c.pointerType!==f.mouse?c.preventDefault():this.mouseoutMenuHandler(c)},mouseoverOpenerHandler:function(){this.update(!0)},mouseoutOpenerHandler:function(c){this.openerEl.contains(c.relatedTarget)||(this.useMouseTriangleDetection=!0)},isShowing:function(){return this.menuEl.classList.contains(d)}})})();
(function(){var r=netflix.cadmium,n=r.element,m=r.objects,l=r.UiEvents,c=r.keyboard,d=r.session;r.ui.VolumeMenuComponent=r.ui.MenuComponent.extend({id:null,wrapper:null,scrubber:null,volumeControlHeight:0,volumeTextNode:null,muted:!1,savedVolume:0,videoPlayer:null,disposed:null,normalize:function(c){c/=this.volumeControlHeight||1;return.05>c?c=0:.97<c&&(c=1),c},updateVolumeDisplay:function(c){c=parseInt(c);c=Math.min(Math.ceil(c/33),3);for(var d=0;4>d;d++)this.parentNode.classList.remove("icon-player-volume-"+
d);this.parentNode.classList.add("icon-player-volume-"+c)},volumeLevelChanged:function(c){c=this.normalize(c.value);c!==this.getVolume()&&(this.setVolume(c),this.updateVolumeDisplay(100*c))},clickScrubberHandler:function(c,d){d.value=d.pointerEventData.drag.current.value;this.volumeLevelChanged(d);this.scrubber.updatePercent(this.getVolume())},setVolume:function(c){c!==this.getVolume()&&(this.videoPlayer.setVolume(c),this.muted=0===c,this.videoPlayer.setMuted(this.muted),d.setSessionData(d.SESSION_TYPES.VOLUME,
{percentage:c,mute:this.muted}))},getVolume:function(){return this.videoPlayer.getVolume()},muteOn:function(){this.savedVolume=this.getVolume();this.updateVolumeDisplay(0);this.scrubber.updatePercent(0);this.muted=!0;this.videoPlayer.setMuted(this.muted)},muteOff:function(){this.updateVolumeDisplay(100*this.savedVolume);this.scrubber.updatePercent(this.savedVolume);this.muted=!1;this.videoPlayer.setMuted(this.muted)},toggleMute:function(){this.scrubber.max?this.muted?this.muteOff():this.muteOn():
(this.muted=!this.muted,this.videoPlayer.setMuted(this.muted),this.updateVolumeDisplay(this.muted?0:100*this.getVolume()))},adjustVolume:function(c){c=.1>c?0:1<c?1:c;this.scrubber.max?this.scrubber.updatePercent(c):(this.setVolume(c),this.updateVolumeDisplay(100*c))},showHandler:function(c){c===this.id&&(this.volumeControlHeight=this.scrubber.wrapperEl.offsetHeight,this.scrubber.update(this.getVolume()*this.volumeControlHeight,this.volumeControlHeight))},keyHandler:function(c){var d=this.getVolume();
this.adjustVolume(d+c)},addBehaviors:function(){function d(a,c,f){return Rx.Observable.fromEvent(a,c).takeUntil(n).doAction(f).subscribe(k,b,k)}var g=this.scrubber,m=g.knownEvents,k=r.util.NOOP,n=this.disposed,b=function(a){r.logging.log(a&&a.stack||a)};g.addEventListener(m.DRAG_END,this.clickScrubberHandler);n.onNext(function(){g.removeEventListener(m.DRAG_END,this.clickScrubberHandler)}.bind(this));d(g,m.NEW_VALUE,this.volumeLevelChanged);d(l,l.knownEvents.SHOW_MENU,this.showHandler);var h=this;
Rx.Observable.fromEvent(c,c.knownEvents.TOGGLE_MUTE).takeUntil(n).doAction(function(){h.toggleMute()}).subscribe(k,b,k);Rx.Observable.fromEvent(c,c.knownEvents.INCREASE_VOLUME).takeUntil(n).doAction(function(){h.keyHandler(.1)}).subscribe(k,b,k);Rx.Observable.fromEvent(c,c.knownEvents.DECREASE_VOLUME).takeUntil(n).doAction(function(){h.keyHandler(-.1)}).subscribe(k,b,k)},createContents:function(){this.wrapper=n.create("div",{"class":"volume-menu-content"});this.scrubber=new r.ui.ScrubberComponent(this.wrapper,
{orientation:r.ui.ScrubberComponent.orientations.vertical});this.addBehaviors();this.menuEl.appendChild(this.wrapper);setTimeout(function(){this.updateVolumeDisplay(100*this.getVolume())}.bind(this),1)},init:function(c,g,l){this._super(c,g,l);this.videoPlayer=m.videoPlayer();this.muted=this.videoPlayer.getMuted();this.id=l.id;this.disposed=new Rx.Subject;this.volumeLevelChanged=this.volumeLevelChanged.bind(this);this.clickScrubberHandler=this.clickScrubberHandler.bind(this);this.showHandler=this.showHandler.bind(this);
this.keyHandler=this.keyHandler.bind(this);(c=d.getSessionData(d.SESSION_TYPES.VOLUME))&&void 0!=c.percentage&&(this.savedVolume=c=c.percentage,this.setVolume(c));this.createContents()},destroy:function(){this.disposed&&this.disposed.onNext();this.keyHandler=this.showHandler=this.clickScrubberHandler=this.volumeLevelChanged=this.disposed=this.videoPlayer=this.muted=this.volumeTextNode=this.scrubber=this.wrapper=this.id=null;this._super()}})})();
(function(){var r=netflix.cadmium,n=r.metadata,m=r.element,l=!1;r.ui.NextEpisodeMenuComponent=r.ui.MenuComponent.extend({createContents:function(){var c=n.getNextEpisode(),d,f=netflix.I18n;c&&(this.menuHeaderEl=m.create("h1"),this.menuHeaderEl.textContent=f.get("ce-next-episode-header"),this.menuDataWrapperEl=m.create("div",{"class":"player-next-episode-info"}),d=n.getSmallestImage(c.stills),d&&d.w&&d.h&&d.url&&(this.menuNextEpisodeImageContainer=m.create("div",{"class":"image-container"}),this.menuNextEpisodeImage=
m.create("img",{"class":"next-episode-image"},this.menuNextEpisodeImageContainer),l?this.menuNextEpisodeImage.src=d.url:this.menuNextEpisodeImage.setAttribute("data-img-src",d.url),this.menuNextEpisodeImage.style["margin-left"]=m.calcScaledScreenOffset(d,6),m.create("div",{"class":"play-icon"},this.menuNextEpisodeImageContainer),this.menuDataWrapperEl.appendChild(this.menuNextEpisodeImageContainer)),this.menuTextWrapperEl=m.create("div",{"class":"player-next-episode-description"}),this.menuTextHeaderEl=
m.create("h2"),this.menuTextHeaderEl.textContent=f.getWithParams("ce-next-episode-title",["NUMBER","TITLE"],[c.seq,c.title]),this.menuTextEl=m.create("p"),this.menuTextEl.textContent=c.synopsis,this.menuTextWrapperEl.appendChild(this.menuTextHeaderEl),this.menuTextWrapperEl.appendChild(this.menuTextEl),this.menuDataWrapperEl.appendChild(this.menuTextWrapperEl),this.menuEl.appendChild(this.menuHeaderEl),this.menuEl.appendChild(this.menuDataWrapperEl))},show:function(){l||this.menuNextEpisodeImage.src||
(this.menuNextEpisodeImage.src=this.menuNextEpisodeImage.getAttribute("data-img-src"));this._super()},init:function(c,d,f){this._super(c,d,f);l=r.objects.initParams().imageLazyloadHoldback;this.createContents()}})})();
(function(){var r=netflix.cadmium,n=r.metadata,m=r.element,l=null,c,d,f,g=!1,t=function(b){b.target.classList.contains("episode-list-item--expanded")&&b.target.classList.add("episode-list-item--transition-ready");b.target.removeEventListener("transitionend",t)},k=function(b){b=b.target;if(d.contains(b))for(;d.contains(b);b=b.parentNode){if(b.classList.contains("episode-list-item--expanded")){b=b.getAttribute("data-episode-id");b!=n.getActiveVideo().id&&this.fireEvent("change-video",[{videoId:b}]);
break}if(b.classList.contains("episode-list-item")){var g=document.getElementsByClassName("episode-list-item--expanded")[0];g&&(g.classList.remove("episode-list-item--expanded"),g.classList.remove("episode-list-item--transition-ready"),g.style.height="");u(b,!0);break}if(b.classList.contains("back-to-seasons")){c.classList.remove("show-episode-list");break}}else if(f.contains(b))for(;f.contains(b);b=b.parentNode)if(b.classList.contains("season")){this.createEpisodeListPanel(b.getAttribute("data-season-id"));
c.classList.add("show-episode-list");break}},u=function(b,c){c?(b.addEventListener("transitionend",t),b.classList.add("episode-list-item--expanded"),b.style.height=b.getAttribute("data-expanded-height")):(b.classList.add("episode-list-item--no-transition"),b.classList.add("episode-list-item--expanded"),b.style.height=b.getAttribute("data-expanded-height"),setTimeout(function(){b.classList.remove("episode-list-item--no-transition")},1));if(!g){var a=b.getElementsByClassName("episode-list-image")[0];
g||a.src||(a.src=a.getAttribute("data-img-src"))}};r.ui.EpisodeSelectorMenuComponent=r.ui.MenuComponent.extend({createSeasonPanel:function(){var b=n.getMetadata();f=m.create("div",{"class":"season-list-container"},c);m.create("h2",{"class":"seasons-title"},f).textContent=b.video.title;for(var d=m.create("ul",{"class":"season-list"},f),a=0;a<b.video.seasons.length;a++){var g=m.create("li",{"class":"season icon-player-forward-arrow"},d),k=b.video.seasons[a];m.create("span",null,g).textContent=k.title;
g.setAttribute("data-season-id",k.id)}},createEpisodeListPanel:function(b){for(var f,a,k,r=0;r<l.video.seasons.length;r++)l.video.seasons[r].id==b&&(f=l.video.seasons[r]);n.getActiveSeason().id==b?a=n.getActiveVideo().id:a=f.episodes[0].id;f||(f=n.getActiveSeason());d&&d.parentNode.removeChild(d);d=m.create("div",{"class":"episode-list-container"});r=m.create("div",{"class":"episode-list-header"},d);1<l.video.seasons.length&&(b=m.create("div",{"class":"back-to-seasons-container"},r),m.create("button",
{"class":"back-to-seasons icon-player-back-arrow"},b));m.create("h2",{"class":"seasons-title"},r).textContent=f.title;b=m.create("ul",{"class":"episode-list"},d);for(r=0;r<f.episodes.length;r++){var q=f.episodes[r],p=m.create("li",{"class":"episode-list-item"},b);p.setAttribute("data-episode-id",q.id);var t=m.create("div",{"class":"episode-list-item-header"},p);m.create("span",{"class":"episode-list-index"},t).innerHTML=r+1;m.create("h3",{"class":"episode-list-title"},t).innerHTML=q.title;var A=m.create("progress",
{"class":"episode-list-progress"},t);A.max="100";q.bookmark&&0<=q.bookmark.offset&&0<q.runtime?A.value=q.bookmark.offset/q.runtime*100:A.value=0;m.create("span",{"class":"episode-list-down-arrow icon-player-down-arrow"},t);var p=m.create("div",{"class":"episode-list-description-container"},p),t=m.create("div",{"class":"episode-list-image-container"},p),A=m.create("img",{"class":"episode-list-image"},t),F=n.getSmallestImage(q.stills);F&&(g?A.src=F.url:A.setAttribute("data-img-src",F.url),A.style["margin-left"]=
m.calcScaledScreenOffset(F,6));q.id!==n.getActiveVideo().id&&m.create("div",{"class":"play-icon"},t);m.create("p",{"class":"episode-list-synopsis"},p).innerHTML=q.synopsis}c.appendChild(d);(f=this.menuEl.classList.contains(m.classNames.visible))||this.menuEl.classList.add(m.classNames.visible);b=d.getElementsByClassName("episode-list-item");for(r=0;r<b.length;r++)q=b[r],p=q.cloneNode(!0),p.classList.add("episode-list-item--copied"),q.parentNode.appendChild(p),k||(k=m.create("div",{"class":"measuring-stick"},
p).clientWidth/1E3),t=m.getDimensions(p).h/k-1,q.setAttribute("data-expanded-height",t+"em"),q.parentNode.removeChild(p),q.getAttribute("data-episode-id")==a&&(u(q,!1),q.parentElement.scrollTop=q.offsetTop-q.parentElement.offsetTop);f||this.menuEl.classList.remove(m.classNames.visible)},createContents:function(b){var d=m.create("div",{"class":"episode-selector-container"},this.menuEl);c=m.create("div",{"class":"episode-selector-slider show-episode-list"},d);this.scopedClickHandler=k.bind(this);c.addEventListener("click",
this.scopedClickHandler);this.createSeasonPanel();this.createEpisodeListPanel(b)},init:function(b,c,a){this._super(b,c,a);l||(l=n.getMetadata());g=r.objects.initParams().imageLazyloadHoldback;this.createContents(n.getActiveSeason().id)},destroy:function(){l=null;c.removeEventListener("click",this.scopedClickHandler);this._super()},CHANGE_VIDEO_EVENT:"change-video"})})();
(function(){var r=netflix.cadmium,n=r.objects,m=r.element,l=r.logging,c=r.util.NOOP,d=m.classNames.visible;r.ui.AudioSubtitleMenuComponent=r.ui.MenuComponent.extend({audioListEl:null,audioHeaderEl:null,audioItemsEls:{},textListEl:null,textHeaderEl:null,textItemsEls:{},videoPlayer:null,allowAudioTrackModification:!1,allowTextTrackModifications:!1,clickHandler:function(c){c=c.target;var d=c.getAttribute("data-id"),l,k;this.useMouseTriangleDetection=!0;this.audioListEl.contains(c)?(l=this.audioItemsEls[d],
k=l&&l.track,l&&this.videoPlayer.setAudioTrack(k)):this.textListEl.contains(c)&&("none"===d?this.videoPlayer.setTimedTextTrack(null):(l=this.textItemsEls[d],l&&(k=l.track,this.videoPlayer.setTimedTextTrack(k))))},_updateAudioListDOM:function(){var c=this.videoPlayer.getAudioTrackList(),g=this.videoPlayer.getAudioTrack(),l,k,n,b=this;if(c){for(l in this.audioItemsEls)this.audioItemsEls.hasOwnProperty(l)&&(l=this.audioItemsEls[l],m.remove(l.el));b.audioItemsEls={};c.forEach(function(c){if(c){n=c.trackId;
k=m.create("li",{"class":g&&g.trackId===n?"player-track-selected":null},b.audioListEl);k.setAttribute("data-id",n);if("COMMENTARY"==c.trackType){var a=c.displayName.split(" - "),d="";2==a.length?(d=netflix.I18n.get("ce-audio-tracks-commentator-title"),d=d.replace("{LANGUAGE}",a[0]),d=d.replace("{COMMENTATOR}",a[1])):d=c.displayName;k.setAttribute("data-commentary","true");k.appendChild(document.createTextNode(d))}else k.appendChild(document.createTextNode(c.displayName));b.audioItemsEls[n]={el:k,
track:c}}});this.audioListEl.classList.add(d);this.allowAudioTrackModification=1<c.length}else this.audioListEl.classList.remove(d),this.allowAudioTrackModification=!1},_updateTextListDOM:function(){var c=this.videoPlayer.getTimedTextTrackList(),g=this.videoPlayer.getTimedTextTrack(),l,k,n=!1,b,h,a=netflix.I18n,r=this;if(c&&0<c.length){for(l in this.textItemsEls)this.textItemsEls.hasOwnProperty(l)&&(l=this.textItemsEls[l],m.remove(l.el));r.textItemsEls={};c.forEach(function(c){c?(n=g&&g.trackId===
c.trackId,b=c.trackId,h=c.displayName+("ASSISTIVE"===c.trackType?" [CC]":"")):(c="none",n=!g,b=c,h=a.get("ce-none-track"));k=m.create("li",{"class":n?"player-track-selected":null},r.textListEl);k.setAttribute("data-id",b);k.appendChild(document.createTextNode(h));r.textItemsEls[b]={el:k,track:c}});this.textListEl.classList.add(d);this.allowTextTrackModifications=1<c.length}else this.textListEl.classList.remove(d),this.allowTextTrackModifications=!1},createContents:function(){this.videoPlayer=n.videoPlayer();
var c=netflix.I18n;this.audioListEl=m.create("ol",{"class":"player-audio-tracks"});this.audioHeaderEl=m.create("lh",{},this.audioListEl);this.audioHeaderEl.appendChild(document.createTextNode(c.get("ce-audio-tracks-title")));this._updateAudioListDOM();this.menuEl.appendChild(this.audioListEl);this.textListEl=m.create("ol",{"class":"player-timed-text-tracks"});this.textHeaderEl=m.create("lh",{},this.textListEl);this.textHeaderEl.appendChild(document.createTextNode(c.get("ce-text-tracks-title")));this._updateTextListDOM();
this.menuEl.appendChild(this.textListEl)},audioTrackListChangedHandler:function(){this._updateAudioListDOM()},audioTrackChangedHandler:function(){this._updateAudioListDOM()},textTrackListChangedHandler:function(){this._updateTextListDOM()},textTrackChangedHandler:function(){this._updateTextListDOM()},attachListeners:function(){function d(f,l,b){Rx.Observable.fromEvent(f,l).takeUntil(g).doAction(b).subscribe(c,m,c)}l.log("initializing component.audio.subtitle.menu");var g=this._disposed,m=function(c){l.error(c&&
c.stack||c)};d(this.menuEl,"click",this.clickHandler);d(this.videoPlayer,"audiotracklistchanged",this.audioTrackListChangedHandler);d(this.videoPlayer,"audiotrackchanged",this.audioTrackChangedHandler);d(this.videoPlayer,"timedtexttracklistchanged",this.textTrackListChangedHandler);d(this.videoPlayer,"timedtexttrackchanged",this.textTrackChangedHandler)},init:function(c,d,l){this._super(c,d,l);this.clickHandler=this.clickHandler.bind(this);this.audioTrackListChangedHandler=this.audioTrackListChangedHandler.bind(this);
this.audioTrackChangedHandler=this.audioTrackChangedHandler.bind(this);this.textTrackListChangedHandler=this.textTrackListChangedHandler.bind(this);this.textTrackChangedHandler=this.textTrackChangedHandler.bind(this);this._disposed=new Rx.Subject;this.createContents();this.attachListeners()},destroy:function(){this._disposed&&this._disposed.onNext();this.audioHeaderEl=this.audioListEl=null;this.audioItemsEls={};this.textHeaderEl=this.textListEl=null;this.textItemsEls={};this.videoPlayer=null;this._super()}})})();
(function(){var r=netflix.cadmium,n=r.objects,m=Rx.Observable,l=r.element,c=r.UiEvents,d,f=!1,g,t=r.util.NOOP;r.ui.MdxMenuComponent=r.ui.MenuComponent.extend({mdxListEl:null,mdxHeaderEl:null,mdxItemsEls:{},videoPlayer:null,allowMdxTrackModification:!1,allowTextTrackModifications:!1,clickHandler:function(c){c=c.target.getAttribute("data-ip");r.ui.master.toggleMdxMode(!0,c)},_mdxLoadedHandler:function(){d=n.mdxManager();var k=Number(window.localStorage.getItem("mdxTicklerShowCount"));3>k?(window.localStorage.setItem("mdxTicklerShowCount",
k+1),f=!0,this._updateMdxListDOM()):m.timer(3E3).take(1).subscribe(function(){f=!0},t,t);m.fromEvent(d,d.EVENTS.devicefound).takeUntil(g).doAction(this._updateMdxListDOM.bind(this),t,t).subscribe();c.removeEventListener(c.knownEvents.MDX_LOADED,this._mdxLoadedHandler,this)},_updateMdxListDOM:function(){if(d){for(var c=d.getTargetList(),g;this.mdxListEl.firstChild;)this.mdxListEl.removeChild(this.mdxListEl.firstChild);this.mdxListEl.appendChild(this.mdxHeaderEl);if(netflix.cadmium.util.isEmptyObject(c))this.hide();
else{var b,h=null;for(b in c)(h=c[b])&&h._config&&(g=l.create("li",null,this.mdxListEl),g.setAttribute("data-ip",b),g.appendChild(document.createTextNode(h._config.friendlyName)));f&&this.showTickler()}}},createContents:function(){this.videoPlayer=n.videoPlayer();this.mdxListEl=l.create("ol",{"class":"player-mdx-list"});this.mdxHeaderEl=l.create("lh",{},this.mdxListEl);this.mdxHeaderEl.appendChild(document.createTextNode(netflix.I18n.get("mdx-play-on")));d=n.mdxManager();this._updateMdxListDOM();
this.menuEl.appendChild(this.mdxListEl)},attachListeners:function(){this.boundClickHandler||(this.boundClickHandler=this.clickHandler.bind(this));this.menuEl.addEventListener("click",this.boundClickHandler,!1)},init:function(d,f,b){this._super(d,f,b);this.createContents();this.attachListeners();g=new Rx.Subject;n.mdxManager()?this._mdxLoadedHandler():c.addEventListener(c.knownEvents.MDX_LOADED,this._mdxLoadedHandler,this)},destroy:function(){this.menuEl.removeEventListener("click",this.boundClickHandler,
!1);c.removeEventListener(c.knownEvents.MDX_LOADED,this._mdxLoadedHandler,this);d&&d.removeEventListener(d.EVENTS.devicefound,this._updateMdxListDOM,this);g.onNext();this._super()}})})();
(function(){var r=netflix.cadmium,n=r.element;r.ui.Button=r.ui.Component.extend({knownEvents:Object.freeze({CLICK:"click"}),buttonEl:null,focus:function(){this.buttonEl.focus()},blur:function(){this.buttonEl.blur()},clickHandler:function(m){this.fireEvent(this.knownEvents.CLICK,[m,this])},destroy:function(){this.initialized&&(this.initialized=!1,this.buttonEl.removeEventListener("click",this.boundClickHandler),n.remove(this.buttonEl),this.buttonEl=null)},init:function(m,l){this._super(m,l);this.buttonEl=
n.create("button",{"class":["button",this.config.class||""].join(" "),id:this.config.id||null},this.parentNode);this.buttonEl.setAttribute("type","button");this.buttonEl.appendChild(this.config.contentsEl);this.boundClickHandler||(this.boundClickHandler=this.clickHandler.bind(this));this.buttonEl.addEventListener("click",this.boundClickHandler)}});Object.defineProperty(r.ui.Button.prototype,"enabled",{get:function(){return this._enabled},set:function(m){this._enabled=!!m;this.buttonEl.classList[this._enabled?
"remove":"add"]("disabled")}})})();
(function(){var r=netflix.cadmium,n=r.element;r.ui.LoaderProgress=r.ui.Component.extend({_loader:null,rootEl:null,_onLoadStart:function(){this._loader.removeEventListener(this._loader.knownEvents.START_LOAD,this._onLoadStart);this.parentNode.appendChild(this.rootEl);setTimeout(function(){this.initialized&&this._spinnerEl.classList.add(n.classNames.visible)}.bind(this),100)},init:function(m){this._super(m.rootEl,{});this._loader=m;this.rootEl=n.create("div");this._spinnerEl=n.create("div",{"class":"player-progress-loading"},
this.rootEl);this._onLoadStart=this._onLoadStart.bind(this);this._loader.addEventListener(this._loader.knownEvents.START_LOAD,this._onLoadStart)},destroy:function(){this.initialized&&(this.initialized=!1,n.remove(this.rootEl),this._loader&&this._loader.removeEventListener(this._loader.knownEvents.START_LOAD,this._onLoadStart),this.parentNode=this.rootEl=this._spinnerEl=this._loader=null)}});r.ui.LoaderProgress.create=function(m){return new r.ui.LoaderProgress(m)}})();
(function(){var r=netflix.cadmium,n=r.element,m=r.browser,l=r.metadata,c=n.classNames.visible,d=r.ui.LoaderMetadata=r.ui.Component.extend({_backgroundImageEl:null,_backgroundGradientEl:null,_headerEl:null,_descriptionEl:null,_loader:null,rootEl:null,_metadataReadyHandler:function(){this._loader.removeEventListener(this._loader.knownEvents.METADATA_READY,this._metadataReadyHandler);this._attemptPopulateDescription()},_attemptPopulateDescription:function(){var c=l.getActiveVideo();(c=l.getLargestImage(c.stills))?
(this._backgroundImageEl.addEventListener("load",this._populateDescription),this._backgroundImageEl.addEventListener("error",this._populateDescription),this._backgroundImageEl.src=c.url):this._populateDescription()},_populateDescription:function(){var d=l.getMetadata(),g=l.getActiveVideo(),r=l.isShowData(d),k=n.create("h1",{},this._descriptionEl);k.innerHTML=d.video.title;this._backgroundImageEl&&(this._backgroundImageEl.removeEventListener("load",this._populateDescription),this._backgroundImageEl.removeEventListener("error",
this._populateDescription),this._backgroundGradientEl.style.backgroundImage=m.prefix().css+"linear-gradient(top, rgba(0,0,0,.2), rgba(0,0,0,.65)), url("+this._backgroundImageEl.src+")");if(r){var d=l.getActiveSeason(),u=n.create("h2",{},this._descriptionEl);u.innerHTML=netflix.I18n.getWithParams("ce-loading-show-title",["SEASON","EPISODE","TITLE"],[d.seq,g.seq,g.title])}this.parentNode.appendChild(this.rootEl);setTimeout(function(){this.initialized&&(this._headerEl.classList.add(c),this._backgroundGradientEl.classList.add(c),
r?(n.limitLinesOfText(k,{maxLines:2}),n.limitLinesOfText(u,{maxLines:2})):n.limitLinesOfText(k,{maxLines:3}))}.bind(this),500)},init:function(c,d){d=d||{};this._super(c.rootEl,d);this._loader=c;var l=d.initParams||{};this._populateDescription=this._populateDescription.bind(this);this._metadataReadyHandler=this._metadataReadyHandler.bind(this);this.rootEl=n.create("div");this._backgroundImageEl=n.create("img");this._headerEl=n.create("div",{"class":"header-container"},this.rootEl);l.referrerIsNetflix||
(n.create("div",{"class":"logo"},this._headerEl),this._headerEl.classList.add("with-logo"));this._backgroundGradientEl=n.create("div",{"class":"player-loading-background"},this.rootEl);this._descriptionEl=n.create("div",{"class":"description"},this._headerEl);this._loader.addEventListener(this._loader.knownEvents.METADATA_READY,this._metadataReadyHandler)},destroy:function(){this.initialized&&(n.remove(this.rootEl),this.rootEl=null,this._backgroundImageEl&&(this._backgroundImageEl.removeEventListener("load",
this._populateDescription),this._backgroundImageEl.removeEventListener("error",this._populateDescription)),this._descriptionEl=this._headerEl=this._backgroundGradientEl=this.parentNode=this._backgroundImageEl=null,this._loader&&this._loader.removeEventListener(this._loader.knownEvents.METADATA_READY,this._metadataReadyHandler),this._loader=null,r.ui.Component.prototype.destroy.call(this))}});d.create=function(c,g){return new d(c,g)}})();
(function(){var r=netflix.cadmium,n=r.element,m=r.ui.LoaderProgress,l=n.classNames.visible;r.ui.LoaderProgressPrePlay=m.extend({_logoEl:null,_lightingEl:null,_shadowEl:null,_onLoadStart:function(){this._loader.removeEventListener(this._loader.knownEvents.START_LOAD,this._onLoadStart);this.parentNode.appendChild(this.rootEl);setTimeout(function(){this.rootEl.classList.add(l)}.bind(this),1)},init:function(c){this._super(c);this.rootEl.classList.add("preplay-loader-container");this._logoEl=n.create("div",
{id:"logo"},this.rootEl);this._lightingEl=n.create("div",{id:"light"},this.rootEl);this._shadowEl=n.create("div",{id:"shadow"},this.rootEl)},destroy:function(){m.prototype.destroy.call(this);this._shadowEl=this._lightingEl=this._logoEl=null}});r.ui.LoaderProgressPrePlay.create=function(c){return new r.ui.LoaderProgressPrePlay(c)}})();
(function(){var r=netflix.cadmium,n=r.element,m=r.url,l=r.objects,c,d,f=0,g=0,t,k=function(b){b=b||{};var c={method:b.method,xid:l.videoPlayer().getXid(),videoId:l.videoId()};void 0!=b.isIncognito&&(c.on=b.isIncognito,c.seq=f++);var c=m.constructUrl(d,c),a=new XMLHttpRequest,n=function(){2>g?(g++,k(b)):r.ui.popup.showGenericError(netflix.I18n.get("ce-incognito-api-error-title"),netflix.I18n.get("ce-incognito-api-error-text"))};a.onload=function(){var b;try{b=JSON.parse(a.responseText)}catch(c){n()}b&&
"success"==b.result||n()};a.onerror=n;a.open("GET",c,!0);a.withCredentials=!0;a.send()},u=function(b){b=b.target;if(c.contains(b))for(;c.contains(b);b=b.parentNode)if(b.hasAttribute("data-is-incognito")){if(!b.classList.contains("incognito-mode-selected")){var d=b.getAttribute("data-is-incognito");k({isIncognito:d,method:"toggle"});d=c.getElementsByClassName("incognito-mode-selected");0<d.length&&d[0].classList.remove("incognito-mode-selected");b.classList.add("incognito-mode-selected")}break}};r.ui.IncognitoMenuComponent=
r.ui.MenuComponent.extend({createContents:function(){var b=l.initParams().incognitoConfig.mode;c=n.create("ul",{"class":"incognito-options"});n.create("lh",{"class":"incognito-title"},c).appendChild(document.createTextNode(t[b].menuTitle));for(var b=t[b].menuOptions,f=0;f<b.length;f++){var a=n.create("li",{"class":"incognito-option"});a.appendChild(document.createTextNode(b[f].text));a.setAttribute("data-is-incognito",b[f].incognito);!1===b[f].incognito&&a.classList.add("incognito-mode-selected");
c.appendChild(a)}this.menuEl.appendChild(c);this.menuEl.addEventListener("click",u);d=l.initParams().apiUrl+"cbp/incognito";l.videoPlayer().getXid()},destroy:function(){this.menuEl.removeEventListener("click",u);this._super()},init:function(b,c,a){this._super(b,c,a);t={"private":{menuTitle:netflix.I18n.get("ce-incognito-private-menu"),menuOptions:[{text:netflix.I18n.get("ce-incognito-private-on"),incognito:!0},{text:netflix.I18n.get("ce-incognito-private-off"),incognito:!1}]},anonymous:{menuTitle:netflix.I18n.get("ce-incognito-anonymous-menu"),
menuOptions:[{text:netflix.I18n.get("ce-incognito-anonymous-on"),incognito:!0},{text:netflix.I18n.get("ce-incognito-anonymous-off"),incognito:!1}]},history:{menuTitle:netflix.I18n.get("ce-incognito-history-menu"),menuOptions:[{text:netflix.I18n.get("ce-incognito-history-save"),incognito:!1},{text:netflix.I18n.get("ce-incognito-history-hide"),incognito:!0}]}};this.createContents();this.setIncognitoOptions=k}})})();
(function(){var r=netflix.cadmium,n=r.element,m=r.logging,l=r.util.NOOP;r.ui.PIN=r.ui.Component.extend({knownEvents:Object.freeze({COMPLETE:"complete",INPUT:"input"}),containerEl:null,pinEl:null,caretEl:null,pinCells:null,_type:null,_caretOffset:null,_fontSize:null,_caretIncrement:null,_initElements:function(){this.containerEl=n.create("div",{"class":"pin-container",id:this.config.id||null});this.pinEl=n.create("input",{"class":["pin-input",this.config.inputClass||"","type-"+this._type].join(" ")},
this.containerEl);this.pinEl.setAttribute("maxlength",this._pinLength);this.caretEl=n.create("div",{"class":"pin-caret"},this.containerEl);for(var c=0,d;c<this._pinLength;c++)d=n.create("div",{"class":"pin-ui"},this.containerEl),d=n.create("span",{},d),this.pinCells.push(d)},_initHandlers:function(){var c=Rx.Observable.fromEvent(this.pinEl,"keyup"),d=Rx.Observable.fromEvent(this.pinEl,"change"),f=Rx.Observable.fromEvent(this.pinEl,"focus"),g=Rx.Observable.fromEvent(this.containerEl,"click");c.merge(d).takeUntil(this._disposed).map(function(c){return c.preventDefault(),
c.stopPropagation(),this.getValue()}.bind(this)).distinctUntilChanged().doAction(this._inputChangeHandler).subscribe(l,this._rxErrorHandler,l);f.merge(g).takeUntil(this._disposed).doAction(this._clickAndFocusHandler).subscribe(l,this._rxErrorHandler,l)},_updateComputedValues:function(){this._caretOffset=this._caretOffset||parseInt(getComputedStyle(this.caretEl).left);this._fontSize=this._fontSize||parseInt(getComputedStyle(this.pinEl).fontSize);this._caretIncrement=this._caretIncrement||parseInt(getComputedStyle(this.containerEl.querySelector(".pin-ui")).width)},
_inputChangeHandler:function(){var c=this.pinEl.value,d=c.length,f="password"===this._type,g;d===this._pinLength?g=this._caretOffset+(d-1)*this._caretIncrement+this._fontSize:g=this._caretOffset+d*this._caretIncrement;this.caretEl.style.cssText="left: "+g+"px;";this.pinCells.forEach(function(d,g){var l=c.charAt(g);l?d.innerHTML=f?"&#9679":l:d.innerHTML=""});c&&d===this._pinLength?(this.caretEl.classList.add("hide"),this.fireEvent(this.knownEvents.COMPLETE,[c])):(this.caretEl.classList.remove("hide"),
this.fireEvent(this.knownEvents.INPUT,[c]))},_clickAndFocusHandler:function(c){c.preventDefault();this._updateComputedValues();this.focus();this.pinEl.value=this.pinEl.value},_rxErrorHandler:function(c){m.log("component.pin.input",c&&c.stack||c)},focus:function(){return this.pinEl.focus(),this},blur:function(){return this.pinEl&&this.pinEl.blur(),this},clear:function(){return this.pinEl.value="",this._inputChangeHandler(),this},getValue:function(){return this.pinEl&&this.pinEl.value},destroy:function(){this.initialized&&
(this.initialized=!1,this._disposed.onNext(),n.remove(this.containerEl),this.containerEl=null,this.pinCells=null,this.events=null,this._disposed=null)},init:function(c,d){d=d||{};this._super(c,d);this._disposed=new Rx.Subject;this._pinLength=d.pinLength||4;this._type=d.type||"password";this.pinCells=[];this._inputChangeHandler=this._inputChangeHandler.bind(this);this._clickAndFocusHandler=this._clickAndFocusHandler.bind(this);this._initElements();this._initHandlers();c.appendChild(this.containerEl)}})})();
(function(){var r=netflix.cadmium,n=netflix.I18n,m=r.metadata,l=r.xhr,c=r.logging,d=Rx.Observable,f=r.dom.DIV,g,t,k,u=function(){},b=function(a){c.error("error:"+a.stack)},h=function(){this.menuEl.removeChild(g);g=null;this.menuEl.appendChild(f({"class":"completed"},n.get("ce-dontshare-unshared")));m.setMetadataField("video.social.facebook.do_not_share.enabled",!1)},a=function(a){a=m.getMetadata().social.netflix.user.id;a=t.replace("TITLE_ID",m.getActiveVideo().id).replace("USER_ID",a);l.post(a,{withCredentials:!0}).takeUntil(k).doAction(h.bind(this)).retryWithBackoff(5,
1E3).subscribe(u,b,u)},w=function(){g=f({"class":"dont-share-button"},n.get("ce-dontshare-prompt"));k=new Rx.Subject;d.fromEvent(g,"click").takeUntil(k).take(1).doAction(a.bind(this)).subscribe(u,b,u);this.menuEl.appendChild(g)};r.ui.DontShareMenuComponent=r.ui.MenuComponent.extend({init:function(a,b,c){this._super(a,b,c);t=r.objects.initParams().apiUrl+"users/USER_ID/social/titles/TITLE_ID?output=json";w.bind(this)()},destroy:function(){k.onNext();this._super()}})})();
(function(){var r=netflix.cadmium,n,m,l,c,d=r.ui.ExitPlaybackComponent=r.ui.Component.extend({_backToBrowsingEl:null,_rootEl:null,_render:function(){null===this._backToBrowsingEl&&(this._backToBrowsingEl=c({"class":"player-exit-playback icon-player-cancel no-select"}))},destroy:function(){this.initialized&&this._backToBrowsingEl&&(this._backToBrowsingEl.removeEventListener("click",r.ui.master.goBackToBrowsing,!1),n.remove(this._backToBrowsingEl),this._backToBrowsingEl=null);this._super()},init:function(d){this._super(d.rootEl);
this._rootEl=d.rootEl;this._initialized=!0;n=r.element;m=r.objects;l=r.dom;c=l.A;var g=this;m.initParams().inPagePlayer||(this._render(),setTimeout(function(){g.initialized&&(g._rootEl.appendChild(g._backToBrowsingEl),g._backToBrowsingEl.addEventListener("click",r.ui.master.goBackToBrowsing,!1))},17))},getBackToBrowsingEl:function(){return this._backToBrowsingEl}});d.create=function(c,g){return new d(c,g)}})();
(function(){var r=netflix.cadmium,n=r.util,m=r.objects,l=r.dom.DIV,c=r.dom.get("H2"),d=r.element,f=r.Logger.create("cadmium.ui.VideoInterstitialComponent"),g="webkit"===r.browser.prefix().lowercase,t=r.util.NOOP,k=Rx.Observable,u=r.ui.VideoInterstitialComponent=r.ui.Component.extend({_rootEl:null,_videoPlayerWrapperEl:null,_videoTitleEl:null,_videoPlayer:null,_videoDuration:null,_videoCurrentTime:null,_autoPlayTimer:null,_disposed:new Rx.Subject,videoEvents:{INTERSTITIAL_VIDEO_END:"interstitialVideoEnd",
INTERSTITIAL_VIDEO_START:"interstitialVideoStart"},_render:function(){null===this._rootEl&&(this._rootEl=l({"class":"player-video-interstitial",style:"background-image: url("+this.config.background+");"},this._videoPlayerWrapperEl=l({"class":"player-video-interstitial-wrapper"}),this._videoTitleEl=this.config.title&&c({"class":"player-video-interstitial-title"},this.config.title)))},_createEventSubscriptions:function(){this.initialized&&(k.fromEvent(this._videoPlayer,"loaded").takeUntil(this._disposed).doAction(function(){this.fireEvent(this.videoEvents.INTERSTITIAL_VIDEO_START);
this._videoPlayerWrapperEl.style.display="";this._videoDuration=this._videoPlayer.getDuration();this._addChangeListeners()}.bind(this)).subscribe(t,f.getErrorHandler("event|loaded"),t),this._onTransitionEnd=this._onTransitionEnd.bind(this),this.getElement().addEventListener("transitionend",this._onTransitionEnd))},_onTransitionEnd:function(){var b=this.getElement();b.removeEventListener("transitionend",this._onTransitionEnd);b.style.display="none"},_addChangeListeners:function(){var b;g?b=k.fromEvent(this._videoPlayer,
"currenttimechanged").takeUntil(this._disposed).throttle(500).filter(function(){return this._videoCurrentTime=this._videoPlayer.getCurrentTime(),this._videoCurrentTime>=this._videoDuration-1500}.bind(this)).take(1):b=k.fromEvent(this._videoPlayer,"endedchanged").takeUntil(this._disposed).filter(function(){return this._videoPlayer.getEnded()}.bind(this));b.doAction(function(){this._videoPlayerWrapperEl.classList.add("interstitial-video-ended");this.fireEvent(this.videoEvents.INTERSTITIAL_VIDEO_END)}.bind(this)).subscribe(t,
f.getErrorHandler("event|currenttimechanged"),t)},destroy:function(){this._disposed.onNext();d.remove(this._rootEl);this._videoPlayer&&this._videoPlayer.close();this._super()},init:function(b,c){var a=m.videoSession();this._super(b,c);this._initialized=!0;a=n.tryCatch(a.createPlayer,a,[c.videoId,c.trackId||0]);a instanceof Error?f.error(a):(this._render(),this._videoPlayer=a,this._videoPlayerWrapperEl.appendChild(this._videoPlayer.getElement()),this._videoPlayerWrapperEl.style.display="none",this._createEventSubscriptions())},
_prepareForVideoPlayback:function(){this._videoTitleEl&&(this._videoTitleEl.style.display="none");this._rootEl.style.backgroundImage=""},getElement:function(){return this._rootEl},startAutoPlay:function(){var b=this.config.autoPlayTimer||5;this._autoPlayTimer=setTimeout(function(){this._prepareForVideoPlayback();this._videoPlayer.seek(0);this._videoPlayer.load()}.bind(this),1E3*b)},cancelAutoPlay:function(){clearTimeout(this._autoPlayTimer)},hasVideoPlayer:function(){return!!this._videoPlayer}});
u.create=function(b,c){return new u(b,c)}})();(function(){var r=netflix.cadmium,n=r.dom,m=n.DIV,l=n.SPAN,c;r.ui.ReportProblemMenuComponent=r.ui.MenuComponent.extend({init:function(d,f,g){c=netflix.I18n;this._super(d,f,g);this.menuEl.appendChild(m({"class":"report-problem-button"},l(c.get("ce-report-problem-menu"))))},destroy:function(){this._super()}})})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l=r.Logger.create("component.postplay.background"),c=n.extend({init:function(c){this.initialized||(this._super(c),this._rootEl=m.create("div",{"class":"player-postplay-background-image"}),m.create("div",{"class":"player-postplay-background-gradient"},this._rootEl))},destroy:function(){this.initialized&&(l.log("destroy"),m.remove(this._rootEl),this._super())}});Object.defineProperties(c.prototype,{source:{enumerable:!0,get:function(){return this._source},
set:function(c){this._source=c;this._rootEl.style.cssText="background-image: url("+c+");";this.parentNode.contains(this._rootEl)||this.parentNode.appendChild(this._rootEl)}}});c.createFromUrl=function(d,f){var g=new c(d);return g.source=f,g};c.create=function(d){return new c(d)};r.ui.PostPlayBackground=c})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l=r.dom,c=l.get("DIV"),d=l.get("SPAN"),f=l.get("UL"),g=l.get("LI"),t=r.time,k,u=r.Logger.create("component.postplay.bob"),b=n.extend({init:function(b,a){u.log("init");k=netflix.I18n;this._super(b);this._metadata=a;this._createElements()},destroy:function(){u.log("destroy");m.remove(this._rootEl);this._super()},show:function(){this._rootEl.classList.add(m.classNames.active)},hide:function(){this._rootEl.classList.remove(m.classNames.active)},
_createElements:function(){function b(a,c,f){if(a&&f){var h=c&&0<a.length;(h||!c&&""!==a)&&l.appendChild(g({},d({"class":"label"},k.get("ce-post-bob-"+f)+": "),document.createTextNode(h?a.slice(0,2).join(", "):a)))}}var a=this._metadata,l,m=a.duration||{},n;"seconds"===m.unit?n=t.convertUsingKey(m.value,!1,!0,"ce-time"):m.unit&&m.value?n=k.getWithParams("ce-post-bob-duration-"+m.unit+(1<m.value?"-plural":""),["VALUE"],[m.value]):n="";this._rootEl=c({"class":"player-postplay-recommendation-bob"},this._headerEl=
c({"class":"bob-movie-header"},d({"class":"title"},a.title||""),d({"class":"year"},a.year||""),a.rating?d({"class":"mpaa-rating mpaa-"+a.rating},a.rating):null,d({"class":"duration"},n)),c({"class":"bob-movie-content"},a.synopsis||"",c({"class":"info"},l=f({}))));b(a.actors,!0,"actors");b(a.directors,!0,"director");b(a.primaryGenre,!1,"genre");this.parentNode.appendChild(this._rootEl)}});b.create=function(c,a){return new b(c,a)};r.ui.PostPlayBob=b})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l=r.ui.PostPlayBob,c=Rx.Observable,d=r.Logger.create("component.postplay.boxshot"),f=m.classNames.active,g=n.extend({init:function(d,f,g){this.initialized||(this._super(d,g),this._metadata=f,this._templateBuilder=g.template,this._index=g.index,this._eventsObservable=c.empty(),this._createElements(),this._createEventSubscriptions(),d.appendChild(this._rootEl))},destroy:function(){this.initialized&&(d.log("destroy"),m.remove(this._rootEl),
this._super())},getData:function(){return this._metadata},onAction:function(){return this._eventsObservable},setHighlighted:function(c){this._rootEl.classList[c?"add":"remove"](f)},setBobVisibility:function(c){this._bob[c?"show":"hide"]()},_createElements:function(){this._rootEl=this._templateBuilder(this._metadata,this._index);this._bob=l.create(this._rootEl,this._metadata)},_createEventSubscriptions:function(){this.config.events&&this.config.events.forEach(function(d){d=c.fromEvent(this._rootEl,
d).map(function(c){return{instance:this,el:this._rootEl,type:c.type,data:this._metadata,id:this._metadata.id,event:c}}.bind(this));this._eventsObservable=this._eventsObservable.merge(d)},this)}});g.create=function(c,d,f){return new g(c,d,f)};r.ui.BoxShot=g})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.dom.DIV,l=r.ui.Button,c=r.fullscreen,d=r.UiEvents,f,g=Rx.Observable,t=r.util.NOOP,k=r.Logger.create("component.postplay.buttons"),u=n.extend({init:function(b,c){this.initialized||(f=netflix.I18n,this._super(b),this._rootEl=m({"class":c||"action-buttons"}),this._buttons={},this._eventsObservable=g.empty(),this._disposed=new Rx.Subject,b.appendChild(this._rootEl))},destroy:function(){if(this.initialized){k.log("destroy");this._disposed.onNext();
for(var b in this._buttons)this._buttons[b].destroy();this._super()}},addButton:function(b,c){var a=this.getButton(b.id);return a?a:(a=new l(c||this._rootEl,{"class":b.class,contentsEl:b.contentsEl}),a.type=b.type,a.id=b.id,this._buttons[a.id]=a,b.events&&b.events.forEach(function(b){b=g.fromEvent(a,b).map(function(b){return{id:a.id,type:b.type,event:b,component:a}}).takeUntil(this._disposed);this._eventsObservable=this._eventsObservable.merge(b)},this),a)},getButton:function(b){return this._buttons&&
this._buttons[b]},hideButton:function(b){return this._showHideButton(b,!1)},showButton:function(b){return this._showHideButton(b,!0)},onAction:function(){return this._eventsObservable},_showHideButton:function(b,c){var a=this.getButton(b);return a&&a.buttonEl.classList[c?"remove":"add"]("display-none"),a}});u.create=function(b,c,a){var d=new u(b,a);return c.forEach(function(a){d.addButton(a)}),d};u.createBasic=function(b,h){f=netflix.I18n;var a=[{id:"b2bBtn",contentsEl:document.createTextNode(f.get("ce-back-to-browse")),
"class":"back-to-browsing",events:["click"]}];c.isFullscreen()&&a.push({id:"exitFSBtn",contentsEl:document.createTextNode(f.get("ce-post-exit-fullscreen")),"class":"exit-fullscreen",events:["click"]});var l=u.create(b,a,h);return l.onAction().takeUntil(l._disposed).doAction(function(a){switch(a.id){case "b2bBtn":r.ui.master.goBackToBrowsing();break;case "exitFSBtn":r.fullscreen.exit()}}).subscribe(t,k.getErrorHandler("onAction handler"),t),g.fromEvent(d,d.knownEvents.FULLSCREEN_CHANGE).takeUntil(l._disposed).filter(function(a){return!a}).doAction(function(){l.hideButton("exitFSBtn")}).subscribe(t,
k.getErrorHandler("fullscreen change handler"),t),l};r.ui.PostPlayActionButtons=u})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=Rx.Observable,l=r.ui.BoxShot,c=r.util.NOOP,d=r.Logger.create("component.postplay.sims"),f=Object.freeze({hoverover:["mouseover","MSPointerEnter"],hoverout:["mouseout","MSPointerLeave"],click:["click","MSPointerDown"],all:"click MSPointerDown mouseover mouseout MSPointerEnter MSPointerLeave".split(" ")}),g=n.extend({init:function(c,d,f){this.initialized||(this._super(c),this._simList=d,this._template=f,this._sims=[],this._eventsObservable=m.empty(),
this._disposed=new Rx.Subject,this._onHighlightSim=new Rx.Subject,this._activeSim=null,this._createElements(),this._initSubscriptions())},destroy:function(){d.log("destroy");this._disposed.onNext();this._sims.forEach(function(c){c.destroy()});this._super()},getAt:function(c){return this._sims[c]},onHoverOver:function(){return this._getEventObservable("hoverover")},onHoverOut:function(){return this._getEventObservable("hoverout")},onHighlight:function(){return this._onHighlightSim},onClick:function(){return this._getEventObservable("click")},
highlightSimAtIndex:function(c,d){var f=this._sims[c];this._highlightSim(f);d&&this._setBobVisibilityForSim(f,!0)},_highlightSim:function(c){this._activeSim&&this._activeSim.setHighlighted(!1);this._activeSim&&this._setBobVisibilityForSim(this._activeSim,!1);this._activeSim=c;c.setHighlighted(!0);this._onHighlightSim.onNext(c)},_setBobVisibilityForSim:function(c,d){c.setBobVisibility(d)},_getEventObservable:function(c){return function(c){return this._eventsObservable.filter(function(d){return c.some(function(b){return b===
d.type})})}.call(this,f[c]||[])},_createElements:function(){this._simList.forEach(function(c,d){var g=l.create(this.parentNode,c,{events:f.all,template:this._template,index:d});this._sims.push(g);this._eventsObservable=this._eventsObservable.merge(g.onAction())},this)},_initSubscriptions:function(){this.onHoverOver().takeUntil(this._disposed).doAction(function(c){this._highlightSim(c.instance);this._setBobVisibilityForSim(c.instance,!0)}.bind(this)).subscribe(c,d.getErrorHandler("hover over handler"),
c);this.onHoverOut().takeUntil(this._disposed).doAction(function(c){this._setBobVisibilityForSim(c.instance,!1)}.bind(this)).subscribe(c,d.getErrorHandler("hover out handler"),c)}});g.create=function(c,d,f){return new g(c,d,f)};r.ui.PostPlaySimsCollection=g})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l,c=r.Logger.create("component.postplay.timer"),d=Rx.Observable,f=r.util.NOOP,g=n.extend({init:function(c,d){d=d||{};l=netflix.I18n;this._super(c);this._disposed=new Rx.Subject;this._stopped=new Rx.Subject;this._timer=this._startTime=null;this._maxTime=d.maxTime||15;this._pluralTemplate=d.pluralTemplate||function(c){return l.getWithParams("ce-post-autoplay",["SECONDS"],[c])};this._singularTemplate=d.singularTemplate||function(){return l.get("ce-post-autoplay-singular")};
this._stoppedTemplate=d.stoppedTemplate||function(){return""};this._createElements();this._createTimerObservable()},destroy:function(){c.log("destroy");this._disposed.onNext();m.remove(this._rootEl);this._super()},start:function(d){return this._timer.subscribe(f,c.getErrorHandler("timer error"),f),this.onTimerEnd().doAction(d||f).subscribe(f,c.getErrorHandler("timer end"),f),this},stop:function(){this._stopped.onNext();this.parentNode&&(void 0!=this._stoppedTemplate()?this.parentNode.innerHTML=this._stoppedTemplate():
this.parentNode.parentNode&&this.parentNode.parentNode.removeChild(this.parentNode))},onTimerEnd:function(){return this._timer.map(function(c){return 1>=c}).filter(function(c){return c}).delay(1E3).map(function(){return!0})},_createElements:function(){this.parentNode.innerHTML=this._pluralTemplate(this._maxTime)},_createTimerObservable:function(){this._timer=d.interval(1E3).takeUntil(this._disposed).takeUntil(this._stopped).timeInterval().map(function(c){return this._maxTime-c.value}.bind(this)).doAction(this._updateTimer.bind(this)).share()},
_updateTimer:function(c){1<c?this.parentNode.innerHTML=this._pluralTemplate(c):1===c?this.parentNode.innerHTML=this._singularTemplate():this.stop()}});g.create=function(c,d){return new g(c,d)};r.ui.PostPlayTimer=g})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l=r.fullscreen,c=r.UiEvents,d=r.dom,f=d.get("DIV"),g=d.get("SPAN"),t,k=r.Logger.create("component.postplay.exit.fullscreen"),u=r.util.NOOP,b=n.extend({init:function(b){k.log("init");t=netflix.I18n;this._disposed=new Rx.Subject;this._super(b);this._createElements();this._setupSubscriptions()},destroy:function(){k.log("destroy");m.remove(this._rootEl);this._super()},hide:function(){this._rootEl.classList.add("display-none")},show:function(){this._rootEl.classList.remove("display-none")},
_createElements:function(){this._rootEl=f({"class":"exit-fullscreen-button"},g({"class":"exit-fullscreen-text"},t.get("ce-post-exit-fullscreen")),g({"class":"exit-fullscreen-icon"}));this.parentNode.appendChild(this._rootEl)},_setupSubscriptions:function(){Rx.Observable.fromEvent(this._rootEl,"click").takeUntil(this._disposed).take(1).doAction(function(){l.exit();this.hide()}.bind(this)).subscribe(u,k.getErrorHandler("event|click"),u);Rx.Observable.fromEvent(c,c.knownEvents.FULLSCREEN_CHANGE).takeUntil(this._disposed).take(1).doAction(function(b){b?
this.show():this.hide()}.bind(this)).subscribe(u,k.getErrorHandler("event|FULLSCREEN_CHANGE"),u)}});b.create=function(c){c=new b(c);return l.isFullscreen()?c.show():c.hide(),c};r.ui.PostPlayExitFullscreen=b})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.element,l=r.dom.get("DIV"),c=r.dom.get("SPAN"),d,f=r.Logger.create("component.postplay.starbar"),g=Rx.Observable,t=r.xhr,k=r.util.NOOP,u=n.extend({init:function(b,c){c=c||{};d=netflix.I18n;this._titleId=c.id;this._endpoint=c.endpoint;this._apiRevision=c.apiRevision;this._super(b);this._disposed=new Rx.Subject;this._selectedRating=c.value||0;this._createElements();this._createEventSubscriptions();this._resetStars()},destroy:function(){f.log("destroy");
this._disposed.onNext();m.remove(this._rootEl);this._super()},_rateTitle:function(b){if(b===this._selectedRating)return g.empty();f.log("Rating title "+this._titleId+" rating="+b);this._selectedRating=b;this._resetStars();b={withCredentials:!0,urlEncoded:!0,data:{titleid:this._titleId,rating:this._selectedRating}};this._apiRevision&&(b.data.revision=this._apiRevision);b=t.post(this._endpoint,b).takeUntil(this._disposed).timeout(1E4).retryWithBackoff(5,1E3).doAction(function(b){f.log("data received",
b)}).catch(function(){this._resetStars()}.bind(this));return b.subscribe(k,f.getErrorHandler("xhr|rating"),k),b},_resetStars:function(){Array.prototype.slice.call(this._rootEl.querySelectorAll(".postplay-star")).forEach(function(b){var c=parseInt(b.getAttribute("data-id"));b.classList[c>this._selectedRating?"remove":"add"]("selected")},this)},_createElements:function(){this._rootEl=l({"class":"postplay-starbar"},c({"class":"postplay-star-text"},d.get("ce-post-rate")),l({"class":"postplay-starbar-wrapper"},
c({"class":"postplay-star","data-id":"1"}),c({"class":"postplay-star","data-id":"2"}),c({"class":"postplay-star","data-id":"3"}),c({"class":"postplay-star","data-id":"4"}),c({"class":"postplay-star","data-id":"5"})));this.parentNode.appendChild(this._rootEl)},_createEventSubscriptions:function(){g.fromEvent(this._rootEl,"click").takeUntil(this._disposed).doAction(function(b){b=parseInt(b.target.getAttribute("data-id"));isNaN(b)||this._rateTitle(b)}.bind(this)).subscribe(k,f.getErrorHandler("event|click"),
k);g.fromEvent(this._rootEl,"mouseover").takeUntil(this._disposed).doAction(function(b){var c=parseInt(b.target.getAttribute("data-id"));if(!isNaN(c))for(var a=1;5>=a;a++)b.currentTarget.querySelector('.postplay-star[data-id="'+a+'"]').classList[a<=c?"add":"remove"]("selected")}).subscribe(k,f.getErrorHandler("event|mouseover"),k);g.fromEvent(this._rootEl,"mouseout").takeUntil(this._disposed).filter(function(b){return!this._rootEl.querySelector(":hover")}.bind(this)).doAction(this._resetStars.bind(this)).subscribe(k,
f.getErrorHandler("event|mouseout"),k)}});u.create=function(b,c){return new u(b,c)};r.ui.PostPlayStarbar=u})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.ui.PostPlayStarbar,l=r.dom,c=l.get("DIV"),d=l.get("IMG"),f=l.get("P"),g,t=r.Logger.create("component.postplay.horizontal"),k=n.extend({init:function(c,b){b=b||{};g=netflix.I18n;this._super(c);this._metadata=b;this._starbar=null;this._createElements()},destroy:function(){t.log("destroy");this._starbar&&this._starbar.destroy();this._super()},_createElements:function(){var k=this._metadata||{};this._rootEl=c({"class":"trailer-horizontal trailer-merch"},
this._wrapperEl=c({"class":"trailer-horizontal-wrapper"},this._imageEl=d({"class":"trailer-horizontal-image"}),c({"class":"trailer-replay"},f({"class":"trailer-replay-icon"}),f({"class":"trailer-replay-text"},g.get("ce-post-replay-trailer")))));k.horizontal?this._imageEl.setAttribute("src",k.horizontal):this._imageEl.style.minHeight="22.5em";k.userRating&&(this._starBar=m.create(this._rootEl,k.userRating));this.parentNode.appendChild(this._rootEl)}});k.create=function(c,b){return new k(c,b)};r.ui.PostPlayHorizontal=
k})();
(function(){var r=netflix.cadmium,n=r.ui.Component,m=r.objects,l=r.element,c=r.url,d,f=r.Logger.create("component.postplay.mylist"),g=Rx.Observable,t=r.xhr,k=r.util.NOOP,u=n.extend({init:function(b,c){c=c||{};d=netflix.I18n;this._myList=c.myList;this._trackId=c.trackId;this._element=c.element;this._disposed=new Rx.Subject;this._myListRequest=this._myListAction=null;this._super(b)},destroy:function(){f.log("destroy");this._disposed.onNext();l.remove(this._rootEl);this._super()},toggleMyList:function(){if(this._myListRequest)return this._myListRequest;var b=
this._myList;return b&&b.endpoint?(this._myListRequest=g.defer(function(){return this._myListAction||(this._myListAction="save"===b.action?"add":b.action),g.return(this._myListAction)}.bind(this)).map(function(b){return{action:b,xaction:this._getXAction(b)}}.bind(this)).doAction(function(b){f.log("My List action",b);this._updateUI(b.xaction)}.bind(this)).flatMap(this._makeXhr.bind(this)).doAction(function(b){this._myList.action=this._myListAction=b.xaction;this._myListRequest=null}.bind(this)).catch(function(){this._myListRequest=
null}.bind(this)),this._myListRequest.subscribe(k,f.getErrorHandler("xhr|mylist"),k),this._myListRequest):g.throw("Nothing to add; my list is not defined.")},_getXAction:function(b){var c;return"save"===b||"add"==b?c="remove":c=this._myList.addAction,c},_makeXhr:function(b){return t.post(this._myList.endpoint,{withCredentials:!0,urlEncoded:!1,data:{action:b.action,videoId:this._myList.id,trackId:this._trackId}}).takeUntil(this._disposed).timeout(1E4).retryWithBackoff(3,1E3).map(function(c){f.log("My list response",
c);c=c||{};if(!c.status||"success"!==c.status.toLowerCase())throw Error(c);return c.xaction=b.xaction,c}.bind(this))},_updateUI:function(b){!this._element||"add"!==b&&"remove"!==b&&"save"!==b||(this._element.textContent=d.get("ce-post-"+b+"-to-my-list"))}});u.create=function(b,c){return new u(b,c)};u.getCurrentState=function(b){b=b||{};var d=m&&m.initParams()||{},a={withCredentials:!0,urlEncoded:!0,data:{action:"get",videoId:b.id}};return"prod"!==d.environment&&(a.data.forcepromo=c.urlContains(/forcepromo=true/)),
t.get(b.endpoint,a)};r.ui.PostPlayMyList=u})();(function(){netflix.cadmium.mixins.ui.buttons={MY_LIST_BUTTON:"save-to-list",MORE_INFO_BUTTON:"more-info",getMyListButton:function(r){return{id:"save-to-list",contentsEl:document.createTextNode(netflix.I18n.get("ce-post-"+r+"-to-my-list")),"class":"my-list",events:["click"]}},getMoreInfoButton:function(){return{id:"more-info",contentsEl:document.createTextNode(netflix.I18n.get("ce-post-more-info")),"class":"more-info",events:["click"]}}}})();
(function(){var r=netflix.cadmium;r.mixins.ui.videoInterstitial={addVideoInterstitialComponent:function(n){this._interstitial=this._addComponent(r.ui.VideoInterstitialComponent.create(this._parentEl,n));this._interstitial.hasVideoPlayer()?(this._rootEl.style.display="none",this._parentEl.appendChild(this._interstitial.getElement()),this._interstitial.startAutoPlay()):(this._interstitial.destroy(),this._interstitial=null)},_handleInterstitialReturnToPlayback:function(){this._interstitial&&this._interstitial.cancelAutoPlay()},
_onInterstitialTransitionEnd:function(){this._interstitial.getElement().removeEventListener("transitionend",this._onInterstitialTransitionEnd);this._interstitial.removeEventListener(this._interstitial.videoEvents.INTERSTITIAL_VIDEO_START,this._onInterstitialVideoStart);this._interstitial.removeEventListener(this._interstitial.videoEvents.INTERSTITIAL_VIDEO_END,this._onInterstitialVideoEnd);this._interstitial.destroy()},_onInterstitialVideoStart:function(){this._videoPlayer&&this._videoPlayer.close();
r.UiEvents.fireEvent(r.UiEvents.knownEvents.VIDEO_ENDED);r.ui.exitPlayback.init(this._parentEl)},_onInterstitialVideoEnd:function(){var n=this._interstitial.getElement();this._rootEl.style.display="";n.addEventListener("transitionend",this._onInterstitialTransitionEnd);r.ui.exitPlayback.deinit()},createVideoInterstitialEvents:function(){this._interstitial&&(this._onInterstitialTransitionEnd=this._onInterstitialTransitionEnd.bind(this),this._onInterstitialVideoStart=this._onInterstitialVideoStart.bind(this),
this._onInterstitialVideoEnd=this._onInterstitialVideoEnd.bind(this),this._interstitial.addEventListener(this._interstitial.videoEvents.INTERSTITIAL_VIDEO_START,this._onInterstitialVideoStart),this._interstitial.addEventListener(this._interstitial.videoEvents.INTERSTITIAL_VIDEO_END,this._onInterstitialVideoEnd))}}})();
netflix.cadmium.ui.exitPlayback=function(){function r(){n&&(n=!1,l&&(l.removeEventListener("click",d.ui.master.goBackToBrowsing,!1),g.remove(l),l=null),t.removeEventListener(t.knownEvents.CINEMA_MODE_ENTER,u),t.removeEventListener(t.knownEvents.CINEMA_MODE_EXIT,b),t.removeEventListener(t.knownEvents.SHOW_AUTOPLAY_INTERRUPTER,u),t.removeEventListener(t.knownEvents.HIDE_AUTOPLAY_INTERRUPTER,b),m=null,l=null,c=null,d=null,f=null,g=null,t=null,k=null)}var n=!1,m,l=null,c,d,f,g,t,k,u=function(){l&&d.animate.fadeOut(l)},
b=function(){l&&d.animate.fadeIn(l)};return{init:function(h){n&&r();n=!0;m=h;d=netflix.cadmium;f=netflix.I18n;g=d.element;t=d.UiEvents;k=d.objects;k.initParams().inPagePlayer||(m.appendChild((null===l&&(c=g.create("p"),c.appendChild(document.createTextNode(f.get("ce-back-to-browse"))),l=g.create("a",{"class":"player-back-to-browsing no-select icon-player-back-to-browse"}),l.appendChild(c)),l)),l.addEventListener("click",d.ui.master.goBackToBrowsing,!1));t.addEventListener(t.knownEvents.CINEMA_MODE_ENTER,
u);t.addEventListener(t.knownEvents.CINEMA_MODE_EXIT,b);t.addEventListener(t.knownEvents.SHOW_AUTOPLAY_INTERRUPTER,u);t.addEventListener(t.knownEvents.HIDE_AUTOPLAY_INTERRUPTER,b)},deinit:r,getBackToBrowsingEl:function(){return l}}}();
netflix.cadmium.ui.master=function(){function r(){try{return"akira"===D.initParams().uimode}catch(a){return!1}}function n(){return ba=!1,netflix.cadmium.fullscreen&&netflix.cadmium.fullscreen.isFullscreen()&&(window.location=window.location),Rx.Observable.create(function(b){function c(){w&&w.views.deinit();b.onNext(!0);b.onCompleted();A&&A.fireEvent(A.knownEvents.SHUTDOWN);f()}a&&(q.remove(a),a=null);return B?B.close(c):c(),T})}function m(){t&&(B=D.videoPlayer(),A.removeEventListener(F.NEW_PLAYER_CREATED,
m),y.log("new player created, appending element to dom"),h.appendChild(B.getElement()),A.fireEvent(F.NEW_PLAYER_DOM_CREATED))}function l(){t&&ba&&(w.views.show(w.ui.shutdown,[b]),n().doAction(f).subscribe(T,y.getErrorHandler("beforeUnload"),T))}function c(a){if(!/debug=true/.test(window.location.search))return a.preventDefault(),!1}function d(a){y.log("postplayEnterHandler, ev:",a);a=D.playerWrapper();w.ui.PostPlay.preinit(a)}function f(c){if(t){t=!1;y.log("deinit");w.ui.playback.deinit();q.remove(h.childNodes);
E.deinit();w.playbackEvents.deinit();L.deinit();w.removeBeforeUnloadHandler(l);A.removeEventListener(F.VIDEO_POSTPLAY_ENTER,d);c||(q.remove(b),b=null,h=null,x.clear(),A.destroy(),J.deinit(),netflix.cadmium.PostPlayData.deinit(),netflix.cadmium.playbackShutdown&&netflix.cadmium.playbackShutdown.onNext());try{netflix.player.diag.togglePanel("log",!1)}catch(f){}D.drain(c);G=J=E=H=B=D=F=A=x=p=q=y=a=u=k=null;ba=N=!1}}function g(g,n,B){t&&f(!0);var N,sa;w=netflix.cadmium;x=w.metadata;y=w.Logger.create("view.master");
q=w.element;A=w.UiEvents;F=A.knownEvents;D=w.objects;H=w.browser;p=w.url;E=w.sizing;k=g||document.body;J=w.session;G=w.ui.errors;T=w.util.NOOP;L=w.fullscreen;y.log("init");w.unloadActions.init();w.ui.fatal.listenForFatalErrors();if(n){n.breakOnError=!1;void 0==n.enableTrickPlay&&(n.enableTrickPlay=!0);w.playbackEvents.init();L.init();J.init();try{N=netflix.clientNotifications.getCurrentSession("appSession").sessionId,sa=netflix.clientNotifications.getCurrentSession("userSession").sessionId,n.isBladerunner?
(n.appId=N,n.sessionId=sa):(n.nccpAppId=N,n.nccpSessionId=sa)}catch(oa){}n.disableVideoRightClickMenu=!1;g=p.getNextVideo();if(g.episodeId||g.videoId)delete n.videoId,delete n.movieId,delete n.episodeId,B=g.videoId?null:B,w.util.mix(g,n);g=n.episodeId||n.movieId||n.videoId||-1;n.recap&&n.recap.hasPlayed&&delete n.recap;(N=p.getQueryString().ad)&&(n.assistiveAudioPreferred="true"===N);D.setInitParams(n);N=parseInt(p.getQueryString()[p.CONSTANTS.BOOKMARK],10);isNaN(N)||D.overrideBookmark(g,1E3*N);D.createVideoSession();
if(!a){sa=document.getElementsByTagName("head")[0];N=0;a=document.createElement("style");a.appendChild(document.createTextNode(""));sa.appendChild(a);sa=a.sheet;if("webkit"===H.prefix().lowercase&&0>window.navigator.userAgent.indexOf("Edge/"))try{sa.insertRule("::-webkit-scrollbar { background-color: #262626; border-left: 1px solid black; width: 1.5em; }",N++),sa.insertRule("::-webkit-scrollbar-thumb { background: -webkit-linear-gradient(top, #ccc 0%, #aaa 100%); border-left: 1px solid black; border-radius: .3em; }",
N++)}catch(Aa){y.info(Aa)}try{sa.insertRule("body { background-color: #000; }",N++)}catch(da){y.info(da)}}null===b&&(N=H.prefix(),u=q.create("section",{id:"netflix-player-font-wrapper"}),b=q.create("section",{id:"netflix-player","class":N&&N.css?"ua"+N.css:""},u),h=q.create("div",{"class":"player-video-wrapper player-hidden"},b),k.appendChild(u),D.setPlayerWrapper(b),b.addEventListener("contextmenu",c));E.init(b);1>=n.movieId||1>=n.videoId?G.throwUIError(G.type.UI_TITLE_UNAVAILABLE):(B?x.setMetadata(g,
B):x.retrieveData(g),B=x.getActiveVideo()||{},w.ui.preplay.preplayNeeded()||w.clips.getClipValues(B.id)||A.addEventListener(F.VIDEO_POSTPLAY_ENTER,d),ba=t=!0,A.addEventListener(F.NEW_PLAYER_CREATED,m),netflix.cadmium.addBeforeUnloadHandler(l),r()&&(document.cookie="profilesNewSession=0; domain=.netflix.com; path=/;max-age=100000000;"),w.views.show(w.ui.loader.create(n),[b,n]))}}"use strict";var t=!1,k=null,u=null,b=null,h=null,a=null,w,y,q,p,x,A,F,D,B,H,E,J,G,L,N=!1,T,ba=!1;return{init:g,deinit:f,
updateInitParams:function(a,b){D&&D.setPlayContext(b);g(k,a)},goBackToBrowsing:function(){if(t){w&&w.views&&w.views.show(w.ui.shutdown,[b]);var a=D&&D.initParams()&&D.initParams().referrerIsNetflix;r()&&a?window.history.back():window.location.replace(D.initParams().backToBrowsingUrl)}},toggleMdxMode:function(a,c){if(a&&!N){N=!0;B.close();b.classList.add("player-mdx-mode");var d=D.videoId();netflix.mdx.ui.master.init(d);netflix.mdx.ui.master.showState(c,"loading",d)}else!a&&N&&(N=!1,netflix.mdx.ui.master.hide(),
g(k,D.initParams(),w.metadata.getMetadata()),b.classList.remove("player-mdx-mode"))},isAkira:r,shutdown:n}}();
netflix.cadmium.ui.fatal=function(){function r(b,c){var d=!1,h;return b&&0<b.length&&b.some(function(b){h=c+b+"-phone";d=a.getWithParams(h,f,g);if(""===d||0<=d.indexOf(h))d=a.getWithParams(c+b,f,g);return""!==d&&!/---.*---/.test(d)&&!/{.*}/.test(d)}),d=-1<d.indexOf("MISSINGRESOURCE")?"":d,d||a.get(c+"default")}function n(c){if(null===d){d=b.create("section",{"class":"player-fatal-message"});var f=r(c.messageIdList,"ce-head-"),g,h=a.get("ce-support-text"),l="",m="-1",n=k.initParams().hideSupportUrl;
c.display&&(m=a.getWithParams("ce-head-code",["CODE"],[c.display.code||m]),g=c.display.code||m,l=k.initParams().errorSupportUrls||{},l=l[g]?"https://help.netflix.com/support/"+l[g]:"",g=c.display.text?c.display.text:r(c.messageIdList,"ce-text-"));c="";!n&&""!==l&&""!==h&&(c="<p class='player-help-center'>"+h+"<a href='"+l+"'>"+l+"</a></p>");d.innerHTML="<h1>"+a.get("ce-header")+"</h1><h2>"+f+"</h2><p>"+g+"</p>"+c+"<h3>"+m+"</h3>"}return d}function m(){function a(b,c){c&&(f.push(b),g.push(c))}var b=
k.initParams(),c=b.supportPhoneNumber,d=b.signoutUrl,b=b.chromeVersion,h=k&&k.getCountry().toUpperCase();a("PHONE",c);a("SIGNOUT_URL",d);a("CHROME_VERSION",b);a("ISO",h)}function l(){t.views.show(t.ui.fatal,[k.videoPlayer().getError()])}"use strict";var c,d=null,f=[],g=[],t=netflix.cadmium,k=t.objects,u=t.UiEvents,b=t.element,h=t.url,a;return{init:function(b){c=k.playerWrapper();a=netflix.I18n;m();c.appendChild(n(b));var d=netflix.clientNotifications;if(d){var f=h.getHash(h.CONSTANTS.EPISODE_ID),
g=h.getHash(h.CONSTANTS.VIDEO_ID),l=k.videoId(),r=h.getQueryString(),r=parseInt(r.movieid);b={category:"uiQOE",modalView:"errorDialog",data:{playable:l||-1,requested:isNaN(r)?-1:r,h_episode:f||-1,h_video:g||-1,code:b&&b.display&&b.display.code||-1,core:k.videoPlayer()&&k.videoPlayer().getAdditionalLogInfo()||"na"}};d.notify("uiModalViewChanged",b);d.flushBuffer&&d.flushBuffer()}t.ui.exitPlayback.init(c)},listenForFatalErrors:function(){u.addEventListener(u.knownEvents.NEW_PLAYER_CREATED,function y(){k.videoPlayer().addEventListener("error",
l);u.removeEventListener(u.knownEvents.NEW_PLAYER_CREATED,y)});u.addEventListener(u.knownEvents.ERROR,function q(a){t.views.show(t.ui.fatal,[a]);u.removeEventListener(u.knownEvents.ERROR,q)})}}}();netflix.cadmium.views.register(netflix.cadmium.ui.fatal,netflix.cadmium.views.types.fatal);
(function(){var r=netflix.cadmium,n=r.element,m=r.ui.Component.extend({_rootClassName:"player-shutdown",_initDOM:function(){this.rootEl=n.create("div",{"class":this._rootClassName},this.parentNode);this._logoEl=n.create("div",{id:"logo"},this.rootEl);this._lightingEl=n.create("div",{id:"light"},this.rootEl);this._shadowEl=n.create("div",{id:"shadow"},this.rootEl)},_show:function(){this.parentNode.appendChild(this.rootEl);setTimeout(function(){this.rootEl.classList.add(n.classNames.visible)}.bind(this),
1)},init:function(l){l&&(this._super(l,{}),this._initDOM(),this._show())}});r.ui.shutdown=function(){var l=new m;return{init:l.init.bind(l)}}();r.views.register(r.ui.shutdown,r.views.types.fatal)})();netflix.cadmium.ui.mdx.playback=function(){function r(){!n}var n=!1,m,l,c;return{init:function(d){n&&r();n=!0;m=netflix.cadmium;l=m.objects;c=m.logging;c.log("view.mdx.playback.init",d,n);d=l.videoPlayer();d.getPaused()?d.play():d.pause()},deinit:r}}();
netflix.cadmium.views.register(netflix.cadmium.ui.mdx.playback,netflix.cadmium.views.types.standard);
netflix.cadmium.ui.autoplayInterrupter=function(){function r(){F.info("Reset count.");T={}}function n(){t&&(u=N.getCurrentTime(),u>=h&&g())}function m(){F.log("Continue playing.");c();f()}function l(){F.log("Play from beginning.");N.seek(0);c();f()}function c(){N.removeEventListener("currenttimechanged",n);N.play();r()}function d(){if(null===w){w=B.create("div",{"class":"player-autoplay-interrupter no-select"});var a=L(L({"class":"nf-icons icon-player-play"}),H.get("ce-post-break-continue"));y=new D.ui.Button(w,
{"class":"continue-playing",contentsEl:a});y.addEventListener(y.knownEvents.CLICK,m);a=L(L({"class":"nf-icons icon-player-prev-episode"}),H.get("ce-post-break-restart"));q=new D.ui.Button(w,{"class":"continue-playing",contentsEl:a});q.addEventListener(q.knownEvents.CLICK,l);a=L(L({"class":"nf-icons icon-player-cancel"}),H.get("ce-post-break-back-to-browse"));p=new D.ui.Button(w,{"class":"continue-playing",contentsEl:a});p.addEventListener(p.knownEvents.CLICK,D.ui.master.goBackToBrowsing)}return w}
function f(){t&&(F.log("deinit"),t=!1,w&&(y&&(y.removeEventListener(y.knownEvents.CLICK,m),y.destroy()),q&&(q.removeEventListener(q.knownEvents.CLICK,l),q.destroy()),p&&(p.removeEventListener(p.knownEvents.CLICK,D.ui.master.goBackToBrowsing),p.destroy()),a.classList.remove(x),B.remove(w),N&&N.removeEventListener("currenttimechanged",n),J.fireEvent(J.knownEvents.HIDE_AUTOPLAY_INTERRUPTER)),k=null,u=null,a=null,w=null,y=null,q=null,p=null,x=null,A=null,D=null,B=null,H=null,E=null,J=null,G=null,L=null,
N=null)}function g(){N.pause();a.classList.add(x);a.appendChild(d());requestAnimationFrame(function(){w.classList.add(A);J.fireEvent(J.knownEvents.SHOW_AUTOPLAY_INTERRUPTER)})}"use strict";var t=!1,k=!1,u,b,h,a,w,y,q,p,x,A,F=netflix.cadmium.Logger.create("subview.autoplay.interrupter"),D,B,H,E,J,G,L,N,T;return netflix.cadmium.UiEvents.addEventListener(netflix.cadmium.UiEvents.knownEvents.AUTOPLAY_NEXT_EPISODE,function(a){F.log("setNextVideoIsAutoplay for id",a);T=T||{};a&&(T[a]=!0);k=!0}),netflix.cadmium.UiEvents.addEventListener(netflix.cadmium.UiEvents.knownEvents.VIDEO_FIRST_PLAY,
function(){k?(k=!1,Object.keys(T||{}).length>=b&&(N=netflix.cadmium.objects.videoPlayer(),N&&N.addEventListener("currenttimechanged",n))):r();F.log("Autoplay count "+Object.keys(T||{}).length)}),{init:function(c){t&&f();k=!1;x="player-autoplay-interrupter-mode";A="show-autoplay-interrupter";D=netflix.cadmium;B=D.element;H=netflix.I18n;E=D.objects;J=D.UiEvents;G=D.dom;L=G.SPAN;F.log("init");b=E.initParams().maxConsecutiveAutoplays||2;h=E.initParams().autoplayInterrupterTimestamp||12E4;t=!0;a=c},deinit:f}}();
netflix.cadmium.ui.trickplayPreview=function(){function r(){function a(b){if(y){var c=q.classList.contains(d);b&&c&&(q.classList.remove(d),D=null);!b&&!c&&(q.classList.add(d),D=null);b=v.relativePosition-1;c=D||J.getDimensions(q).w;q.style.left=Math.floor(b-c/2)+"px";F.style.left=Math.floor(b)+"px"}}if(y){var b=Aa+v.value,c=1E3*E.getFloored(b),d="no-preview";x.nodeValue=E.convert(b);H.setImageTagSourceAtTime(A,c,a)}}function n(a){a=a?"add":"remove";q.classList[a](db);F.classList[a](db);window.requestAnimationFrame(r)}
function m(){D=J.getDimensions(q).w}function l(a){q.contains(a.target)||(v=a.component.pointerEventData.drag.current,n(!1))}function c(a){a.dragging&&(v=a.pointerEventData.drag.current,n(v.animate))}function d(a){v=a.pointerEventData.drag.current;n(v.animate);F.classList.add(Ma);q.classList.add(Ma);window.requestAnimationFrame(function(){y&&(F.classList.add(C),q.classList.add(C),N.fireEvent(N.knownEvents.SHOWN_TRICKPLAY_PREVIEW))})}function f(a){var b=a.component;q.contains(a.target)?g(a):(v=b.pointerEventData.drag.current,
n(!1))}function g(a){window.clearTimeout(K);D=null;K=window.setTimeout(b,Y)}function t(a){window.clearTimeout(K);v=a.component.pointerEventData.drag.current;D=J.getDimensions(q).w;K=window.setTimeout(u,Y)}function k(a){var b=T.getPaused();if(F.classList.contains(C)||a.pointerType===Q.touch)v=a.component.pointerEventData.drag.current,T.seek(1E3*v.value),b||T.play(),t(a)}function u(){y&&(window.clearTimeout(K),n(!1),F.classList.add(Ma),q.classList.add(Ma),window.requestAnimationFrame(function(){y&&
(F.classList.add(C),q.classList.add(C),N.fireEvent(N.knownEvents.SHOWN_TRICKPLAY_PREVIEW))}))}function b(){y&&(window.clearTimeout(K),F.classList.remove(C),q.classList.remove(C),Qa.fromEvent(q,"transitionend").takeUntil(sa).filter(function(a){return"opacity"===a.propertyName}).take(1).doAction(function(){q.classList.contains(C)||(F.classList.remove(Ma),q.classList.remove(Ma),N.fireEvent(N.knownEvents.HIDDEN_TRICKPLAY_PREVIEW))}).subscribe(oa,V.getErrorHandler("event|transitionend"),oa))}function h(){da=
L.getActiveVideo();var a=ba.getClipValues(da.id);Aa=a&&a.start/1E3||0}function a(){function a(b,c,d){return Qa.fromEvent(b,c).takeUntil(sa).doAction(d)}var b=la.knownEvents,p=Qa.merge(a(la,b.MOUSE_ENTER,t),a(la,b.MOUSE_MOVE,f),a(la,b.MOUSE_LEAVE,g),a(la,b.DRAG_START,m),a(la,b.NEW_VALUE,c),a(la,b.DRAG_END,l),a(la,b.CLICK,k)),n=Qa.fromEvent(la,b.NEW_VALUE),q=Qa.fromEvent(N,N.knownEvents.DRAG_MODE_ENTER),r=Qa.fromEvent(N,N.knownEvents.KEYBOARD_SEEK_ENTER);q.startWith(null).takeUntil(sa).flatMap(function(){return p.takeUntil(r)}).subscribe(oa,
V.getErrorHandler("uievent|DRAG_MODE_ENTER"),oa);r.takeUntil(sa).flatMap(function(){return n.takeUntil(q).throttle(10)}).doAction(d).subscribe(oa,V.getErrorHandler("uievent|KEYBOARD_SEEK_ENTER"),oa);Qa.fromEvent(N,N.knownEvents.CINEMA_MODE_ENTER).takeUntil(sa).doAction(g).subscribe(oa,V.getErrorHandler("uievent|CINEMA_MODE_ENTER"),oa);Qa.fromEvent(N,N.knownEvents.METADATA_LOADED).merge(Qa.return(da&&da.id===G.videoId())).takeUntil(sa).filter(function(a){return!!a}).doAction(h).subscribe(oa,V.getErrorHandler("uievent|METADATA_LOADED"),
oa)}function w(){y&&(y=!1,sa.onNext(),window.clearTimeout(K),J.remove([F,q]),q=null,p=null,x=null,A=null,F=null,D=null,B=null,H=null,E=null,J=null,G=null,L=null,N=null,T=null,ba=null,Q=null,V=null,la=null,sa=null,oa=null,da=null,v=null,K=null,db=null,Ma=null,C=null)}"use strict";var y=!1,q,p,x,A,F,D=null,B,H,E,J,G,L,N,T,ba,Q,V,la,Qa=Rx.Observable,sa,oa,Aa=0,da,v={value:null,relativePosition:null,absolutePosition:null,wrapperDimensions:null},K=null,Y=300,db,Ma,C;return{init:function(b){y&&w();y=!0;
B=netflix.cadmium;H=B.trickplay;E=B.time;J=B.element;G=B.objects;N=B.UiEvents;L=B.metadata;ba=B.clips;T=G.videoPlayer();Q=B.browser.pointerTypes;V=B.Logger.create("subview.trickplay.preview");db=J.classNames.animate;Ma=J.classNames.visible;C=J.classNames.active;oa=B.util.NOOP;v={value:null,relativePosition:null,absolutePosition:null,wrapperDimensions:null};sa=new Rx.Subject;Aa=0;la=B.ui.scrubber.getScrubberComponent();da=L.getActiveVideo();B.ui.scrubber.getLabelEl();A=null;p=J.create("time");x=p.appendChild(document.createTextNode("0"));
q=J.create("section",{"class":"trickplay-preview no-preview"});q.appendChild(p);la.wrapperEl.appendChild(q);F=J.create("div",{"class":"trickplay-position"},la.progressEl);null!==A&&J.remove(A);A=J.create("img",{"class":"trickplay-image"},q);a()},deinit:w,hideTrickplayPreview:b}}();
netflix.cadmium.ui.scrubber=function(){function r(a,b){y&&q&&b&&A.update(ba,a.duration,a.buffer)}function n(){if(y){var a=J.getCurrentTime()/1E3,b=J.getBufferedTime()/1E3;!A.dragging&&N&&a!==ba&&(ba=a,a={currentTime:a,duration:J.getDuration()/1E3,buffer:b},r(a,!0),y&&(x.firstChild.nodeValue=D.convert(a.duration-ba),Q&&Q===a.duration||(Q=a.duration,x.classList[Q>V?"add":"remove"]("player-long-title"))))}}function m(a){r({currentTime:a.value,duration:a.max},!1)}function l(){A.snapbackDragEl.classList.add(B.classNames.active);
N||(N=!0,H.fireEvent(H.knownEvents.DRAG_MODE_ENTER));H.fireEvent(H.knownEvents.DRAG_START_SCRUBBER)}function c(a,b){J.seek(1E3*b.value);b.pointerEventData.playing&&J.play();A.snapbackDragEl.classList.remove(B.classNames.active);H.fireEvent(H.knownEvents.DRAG_FINISH_SCRUBBER)}function d(){p.classList.add(T)}function f(){p.classList.remove(T)}function g(){q=!1}function t(){q=!0;n()}function k(a){J.getPaused()||J.pause();setTimeout(function(){A.incrementScrubberPosition(a);N&&(H.fireEvent(H.knownEvents.KEYBOARD_SEEK_ENTER),
N=!1);A.fireEvent(A.knownEvents.NEW_VALUE,[A])},1)}function u(){k(L)}function b(){k(-1*L)}function h(){J.getPaused()||N||(J.seek(1E3*A.value),N=!0,H.fireEvent(H.knownEvents.DRAG_MODE_ENTER),la.hideTrickplayPreview())}function a(){A.incrementScrubberPosition(0);A.fireEvent(A.knownEvents.NEW_VALUE,[A])}function w(){y&&(la.deinit(),A.destroy(),A.removeEventListener(A.knownEvents.NEW_VALUE,m),A.removeEventListener(A.knownEvents.DRAG_END,c),A.removeEventListener(A.knownEvents.DRAG_START,l),H.removeEventListener(H.knownEvents.SHOW_MENU,
d),H.removeEventListener(H.knownEvents.HIDE_MENU,f),H.removeEventListener(H.knownEvents.CINEMA_MODE_ENTER,g),H.removeEventListener(H.knownEvents.CINEMA_MODE_EXIT,t),H.removeEventListener(H.knownEvents.WINDOW_RESIZE,a),J.removeEventListener("currenttimechanged",n),J.removeEventListener("durationchanged",n),J.removeEventListener("bufferedtimechanged",n),G.removeEventListener(G.knownEvents.SEEK_FORWARD,u),G.removeEventListener(G.knownEvents.SEEK_BACKWARD,b),J.removeEventListener("pausedchanged",h),B.remove(x),
p=null,x=null,A=null,F=null,D=null,B=null,H=null,E=null,J=null,G=null,T=null,ba=0,la=null,y=!1,Q=!1)}"use strict";var y=!1,q=!0,p=null,x=null,A,F,D,B,H,E,J,G,L=10,N=!0,T,ba=0,Q=!1,V=36E5,la;return{init:function(k){y&&w();y=!0;p=k;F=netflix.cadmium;H=F.UiEvents;B=F.element;D=F.time;E=F.objects;G=F.keyboard;J=E.videoPlayer();T=B.classNames.hidden;x=B.create("label",{},p);x.appendChild(document.createTextNode(0));A=new F.ui.ScrubberComponent(p);la=F.ui.trickplayPreview;la.init(p);A.addEventListener(A.knownEvents.NEW_VALUE,
m);A.addEventListener(A.knownEvents.DRAG_START,l);A.addEventListener(A.knownEvents.DRAG_END,c);H.addEventListener(H.knownEvents.SHOW_MENU,d);H.addEventListener(H.knownEvents.HIDE_MENU,f);H.addEventListener(H.knownEvents.CINEMA_MODE_ENTER,g);H.addEventListener(H.knownEvents.CINEMA_MODE_EXIT,t);H.addEventListener(H.knownEvents.WINDOW_RESIZE,a);G.addEventListener(G.knownEvents.SEEK_FORWARD,u);G.addEventListener(G.knownEvents.SEEK_BACKWARD,b);J.addEventListener("pausedchanged",h);J.addEventListener("currenttimechanged",
n);J.addEventListener("durationchanged",n);J.addEventListener("bufferedtimechanged",n);r({currentTime:J.getCurrentTime()/1E3,buffer:J.getBufferedTime()/1E3,duration:J.getDuration()/1E3},!0)},deinit:w,getLabelEl:function(){return x},getScrubberComponent:function(){return A}}}();
netflix.cadmium.ui.longpause=function(){function r(){var a=g.getMetadata();A=y("div",{"class":"playback-longpause-container opacity-transparent display-none player-hidden"});y("div",{"class":"fade-overlay"},A);F=y("div",{"class":"content"},A);y("p",{id:"p-label"},A).textContent=h.get("ce-long-pause-paused");y("p",{id:"yw-label"},F).textContent=h.get("ce-long-pause-youre-watching");if(g.isShowData(a)){var b=y("h2",{},F),c=y("h3",{},F),d=y("h3",{},F),f=y("p",{},F),a=a.video,k=g.getActiveSeason(),l=
g.getActiveVideo();a.title&&(b.textContent=a.title);c.innerHTML=k.title+": "+h.get("ce-episode-abbreviation")+" "+l.seq;l.title&&(d.textContent=l.title);l.synopsis&&(f.textContent=l.synopsis)}else b=y("h2",{},F),f=y("h3",{},F),c=y("span",{},f),d=y("span",{},f),f=y("span",{},f),k=y("p",{},F),a=a.video,a.title&&(b.textContent=a.title),a.year&&(c.textContent=a.year),a.rating&&(d.textContent=a.rating),a.runtime&&(f.textContent=u.convertUsingKey(a.runtime,!1,!0,"ce-time")),a.synopsis&&(k.textContent=a.synopsis);
x.appendChild(A);m();D=!0}function n(){D&&(D=!1,B.onNext(),k.remove(A),p=q=y=w=a=h=b=u=k=t=g=f=d=B=F=A=x=null)}function m(){var b=f.fromEvent(a,a.knownEvents.CINEMA_MODE_ENTER),d=f.fromEvent(a,a.knownEvents.CINEMA_MODE_EXIT),g=f.fromEvent(a,a.knownEvents.PAUSE_TOGGLED).filter(function(a){return a}),h=f.fromEvent(a,a.knownEvents.PAUSE_TOGGLED).filter(function(a){return!a});g.takeUntil(B).flatMap(function(){w.log("User initiated pause.");var a=b.filter(function(){return t.videoPlayer().getPaused()}).takeUntil(h).flatMap(function(){return f.timer(H).takeUntil(d).doAction(l)}),
g=f.merge(h,d).doAction(c);return f.merge(a,g)}).subscribe(q,w.getErrorHandler("event|PAUSE_TOGGLED"),q)}function l(){D&&(t.videoPlayer().getPaused()?(setTimeout(function(){A.classList.remove(p)},1),b.fadeIn(A)):w.error("Show pause screen called but player is not in a paused state."))}function c(){D&&(A.classList.add(p),b.fadeOut(A))}"use strict";var d,f,g,t,k,u,b,h,a,w,y,q,p,x,A,F,D,B,H=1E4;return{init:function(c){D&&n();d=netflix.cadmium;f=Rx.Observable;g=d.metadata;t=d.objects;k=d.element;u=d.time;
b=d.animate;h=netflix.I18n;a=d.UiEvents;w=d.Logger.create("subview.longpause");y=k.create;q=d.util.NOOP;p=k.classNames.hidden;x=c;B=new Rx.Subject;g.getMetadata()?r():f.fromEvent(a,a.knownEvents.METADATA_LOADED).takeUntil(B).take(1).doAction(r).subscribe(q,w.getErrorHandler("event|METADATA_LOADED"),q)},deinit:n}}();
netflix.cadmium.ui.mdx=function(){function r(){b.hasCastTargets=!1;h.classList.add(u)}function n(){b.hasCastTargets=!0;h.classList.remove(u)}function m(){k.isFullscreen()&&k.exit();b.showCastDialog()}function l(){t.removeEventListener(t.knownEvents.MDX_LOADED,l);b=g.mdxManager();h.addEventListener("click",m);b.addEventListener(b.EVENTS.castDevicesAvailable,n);b.addEventListener(b.EVENTS.castDevicesUnavailable,r);b.hasCastTargets&&n()}function c(){a&&(t.removeEventListener(t.knownEvents.MDX_LOADED,
this._mdxLoadedHandler,this),f.remove(h),b&&(h.removeEventListener("click",m),b.removeEventListener(b.EVENTS.castDevicesAvailable,n),b.removeEventListener(b.EVENTS.castDevicesUnavailable,r)),h=null,b=null,d=null,f=null,g=null,t=null,k=null,u=null,a=!1)}var d,f,g,t,k,u,b,h=null,a;return{init:function(m){a&&c();if(netflix.cadmium.objects.initParams().mdxEnabled)return a=!0,d=netflix.cadmium,g=d.objects,t=netflix.cadmium.UiEvents,k=netflix.cadmium.fullscreen,f=d.element,u=f.classNames.hidden,m.appendChild((null===
h&&(h=f.create("div",{"class":["player-mdx player-control-button icon-player-mdx",u].join(" ")})),h)),b=g.mdxManager(),b&&b.mdxEnabled?l():(t.addEventListener(t.knownEvents.MDX_LOADED,l),netflix.mdx.bootstrap.readyToInit()&&netflix.mdx.bootstrap.tryInitMdx()),h},deinit:c}}();
netflix.cadmium.ui.pauser=function(){function r(){t&&(p.getPaused()?(u.classList.remove(D),u.classList.remove(H),u.classList.add(F),u.classList.add(B)):(u.classList.remove(F),u.classList.remove(B),u.classList.add(D),u.classList.add(H)))}function n(){p.getPaused()?p.play():p.pause();x.fireEvent(x.knownEvents.PAUSE_TOGGLED,[p.getPaused()])}function m(){a=!1}function l(){a=!0}function c(a){a.target!==u&&a.target!==b||n()}function d(b){!h&&a&&b.target===document.body&&(b.preventDefault(),n())}function f(a){h=
"focus"===a.type}function g(){t&&(t=!1,p.removeEventListener("pausedchanged",r),u.removeEventListener("click",c),u.removeEventListener("focus",f),u.removeEventListener("blur",f),x.removeEventListener(x.knownEvents.SHOW_AUTOPLAY_INTERRUPTER,m),x.removeEventListener(x.knownEvents.HIDE_AUTOPLAY_INTERRUPTER,l),A.removeEventListener(A.knownEvents.TOGGLE_PLAY,d),y.remove(u),k=null,u=null,b=null,w=null,y=null,q=null,p=null,x=null,A=null)}"use strict";var t=!1,k,u=null,b,h=!1,a=!0,w,y,q,p,x,A,F="play",D=
"pause",B="icon-player-play",H="icon-player-pause";return{init:function(a){return t&&g(),t=!0,k=a,h=!1,w=netflix.cadmium,y=w.element,q=w.objects,p=q.videoPlayer(),x=w.UiEvents,A=w.keyboard,k.appendChild((null===u&&(u=y.create("div",{"class":"player-control-button player-play-pause pause "+H})),u)),r(),p.addEventListener("pausedchanged",r),u.addEventListener("click",c),u.addEventListener("focus",f),u.addEventListener("blur",f),A.addEventListener(A.knownEvents.TOGGLE_PLAY,d),x.addEventListener(x.knownEvents.SHOW_AUTOPLAY_INTERRUPTER,
m),x.addEventListener(x.knownEvents.HIDE_AUTOPLAY_INTERRUPTER,l),u},deinit:g}}();
netflix.cadmium.ui.volume=function(){function r(c){f.menuEl.contains(c.target)||f.toggleMute()}function n(){c.removeEventListener("click",r);f&&f.destroy();m=!1;t=g=f=d=c=l=null}var m=!1,l=null,c=null,d=null,f=null,g,t;return{init:function(k){return m&&n(),m=!0,l=k,g=netflix.cadmium,t=g.element,l.appendChild((null===c&&(c=t.create("div",{"class":"player-control-button volume icon-player-volume-full"}),f=new g.ui.VolumeMenuComponent(c,c,{id:"player-menu-volume",volumeTextNode:d})),c)),c.addEventListener("click",
r),c},deinit:n}}();
netflix.cadmium.ui.status=function(){function r(){if(f.videoIsKnown(k.videoId())){var g=f.getMetadata(),b=f.isShowData(g),g="<span class='player-status-main-title'>"+g.video.title+"</span>";b&&(b=f.getActiveVideo(),g+="<span>"+f.getActiveSeason().title+": "+netflix.I18n.get("ce-episode-abbreviation")+" "+b.seq+"</span><span>"+b.title+"</span>");c.innerHTML=g}else d.ui.preplay.preplayNeeded()&&(b=(b=k.initParams().preplay)?b.movieTitle:"",b=decodeURIComponent(b.replace(/\+/g,"%20")),c.innerHTML="<span class='player-status-main-title'>"+
b+"</span>")}function n(){m&&(m=!1,t.removeEventListener(t.knownEvents.METADATA_LOADED,r),g.remove(c),l=null,c=null,d=null,f=null,g=null,t=null,k=null)}var m=!1,l,c=null,d,f,g,t,k;return{init:function(u){return m&&n(),m=!0,l=u,d=netflix.cadmium,f=d.metadata,g=d.element,t=d.UiEvents,k=d.objects,t.addEventListener(t.knownEvents.METADATA_LOADED,r),l.appendChild((null===c&&(c=g.create("div",{"class":"player-status"})),c)),r(),c},deinit:n}}();
netflix.cadmium.ui.nextEpisode=function(){function r(a){if(d.contains(a.target)){a=h.initParams()||{};var b=t.getNextEpisode().id;u.setNextVideo(u.CONSTANTS.EPISODE_ID,b,a.trackIdNextEpisode||0);g.ui.master.updateInitParams(a,null)}}function n(){var b=h.videoId();t.videoIsKnown(b)&&null!==t.getNextEpisode()&&!a.getClipValues(b)?(d.classList.remove(w),f=new g.ui.NextEpisodeMenuComponent(d,d,{id:"player-menu-next-episode"})):d.classList.add(w)}function m(){l&&(l=!1,null!==f&&f.destroy(),b.removeEventListener(b.knownEvents.METADATA_LOADED,
n),d.removeEventListener("click",r),k.remove(d),c=null,d=null,f=null,g=null,t=null,k=null,u=null,b=null,h=null,a=null,w=null)}var l=!1,c,d=null,f=null,g,t,k,u,b,h,a,w;return{init:function(f){return l&&m(),l=!0,c=f,g=netflix.cadmium,t=g.metadata,k=g.element,u=g.url,b=g.UiEvents,h=g.objects,a=g.clips,w=k.classNames.hidden,c.appendChild((null===d&&(d=k.create("div",{"class":["player-control-button player-next-episode icon-player-next-episode",w].join(" ")})),d)),b.addEventListener(b.knownEvents.METADATA_LOADED,
n),d.addEventListener("click",r),n(),d},deinit:m}}();
netflix.cadmium.ui.episodeSelector=function(){function r(c){var d=b.initParams()||{};a.setNextVideo(a.CONSTANTS.EPISODE_ID,c.videoId,d.trackIdEpisodeSelector);g.ui.master.updateInitParams(b.initParams(),null)}function n(){var a=b.videoId();t.videoIsKnown(a)&&1<t.getTotalEpisodeCount(a)&&!h.getClipValues(a)?(d.classList.remove(w),f=f||new g.ui.EpisodeSelectorMenuComponent(d,d,{id:"player-menu-episode-selector"}),f.addEventListener(f.CHANGE_VIDEO_EVENT,r)):d.classList.add(w)}function m(){l&&(l=!1,null!==
f&&(f.removeEventListener(f.CHANGE_VIDEO_EVENT,r),f.destroy()),f=null,u.removeEventListener(u.knownEvents.METADATA_LOADED,n),k.remove(d),c=null,d=null,g=null,t=null,k=null,u=null,b=null,h=null,a=null,w=null)}"use strict";var l=!1,c,d=null,f=null,g,t,k,u,b,h,a,w;return{init:function(f){return g=netflix.cadmium,b=g.objects,l&&m(),l=!0,c=f,t=g.metadata,k=g.element,u=g.UiEvents,h=g.clips,a=g.url,w=k.classNames.hidden,c.appendChild((null===d&&(d=k.create("div",{"class":["player-control-button player-episode-selector icon-player-episode-selector",
w].join(" ")})),d)),u.addEventListener(u.knownEvents.METADATA_LOADED,n),n(),d},deinit:m}}();
netflix.cadmium.ui.audio=function(){function r(){(1<b.getAudioTrackList().length||1<b.getTimedTextTrackList().length)&&c.classList.remove(h)}function n(){m&&(m=!1,d.destroy(),t.removeEventListener(k.METADATA_LOADED,r),g.remove(c),l=null,c=null,d=null,f=null,g=null,t=null,k=null,u=null,b=null,h=null)}"use strict";var m=!1,l,c=null,d,f,g,t,k,u,b,h;return{init:function(a){return m&&n(),m=!0,l=a,f=netflix.cadmium,g=f.element,t=f.UiEvents,k=t.knownEvents,u=f.objects,b=u.videoPlayer(),h=g.classNames.hidden,
l.appendChild((null===c&&(c=g.create("div",{"class":["player-control-button player-audio-select icon-player-subtitle-selector",h].join(" ")})),c)),d=new f.ui.AudioSubtitleMenuComponent(c,c,{id:"player-menu-track-settings"}),t.addEventListener(k.METADATA_LOADED,r),r(),c},deinit:n}}();
netflix.cadmium.ui.fullscreen=function(){function r(a){a?(k.classList.add(H),k.classList.remove(B)):(k.classList.add(B),k.classList.remove(H))}function n(a){k.contains(a.target)&&A.toggle()}function m(a){t.parentNode.contains(a.target)||A.toggle()}function l(){x.removeEventListener(x.knownEvents.VIDEO_ENDED,l);A.exit()}function c(){x.removeEventListener(x.knownEvents.METADATA_LOADED,c);d()}function d(){if((b=a.getActiveVideo())&&b.id===w.videoId()){var d=p.isMetroMode(),f=q.getClipValues(b.id),g=
w.initParams().windowScaling;(d&&f&&!g||!d)&&(k.addEventListener("click",n),u.addEventListener("dblclick",m,!1),x.addEventListener(x.knownEvents.FULLSCREEN_CHANGE,r),f&&w.initParams().inPagePlayer&&x.addEventListener(x.knownEvents.VIDEO_ENDED,l),k.classList.remove(D))}else x.addEventListener(x.knownEvents.METADATA_LOADED,c)}function f(){g&&(g=!1,k.removeEventListener("click",n),u.removeEventListener("dblclick",m,!1),x.removeEventListener(x.knownEvents.METADATA_LOADED,c),x.removeEventListener(x.knownEvents.FULLSCREEN_CHANGE,
r),y.remove(k),t=null,k=null,u=null,b=null,h=null,a=null,w=null,y=null,q=null,p=null,x=null,A=null,F=null)}"use strict";var g=!1,t,k=null,u,b,h,a,w,y,q,p,x,A,F,D="player-hidden",B="icon-player-full-screen",H="icon-player-windowed-screen";return{init:function(b){return g&&f(),h=netflix.cadmium,y=h.element,a=h.metadata,w=h.objects,x=h.UiEvents,p=h.browser,q=h.clips,A=h.fullscreen,F=h.Logger.create("subview.fullscreen"),F.log("init"),u=w.playerWrapper(),t=b,k=(null===k&&(k=y.create("div",{"class":"player-control-button player-fill-screen "+
D})),r(A.isFullscreen()),k),t.appendChild(k),d(),g=!0,k},deinit:f}}();
netflix.cadmium.ui.preplay=function(){function r(){var a=netflix.cadmium&&netflix.cadmium.objects&&"function"==typeof netflix.cadmium.objects.initParams&&netflix.cadmium.objects.initParams().recap;return a&&a.movieId&&!a.hasPlayed}function n(){t.removeAttribute("style");var a=F.initParams();a.recap.hasPlayed=!0;A.ui.master.updateInitParams(a)}function m(){n()}function l(){n()}function c(){f&&(q.onNext(),g.classList.remove(x),y&&y.destroy(),D.remove(u),D.remove(b),D.remove(k),D.remove(w),F.clearTrackId(),
f=!1,g=null,t=null,k=null,u=null,b=null,h=null,a=null,w=null,y=null,q=null,p=null,A=null,F=null,D=null,B=null,H=null,E=null,G=null)}function d(){window.requestAnimationFrame(function(){var a=D.getDimensions(g),b,c;a.w/a.h>G?(c=.7*a.h,b=c*G):(b=.7*a.w,c=b/G);t.style.width=b+"px";t.style.height=c+"px"})}"use strict";var f=!1,g,t,k,u,b,h,a,w,y,q,p,x="player-preplay",A=netflix.cadmium,F=A.objects,D,B,H,E,J=Rx.Observable,G=null;return{init:function(n){f&&c();r()&&(A=netflix.cadmium,F=A.objects,D=A.element,
B=A.UiEvents,H=F.videoPlayer(),E=netflix.I18n,p=F.initParams().recap,f=!0,q=new Rx.Subject,t=document.getElementsByClassName("player-video-wrapper")[0],g=n,n.classList.add(x),u=D.create("div",{id:"preplay-bg"},n),u.style.cssText="background-image: url("+p.backgroundImage+");",k=D.create("div",{id:"video-bg"},t),b=D.create("div",{"class":"preplay-header"},t),h=D.create("div",{id:"preplay-logo"},b),a=D.create("span",{id:"preplay-text-recap"},b),n=p.seasonNumber,h.style.cssText="background-image: url("+
p.logoImage+");",a.textContent=E.getWithParams("ce-season-recap-text",["SEASON"],[n]),w=D.create("div",{},t),y=new A.ui.Button(w,{id:"preplay-skip-button",contentsEl:document.createTextNode(E.getWithParams("ce-start-next-season-button",["SEASON"],[n+1]))}),J.fromEvent(y,y.knownEvents.CLICK).takeUntil(q).take(1).subscribe(m),n=H.getVideoSize(),G=n.width/n.height,d(),J.fromEvent(B,B.knownEvents.WINDOW_RESIZE).takeUntil(q).subscribe(d),J.fromEvent(B,B.knownEvents.VIDEO_ENDED).takeUntil(q).take(1).subscribe(l))},
deinit:c,preplayNeeded:r}}();
netflix.cadmium.ui.incognito=function(){function r(){n&&(n=!1,c&&c.destroy(),c=null,f.remove(l),l=null,m=null,d=null,f=null,g=null,t=null,k=null,u=null)}var n=!1,m,l=null,c=null,d,f,g,t,k,u,b={history:"a",anonymous:"b","private":"c"};return{init:function(h){n&&r();d=netflix.cadmium;g=d.objects;var a=g.videoPlayer();if(a&&a.getXid&&a.getXid())return n=!0,m=h,f=d.element,k=f.classNames.hidden,t=g.initParams().incognitoConfig,m.appendChild((null===l&&(l=f.create("div",{"class":["player-control-button player-incognito",k].join(" ")})),
l)),t&&!0===t.enabled&&(l.classList.remove(k),c=c||new d.ui.IncognitoMenuComponent(l,l,{id:"player-menu--incognito"}),t.autoshow&&(c.showTickler(),c.setIncognitoOptions({method:"auto"})),u=f.create("span"),l.classList.add("player-incognito--"+t.mode),u.appendChild(document.createTextNode(b[t.mode])),l.appendChild(u)),l},deinit:r}}();
netflix.cadmium.ui.popup=function(){var r=netflix.cadmium.element,n,m=null,l=[],c=!1,d=!1,f=function(){var d=l.pop();c=!0;m=r.create("div",{"class":"popup-dialog-container"});r.create("h2",{"class":"popup-dialog-message"},m).appendChild(document.createTextNode(d.title));r.create("p",{"class":"popup-dialog-message"},m).appendChild(document.createTextNode(d.message));for(var b=r.create("div",{"class":"popup-buttons-container"}),f=0;f<d.choices.length;f++){var a=d.choices[f],g=r.create("button",{},b);
g.appendChild(document.createTextNode(a.text));a.onClick&&g.addEventListener("click",a.onClick)}m.appendChild(b);n.appendChild(m)},g=function(){r.remove(m);m=null;c=!1;0<l.length&&f()},t=function(d,b,g){l.push({title:d,message:b,choices:g});c||f()},k=function(){r.remove(m);n=l=m=null;d=c=!1};return{init:function(c){d||k();d=!0;n=c;l=[]},deinit:k,queueDialog:t,showGenericError:function(c,b){t(c,b,[{text:netflix.I18n.get("ce-error-dialog-button-ok"),onClick:g}])},closeDialog:g}}();
netflix.cadmium.ui.pinentry=function(){function r(){da=a.create("div",{"class":"pin-entry"});var b=a.create("div",{id:"pin-buttons"},da),c=a.create("div",{"class":"play-button-content"}),d=a.create("span",{},c),f=a.create("p",{},c);d.textContent="\ue646";f.textContent=x.get("ce-pin-play");db=new h.ui.PIN(da);K=new h.ui.Button(b,{"class":"pin-play-button disabled",contentsEl:c});Y=new h.ui.Button(b,{"class":"pin-cancel-button",contentsEl:document.createTextNode(x.get("ce-pin-cancel"))});I=[db,K,Y];
v=a.create("h2",{"class":"pin-title"},da);v.textContent=x.get("ce-enter-pin");Ma=a.create("p",{"class":"pin-forgot"},da);Ma.textContent=x.get("ce-forgot-pin");C=document.querySelector(".player-progress-loading")}function n(){var a;da=D({"class":"pin-entry"},B({},x.get("ce-adult-verification-message")),a=D({id:"pin-buttons"}));var c=new h.ui.Button(a,{"class":"pin-play-button",contentsEl:document.createTextNode(x.get("ce-verify-age"))});a=new h.ui.Button(a,{"class":"pin-cancel-button",contentsEl:document.createTextNode(x.get("ce-pin-cancel"))});
Aa.appendChild(da);q.fromEvent(c,"click").take(1).doAction(function(){window.location.replace(Fb)}).subscribe();q.fromEvent(a,"click").take(1).doAction(function(){netflix.cadmium.ui.master.goBackToBrowsing();b()}).subscribe();requestAnimationFrame(function(){oa&&da.classList.add(T)});(C=document.querySelector(".player-progress-loading"))&&C.classList.add(Q)}function m(){var a=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){}return{valid:a.success}},b=function(a){return 401===a.status?
q.return(a.responseText||{success:!1}):q.throw(a)},f=function(a){return q.return({error:a.status})},h=q.fromEvent(Y,"click");h.takeUntil(Ha).take(1).doAction(d).subscribe(F,l,F);q.fromEvent(K,"click").takeUntil(Ha).filter(function(){return K.enabled}).doAction(function(){K.enabled=!1}).flatMap(function(){var c={withCredentials:!0,urlEncoded:!0,data:{pin:db.getValue()}};return y.post(H,c).takeUntil(Ha).takeUntil(h).timeout(E).catch(b).retryWithBackoff(J,G).map(a).catch(f)}).doAction(c).subscribe(F,
l,F);q.fromEvent(Ma,"click").takeUntil(Ha).doAction(g).subscribe(F,l,F);q.fromEvent(db,"complete").takeUntil(Ha).doAction(function(){K.enabled=!0;K.focus();db.blur()}).subscribe(F,l,F);q.fromEvent(db,"input").takeUntil(Ha).doAction(function(){K.enabled=!1}).subscribe(F,l,F)}function l(a){A.log("subview.pin.entry",a&&a.stack||a)}function c(a){a=a||{};if(!0===a.valid)Ia.onNext(L);else!1===a.valid?(a=x.get("ce-invalid-pin"),v.innerHTML=a,t(),db.clear().focus()):(a=x.get("ce-pin-network-error"),v.innerHTML=
a,K.enabled=!0)}function d(){Ia.onNext(N)}function f(a){a=a.data||{};if("pinReset"===a.state&&"success"===a.status)Ia.onNext(L)}function g(){var a="";try{a=netflix.constants.page.xsrf}catch(b){}R=w.open({url:la+"?authurl="+a,name:Qa,features:sa});R.doAction(f).subscribe(F,l,F)}function t(){q.fromEvent(da,"webkitAnimationEnd").merge(q.fromEvent(da,"animationend")).take(1).doAction(function(){da.classList.remove(V)}).subscribe(F,l,F);da.classList.add(V)}function k(){return da.classList.remove(T),da.classList.add(ba),
Rx.Observable.fromEvent(da,"transitionend").take(1).map(function(){return P})}function u(c){oa&&b();oa=!0;h=netflix.cadmium;a=h.element;w=h.popup;y=h.xhr;q=Rx.Observable;p=h.objects;x=netflix.I18n;A=h.logging;F=h.util.NOOP;D=h.dom.DIV;B=h.dom.H2;Ha=new Rx.Subject;Ia=new Rx.Subject;Aa=c;c=p.initParams().pinConfig||{};var d=!!(h.metadata.getActiveVideo()||{}).requiresAdultVerification,f=!!c.isAdultVerified,g=!!c.adultVerificationEnabled;Fb=c.adultVerificationURL||"/verifypin";if(d&&g&&!f)n();else return netflix.cadmium&&
netflix.cadmium.ui&&netflix.cadmium.ui.master&&netflix.cadmium.ui.master.isAkira()?(H=c.pinApiEndpoint||"https://"+location.hostname+"/api/desktop/pin/service",la=c.resetURL||"https://"+location.hostname+"/player/pinreset"):(H=c.pinApiEndpoint||"https://api.netflix.com/desktop/pin/service",la=c.resetURL||"/player/pinreset"),r(),m(),Aa.appendChild(da),db.focus(),requestAnimationFrame(function(){oa&&da.classList.add(T)}),C&&C.classList.add(Q),P}function b(){oa&&(C&&C.classList.remove(Q),Ha.onNext(),
I&&I.forEach(function(a){a&&a.destroy()}),a.remove(da),oa=!1,F=A=x=p=q=y=w=a=h=Ia=Ha=I=C=Ma=db=Y=K=v=da=Aa=null)}"use strict";var h,a,w,y,q,p,x,A,F,D,B,H,E=1E4,J=4,G=1E3,L="valid",N="canceled",T=netflix.cadmium.element.classNames.visible,ba=netflix.cadmium.element.classNames.hidden,Q="pin-active",V="shake",la,Qa="nf-pin-reset-popup",sa={menubar:!1,resizable:!1,location:!0,width:400,height:300,scrollBars:!1,chrome:!0,centered:!0},oa=!1,Aa=null,da=null,v=null,K=null,Y=null,db=null,Ma=null,C=null,I=
null,R=null,Fb,Ha=null,Ia=null,P={init:u,deinit:b,show:function(a,c){return u(a),Ia.flatMap(function(a){return k().map(function(){return{pinStatus:a}}).doAction(function(){c&&b()})})},hide:k,VALID:L,CANCELED:N};return P}();
netflix.cadmium.ui.dontShare=function(){function r(){var b=g.getMetadata(),b=b&&b.video&&b.video.social&&b.video.social.facebook&&b.video.social.facebook.do_not_share&&b.video.social.facebook.do_not_share.enabled,h=a.get("ce-dontshare-prompt"),h=h&&0>h.indexOf("MISSINGRESOURCE"),k=u.initParams().incognitoConfig;!b||!h||k&&k.enabled?c.classList.add(w):(c.classList.remove(w),d=new f.ui.DontShareMenuComponent(c,c,{id:"player-menu-dont-share"}),d.showTickler(y))}function n(){m&&(m=!1,null!==d&&d.destroy(),
d=null,k.removeEventListener(k.knownEvents.METADATA_LOADED,r),t.remove(c),c=null);f=l=g=a=t=k=u=w=b=h=null}"use strict";var m=!1,l,c=null,d=null,f,g,t,k,u,b,h,a,w,y=2E3;return{init:function(d){return m&&n(),m=!0,l=d,f=netflix.cadmium,g=f.metadata,t=f.element,k=f.UiEvents,u=f.objects,w=t.classNames.hidden,a=netflix.I18n,b=f.dom,h=b.get("DIV"),b.get("SPAN"),l.appendChild((null===c&&(c=h({"class":["player-control-button player-dont-share icon-player-dont-share",w].join(" ")})),c)),k.addEventListener(k.knownEvents.METADATA_LOADED,
r),r(),c},deinit:n}}();
(function(){function r(){!y&&w&&(y=!0,g.fireEvent(g.knownEvents.CINEMA_MODE_EXIT),k.deinit(),d.queueDialog(netflix.I18n.get("ce-head-internet_connection_problem"),netflix.I18n.get("ce-text-internet_connection_problem"),[{text:netflix.I18n.get("ce-error-dialog-button-ok"),onClick:function(){n();a.onNext("closed")}}]))}function n(){w&&y&&(d.closeDialog(),k.init(),y=!1)}function m(){var c=f.fromEvent(u,"busychanged").throttle(100).map(function(){return u&&u.getBusy()}),d=c.filter(function(a){return a&&0<=
a.progress&&!a.networkStalled}).map(function(a){return a&&a.progress}).distinctUntilChanged(),g=c.filter(function(a){return a&&a.networkStalled}).map(function(a){return a&&a.networkStalled}).distinctUntilChanged(),k=f.fromEvent(u,"currenttimechanged").sample(300).distinctUntilChanged().take(3).takeLast(),l=f.merge(k,d,c.filter(function(a){return!a}));g.takeUntil(h).flatMap(function(){return f.merge(f.return(),a).takeUntil(l).delay(q).doAction(r)}).subscribe(b,t.getErrorHandler("progressStalled"),
b);l.takeUntil(h).doAction(n).subscribe(b,t.getErrorHandler("hideErrorDialog"),b)}function l(){w&&(w=!1,h&&h.onNext(),u=f=d=c=h=null,y=!1,a=k=g=b=null)}"use strict";var c,d,f,g,t,k,u,b,h,a,w=!1,y=!1,q=3E3;netflix.cadmium.ui.NetworkError={init:function(){w&&l();w=!0;c=netflix&&netflix.cadmium||{};t=c.Logger&&c.Logger.create("view.network.error");d=c.ui&&c.ui.popup;f=Rx.Observable;g=c.UiEvents;u=c.objects&&c.objects.videoPlayer&&c.objects.videoPlayer();b=c.util&&c.util.NOOP;k=c.cinemamode;h=new Rx.Subject;
a=new Rx.Subject;m()},deinit:l}})();
netflix.cadmium.ui.reportProblem=function(){function r(){n&&(n=!1,l&&l.destroy(),l=null,m=null,c=null,t=null,d=null,k.onNext())}var n=!1,m,l=null,c,d,f,g,t,k,u=function(){d.isFullscreen()&&d.exit();c.objects.videoPlayer().pause();c.cinemamode.disableCinemaMode();c.keyboard.disableShortcut();c.ui.reportProblemPopup.showPopup()};return{init:function(b){n&&r();c=netflix.cadmium;d=c.fullscreen;var h=c.objects.initParams();if(h&&h.reportProblemEnabled)return n=!0,m=b,f=c.dom,g=f.get("div"),f.get("span"),
t=g({"class":"player-control-button player-report-problem"},g({"class":"border"},"?")),k=new Rx.Subject,Rx.Observable.fromEvent(t,"click").takeUntil(k).doAction(u).subscribe(),l=new c.ui.ReportProblemMenuComponent(t,t,{id:"player-menu-report-problem"}),m.appendChild(t),t},deinit:r,showPopup:u}}();
netflix.cadmium.ui.reportProblemPopup=function(){var r,n,m,l,c,d,f,g,t,k,u,b,h,a,w,y,q,p,x,A,F=null,D=null,B=!1,H,E,J,G=!1,L,N,T=function(){B&&(m.remove(D),A=D=F=x=p=q=y=w=a=h=b=u=k=t=g=f=d=c=l=m=n=r=null,B=!1)},ba=function(){F=null;J.onNext();r.cinemamode.enableCinemaMode();r.keyboard.enableShortcut();D.classList.add("hidden");setTimeout(function(){A.removeChild(D)},350)},Q=function(a){var b,d,f;a.connection&&(c.get("ce-report-buffering-confirmation-subtext"),b=y({"class":"report-problem-subtitle"},
c.get("ce-report-buffering-confirmation-subtext")),d=u({"class":"report-problem-help-center-link",target:"_blank",href:"https://help.netflix.com/help"},c.get("ce-report-buffering-confirmation-link")));a=w({"class":"report-problem-title"},c.get("ce-report-confirmation-title"));f=k({"class":"report-problem-confirmation-container opacity-transparent"},a,b,k({"class":"report-problem-confirmation-button-row"},h({"class":"report-problem-button report-problem-finish"},c.get("ce-report-confirmation-finish")),
d));F.appendChild(f);requestAnimationFrame(function(){n.fadeOut(H);n.fadeIn(f)})},V=function(a){var b=k({"class":"report-problem-confirmation-container opacity-transparent"},y({"class":"report-problem-subtitle"},c.get("ce-social-error")),k({"class":"report-problem-confirmation-button-row"},h({"class":"report-problem-button report-problem-finish"},c.get("ce-report-confirmation-finish"))));F.appendChild(b);requestAnimationFrame(function(){n.fadeOut(H);n.fadeIn(b)});var d=netflix.clientNotifications;
d&&(d.notify("reportProblemError",{category:"uiQOE",modalView:"reportProblem",data:a}),d.flushBuffer&&d.flushBuffer())},la=function(){var a;netflix.cadmium&&netflix.cadmium.ui&&netflix.cadmium.ui.master&&netflix.cadmium.ui.master.isAkira()?a=d.getSecureApiPath()+"reportproblem":a=d.getSecureApiPath()+"desktop/playback/reportproblem";for(var b=document.getElementsByClassName("checkbox selected"),c={movieID:netflix.cadmium.objects.videoId(),authURL:netflix.constants.page.xsrf},g=0;g<b.length;g++){var h=
b[g].getAttribute("data-category");c[h]="true"}b=document.getElementsByClassName("report-problem-details-text")[0].value;0<b.length&&(c.comments=b);c.isPlayer="true";c.contentTime=x.getCurrentTime();b={withCredentials:!0,data:c};g=document.getElementsByClassName("report-problem-dialog-container",F)[0];n.fadeOut(g);H=k({"class":"loading display-none opacity-transparent"});F.appendChild(H);n.fadeIn(H);f.post(a,b).takeUntil(J).doAction(function(){Q(c)},function(){V(c)},L).subscribe(L,t.getErrorHandler("submit post request"))},
Qa=function(a){a=a.getElementsByClassName("checkbox")[0];a.classList.toggle("selected");if(a.classList.contains("selected")){if(a.appendChild(k({"class":"icon-player-checked"})),E.classList.remove("hidden"),!G){var b=0,c=setInterval(function(){10>++b?E.scrollIntoView():clearInterval(c)},30);G=!0}}else a.innerHTML="",0==document.getElementsByClassName("checkbox selected").length&&E.classList.add("hidden")},sa=function(a){for(var b=a.target;!b.classList.contains("report-problem-popup-bg");){if(b.classList.contains("checkbox-row-container")){Qa(b);
break}if(b.classList.contains("report-problem-close")||b.classList.contains("report-problem-finish")){ba();break}if(b.classList.contains("report-problem-submit")){la();break}b=b.parentNode}a.stopPropagation()},oa=function(a){a.stopPropagation()},Aa=function(a){return k({"class":"checkbox-row-container"},k({"class":"checkbox","data-category":a.category}),k({"class":"text-container"},w({"class":"title-text"},a.text),y({"class":"subtext-text"},a.subtext)))};return{init:function(D){B&&T();B=!0;A=D;r=
netflix.cadmium;n=r.animate;m=r.element;l=r.util;c=netflix.I18n;d=r.url;f=r.xhr;g=r.dom;t=r.Logger.create("reportProblem.popup");k=g.DIV;u=g.A;b=g.SPAN;h=g.BUTTON;a=g.H1;w=g.H2;y=g.H3;q=g.get("textarea");L=l.NOOP;p=r.objects;x=p.videoPlayer();N=[{text:c.get("ce-report-problem-label-problem-title"),subtext:c.get("ce-report-problem-label-problem-subtext"),category:"mislabel"},{text:c.get("ce-report-problem-video-problem-title"),subtext:c.get("ce-report-problem-video-problem-subtext"),category:"video"},
{text:c.get("ce-report-problem-sound-problem-title"),subtext:c.get("ce-report-problem-sound-problem-subtext"),category:"sound"},{text:c.get("ce-report-problem-subtitle-problem-title"),subtext:c.get("ce-report-problem-subtitle-problem-subtext"),category:"subtitle"},{text:c.get("ce-report-problem-buffering-problem-title"),subtext:c.get("ce-report-problem-buffering-problem-subtext"),category:"connection"}]},deinit:T,showPopup:function(){D=k({"class":"report-problem-popup-bg hidden"},F=k({"class":"report-problem-popup"},
k({"class":"report-problem-close"},b({"class":"icon-player-thin-cancel"})),k({"class":"report-problem-dialog-container"},a({"class":"report-problem-title"},c.get("ce-report-problem-title")),w({"class":"report-problem-subtitle"},c.get("ce-report-problem-subtext")),k({"class":"report-problem-rows-container"},N.map(Aa)),E=k({"class":"report-problem-details-container hidden"},k({"class":"report-problem-details-title-container"},b({"class":"report-problem-details-title"},c.get("ce-report-problem-details-text")),
b({"class":"report-problem-details-subtext"},"("+c.get("ce-report-problem-details-optional")+")")),q({"class":"report-problem-details-text",rows:5,cols:30}),h({"class":"report-problem-button report-problem-submit"},c.get("ce-report-problem-submit"))))));J=new Rx.Subject;Rx.Observable.fromEvent(D,"click").takeUntil(J).doAction(sa).subscribe(L,t.getErrorHandler("clickhandler"));Rx.Observable.fromEvent(D,"dblclick").takeUntil(J).doAction(oa).subscribe(L,t.getErrorHandler("dblclick handler"),L);A.appendChild(D);
setTimeout(function(){D.classList.remove("hidden")},30)}}}();"use strict";netflix.cadmium.ui.controlDivider=function(){var r,n,m,l;return{init:function(c){return r=netflix.cadmium,n=r.dom,m=n.get("div"),l=m({"class":"player-control-divider"}),c.appendChild(l),l},deinit:function(){r=n=m=null}}}();
netflix.cadmium.ui.playback=function(){function r(){x.update(100)}function n(a){x.update((100*a).toFixed(0))}function m(a){h||(h=H.create("div",{id:"fademask"},document.body));N.fromEvent(h,"transitionend").take(1).takeUntil(T).doAction(function(){H.remove(h);h=null}).subscribe(Q,G.getErrorHandler("fadeEl|transitionend"),Q);N.timer(a).doAction(function(){b.classList.remove(H.classNames.hidden);h.style.opacity=0}).subscribe(Q,G.getErrorHandler("timer|hidden"),Q)}function l(){c()}function c(a){if(g){var b=
L.ui&&L.ui.timedText&&L.ui.timedText.setBounds&&L.ui.timedText.setBounds.bind(L.ui.timedText)||Q;if(void 0!==a&&null!==a)b({bottom:a});else{var c=(a=document.querySelector(".player-controls-wrapper"))&&a.classList.contains("display-none");a&&!1===c?(c=(c=J.playerWrapper())&&c.getBoundingClientRect().height,a=a.getBoundingClientRect().top,a=Math.floor(c-a),!isNaN(a)&&L?b({bottom:a}):G.log("view.playback: could not set timed text bounds.")):b({bottom:0})}}}function d(){var d=N.fromEvent(E,E.knownEvents.CINEMA_MODE_ENTER),
f=N.fromEvent(E,E.knownEvents.CINEMA_MODE_EXIT),g=N.fromEvent(L,"busychanged").throttle(100).map(function(){return L&&L.getBusy()});g.takeUntil(T).filter(function(a){return a&&0<=a.progress&&!a.networkStalled}).map(function(a){return a&&a.progress}).distinctUntilChanged().doAction(n).subscribe(Q,G.getErrorHandler("VideoPlayer|progressChanged"),Q);g.takeUntil(T).filter(function(a){return!a}).doAction(r).subscribe(Q,G.getErrorHandler("VideoPlayer|progressCompleted"),Q);N.fromEvent(E,E.knownEvents.SHOW_AUTOPLAY_INTERRUPTER).merge(d).takeUntil(T).doAction(sa).subscribe(Q,
G.getErrorHandler("UiEvents|autoplay_interrupt"),Q);N.fromEvent(E,E.knownEvents.HIDE_AUTOPLAY_INTERRUPTER).merge(f).takeUntil(T).doAction(Qa).subscribe(Q,G.getErrorHandler("UiEvents|hide_interrupt"),Q);N.fromEvent(E,E.knownEvents.WINDOW_RESIZE).takeUntil(T).doAction(l).subscribe(Q,G.getErrorHandler("UiEvents|window_resize"),Q);N.fromEvent(b,"transitionend").merge(N.fromEvent(b,"webkitTransitionEnd")).merge(N.fromEvent(b,"msTransitionEnd")).filter(function(a){return"width"===a.propertyName}).takeUntil(N.fromEvent(E,
E.knownEvents.VIDEO_FIRST_PLAY)).doAction(l).subscribe(Q,G.getErrorHandler("UiEvents|first_play"),Q);Rx.Observable.fromEvent(L,"timedtexttrackchanged").takeUntil(T).doAction(c.bind(null,null)).subscribe(Q,G.getErrorHandler("timedtexttrackchanged"),Q);d.takeUntil(T).delay(V).doAction(c.bind(null,0)).subscribe(Q,G.getErrorHandler("cinemaModeEnter"),Q);c();D.MutationUtils.observeAndRemoveUnsafeNodes(a,q).takeUntil(T).subscribe(Q,G.getErrorHandler("mutationObserver"),Q)}function f(){g&&(G.log("deinit"),
clearTimeout(A),u.classList.remove(la),u.style.cursor="auto",g=!1,T.onNext(),x.destroy(),y.forEach(function(a){a.deinit()}),netflix.cadmium.cinemamode.deinit(),H.remove(k),h&&H.remove(h),t=null,k=null,u=null,b=null,h=null,a=null,w=null,y=null,q=null,p=null,x=null,A=null,D=null,B=null,H=null,E=null,J=null,G=null,L=null,N=null,T=null,ba=null,F=null,Q=null)}"use strict";var g=!1,t,k=null,u,b,h,a,w,y,q,p=[],x=null,A=null,F=!1,D,B,H,E,J,G,L,N,T,ba,Q,V=100,la="player-cinema-mode",Qa=function(){u.classList.remove(la);
netflix.cadmium.animate.fadeIn(k);requestAnimationFrame(c.bind(null,null));F||(u.style.cursor="default")},sa=function(){u.classList.add(la);netflix.cadmium.animate.fadeOut(k);F||(u.style.cursor="url(https://assets.nflxext.com/en_us/ffe/websiteui/mdx/blank.cur), auto")};return{init:function(c){g&&f();g=!0;t=c;D=netflix.cadmium;E=D.UiEvents;H=D.element;J=D.objects;B=D.ui;G=D.Logger.create("view.playback");N=Rx.Observable;Q=D.util.NOOP;ba=H.classNames.active;F="webkit"===D.browser.prefix().lowercase;
G.log("init",{masterView:!!c,initialized:g});p=[];T=new Rx.Subject;L=J.videoPlayer();u=J.playerWrapper();x=new D.ui.RadialProgressComponent(t,{hideWhenEmpty:!0,hideWhenFull:!0,id:"player-playback-buffering"});null===k&&(k=H.create("div",{"class":["player-controls-wrapper",ba,"no-select"].join(" ")}));k.innerHTML="<section class='player-slider' role='slider'></section><section class='player-control-bar no-select' role='control-bar'></section>";p.push(k);b=document.getElementsByClassName("player-video-wrapper")[0];
B.preplay.preplayNeeded()?(b.appendChild(k),m(500)):(t.appendChild(k),b.classList.remove(H.classNames.hidden));a=k.getElementsByClassName("player-control-bar")[0];w=k.getElementsByClassName("player-slider")[0];D.cinemamode.init();q=[];y=[B.pauser,B.volume,B.status,B.incognito,B.nextEpisode,B.episodeSelector,B.mdx,B.controlDivider,B.audio,B.dontShare,B.fullscreen,B.reportProblem];y.forEach(function(b){try{q.push(b.init(a))}catch(c){G.error(c)}});y.push(B.exitPlayback);B.exitPlayback.init(c);p.push(B.exitPlayback.getBackToBrowsingEl());
y.push(B.autoplayInterrupter);B.autoplayInterrupter.init(c);y.push(B.preplay);B.preplay.init(c);y.push(B.popup);B.popup.init(c);y.push(B.reportProblemPopup);B.reportProblemPopup.init(c);y.push(B.scrubber);B.scrubber.init(w);y.push(B.longpause);B.longpause.init(c);y.push(B.NetworkError);B.NetworkError.init();D.cinemamode.addExclusionEls(p);d()},deinit:f}}();netflix.cadmium.views.register(netflix.cadmium.ui.playback,netflix.cadmium.views.types.standard);
(function(){var r=netflix.cadmium,n=r.objects,m=r.UiEvents,l=r.PostPlayData,c=r.element,d=r.dom.get("DIV"),f=r.Class,g=r.UITracking,t=Rx.Observable,k=r.util.NOOP,u=r.Logger.create("subview.postplay.base"),b=r.url,h=f.extend({_initialized:!1,_disposed:null,_metadata:null,_rootEl:null,_playerWrapperEl:null,_videoPlayer:null,_components:null,_uiTrackingEnabled:!1,_videoCloseDelayTime:2E3,init:function(a,b){this._initialized||(this._initialized=!0,this._disposed=new Rx.Subject,this._parentEl=a,this._metadata=
b,this._rootEl=d({"class":"player-postplay"}),this._videoPlayer=n.videoPlayer(),this._components=[],this._playerWrapperEl=a.querySelector(".player-video-wrapper"),this._uiTrackingEnabled=!!(n&&n.initParams()&&n.initParams().uiTrackingEnabled),u.log("init",b),this._createElements(),this._createEventSubscriptions())},destroy:function(){this._initialized&&(u.log("destroy"),g.deinit(),this._parentEl&&this._parentEl.classList.remove("video-ended"),this._disposed.onNext(),this._components.forEach(function(a){a&&
(a.destroy&&a.destroy(),a.deinit&&a.deinit())}),c.remove(this._rootEl),this._components=this._videoPlayer=this._playerWrapperEl=this._rootEl=this._metadata=this._parentEl=this._disposed=null,this._initialized=!1)},show:function(){return this._parentEl.contains(this._rootEl)||this._parentEl.appendChild(this._rootEl),this._uiTrackingEnabled&&setTimeout(function(){u.log("start tracking UI.");this._trackUI()}.bind(this),2E3),this},hide:function(){},fallback:function(){u.error("Postplay unavailable. Metadata:",
this._metadata)},_createElements:function(){},_addComponent:function(a){return this._components.push(a),a},_createEventSubscriptions:function(){var a=t.fromEvent(m,m.knownEvents.VIDEO_ENDED);t.fromEvent(this._videoPlayer.getElement(),"click").takeUntil(this._disposed).takeUntil(a).doAction(this._returnToPlayback.bind(this)).subscribe(k,u.getErrorHandler("video click"),k);a.takeUntil(this._disposed).delay(this._videoCloseDelayTime).doAction(function(){this._parentEl&&this._parentEl.classList.add("video-ended");
this._rootEl&&this._rootEl.classList.add("video-ended")}.bind(this)).flatMap(function(){return this._parentEl?t.fromEvent(this._parentEl,"transitionend").takeUntil(this._disposed).merge(t.timer(2E3).doAction(function(){u.log("transitionend did not fire for postplay parent.")})).take(1):t.empty()}.bind(this)).doAction(this._closeVideoPlayer.bind(this)).subscribe(k,u.getErrorHandler("video ended"),k)},_returnToPlayback:function(){r.views.show(r.ui.playback,[this._parentEl])},_closeVideoPlayer:function(){u.log("closing video player");
this._videoPlayer&&this._videoPlayer.close()},_startPlayback:function(a){u.log("Requesting playback with uicontext",a);a=a||{row:0,rank:-99,request_id:l.getRequestId(),location:"postplay"};r.ui.master.updateInitParams(n.initParams(),a)},_trackUI:function(){var a=n.initParams()||{};g.init({requestId:l.getRequestId(),location:"postplay",enabled:this._uiTrackingEnabled,maxRecords:a.uiTrackingMaxRecords,localStorageKey:a.uiTrackinglocalStorageKey,endpoint:a.uiTrackingEndpoint,debug:b.urlContains(/ptdebug=true/)});
g.scan()},_getUiContextForEl:function(a){return a?(a=a.hasAttribute(g.TRACKING_ATTRIBUTE)?a:a.querySelector("["+g.TRACKING_ATTRIBUTE+"]"),g.getTrackingContext(a)):null},_setUiContextForEl:function(a,b){return this._uiTrackingEnabled&&g.trackElement(a,b),b},_navToMoreInfo:function(){var a=this._metadata.experience.moreInfoLink;u.info("Navigate to info:"+a);window.location.replace(a)}});h.create=function(a,b){return new h(a,b)};r.ui.PostPlayBase=h})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.url,l=r.dom,c=l.DIV,d=l.H1,l=n.PostPlayBase,f=n.PostPlayBackground,g=n.PostPlayActionButtons,t,k=r.util.NOOP,u=r.Logger.create("subview.postplay.character"),b=l.extend({init:function(b,a){t=netflix.I18n;this._super(b,a);this._sims.highlightSimAtIndex(0,!0);this._autoPlayTimer&&this._autoPlayTimer.start(function(){this._playSim(this._sims.getAt(0).getData())}.bind(this))},_createElements:function(){this._super();var b,a,d=this._metadata.list;this._background=
this._addComponent(f.create(this._rootEl));this._rootEl.appendChild(c({"class":"player-postplay-background-gradient-left"}));this._footerEl=c({"class":"player-postplay-footer player-postplay-character-test"},b=c({"class":"player-postplay-character-test-logo-container"}),a=c({"class":"right-panel"},this._stillContainerEl=c({"class":"player-postplay-character-stills-container"})));b.style.cssText="background-image: url("+this._metadata.logo+");";this._sims=this._addComponent(r.ui.PostPlaySimsCollection.create(this._stillContainerEl,
d,this._boxshotTemplate.bind(this)));this._actionButtons=this._addComponent(g.createBasic(a));this._rootEl.appendChild(this._footerEl)},_boxshotTemplate:function(b,a){b=b||{};0<a&&this._stillContainerEl.appendChild(c({"class":"postplay-character-still-gap"}));var f=b.annotatedTitle||b.title||"",g=b.autoplay&&0===a,k=b.boxart,l,m,n=c({"class":"player-postplay-character-still","data-id":b.id},l=d({"class":"player-postplay-character-still-scene-header"}),m=c({"class":"player-postplay-character-still-art"},
c({"class":"player-postplay-character-still-hover"})));return this._setUiContextForEl(m,{video_id:b.id,track_id:b.trackId,row:0,rank:a,location:"postplay",request_id:r.PostPlayData.getRequestId()}),k?m.style.cssText="background-image: url("+k+");":m.style.cssText="background: #ccc;",g?this._autoPlayTimer=r.ui.PostPlayTimer.create(l,{pluralTemplate:function(a){return t.getWithParams("ce-post-autoplay-character-test",["TITLE","SECONDS"],[f,a])},singularTemplate:function(){return t.getWithParams("ce-post-autoplay-character-test-singular",
["TITLE"],[f])},stoppedTemplate:function(){return f}}):l.innerHTML=f,n},_createEventSubscriptions:function(){this._super();this._sims.onHighlight().takeUntil(this._disposed).doAction(function(b){b=b&&b.getData&&b.getData()||{};this._autoPlayTimer&&this._autoPlayTimer.stop();this._background.source=b.background}.bind(this)).subscribe(k,u.getErrorHandler("Sims highlight error."),k);this._sims.onClick().takeUntil(this._disposed).doAction(this._playSim.bind(this)).subscribe(k,u.getErrorHandler("Sims click error."),
k)},_playSim:function(b){u.log("play next video",b.id);m.setNextVideo(m.CONSTANTS.EPISODE_ID,b.id,b.trackId);this._startPlayback(this._getUiContextForEl(b.el))}});b.create=function(c,a){return new b(c,a)};r.ui.PostPlayCharacterVideos=b})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.url,l=r.UiEvents,c=r.dom,d=c.get("DIV"),f=c.get("SECTION"),g=c.get("H1"),t=c.get("H2"),k=c.get("P"),u=c.get("IMG"),b=r.time,h=Rx.Observable,c=n.PostPlayBase,a=n.PostPlayBackground,w=n.PostPlayActionButtons,y,q=r.util.NOOP,p=r.Logger.create("subview.postplay.continue"),x=c.extend({init:function(){y=netflix.I18n;this._onSelectEpisode=this._onSelectEpisode.bind(this);this._super.apply(this,arguments);this._autoPlayTimer&&this._autoPlayTimer.start(function(){l.fireEvent(l.knownEvents.AUTOPLAY_NEXT_EPISODE,
[this._nextEpisode&&this._nextEpisode.id]);this._playNextEpisode(!0)}.bind(this))},_createElements:function(){this._super();var c=this._nextEpisode=this._metadata.list,h=y.getWithParams("ce-show-member-type-"+(c.memberType||"season"),["SEQ"],[c.seasonNumber])+" "+netflix.I18n.get("ce-episode-abbreviation")+" "+c.episodeNumber+" \u2013 "+c.title,l=c.duration&&c.duration.value,m=c.year+" "+(c.rating?c.rating:"")+(l?" "+b.convertUsingKey(l,!1,!0,"ce-time"):""),p=c.boxart,l=this._metadata.list;this._background=
c.background&&this._addComponent(a.createFromUrl(this._rootEl,c.background));this._footerEl=d({"class":"player-postplay-footer"},f({"class":"player-postplay-show-metadata"},d({"class":"postplay-metadata-container"},g({"class":"player-postplay-show-title"},document.createTextNode(c.showTitle)),t({"class":"player-postplay-episode-title"},document.createTextNode(h)),k({"class":"player-postplay-episode-metadata"},document.createTextNode(m)),k({"class":"player-postplay-episode-synopsis"},document.createTextNode(c.synopsis)))),
p=f({"class":"player-postplay-show-autoplay"},this._stillEl=d({"class":"postplay-still-container"},h=g({"class":"player-postplay-autoplay-header"}),u({"class":"player-postplay-autoplay-still",src:p}),d({"class":"player-postplay-still-hover-container"},u({"class":"player-postplay-still-hover",src:"https://assets.nflxext.com/en_us/buttons/play-button-114.png"})))));c.autoplay?this._autoPlayTimer=this._addComponent(r.ui.PostPlayTimer.create(h)):h.appendChild(document.createTextNode(y.get("ce-post-no-autoplay")));
this._actionButtons=this._addComponent(w.createBasic(p,"action-buttons episodic-action-buttons"));c=d({"class":"more-episodes-container"});this._moreEpisodesMenu=new r.ui.EpisodeSelectorMenuComponent(c,c,{id:"player-menu-episode-selector",showEvent:"click"});this._actionButtons.addButton({id:"meBtn",contentsEl:document.createTextNode(y.get("ce-post-more-episodes")),"class":"more-episodes",events:["click"]},c);this._actionButtons._rootEl.appendChild(c);this._playContext=this._setUiContextForEl(this._stillEl,
{video_id:l.id,track_id:l.trackId,row:0,rank:0,location:"postplay",request_id:r.PostPlayData.getRequestId()});this._rootEl.appendChild(this._footerEl)},_createEventSubscriptions:function(){this._super();h.fromEvent(this._stillEl,"click").takeUntil(this._disposed).doAction(this._playNextEpisode.bind(this,!1)).subscribe(q,p.getErrorHandler("still click"),q);h.fromEvent(this._moreEpisodesMenu,this._moreEpisodesMenu.CHANGE_VIDEO_EVENT).takeUntil(this._disposed).doAction(this._onSelectEpisode).subscribe(q,
p.getErrorHandler("episode selector handler"),q);this._actionButtons.onAction().takeUntil(this._disposed).doAction(function(){this._autoPlayTimer&&this._autoPlayTimer.stop()}.bind(this)).subscribe(q,p.getErrorHandler("action button handler"),q)},_onSelectEpisode:function(a){m.setNextVideo(m.CONSTANTS.EPISODE_ID,a.videoId,null);this._startPlayback()},_playNextEpisode:function(a){p.log("play next episode",this._nextEpisode.id);m.setNextVideo(m.CONSTANTS.EPISODE_ID,this._nextEpisode.id,this._nextEpisode.trackId);
var b=1E3*this._nextEpisode.offsetStart;0<=b&&r.objects.overrideBookmark(this._nextEpisode.id,a?b:0);this._startPlayback(this._playContext)},_returnToPlayback:function(){this._autoPlayTimer&&this._autoPlayTimer.stop();this._super()}});x.create=function(a,b){return new x(a,b)};r.ui.PostPlayContinueWatching=x})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.element,l=r.dom.DIV,c=n.PostPlayBase,d=n.PostPlayBackground,f=n.PostPlayActionButtons,g=n.PostPlaySimsCollection,t=r.objects,k=r.url,u,b=r.util.NOOP,h=r.Logger.create("subview.postplay.sims"),a=c.extend({init:function(){u=netflix.I18n;this._super.apply(this,arguments);this._sims.highlightSimAtIndex(0)},_createElements:function(){this._super();this._createSections();this._background=this._addComponent(d.create(this._rootEl));this._actionButtons=this._addComponent(f.createBasic(this._leftSection));
this._sims=this._addComponent(g.create(this._rightSection,this._getSims(),this._boxshotTemplate.bind(this)))},_createSections:function(){u=u||netflix.I18n;this._leftSection=m.create("section",{"class":"player-postplay-recommend-text"},this._rootEl);this._rightSection=m.create("div",{"class":"player-postplay-recommendations"},this._rootEl);var a=m.create("h1",{"class":"player-postplay-recommend-header"},this._leftSection),b=m.create("h2",{"class":"player-postplay-recommend-subheader"},this._leftSection);
a.appendChild(document.createTextNode(u.get("ce-post-recommend-head")));b.appendChild(document.createTextNode(u.get("ce-post-recommend-body")))},_boxshotTemplate:function(a,b){a=a||{};var c,d=l({"class":"player-postplay-recommendation","data-id":a.id},c=l({"class":"player-postplay-recommendation-boxshot"},l({"class":"player-postplay-recommendation-hover"})));return this._setUiContextForEl(c,{video_id:a.id,track_id:a.trackId,row:0,rank:b,location:"postplay",request_id:r.PostPlayData.getRequestId()}),
c.style.cssText="background-image: url("+a.boxart+");",d},_createEventSubscriptions:function(){this._super();this._sims.onHighlight().takeUntil(this._disposed).doAction(function(a){a=a.getData();this._background.source=a&&a.background}.bind(this)).subscribe(b,h.getErrorHandler("Sims highlight error."),b);this._sims.onClick().takeUntil(this._disposed).doAction(this._playSim.bind(this)).subscribe(b,h.getErrorHandler("Sims click error."),b)},_getSims:function(){return this._metadata&&this._metadata.list||
[]},_playSim:function(a){var b=a.data||{};k.setNextVideo(k.CONSTANTS.VIDEO_ID,"show"===b.type?b.episodeId:b.id,b.trackId);b=t.initParams()||{};a=this._getUiContextForEl(a.el);b.commentarySettings&&delete b.commentarySettings;this._startPlayback(a)}});a.create=function(b,c){return new a(b,c)};r.ui.PostPlaySims=a})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom.get("H2"),l=r.dom.DIV,c=r.ui.PostPlaySims,d=r.util.NOOP,f=r.mixins.ui.buttons,g=r.Logger.create("subview.postplay.sims.dab"),t=n.PostPlayActionButtons,k=n.PostPlayMyList,u=c.extend({init:function(){g.log("init");this._super.apply(this,arguments)},_createElements:function(){var b=this._metadata.experience;this._super();this._dabEl=l({"class":"postplay-promo postplay-dab"},l({"class":"promo-postplay-metadata"},l({"class":"logo",style:"background-image: url("+
b.horizontal+");"}),b.tagline&&m({"class":"tagline"},b.tagline)));this._actionButtons=this._addComponent(t.create(this._dabEl,[f.getMyListButton(b.myList.action),f.getMoreInfoButton()]));this._rootEl.appendChild(this._dabEl);this._myList=this._addComponent(k.create(this._rootEl,{myList:b.myList,trackId:b.trackId,element:this._rootEl.querySelector(".my-list")}))},_createEventSubscriptions:function(){this._super();this._actionButtons.onAction().takeUntil(this._disposed).doAction(function(b){switch(b.id){case f.MY_LIST_BUTTON:this._myList.toggleMyList();
break;case f.MORE_INFO_BUTTON:this._navToMoreInfo()}}.bind(this)).subscribe(d,g.getErrorHandler("actionButtons|onAction"),d)}});u.create=function(b,c){return new u(b,c)};n.PostPlaySimsDAB=u})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.mixins,l=n.PostPlaySimsDAB,c=r.Logger.create("subview.postplay.sims.specialmessage"),d=l.extend({init:function(){c.log("init");this._super.apply(this,arguments)},_createElements:function(){var c=this._metadata.experience;this._super();c.specialMessageEnabled&&this.addVideoInterstitialComponent({videoId:c.trailer.id,trackId:c.trailer.trackId,title:c.trailer.title,background:c.trailer.background,autoPlayTimer:c.trailer.autoPlayTimerOverride})},_createEventSubscriptions:function(){this._super();
this.createVideoInterstitialEvents()},_returnToPlayback:function(){this._handleInterstitialReturnToPlayback();this._super()}});d.create=function(c,g){return new d(c,g)};m.mixin(d.prototype,m.ui.videoInterstitial);n.PostPlaySimsSpecialMessage=d})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom,l=m.get("DIV"),c=m.get("SPAN"),d=r.PostPlayData,m=n.PostPlayBase,f=n.PostPlayBackground,g=n.PostPlayExitFullscreen,t=n.exitPlayback,k=r.Logger.create("subview.postplay.trailer.base"),u=r.url,b,h=r.animate,a=m.extend({_metadata:null,_background:null,_exitPlaybackButton:null,_exitFullScreenButton:null,_promoUiContext:null,init:function(a,c){k.log("init");b=netflix.I18n;this._videoCloseDelayTime=0;this._super(a,c)},destroy:function(){this._playerWrapperEl&&
h.fadeIn(this._playerWrapperEl);this._super()},show:function(){this._super();var a=this._metadata&&this._metadata.experience&&this._metadata.experience.impression;return a&&d.recordImpression(a),this},_createElements:function(){this._rootEl.classList.add("trailer-merch");var a=this._metadata.experience;this._exitPlaybackButton=this._addComponent(t).init(this._parentEl);this._background=this._addComponent(f.createFromUrl(this._rootEl,a.background));this._exitFullScreenButton=this._addComponent(g.create(this._parentEl));
t.getBackToBrowsingEl().classList.add("trailer-merch")},_playPromotedVideo:function(){var a=this._metadata.experience.promotedVideo.id;k.log("play promoted title",a);r.PostPlayData.deinit();this._playVideo(a)},_playTrailer:function(){var a=this._metadata.experience.trailerId;k.log("play trailer",a);this._playVideo(a)},_replayTrailer:function(){k.log("Replay trailer.");this._playerWrapperEl&&h.fadeIn(this._playerWrapperEl);r.PostPlayData.repeatCurrentPostPlayData();this._playTrailer()},_playVideo:function(a){u.setNextVideo(u.CONSTANTS.VIDEO_ID,
a,this._metadata.experience.trackId);this._startPlayback(this._promoUiContext)},_setPromoUiContextForEl:function(a,b){if(this._uiTrackingEnabled){b=b||{};var c={video_id:b.trailerId,track_id:b.trackId,row:0,rank:0,location:"postplay",request_id:d.getRequestId()};this._promoUiContext=c;r.UITracking.trackElement(a,c)}}});a.create=function(b,c){return new a(b,c)};a.getPlayPromotedVideoButton=function(a){return a=a||{},{id:"play-show",contentsEl:l({"class":"play-button-content"},c({"class":"play-button-text"},
null!=a.seasonNumber?b.getWithParams("ce-post-play-promo-episode",["SEASON","EPISODE"],[a.seasonNumber,a.episodeNumber]):b.get("ce-post-play-promo-title"))),"class":"play-button",events:["click"]}};a.getPlayTrailerButton=function(a){a=a||"play-button-trailer";var d=b.get("ce-post-play-trailer");return{id:"play-trailer",contentsEl:"play-button"===a?l({"class":"play-button-content"},c({"class":"play-button-text"},d)):document.createTextNode(d),"class":a,events:["click"]}};n.PostPlayTrailerBase=a})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom,l=m.get("DIV"),c=m.get("IMG"),d=m.get("H1"),f=m.get("P"),g=m.get("A");m.get("SPAN");var t=n.PostPlayTrailerBase,k=n.PostPlayActionButtons,u=n.PostPlayHorizontal,b=n.PostPlayMyList,h,a=r.util.NOOP,w=r.Logger.create("subview.postplay.trailer.merch"),y=r.mixins.ui.buttons,q=t.extend({init:function(a,b){w.log("init");h=netflix.I18n;this._super(a,b)},_createElements:function(){this._super();var a=this._metadata.experience,k,m=l({"class":"promo-postplay-metadata"},
k=c({"class":"logo"}),d({"class":"tagline"},a.tagline||""),a.synopsis&&f({"class":"synopsis"},a.synopsis,g({"class":"more-info",href:a.moreInfoLink},h.get("ce-post-more-info"))));a.logo&&k.setAttribute("src",a.logo);var n=function(){this._setPromoUiContextForEl(k,a)}.bind(this);k.width&&n();k.onload=n;this._horizontal=this._addComponent(u.create(this._rootEl,a));this._rootEl.appendChild(m);this._actionButtons=this._createButtons(m);this._myList=this._addComponent(b.create(this._rootEl,{myList:a.myList,
trackId:a.trackId,element:this._rootEl.querySelector(".my-list")}))},_createEventSubscriptions:function(){this._super();this._actionButtons.onAction().takeUntil(this._disposed).doAction(function(a){this._autoPlayTimer&&this._autoPlayTimer.stop();switch(a.id){case "play-trailer":this._playTrailer();break;case "play-show":this._playPromotedVideo();break;case y.MY_LIST_BUTTON:this._myList.toggleMyList();break;case y.MORE_INFO_BUTTON:this._navToMoreInfo()}}.bind(this)).subscribe(a,w.getErrorHandler("actionButtons|onAction"),
a)},_createButtons:function(a){var b=this._metadata.experience||{},b=[t.getPlayPromotedVideoButton(b.promotedVideo),t.getPlayTrailerButton(),y.getMyListButton(b.myList.action)];return k.create(a,b)}});q.create=function(a,b){return new q(a,b)};n.PostPlayTrailerMerch=q})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom,l=m.get("H1"),c=r.dom.get("H2"),d=m.get("SECTION"),f=n.PostPlayTrailerBase,g=n.PostPlayActionButtons,m=n.PostPlayTrailerMerch,t,k=r.Logger.create("subview.postplay.trailer.merch.post"),u=r.util.NOOP,b=Rx.Observable,h=r.mixins.ui.buttons,a=m.extend({init:function(a,b){k.log("init");t=netflix.I18n;this._super(a,b)},_createElements:function(){this._super();this._horizontal._rootEl.classList.remove("trailer-merch");this._rootEl.appendChild(d({"class":"trailer-recommend-text"},
l({"class":"trailer-recommend-header"},t.get("ce-post-original-promote-header")),c({"class":"trailer-recommend-subheader"},t.get("ce-post-original-promote-text"))))},_createEventSubscriptions:function(){this._super();b.fromEvent(this._horizontal._rootEl,"click").takeUntil(this._disposed).take(1).doAction(this._replayTrailer.bind(this)).subscribe(u,k.getErrorHandler("event|click"))},_createButtons:function(a){var b=this._metadata.experience,b=[f.getPlayPromotedVideoButton(b.promotedVideo),h.getMyListButton(b.myList.action)];
return g.create(a,b)}});a.create=function(b,c){return new a(b,c)};n.PostPlayTrailerMerchPost=a})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom.get("H2"),l=r.objects,c=n.PostPlayTrailerBase,d=n.PostPlayActionButtons,f=n.PostPlayTimer,g,t=r.Logger.create("subview.postplay.trailer.promo"),k=r.mixins.ui.buttons,u=n.PostPlayTrailerMerch.extend({init:function(b,c){t.log("init");g=netflix.I18n;this._super(b,c);l&&l.initParams();this._autoPlayTimer&&this._autoPlayTimer.start(this._playTrailer.bind(this))},_createElements:function(){this._super();var b=this._metadata.experience,c=this._rootEl.querySelector(".promo-postplay-metadata"),
a=m({"class":"autoplay-timer"});c.insertBefore(a,c.lastChild);b.autoplay&&(this._autoPlayTimer=f.create(a,{maxTime:b.autoplayTime,singularTemplate:function(){return g.get("ce-post-autoplay-prepromo-trailer-singular")},pluralTemplate:function(a){return g.getWithParams("ce-post-autoplay-prepromo-trailer-plural",["SECONDS"],[a])},stoppedTemplate:function(){return null}}))},_createButtons:function(b){var f=this._metadata.experience.myList,f=[c.getPlayTrailerButton("play-button"),k.getMyListButton(f.action)];
return d.create(b,f)}});u.create=function(b,c){return new u(b,c)};n.PostPlayTrailerPromo=u})();
(function(){var r=netflix.cadmium,n=r.ui,m=r.dom.get("DIV"),l=r.dom.get("H2"),c=n.PostPlayActionButtons,d=n.PostPlayBackground,f=n.PostPlaySimsCollection,g=n.PostPlayHorizontal,t=n.PostPlayTrailerMerch,k=n.PostPlaySims,u=n.PostPlayTrailerBase,b=n.PostPlayMyList,h=r.Logger.create("subview.postplay.trailer.promo.recs"),a=r.util.NOOP,w=Rx.Observable,y=r.mixins.ui.buttons,q=t.extend({init:function(a,b){h.log("init");this._super(a,b);this._sims.highlightSimAtIndex(0)},_createElements:function(){var a=
this._metadata.experience,c,h,n;u.prototype._createElements.call(this);k.prototype._createSections.call(this);this._background=this._addComponent(d.create(this._rootEl));this._sims=this._addComponent(f.create(this._rightSection,this._getSims(),this._boxshotTemplate.bind(this)));this._promoEl=m({"class":"postplay-promo"},c=m({"class":"postplay-promo-horizontal-container"}),h=m({"class":"promo-postplay-metadata"},n=m({"class":"logo",style:"background-image: url("+a.logo+");"}),l({"class":"tagline"},
a.tagline)));this._setPromoUiContextForEl(n,a);this._horizontal=this._addComponent(g.create(c,a));this._actionButtons=this._addComponent(this._createButtons(h));this._myList=this._addComponent(b.create(this._rootEl,{myList:a.myList,trackId:a.trackId,element:h.querySelector(".my-list")}));this._horizontal._rootEl.classList.remove("trailer-merch");this._rootEl.appendChild(this._promoEl)},_boxshotTemplate:function(a,b){a=a||{};var c=k.prototype._boxshotTemplate.apply(this,arguments),d=c.querySelector(".player-postplay-recommendation-boxshot");
return this._setUiContextForEl(d,{video_id:a.id,track_id:a.trackId,row:1,rank:b,request_id:r.PostPlayData.getRequestId(),location:"postplay"}),c},_getSims:function(){var a=this._metadata||{};return a.experience&&a.experience.recommendations||a.experience.recommendations||[]},_createEventSubscriptions:function(){this._super();this._sims.onHighlight().takeUntil(this._disposed).doAction(function(a){a=a.getData();this._background.source=a&&a.background}.bind(this)).subscribe(a,h.getErrorHandler("sims|onHighlight"),
a);this._sims.onClick().takeUntil(this._disposed).doAction(function(a){r.PostPlayData.deinit();k.prototype._playSim.call(this,a)}.bind(this)).subscribe(a,h.getErrorHandler("sims|onClick"),a);w.fromEvent(this._horizontal._rootEl,"click").takeUntil(this._disposed).take(1).doAction(this._replayTrailer.bind(this)).subscribe(a,h.getErrorHandler("event|click"))},_createButtons:function(a){return this._addComponent(c.create(a,[y.getMyListButton(this._metadata.experience.myList.action),y.getMoreInfoButton()]))}});
q.create=function(a,b){return new q(a,b)};n.PostPlayTrailerPromoRecs=q})();
(function(){function r(){w.info("Failed to get post play data. Falling back...")}function n(){c=netflix.cadmium;d=c.views;f=c.objects;g=c.element;t=c.UiEvents;k=Rx.Observable;u=c.dom.DIV;b=c.PostPlayData;a=c.util.NOOP;w=w||c.Logger.create("view.postplay.factory")}function m(){y&&(w.log("destroy"),A&&A.onNext(),A=null,p.classList.remove(F),p.classList.remove("player-postplay-video-ended"),x&&x.destroy(),g.remove(q),w=a=h=b=u=k=t=g=f=d=c=x=q=p=null,y=!1)}function l(a){return a&&a.experience&&a.experience.myList&&
a.type===D.POST_TRAILER_MERCH||a.type===D.POST_PROMO_PHASE?(w.log("Getting my list status."),c.ui.PostPlayMyList.getCurrentState(a.experience.myList).map(function(b){return a.experience.myList.action=b.action,a})):k.return(a)}"use strict";var c,d,f,g,t,k,u,b,h,a,w,y=!1,q,p,x,A,F="player-postplay",D=Object.freeze({WATCH_NEXT:"watchNext",SIMILARS:"recommendations",SIMILARS_DAB:"recommendationsDAB",SIMILARS_SPECIAL_MESSAGE:"specialMessage",CHARACTER:"character",TRAILER_MERCH:"trailerMerch",POST_TRAILER_MERCH:"postTrailerMerch",
PROMO_PHASE:"promoTrailerMerch",POST_PROMO_PHASE:"postPromoTrailer"});netflix.cadmium.ui.PostPlay={preinit:function(f){n();w.log("preinit");k.fromEvent(t,t.knownEvents.VIDEO_ENDED).doAction(function(){w.log("postplay fallback. videoEnded; going back home.");r()});b.getData().flatMap(l).doAction(function(a){d.show(c.ui.PostPlay,[f,a])}).subscribe(a,w.getErrorHandler("preinit.postplayexperience"),a)},init:function(a,b){y&&m();A=A||new Rx.Subject;n();w.log("init");q=u({"class":"player-postplay"});p=
a;h=f.videoPlayer();h.getElement();a:{w.log("createPostPlayExperience");w.log("createPostPlayExperience.doAction",b.type);var d;switch(b.type){case D.WATCH_NEXT:d=c.ui.PostPlayContinueWatching;break;case D.CHARACTER:d=c.ui.PostPlayCharacterVideos;break;case D.TRAILER_MERCH:d=c.ui.PostPlayTrailerMerch;break;case D.POST_TRAILER_MERCH:d=c.ui.PostPlayTrailerMerchPost;break;case D.PROMO_PHASE:d=c.ui.PostPlayTrailerPromo;break;case D.POST_PROMO_PHASE:d=c.ui.PostPlayTrailerPromoRecs;break;case D.SIMILARS:d=
c.ui.PostPlaySims;break;case D.SIMILARS_DAB:d=c.ui.PostPlaySimsDAB;break;case D.SIMILARS_SPECIAL_MESSAGE:d=c.ui.PostPlaySimsSpecialMessage;break;default:w.error("Could not create a post play experience for "+b.type);r();break a}x=d.create(p,b).show();p.classList.add(F)}y=!0},deinit:m};netflix.cadmium.views.register(netflix.cadmium.ui.PostPlay,netflix.cadmium.views.types.standard)})();
(function(){var r=netflix.cadmium,n=r.element,m=r.Logger.create("loader.manager"),l=r.metadata,c=r.UiEvents,d=r.objects,f=Rx.Observable,g=r.ui.pinentry,t=r.session,k=r.PostPlayData,u=r.util.NOOP,b=r.Eventable.extend({parentNode:null,rootEl:null,knownEvents:Object.freeze({METADATA_READY:"metadataReady",START_LOAD:"startLoad",PROGRESS_CHANGED:"progressChanged"}),_initialized:!1,_components:[],_disposed:null,_videoPlayer:null,_videoDOMNodesAvailable:!1,_attemptedBuffering:!1,_bookmarkOverride:null,_loadingVideoId:null,
_attemptLoadVideo:function(){this._initialized&&(m.log("attemptLoadVideo",{attemptedBuffering:this._attemptedBuffering,id:this._loadingVideoId}),!this._attemptedBuffering&&null!==this._loadingVideoId&&(this._attemptedBuffering=!0,m.log("attemptLoadVideo, create video player",{attemptedBuffering:this._attemptedBuffering,id:this._loadingVideoId}),d.createVideoPlayer(d.videoId(),d.trackId(),function(a,b){a||(this._videoPlayer=b,f.fromEvent(this._videoPlayer,"busychanged").takeUntil(this._disposed).doAction(this._busyChangedHandler).subscribe(u,
function(a){console.error(a)},u),f.fromEvent(this._videoPlayer,"loaded").take(1).takeUntil(this._disposed).doAction(this._loadedVideoHandler).subscribe(u,function(a){console.error(a)},u))}.bind(this))))},_loadedVideoHandler:function(){this._initialized&&(c.fireEvent(c.knownEvents.VIDEO_FIRST_PLAY),m.log("video start time: "+performance.now().toFixed(2)+"ms"),r.views.show(r.ui.playback,[this.parentNode]),k.init())},_busyChangedHandler:function(){if(this._initialized){var a=d.videoPlayer().getBusy()||
{};this.fireEvent(this.knownEvents.PROGRESS_CHANGED,[{progress:a.progress,isStalled:a.networkStalled}])}},_metadataLoadedHandler:function(){this._initialized&&(null===this._loadingVideoId&&(this._loadingVideoId=l.getActiveVideo().id,d.setVideoId(this._loadingVideoId)),this.fireEvent(this.knownEvents.METADATA_READY))},_checkMetadataForId:function(a){if(this._initialized){var b=l.getActiveVideo();b&&b.id===a&&this._metadataLoadedHandler()}},_preparePlayableAndTrackId:function(a){if(this._initialized){var b,
c,f=r.ui.preplay.preplayNeeded();f?(b=a.recap.movieId,c=a.preplay.trackId):(b=a.episodeId||a.movieId||a.videoId||null,c=a.trackingId);this._loadingVideoId=b;d.setVideoId(b);d.setTrackId(c||0);null!==this._loadingVideoId?f?this.fireEvent(this.knownEvents.METADATA_READY):this._checkMetadataForId(this._loadingVideoId):this._checkMetadataForId(a.videoId)}},_verifyPinThenStartPlayback:function(){var a=this,b=f.fromEvent(this,this.knownEvents.METADATA_READY).map(function(){return l.getActiveVideo()}),c=
f.return(l.getActiveVideo());f.merge(b,c).takeUntil(this._disposed).filter(function(a){return!!a}).take(1).flatMap(function(b){return b&&b.requiresPin?g.show(a.rootEl,!0).map(function(a){return!a||!a.pinStatus||a.pinStatus!==g.CANCELED}).doAction(function(a){a&&t.setSessionData(t.SESSION_TYPES.PIN,!0)}):f.return(!0)}).doAction(function(b){b?a._attemptLoadVideo():r.ui.master.goBackToBrowsing()}).subscribe(u,function(a){var b=netflix&&netflix.cadmium&&netflix.cadmium.ui&&netflix.cadmium.ui.errors||
{};b.throwUIError&&b.throwUIError(b.type.UI_UNKNOWN);m.error(a)},u)},init:function(a,b){if(a){b=b||{};this._disposed=new Rx.Subject;this._initialized&&this.destroy();this._initialized=!0;this._super();var d=b.initParams||{},g=b.components,h=this;this.parentNode=a;this.rootEl=n.create("section",{"class":"loading-view-v2"},this.parentNode);g&&0<g.length&&(this._components=[],g.forEach(function(a){this._components.push(a.create(this,b))},this));this.fireEvent(this.knownEvents.START_LOAD);this._loadedVideoHandler=
this._loadedVideoHandler.bind(this);this._busyChangedHandler=this._busyChangedHandler.bind(this);this._metadataLoadedHandler=this._metadataLoadedHandler.bind(this);f.fromEvent(c,c.knownEvents.NEW_PLAYER_DOM_CREATED).takeUntil(this._disposed).doAction(function(){h._initialized&&(h._videoDOMNodesAvailable=!0)}).subscribe(u,m.getErrorHandler("event|NEW_PLAYER_DOM_CREATED"),u);f.fromEvent(c,c.knownEvents.METADATA_LOADED).takeUntil(this._disposed).doAction(this._metadataLoadedHandler).subscribe(u,m.getErrorHandler("event|METADATA_LOADED"),
u);this._preparePlayableAndTrackId(d);d.pinConfig&&d.pinConfig.isEnabled?t.isExpired(t.SESSION_TYPES.PIN)?this._verifyPinThenStartPlayback():(t.setSessionData(t.SESSION_TYPES.PIN,!0),this._attemptLoadVideo()):this._attemptLoadVideo()}},destroy:function(){this._initialized&&(this._disposed.onNext(),n.remove(this.rootEl),this._components&&this._components.forEach(function(a){a&&a.destroy()}),this._components=this.events=this.parentNode=this.rootEl=null,this._attemptedBuffering=this._videoDOMNodesAvailable=
!1,this._disposed=this._videoPlayer=this._loadingVideoId=this._bookmarkOverride=null,this._initialized=!1)}}),h=function(){var a=new b;return{init:function(b,c){var d=[r.ui.LoaderMetadata,r.ui.LoaderProgress];netflix.cadmium&&netflix.cadmium.ui&&netflix.cadmium.ui.master&&netflix.cadmium.ui.master.isAkira()&&d.push(r.ui.ExitPlaybackComponent);a.init(b,{initParams:c,components:d})},deinit:a.destroy.bind(a)}}();netflix.cadmium.views.register(h,netflix.cadmium.views.types.standard);var a=function(){var a=
new b;return{init:function(b,c){a.init(b,{initParams:c,components:[r.ui.LoaderProgressPrePlay]})},deinit:a.destroy.bind(a)}}();netflix.cadmium.views.register(a,netflix.cadmium.views.types.standard);r.ui.loader={create:function(b){var c;return r.ui.preplay.preplayNeeded()?c=a:c=h,c}}})();
